<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.0.0"/>
    <title>xtquant.xtbson.bson37 API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../xtbson.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;xtquant.xtbson</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="variable" href="#ALL_UUID_SUBTYPES">ALL_UUID_SUBTYPES</a>
            </li>
            <li>
                    <a class="variable" href="#CSHARP_LEGACY">CSHARP_LEGACY</a>
            </li>
            <li>
                    <a class="variable" href="#JAVA_LEGACY">JAVA_LEGACY</a>
            </li>
            <li>
                    <a class="variable" href="#OLD_UUID_SUBTYPE">OLD_UUID_SUBTYPE</a>
            </li>
            <li>
                    <a class="variable" href="#STANDARD">STANDARD</a>
            </li>
            <li>
                    <a class="variable" href="#UUID_SUBTYPE">UUID_SUBTYPE</a>
            </li>
            <li>
                    <a class="class" href="#Binary">Binary</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Binary.from_uuid">from_uuid</a>
                        </li>
                        <li>
                                <a class="function" href="#Binary.as_uuid">as_uuid</a>
                        </li>
                        <li>
                                <a class="variable" href="#Binary.subtype">subtype</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#UuidRepresentation">UuidRepresentation</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#UuidRepresentation.UNSPECIFIED">UNSPECIFIED</a>
                        </li>
                        <li>
                                <a class="variable" href="#UuidRepresentation.STANDARD">STANDARD</a>
                        </li>
                        <li>
                                <a class="variable" href="#UuidRepresentation.PYTHON_LEGACY">PYTHON_LEGACY</a>
                        </li>
                        <li>
                                <a class="variable" href="#UuidRepresentation.JAVA_LEGACY">JAVA_LEGACY</a>
                        </li>
                        <li>
                                <a class="variable" href="#UuidRepresentation.CSHARP_LEGACY">CSHARP_LEGACY</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Code">Code</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Code.scope">scope</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#DEFAULT_CODEC_OPTIONS">DEFAULT_CODEC_OPTIONS</a>
            </li>
            <li>
                    <a class="class" href="#CodecOptions">CodecOptions</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#CodecOptions.with_options">with_options</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DBRef">DBRef</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DBRef.__init__">DBRef</a>
                        </li>
                        <li>
                                <a class="variable" href="#DBRef.collection">collection</a>
                        </li>
                        <li>
                                <a class="variable" href="#DBRef.id">id</a>
                        </li>
                        <li>
                                <a class="variable" href="#DBRef.database">database</a>
                        </li>
                        <li>
                                <a class="function" href="#DBRef.as_doc">as_doc</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Decimal128">Decimal128</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Decimal128.__init__">Decimal128</a>
                        </li>
                        <li>
                                <a class="function" href="#Decimal128.to_decimal">to_decimal</a>
                        </li>
                        <li>
                                <a class="function" href="#Decimal128.from_bid">from_bid</a>
                        </li>
                        <li>
                                <a class="variable" href="#Decimal128.bid">bid</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#InvalidBSON">InvalidBSON</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#InvalidDocument">InvalidDocument</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#InvalidStringData">InvalidStringData</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#Int64">Int64</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#MaxKey">MaxKey</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#MinKey">MinKey</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#ObjectId">ObjectId</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ObjectId.__init__">ObjectId</a>
                        </li>
                        <li>
                                <a class="function" href="#ObjectId.from_datetime">from_datetime</a>
                        </li>
                        <li>
                                <a class="function" href="#ObjectId.is_valid">is_valid</a>
                        </li>
                        <li>
                                <a class="variable" href="#ObjectId.binary">binary</a>
                        </li>
                        <li>
                                <a class="variable" href="#ObjectId.generation_time">generation_time</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Regex">Regex</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Regex.__init__">Regex</a>
                        </li>
                        <li>
                                <a class="function" href="#Regex.from_native">from_native</a>
                        </li>
                        <li>
                                <a class="variable" href="#Regex.pattern">pattern</a>
                        </li>
                        <li>
                                <a class="function" href="#Regex.try_compile">try_compile</a>
                        </li>
                        <li>
                                <a class="variable" href="#Regex.flags">flags</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#RE_TYPE">RE_TYPE</a>
            </li>
            <li>
                    <a class="class" href="#SON">SON</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SON.copy">copy</a>
                        </li>
                        <li>
                                <a class="function" href="#SON.has_key">has_key</a>
                        </li>
                        <li>
                                <a class="function" href="#SON.iterkeys">iterkeys</a>
                        </li>
                        <li>
                                <a class="function" href="#SON.itervalues">itervalues</a>
                        </li>
                        <li>
                                <a class="function" href="#SON.values">values</a>
                        </li>
                        <li>
                                <a class="function" href="#SON.clear">clear</a>
                        </li>
                        <li>
                                <a class="function" href="#SON.setdefault">setdefault</a>
                        </li>
                        <li>
                                <a class="function" href="#SON.pop">pop</a>
                        </li>
                        <li>
                                <a class="function" href="#SON.popitem">popitem</a>
                        </li>
                        <li>
                                <a class="function" href="#SON.update">update</a>
                        </li>
                        <li>
                                <a class="function" href="#SON.get">get</a>
                        </li>
                        <li>
                                <a class="function" href="#SON.to_dict">to_dict</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Timestamp">Timestamp</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Timestamp.__init__">Timestamp</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timestamp.time">time</a>
                        </li>
                        <li>
                                <a class="variable" href="#Timestamp.inc">inc</a>
                        </li>
                        <li>
                                <a class="function" href="#Timestamp.as_datetime">as_datetime</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#utc">utc</a>
            </li>
            <li>
                    <a class="variable" href="#EPOCH_AWARE">EPOCH_AWARE</a>
            </li>
            <li>
                    <a class="variable" href="#EPOCH_NAIVE">EPOCH_NAIVE</a>
            </li>
            <li>
                    <a class="variable" href="#BSONNUM">BSONNUM</a>
            </li>
            <li>
                    <a class="variable" href="#BSONSTR">BSONSTR</a>
            </li>
            <li>
                    <a class="variable" href="#BSONOBJ">BSONOBJ</a>
            </li>
            <li>
                    <a class="variable" href="#BSONARR">BSONARR</a>
            </li>
            <li>
                    <a class="variable" href="#BSONBIN">BSONBIN</a>
            </li>
            <li>
                    <a class="variable" href="#BSONUND">BSONUND</a>
            </li>
            <li>
                    <a class="variable" href="#BSONOID">BSONOID</a>
            </li>
            <li>
                    <a class="variable" href="#BSONBOO">BSONBOO</a>
            </li>
            <li>
                    <a class="variable" href="#BSONDAT">BSONDAT</a>
            </li>
            <li>
                    <a class="variable" href="#BSONNUL">BSONNUL</a>
            </li>
            <li>
                    <a class="variable" href="#BSONRGX">BSONRGX</a>
            </li>
            <li>
                    <a class="variable" href="#BSONREF">BSONREF</a>
            </li>
            <li>
                    <a class="variable" href="#BSONCOD">BSONCOD</a>
            </li>
            <li>
                    <a class="variable" href="#BSONSYM">BSONSYM</a>
            </li>
            <li>
                    <a class="variable" href="#BSONCWS">BSONCWS</a>
            </li>
            <li>
                    <a class="variable" href="#BSONINT">BSONINT</a>
            </li>
            <li>
                    <a class="variable" href="#BSONTIM">BSONTIM</a>
            </li>
            <li>
                    <a class="variable" href="#BSONLON">BSONLON</a>
            </li>
            <li>
                    <a class="variable" href="#BSONDEC">BSONDEC</a>
            </li>
            <li>
                    <a class="variable" href="#BSONMIN">BSONMIN</a>
            </li>
            <li>
                    <a class="variable" href="#BSONMAX">BSONMAX</a>
            </li>
            <li>
                    <a class="function" href="#get_data_and_view">get_data_and_view</a>
            </li>
            <li>
                    <a class="function" href="#gen_list_name">gen_list_name</a>
            </li>
            <li>
                    <a class="function" href="#encode">encode</a>
            </li>
            <li>
                    <a class="function" href="#decode">decode</a>
            </li>
            <li>
                    <a class="function" href="#decode_all">decode_all</a>
            </li>
            <li>
                    <a class="function" href="#decode_iter">decode_iter</a>
            </li>
            <li>
                    <a class="function" href="#decode_file_iter">decode_file_iter</a>
            </li>
            <li>
                    <a class="function" href="#is_valid">is_valid</a>
            </li>
            <li>
                    <a class="class" href="#BSON">BSON</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#BSON.encode">encode</a>
                        </li>
                        <li>
                                <a class="function" href="#BSON.decode">decode</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#has_c">has_c</a>
            </li>
            <li>
                    <a class="class" href="#DatetimeConversion">DatetimeConversion</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#DatetimeConversion.DATETIME">DATETIME</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatetimeConversion.DATETIME_CLAMP">DATETIME_CLAMP</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatetimeConversion.DATETIME_MS">DATETIME_MS</a>
                        </li>
                        <li>
                                <a class="variable" href="#DatetimeConversion.DATETIME_AUTO">DATETIME_AUTO</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#DatetimeMS">DatetimeMS</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#DatetimeMS.__init__">DatetimeMS</a>
                        </li>
                        <li>
                                <a class="function" href="#DatetimeMS.as_datetime">as_datetime</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../xtquant.html">xtquant</a><wbr>.<a href="./../xtbson.html">xtbson</a><wbr>.bson37    </h1>

                        <div class="docstring"><p>BSON (Binary JSON) encoding and decoding.</p>

<p>The mapping from Python types to BSON types is as follows:</p>

<p>=======================================  =============  ===================
Python Type                              BSON Type      Supported Direction
=======================================  =============  ===================
None                                     null           both
bool                                     boolean        both
int <sup class="footnote-ref" id="fnref-int"><a href="#fn-int">1</a></sup>                              int32 / int64  py -> bson
<code>bson.int64.Int64</code>                       int64          both
float                                    number (real)  both
str                                      string         both
list                                     array          both
dict / <code><a href="#SON">SON</a></code>                             object         both
datetime.datetime <sup class="footnote-ref" id="fnref-dt"><a href="#fn-dt">2</a></sup> <sup class="footnote-ref" id="fnref-dt2"><a href="#fn-dt2">3</a></sup>         date           both
<code>bson.regex.Regex</code>                       regex          both
compiled re <sup class="footnote-ref" id="fnref-re"><a href="#fn-re">4</a></sup>                       regex          py -> bson
<code>bson.binary.Binary</code>                     binary         both
<code>bson.objectid.ObjectId</code>                 oid            both
<code>bson.dbref.DBRef</code>                       dbref          both
None                                     undefined      bson -> py
<code>bson.code.Code</code>                         code           both
str                                      symbol         bson -> py
bytes <sup class="footnote-ref" id="fnref-bytes"><a href="#fn-bytes">5</a></sup>                          binary         both
=======================================  =============  ===================</p>

<div class="footnotes">
<hr />
<ol>
<li id="fn-int">
<p>A Python int will be saved as a BSON int32 or BSON int64 depending
on its size. A BSON int32 will always decode to a Python int. A BSON
int64 will always decode to a <code>~bson.int64.Int64</code>.&#160;<a href="#fnref-int" class="footnoteBackLink" title="Jump back to footnote 1 in the text.">&#8617;</a></p>
</li>

<li id="fn-dt">
<p>datetime.datetime instances will be rounded to the nearest
millisecond when saved&#160;<a href="#fnref-dt" class="footnoteBackLink" title="Jump back to footnote 2 in the text.">&#8617;</a></p>
</li>

<li id="fn-dt2">
<p>all datetime.datetime instances are treated as <em>naive</em>. clients
should always use UTC.&#160;<a href="#fnref-dt2" class="footnoteBackLink" title="Jump back to footnote 3 in the text.">&#8617;</a></p>
</li>

<li id="fn-re">
<p><code>~bson.regex.Regex</code> instances and regular expression
objects from <code>re.compile()</code> are both saved as BSON regular expressions.
BSON regular expressions are decoded as <code>~bson.regex.Regex</code>
instances.&#160;<a href="#fnref-re" class="footnoteBackLink" title="Jump back to footnote 4 in the text.">&#8617;</a></p>
</li>

<li id="fn-bytes">
<p>The bytes type is encoded as BSON binary with
subtype 0. It will be decoded back to bytes.&#160;<a href="#fnref-bytes" class="footnoteBackLink" title="Jump back to footnote 5 in the text.">&#8617;</a></p>
</li>
</ol>
</div>
</div>

                        <input id="mod-bson37-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-bson37-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="c1"># Copyright 2009-present MongoDB, Inc.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="c1">#</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="c1"># you may not use this file except in compliance with the License.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="c1"># You may obtain a copy of the License at</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="c1">#</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="c1"># http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="c1">#</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="c1"># See the License for the specific language governing permissions and</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="c1"># limitations under the License.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="sd">&quot;&quot;&quot;BSON (Binary JSON) encoding and decoding.</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="sd">The mapping from Python types to BSON types is as follows:</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="sd">=======================================  =============  ===================</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="sd">Python Type                              BSON Type      Supported Direction</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="sd">=======================================  =============  ===================</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="sd">None                                     null           both</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd">bool                                     boolean        both</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="sd">int [#int]_                              int32 / int64  py -&gt; bson</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">`bson.int64.Int64`                       int64          both</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="sd">float                                    number (real)  both</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="sd">str                                      string         both</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">list                                     array          both</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">dict / `SON`                             object         both</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">datetime.datetime [#dt]_ [#dt2]_         date           both</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">`bson.regex.Regex`                       regex          both</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">compiled re [#re]_                       regex          py -&gt; bson</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">`bson.binary.Binary`                     binary         both</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">`bson.objectid.ObjectId`                 oid            both</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">`bson.dbref.DBRef`                       dbref          both</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">None                                     undefined      bson -&gt; py</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">`bson.code.Code`                         code           both</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">str                                      symbol         bson -&gt; py</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">bytes [#bytes]_                          binary         both</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">=======================================  =============  ===================</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">.. [#int] A Python int will be saved as a BSON int32 or BSON int64 depending</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">   on its size. A BSON int32 will always decode to a Python int. A BSON</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="sd">   int64 will always decode to a :class:`~bson.int64.Int64`.</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">.. [#dt] datetime.datetime instances will be rounded to the nearest</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">   millisecond when saved</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">.. [#dt2] all datetime.datetime instances are treated as *naive*. clients</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a><span class="sd">   should always use UTC.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">.. [#re] :class:`~bson.regex.Regex` instances and regular expression</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="sd">   objects from ``re.compile()`` are both saved as BSON regular expressions.</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a><span class="sd">   BSON regular expressions are decoded as :class:`~bson.regex.Regex`</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a><span class="sd">   instances.</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a><span class="sd">.. [#bytes] The bytes type is encoded as BSON binary with</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a><span class="sd">   subtype 0. It will be decoded back to bytes.</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a><span class="kn">import</span> <span class="nn">datetime</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="kn">import</span> <span class="nn">itertools</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="kn">import</span> <span class="nn">re</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="kn">import</span> <span class="nn">struct</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a><span class="kn">import</span> <span class="nn">uuid</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="kn">from</span> <span class="nn">codecs</span> <span class="kn">import</span> <span class="n">utf_8_decode</span> <span class="k">as</span> <span class="n">_utf_8_decode</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="kn">from</span> <span class="nn">codecs</span> <span class="kn">import</span> <span class="n">utf_8_encode</span> <span class="k">as</span> <span class="n">_utf_8_encode</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">abc</span> <span class="k">as</span> <span class="n">_abc</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>    <span class="n">IO</span><span class="p">,</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>    <span class="n">TYPE_CHECKING</span><span class="p">,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>    <span class="n">Any</span><span class="p">,</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>    <span class="n">BinaryIO</span><span class="p">,</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>    <span class="n">Callable</span><span class="p">,</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>    <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>    <span class="n">Generator</span><span class="p">,</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>    <span class="n">Iterator</span><span class="p">,</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>    <span class="n">List</span><span class="p">,</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>    <span class="n">Mapping</span><span class="p">,</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>    <span class="n">MutableMapping</span><span class="p">,</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>    <span class="n">NoReturn</span><span class="p">,</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>    <span class="n">Optional</span><span class="p">,</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>    <span class="n">Sequence</span><span class="p">,</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>    <span class="n">Tuple</span><span class="p">,</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>    <span class="n">Type</span><span class="p">,</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>    <span class="n">TypeVar</span><span class="p">,</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>    <span class="n">Union</span><span class="p">,</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>    <span class="n">cast</span><span class="p">,</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a><span class="p">)</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a><span class="kn">from</span> <span class="nn">.binary</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>    <span class="n">ALL_UUID_SUBTYPES</span><span class="p">,</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>    <span class="n">CSHARP_LEGACY</span><span class="p">,</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>    <span class="n">JAVA_LEGACY</span><span class="p">,</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>    <span class="n">OLD_UUID_SUBTYPE</span><span class="p">,</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>    <span class="n">STANDARD</span><span class="p">,</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>    <span class="n">UUID_SUBTYPE</span><span class="p">,</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>    <span class="n">Binary</span><span class="p">,</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>    <span class="n">UuidRepresentation</span><span class="p">,</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a><span class="p">)</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a><span class="kn">from</span> <span class="nn">.code</span> <span class="kn">import</span> <span class="n">Code</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a><span class="kn">from</span> <span class="nn">.codec_options</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>    <span class="n">DEFAULT_CODEC_OPTIONS</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>    <span class="n">CodecOptions</span><span class="p">,</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>    <span class="n">DatetimeConversion</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>    <span class="n">_DocumentType</span><span class="p">,</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>    <span class="n">_raw_document_class</span><span class="p">,</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="p">)</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="kn">from</span> <span class="nn">.datetime_ms</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>    <span class="n">EPOCH_AWARE</span><span class="p">,</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>    <span class="n">EPOCH_NAIVE</span><span class="p">,</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>    <span class="n">DatetimeMS</span><span class="p">,</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>    <span class="n">_datetime_to_millis</span><span class="p">,</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>    <span class="n">_millis_to_datetime</span><span class="p">,</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>    <span class="n">utc</span><span class="p">,</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="p">)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="kn">from</span> <span class="nn">.dbref</span> <span class="kn">import</span> <span class="n">DBRef</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="kn">from</span> <span class="nn">.decimal128</span> <span class="kn">import</span> <span class="n">Decimal128</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="kn">from</span> <span class="nn">.errors</span> <span class="kn">import</span> <span class="n">InvalidBSON</span><span class="p">,</span> <span class="n">InvalidDocument</span><span class="p">,</span> <span class="n">InvalidStringData</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="kn">from</span> <span class="nn">.int64</span> <span class="kn">import</span> <span class="n">Int64</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="kn">from</span> <span class="nn">.max_key</span> <span class="kn">import</span> <span class="n">MaxKey</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="kn">from</span> <span class="nn">.min_key</span> <span class="kn">import</span> <span class="n">MinKey</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="kn">from</span> <span class="nn">.objectid</span> <span class="kn">import</span> <span class="n">ObjectId</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="kn">from</span> <span class="nn">.regex</span> <span class="kn">import</span> <span class="n">Regex</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="kn">from</span> <span class="nn">.son</span> <span class="kn">import</span> <span class="n">RE_TYPE</span><span class="p">,</span> <span class="n">SON</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="kn">from</span> <span class="nn">.timestamp</span> <span class="kn">import</span> <span class="n">Timestamp</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="c1"># Import some modules for type-checking only.</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>    <span class="kn">from</span> <span class="nn">mmap</span> <span class="kn">import</span> <span class="n">mmap</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="k">try</span><span class="p">:</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>    <span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_cbson</span>  <span class="c1"># type: ignore[attr-defined]</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>    <span class="n">_USE_C</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>    <span class="n">_USE_C</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>    <span class="s2">&quot;ALL_UUID_SUBTYPES&quot;</span><span class="p">,</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>    <span class="s2">&quot;CSHARP_LEGACY&quot;</span><span class="p">,</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>    <span class="s2">&quot;JAVA_LEGACY&quot;</span><span class="p">,</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>    <span class="s2">&quot;OLD_UUID_SUBTYPE&quot;</span><span class="p">,</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>    <span class="s2">&quot;STANDARD&quot;</span><span class="p">,</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>    <span class="s2">&quot;UUID_SUBTYPE&quot;</span><span class="p">,</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>    <span class="s2">&quot;Binary&quot;</span><span class="p">,</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>    <span class="s2">&quot;UuidRepresentation&quot;</span><span class="p">,</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>    <span class="s2">&quot;Code&quot;</span><span class="p">,</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>    <span class="s2">&quot;DEFAULT_CODEC_OPTIONS&quot;</span><span class="p">,</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>    <span class="s2">&quot;CodecOptions&quot;</span><span class="p">,</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>    <span class="s2">&quot;DBRef&quot;</span><span class="p">,</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>    <span class="s2">&quot;Decimal128&quot;</span><span class="p">,</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>    <span class="s2">&quot;InvalidBSON&quot;</span><span class="p">,</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>    <span class="s2">&quot;InvalidDocument&quot;</span><span class="p">,</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>    <span class="s2">&quot;InvalidStringData&quot;</span><span class="p">,</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>    <span class="s2">&quot;Int64&quot;</span><span class="p">,</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>    <span class="s2">&quot;MaxKey&quot;</span><span class="p">,</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>    <span class="s2">&quot;MinKey&quot;</span><span class="p">,</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>    <span class="s2">&quot;ObjectId&quot;</span><span class="p">,</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>    <span class="s2">&quot;Regex&quot;</span><span class="p">,</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>    <span class="s2">&quot;RE_TYPE&quot;</span><span class="p">,</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>    <span class="s2">&quot;SON&quot;</span><span class="p">,</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>    <span class="s2">&quot;Timestamp&quot;</span><span class="p">,</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>    <span class="s2">&quot;utc&quot;</span><span class="p">,</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>    <span class="s2">&quot;EPOCH_AWARE&quot;</span><span class="p">,</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>    <span class="s2">&quot;EPOCH_NAIVE&quot;</span><span class="p">,</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>    <span class="s2">&quot;BSONNUM&quot;</span><span class="p">,</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>    <span class="s2">&quot;BSONSTR&quot;</span><span class="p">,</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>    <span class="s2">&quot;BSONOBJ&quot;</span><span class="p">,</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>    <span class="s2">&quot;BSONARR&quot;</span><span class="p">,</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>    <span class="s2">&quot;BSONBIN&quot;</span><span class="p">,</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>    <span class="s2">&quot;BSONUND&quot;</span><span class="p">,</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>    <span class="s2">&quot;BSONOID&quot;</span><span class="p">,</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>    <span class="s2">&quot;BSONBOO&quot;</span><span class="p">,</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>    <span class="s2">&quot;BSONDAT&quot;</span><span class="p">,</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>    <span class="s2">&quot;BSONNUL&quot;</span><span class="p">,</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>    <span class="s2">&quot;BSONRGX&quot;</span><span class="p">,</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>    <span class="s2">&quot;BSONREF&quot;</span><span class="p">,</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>    <span class="s2">&quot;BSONCOD&quot;</span><span class="p">,</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>    <span class="s2">&quot;BSONSYM&quot;</span><span class="p">,</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>    <span class="s2">&quot;BSONCWS&quot;</span><span class="p">,</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>    <span class="s2">&quot;BSONINT&quot;</span><span class="p">,</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>    <span class="s2">&quot;BSONTIM&quot;</span><span class="p">,</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>    <span class="s2">&quot;BSONLON&quot;</span><span class="p">,</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>    <span class="s2">&quot;BSONDEC&quot;</span><span class="p">,</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>    <span class="s2">&quot;BSONMIN&quot;</span><span class="p">,</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>    <span class="s2">&quot;BSONMAX&quot;</span><span class="p">,</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>    <span class="s2">&quot;get_data_and_view&quot;</span><span class="p">,</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>    <span class="s2">&quot;gen_list_name&quot;</span><span class="p">,</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>    <span class="s2">&quot;encode&quot;</span><span class="p">,</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>    <span class="s2">&quot;decode&quot;</span><span class="p">,</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>    <span class="s2">&quot;decode_all&quot;</span><span class="p">,</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>    <span class="s2">&quot;decode_iter&quot;</span><span class="p">,</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>    <span class="s2">&quot;decode_file_iter&quot;</span><span class="p">,</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>    <span class="s2">&quot;is_valid&quot;</span><span class="p">,</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>    <span class="s2">&quot;BSON&quot;</span><span class="p">,</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>    <span class="s2">&quot;has_c&quot;</span><span class="p">,</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>    <span class="s2">&quot;DatetimeConversion&quot;</span><span class="p">,</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>    <span class="s2">&quot;DatetimeMS&quot;</span><span class="p">,</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a><span class="p">]</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="n">BSONNUM</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x01</span><span class="s2">&quot;</span>  <span class="c1"># Floating point</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="n">BSONSTR</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x02</span><span class="s2">&quot;</span>  <span class="c1"># UTF-8 string</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="n">BSONOBJ</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x03</span><span class="s2">&quot;</span>  <span class="c1"># Embedded document</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="n">BSONARR</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x04</span><span class="s2">&quot;</span>  <span class="c1"># Array</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="n">BSONBIN</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x05</span><span class="s2">&quot;</span>  <span class="c1"># Binary</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="n">BSONUND</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x06</span><span class="s2">&quot;</span>  <span class="c1"># Undefined</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="n">BSONOID</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x07</span><span class="s2">&quot;</span>  <span class="c1"># ObjectId</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="n">BSONBOO</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x08</span><span class="s2">&quot;</span>  <span class="c1"># Boolean</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="n">BSONDAT</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x09</span><span class="s2">&quot;</span>  <span class="c1"># UTC Datetime</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="n">BSONNUL</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x0A</span><span class="s2">&quot;</span>  <span class="c1"># Null</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="n">BSONRGX</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x0B</span><span class="s2">&quot;</span>  <span class="c1"># Regex</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="n">BSONREF</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x0C</span><span class="s2">&quot;</span>  <span class="c1"># DBRef</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="n">BSONCOD</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x0D</span><span class="s2">&quot;</span>  <span class="c1"># Javascript code</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="n">BSONSYM</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x0E</span><span class="s2">&quot;</span>  <span class="c1"># Symbol</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="n">BSONCWS</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x0F</span><span class="s2">&quot;</span>  <span class="c1"># Javascript code with scope</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="n">BSONINT</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x10</span><span class="s2">&quot;</span>  <span class="c1"># 32bit int</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="n">BSONTIM</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x11</span><span class="s2">&quot;</span>  <span class="c1"># Timestamp</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="n">BSONLON</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x12</span><span class="s2">&quot;</span>  <span class="c1"># 64bit int</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="n">BSONDEC</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x13</span><span class="s2">&quot;</span>  <span class="c1"># Decimal128</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="n">BSONMIN</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xFF</span><span class="s2">&quot;</span>  <span class="c1"># Min key</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="n">BSONMAX</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x7F</span><span class="s2">&quot;</span>  <span class="c1"># Max key</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="n">_UNPACK_FLOAT_FROM</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;d&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack_from</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="n">_UNPACK_INT</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;i&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="n">_UNPACK_INT_FROM</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;i&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack_from</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="n">_UNPACK_LENGTH_SUBTYPE_FROM</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;iB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack_from</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="n">_UNPACK_LONG_FROM</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;q&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack_from</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="n">_UNPACK_TIMESTAMP_FROM</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;II&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unpack_from</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="k">def</span> <span class="nf">get_data_and_view</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">]:</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">)):</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>    <span class="n">view</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>    <span class="k">return</span> <span class="n">view</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(),</span> <span class="n">view</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="k">def</span> <span class="nf">_raise_unknown_type</span><span class="p">(</span><span class="n">element_type</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">element_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">NoReturn</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Unknown type helper.&quot;&quot;&quot;</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>    <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>        <span class="s2">&quot;Detected unknown BSON type </span><span class="si">%r</span><span class="s2"> for fieldname &#39;</span><span class="si">%s</span><span class="s2">&#39;. Are &quot;</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>        <span class="s2">&quot;you using the latest driver version?&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">element_type</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">element_name</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>    <span class="p">)</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a><span class="k">def</span> <span class="nf">_get_int</span><span class="p">(</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy2</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON int32 to python int.&quot;&quot;&quot;</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>    <span class="k">return</span> <span class="n">_UNPACK_INT_FROM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a><span class="k">def</span> <span class="nf">_get_c_string</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON &#39;C&#39; string to python str.&quot;&quot;&quot;</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>    <span class="n">end</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>    <span class="k">return</span> <span class="n">_utf_8_decode</span><span class="p">(</span><span class="n">view</span><span class="p">[</span><span class="n">position</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">opts</span><span class="o">.</span><span class="n">unicode_decode_error_handler</span><span class="p">,</span> <span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a><span class="k">def</span> <span class="nf">_get_float</span><span class="p">(</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy2</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON double to python float.&quot;&quot;&quot;</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>    <span class="k">return</span> <span class="n">_UNPACK_FLOAT_FROM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">8</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a><span class="k">def</span> <span class="nf">_get_string</span><span class="p">(</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span> <span class="n">dummy</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON string to python str.&quot;&quot;&quot;</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>    <span class="n">length</span> <span class="o">=</span> <span class="n">_UNPACK_INT_FROM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>    <span class="n">position</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>    <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">obj_end</span> <span class="o">-</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">:</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>        <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;invalid string length&quot;</span><span class="p">)</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>    <span class="n">end</span> <span class="o">=</span> <span class="n">position</span> <span class="o">+</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>        <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;invalid end of string&quot;</span><span class="p">)</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>    <span class="k">return</span> <span class="n">_utf_8_decode</span><span class="p">(</span><span class="n">view</span><span class="p">[</span><span class="n">position</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">opts</span><span class="o">.</span><span class="n">unicode_decode_error_handler</span><span class="p">,</span> <span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="k">def</span> <span class="nf">_get_object_size</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate and return a BSON document&#39;s size.&quot;&quot;&quot;</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>        <span class="n">obj_size</span> <span class="o">=</span> <span class="n">_UNPACK_INT_FROM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>    <span class="k">except</span> <span class="n">struct</span><span class="o">.</span><span class="n">error</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>        <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>    <span class="n">end</span> <span class="o">=</span> <span class="n">position</span> <span class="o">+</span> <span class="n">obj_size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>        <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;bad eoo&quot;</span><span class="p">)</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>    <span class="k">if</span> <span class="n">end</span> <span class="o">&gt;=</span> <span class="n">obj_end</span><span class="p">:</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>        <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;invalid object length&quot;</span><span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>    <span class="c1"># If this is the top-level document, validate the total size too.</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>    <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">obj_size</span> <span class="o">!=</span> <span class="n">obj_end</span><span class="p">:</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>        <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;invalid object length&quot;</span><span class="p">)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>    <span class="k">return</span> <span class="n">obj_size</span><span class="p">,</span> <span class="n">end</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="k">def</span> <span class="nf">_get_object</span><span class="p">(</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span> <span class="n">dummy</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON subdocument to opts.document_class or bson.dbref.DBRef.&quot;&quot;&quot;</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>    <span class="n">obj_size</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">_get_object_size</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>    <span class="k">if</span> <span class="n">_raw_document_class</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">document_class</span><span class="p">):</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">document_class</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">opts</span><span class="p">),</span> <span class="n">position</span> <span class="o">+</span> <span class="n">obj_size</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>    <span class="n">obj</span> <span class="o">=</span> <span class="n">_elements_to_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>    <span class="n">position</span> <span class="o">+=</span> <span class="n">obj_size</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>    <span class="c1"># If DBRef validation fails, return a normal doc.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>    <span class="k">if</span> <span class="p">(</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>        <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;$ref&quot;</span><span class="p">),</span> <span class="nb">str</span><span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>        <span class="ow">and</span> <span class="s2">&quot;$id&quot;</span> <span class="ow">in</span> <span class="n">obj</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>        <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;$db&quot;</span><span class="p">),</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>    <span class="p">):</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">DBRef</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;$ref&quot;</span><span class="p">),</span> <span class="n">obj</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;$id&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">obj</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;$db&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">obj</span><span class="p">),</span> <span class="n">position</span><span class="p">)</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>    <span class="k">return</span> <span class="n">obj</span><span class="p">,</span> <span class="n">position</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a><span class="k">def</span> <span class="nf">_get_array</span><span class="p">(</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span> <span class="n">element_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON array to python list.&quot;&quot;&quot;</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">_UNPACK_INT_FROM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>    <span class="n">end</span> <span class="o">=</span> <span class="n">position</span> <span class="o">+</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">end</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>        <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;bad eoo&quot;</span><span class="p">)</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>    <span class="n">position</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>    <span class="n">end</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>    <span class="n">result</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>    <span class="c1"># Avoid doing global and attribute lookups in the loop.</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>    <span class="n">append</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">append</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">index</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>    <span class="n">getter</span> <span class="o">=</span> <span class="n">_ELEMENT_GETTER</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>    <span class="n">decoder_map</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">_decoder_map</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>    <span class="k">while</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>        <span class="n">element_type</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">]</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>        <span class="c1"># Just skip the keys.</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>        <span class="n">position</span> <span class="o">=</span> <span class="n">index</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>            <span class="n">value</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">getter</span><span class="p">[</span><span class="n">element_type</span><span class="p">](</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">element_name</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>            <span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>            <span class="n">_raise_unknown_type</span><span class="p">(</span><span class="n">element_type</span><span class="p">,</span> <span class="n">element_name</span><span class="p">)</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>        <span class="k">if</span> <span class="n">decoder_map</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>            <span class="n">custom_decoder</span> <span class="o">=</span> <span class="n">decoder_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>            <span class="k">if</span> <span class="n">custom_decoder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">custom_decoder</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>        <span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>    <span class="k">if</span> <span class="n">position</span> <span class="o">!=</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>        <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;bad array length&quot;</span><span class="p">)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>    <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a><span class="k">def</span> <span class="nf">_get_binary</span><span class="p">(</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Binary</span><span class="p">,</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON binary to bson.binary.Binary or python UUID.&quot;&quot;&quot;</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>    <span class="n">length</span><span class="p">,</span> <span class="n">subtype</span> <span class="o">=</span> <span class="n">_UNPACK_LENGTH_SUBTYPE_FROM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>    <span class="n">position</span> <span class="o">+=</span> <span class="mi">5</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>    <span class="k">if</span> <span class="n">subtype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>        <span class="n">length2</span> <span class="o">=</span> <span class="n">_UNPACK_INT_FROM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>        <span class="n">position</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>        <span class="k">if</span> <span class="n">length2</span> <span class="o">!=</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>            <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;invalid binary (st 2) - lengths don&#39;t match!&quot;</span><span class="p">)</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>        <span class="n">length</span> <span class="o">=</span> <span class="n">length2</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>    <span class="n">end</span> <span class="o">=</span> <span class="n">position</span> <span class="o">+</span> <span class="n">length</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>    <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">end</span> <span class="o">&gt;</span> <span class="n">obj_end</span><span class="p">:</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>        <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;bad binary object length&quot;</span><span class="p">)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>    <span class="c1"># Convert UUID subtypes to native UUIDs.</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>    <span class="k">if</span> <span class="n">subtype</span> <span class="ow">in</span> <span class="n">ALL_UUID_SUBTYPES</span><span class="p">:</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>        <span class="n">uuid_rep</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">uuid_representation</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>        <span class="n">binary_value</span> <span class="o">=</span> <span class="n">Binary</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">subtype</span><span class="p">)</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>            <span class="p">(</span><span class="n">uuid_rep</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">UNSPECIFIED</span><span class="p">)</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>            <span class="ow">or</span> <span class="p">(</span><span class="n">subtype</span> <span class="o">==</span> <span class="n">UUID_SUBTYPE</span> <span class="ow">and</span> <span class="n">uuid_rep</span> <span class="o">!=</span> <span class="n">STANDARD</span><span class="p">)</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>            <span class="ow">or</span> <span class="p">(</span><span class="n">subtype</span> <span class="o">==</span> <span class="n">OLD_UUID_SUBTYPE</span> <span class="ow">and</span> <span class="n">uuid_rep</span> <span class="o">==</span> <span class="n">STANDARD</span><span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="p">):</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>            <span class="k">return</span> <span class="n">binary_value</span><span class="p">,</span> <span class="n">end</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>        <span class="k">return</span> <span class="n">binary_value</span><span class="o">.</span><span class="n">as_uuid</span><span class="p">(</span><span class="n">uuid_rep</span><span class="p">),</span> <span class="n">end</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>    <span class="c1"># Decode subtype 0 to &#39;bytes&#39;.</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>    <span class="k">if</span> <span class="n">subtype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>        <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>        <span class="n">value</span> <span class="o">=</span> <span class="n">Binary</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">:</span><span class="n">end</span><span class="p">],</span> <span class="n">subtype</span><span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>    <span class="k">return</span> <span class="n">value</span><span class="p">,</span> <span class="n">end</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="k">def</span> <span class="nf">_get_oid</span><span class="p">(</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy2</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">ObjectId</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON ObjectId to bson.objectid.ObjectId.&quot;&quot;&quot;</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>    <span class="n">end</span> <span class="o">=</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">12</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>    <span class="k">return</span> <span class="n">ObjectId</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">:</span><span class="n">end</span><span class="p">]),</span> <span class="n">end</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="k">def</span> <span class="nf">_get_boolean</span><span class="p">(</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy2</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON true/false to python True/False.&quot;&quot;&quot;</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>    <span class="n">end</span> <span class="o">=</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>    <span class="n">boolean_byte</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>    <span class="k">if</span> <span class="n">boolean_byte</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">:</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">end</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>    <span class="k">elif</span> <span class="n">boolean_byte</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x01</span><span class="s2">&quot;</span><span class="p">:</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">end</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>    <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;invalid boolean value: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">boolean_byte</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a><span class="k">def</span> <span class="nf">_get_date</span><span class="p">(</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">DatetimeMS</span><span class="p">],</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON datetime to python datetime.datetime.&quot;&quot;&quot;</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>    <span class="k">return</span> <span class="n">_millis_to_datetime</span><span class="p">(</span><span class="n">_UNPACK_LONG_FROM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">opts</span><span class="p">),</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">8</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="k">def</span> <span class="nf">_get_code</span><span class="p">(</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span> <span class="n">element_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Code</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON code to bson.code.Code.&quot;&quot;&quot;</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>    <span class="n">code</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">_get_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">element_name</span><span class="p">)</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>    <span class="k">return</span> <span class="n">Code</span><span class="p">(</span><span class="n">code</span><span class="p">),</span> <span class="n">position</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="k">def</span> <span class="nf">_get_code_w_scope</span><span class="p">(</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span> <span class="n">element_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Code</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON code_w_scope to bson.code.Code.&quot;&quot;&quot;</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>    <span class="n">code_end</span> <span class="o">=</span> <span class="n">position</span> <span class="o">+</span> <span class="n">_UNPACK_INT_FROM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>    <span class="n">code</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">_get_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">code_end</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">element_name</span><span class="p">)</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>    <span class="n">scope</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">_get_object</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">code_end</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">element_name</span><span class="p">)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>    <span class="k">if</span> <span class="n">position</span> <span class="o">!=</span> <span class="n">code_end</span><span class="p">:</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;scope outside of javascript code boundaries&quot;</span><span class="p">)</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>    <span class="k">return</span> <span class="n">Code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">scope</span><span class="p">),</span> <span class="n">position</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="k">def</span> <span class="nf">_get_regex</span><span class="p">(</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Regex</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON regex to bson.regex.Regex or a python pattern object.&quot;&quot;&quot;</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>    <span class="n">pattern</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">_get_c_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>    <span class="n">bson_flags</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">_get_c_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>    <span class="n">bson_re</span> <span class="o">=</span> <span class="n">Regex</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">bson_flags</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>    <span class="k">return</span> <span class="n">bson_re</span><span class="p">,</span> <span class="n">position</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a><span class="k">def</span> <span class="nf">_get_ref</span><span class="p">(</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span> <span class="n">element_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">DBRef</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode (deprecated) BSON DBPointer to bson.dbref.DBRef.&quot;&quot;&quot;</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>    <span class="n">collection</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">_get_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">element_name</span><span class="p">)</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>    <span class="n">oid</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">_get_oid</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">element_name</span><span class="p">)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>    <span class="k">return</span> <span class="n">DBRef</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">oid</span><span class="p">),</span> <span class="n">position</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a><span class="k">def</span> <span class="nf">_get_timestamp</span><span class="p">(</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy2</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Timestamp</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON timestamp to bson.timestamp.Timestamp.&quot;&quot;&quot;</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>    <span class="n">inc</span><span class="p">,</span> <span class="n">timestamp</span> <span class="o">=</span> <span class="n">_UNPACK_TIMESTAMP_FROM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>    <span class="k">return</span> <span class="n">Timestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">inc</span><span class="p">),</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">8</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a><span class="k">def</span> <span class="nf">_get_int64</span><span class="p">(</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy2</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Int64</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON int64 to bson.int64.Int64.&quot;&quot;&quot;</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>    <span class="k">return</span> <span class="n">Int64</span><span class="p">(</span><span class="n">_UNPACK_LONG_FROM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">8</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a><span class="k">def</span> <span class="nf">_get_decimal128</span><span class="p">(</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy2</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Decimal128</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON decimal128 to bson.decimal128.Decimal128.&quot;&quot;&quot;</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>    <span class="n">end</span> <span class="o">=</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">16</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>    <span class="k">return</span> <span class="n">Decimal128</span><span class="o">.</span><span class="n">from_bid</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">:</span><span class="n">end</span><span class="p">]),</span> <span class="n">end</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a><span class="c1"># Each decoder function&#39;s signature is:</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a><span class="c1">#   - data: bytes</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="c1">#   - view: memoryview that references `data`</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="c1">#   - position: int, beginning of object in &#39;data&#39; to decode</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a><span class="c1">#   - obj_end: int, end of object to decode in &#39;data&#39; if variable-length type</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a><span class="c1">#   - opts: a CodecOptions</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a><span class="n">_ELEMENT_GETTER</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONNUM</span><span class="p">):</span> <span class="n">_get_float</span><span class="p">,</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONSTR</span><span class="p">):</span> <span class="n">_get_string</span><span class="p">,</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONOBJ</span><span class="p">):</span> <span class="n">_get_object</span><span class="p">,</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONARR</span><span class="p">):</span> <span class="n">_get_array</span><span class="p">,</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONBIN</span><span class="p">):</span> <span class="n">_get_binary</span><span class="p">,</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONUND</span><span class="p">):</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span>  <span class="c1"># Deprecated undefined</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONOID</span><span class="p">):</span> <span class="n">_get_oid</span><span class="p">,</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONBOO</span><span class="p">):</span> <span class="n">_get_boolean</span><span class="p">,</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONDAT</span><span class="p">):</span> <span class="n">_get_date</span><span class="p">,</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONNUL</span><span class="p">):</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONRGX</span><span class="p">):</span> <span class="n">_get_regex</span><span class="p">,</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONREF</span><span class="p">):</span> <span class="n">_get_ref</span><span class="p">,</span>  <span class="c1"># Deprecated DBPointer</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONCOD</span><span class="p">):</span> <span class="n">_get_code</span><span class="p">,</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONSYM</span><span class="p">):</span> <span class="n">_get_string</span><span class="p">,</span>  <span class="c1"># Deprecated symbol</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONCWS</span><span class="p">):</span> <span class="n">_get_code_w_scope</span><span class="p">,</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONINT</span><span class="p">):</span> <span class="n">_get_int</span><span class="p">,</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONTIM</span><span class="p">):</span> <span class="n">_get_timestamp</span><span class="p">,</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONLON</span><span class="p">):</span> <span class="n">_get_int64</span><span class="p">,</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONDEC</span><span class="p">):</span> <span class="n">_get_decimal128</span><span class="p">,</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONMIN</span><span class="p">):</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span><span class="n">MinKey</span><span class="p">(),</span> <span class="n">w</span><span class="p">),</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>    <span class="nb">ord</span><span class="p">(</span><span class="n">BSONMAX</span><span class="p">):</span> <span class="k">lambda</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="p">(</span><span class="n">MaxKey</span><span class="p">(),</span> <span class="n">w</span><span class="p">),</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a><span class="p">}</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a><span class="k">if</span> <span class="n">_USE_C</span><span class="p">:</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>    <span class="k">def</span> <span class="nf">_element_to_dict</span><span class="p">(</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>        <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>        <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>        <span class="n">obj_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>        <span class="n">raw_array</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>        <span class="k">return</span> <span class="n">_cbson</span><span class="o">.</span><span class="n">_element_to_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">raw_array</span><span class="p">)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="k">else</span><span class="p">:</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>    <span class="k">def</span> <span class="nf">_element_to_dict</span><span class="p">(</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>        <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>        <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>        <span class="n">obj_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>        <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>        <span class="n">raw_array</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Decode a single key, value pair.&quot;&quot;&quot;</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>        <span class="n">element_type</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">position</span><span class="p">]</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>        <span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>        <span class="n">element_name</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">_get_c_string</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>        <span class="k">if</span> <span class="n">raw_array</span> <span class="ow">and</span> <span class="n">element_type</span> <span class="o">==</span> <span class="nb">ord</span><span class="p">(</span><span class="n">BSONARR</span><span class="p">):</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>            <span class="n">_</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">_get_object_size</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>            <span class="k">return</span> <span class="n">element_name</span><span class="p">,</span> <span class="n">view</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>            <span class="n">value</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">_ELEMENT_GETTER</span><span class="p">[</span><span class="n">element_type</span><span class="p">](</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>                <span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">element_name</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>            <span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>            <span class="n">_raise_unknown_type</span><span class="p">(</span><span class="n">element_type</span><span class="p">,</span> <span class="n">element_name</span><span class="p">)</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>        <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">_decoder_map</span><span class="p">:</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>            <span class="n">custom_decoder</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">_decoder_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>            <span class="k">if</span> <span class="n">custom_decoder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">custom_decoder</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="k">return</span> <span class="n">element_name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">position</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a><span class="n">_T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;_T&quot;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">MutableMapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a><span class="k">def</span> <span class="nf">_raw_to_dict</span><span class="p">(</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">_T</span><span class="p">,</span> <span class="n">raw_array</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_T</span><span class="p">:</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>    <span class="n">data</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="n">get_data_and_view</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>    <span class="k">return</span> <span class="n">_elements_to_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">raw_array</span><span class="o">=</span><span class="n">raw_array</span><span class="p">)</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a><span class="k">def</span> <span class="nf">_elements_to_dict</span><span class="p">(</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>    <span class="n">view</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>    <span class="n">position</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>    <span class="n">obj_end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>    <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>    <span class="n">result</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>    <span class="n">raw_array</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON document into result.&quot;&quot;&quot;</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>    <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">document_class</span><span class="p">()</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>    <span class="n">end</span> <span class="o">=</span> <span class="n">obj_end</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>    <span class="k">while</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>        <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">_element_to_dict</span><span class="p">(</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>            <span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">raw_array</span><span class="o">=</span><span class="n">raw_array</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>        <span class="p">)</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>        <span class="n">result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>    <span class="k">if</span> <span class="n">position</span> <span class="o">!=</span> <span class="n">obj_end</span><span class="p">:</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>        <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;bad object or element length&quot;</span><span class="p">)</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>    <span class="k">return</span> <span class="n">result</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="k">def</span> <span class="nf">_bson_to_dict</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON string to document_class.&quot;&quot;&quot;</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>    <span class="n">data</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="n">get_data_and_view</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>        <span class="k">if</span> <span class="n">_raw_document_class</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">document_class</span><span class="p">):</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>            <span class="k">return</span> <span class="n">opts</span><span class="o">.</span><span class="n">document_class</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">_get_object_size</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>        <span class="k">return</span> <span class="n">_elements_to_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>    <span class="k">except</span> <span class="n">InvalidBSON</span><span class="p">:</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>        <span class="k">raise</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>        <span class="c1"># Change exception type to InvalidBSON but preserve traceback.</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc_value</span><span class="p">))</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">exc_tb</span><span class="p">)</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a><span class="k">if</span> <span class="n">_USE_C</span><span class="p">:</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>    <span class="n">_bson_to_dict</span> <span class="o">=</span> <span class="n">_cbson</span><span class="o">.</span><span class="n">_bson_to_dict</span>  <span class="c1"># noqa: F811</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a><span class="n">_PACK_FLOAT</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;d&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="n">_PACK_INT</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;i&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a><span class="n">_PACK_LENGTH_SUBTYPE</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;iB&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="n">_PACK_LONG</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;q&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a><span class="n">_PACK_TIMESTAMP</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">Struct</span><span class="p">(</span><span class="s2">&quot;&lt;II&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">pack</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="n">_LIST_NAMES</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a><span class="k">def</span> <span class="nf">gen_list_name</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate &quot;keys&quot; for encoded lists in the sequence</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="sd">    b&quot;0\x00&quot;, b&quot;1\x00&quot;, b&quot;2\x00&quot;, ...</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="sd">    The first 1000 keys are returned from a pre-built cache. All</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="sd">    subsequent keys are generated on the fly.</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_LIST_NAMES</span><span class="p">:</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>        <span class="k">yield</span> <span class="n">name</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>    <span class="n">counter</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="k">yield</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="k">def</span> <span class="nf">_make_c_string_check</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a &#39;C&#39; string, checking for embedded NUL characters.&quot;&quot;&quot;</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>        <span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>            <span class="k">raise</span> <span class="n">InvalidDocument</span><span class="p">(</span><span class="s2">&quot;BSON keys / regex patterns must not contain a NUL character&quot;</span><span class="p">)</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>            <span class="n">_utf_8_decode</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>            <span class="k">return</span> <span class="n">string</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>        <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>            <span class="k">raise</span> <span class="n">InvalidStringData</span><span class="p">(</span><span class="s2">&quot;strings in documents must be valid UTF-8: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">string</span><span class="p">)</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>        <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>            <span class="k">raise</span> <span class="n">InvalidDocument</span><span class="p">(</span><span class="s2">&quot;BSON keys / regex patterns must not contain a NUL character&quot;</span><span class="p">)</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>        <span class="k">return</span> <span class="n">_utf_8_encode</span><span class="p">(</span><span class="n">string</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="k">def</span> <span class="nf">_make_c_string</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a &#39;C&#39; string.&quot;&quot;&quot;</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>            <span class="n">_utf_8_decode</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>            <span class="k">return</span> <span class="n">string</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>        <span class="k">except</span> <span class="ne">UnicodeError</span><span class="p">:</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>            <span class="k">raise</span> <span class="n">InvalidStringData</span><span class="p">(</span><span class="s2">&quot;strings in documents must be valid UTF-8: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">string</span><span class="p">)</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>        <span class="k">return</span> <span class="n">_utf_8_encode</span><span class="p">(</span><span class="n">string</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a><span class="k">def</span> <span class="nf">_make_name</span><span class="p">(</span><span class="n">string</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a &#39;C&#39; string suitable for a BSON key.&quot;&quot;&quot;</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>    <span class="c1"># Keys can only be text in python 3.</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>    <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">string</span><span class="p">:</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>        <span class="k">raise</span> <span class="n">InvalidDocument</span><span class="p">(</span><span class="s2">&quot;BSON keys / regex patterns must not contain a NUL character&quot;</span><span class="p">)</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>    <span class="k">return</span> <span class="n">_utf_8_encode</span><span class="p">(</span><span class="n">string</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="k">def</span> <span class="nf">_encode_float</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a float.&quot;&quot;&quot;</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x01</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_PACK_FLOAT</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="k">def</span> <span class="nf">_encode_bytes</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a python bytes.&quot;&quot;&quot;</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>    <span class="c1"># Python3 special case. Store &#39;bytes&#39; as BSON binary subtype 0.</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x05</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_PACK_INT</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">value</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="k">def</span> <span class="nf">_encode_mapping</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a mapping type.&quot;&quot;&quot;</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>    <span class="k">if</span> <span class="n">_raw_document_class</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>        <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x03</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">value</span><span class="o">.</span><span class="n">raw</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">_element_to_bson</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x03</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_PACK_INT</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="k">def</span> <span class="nf">_encode_dbref</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">DBRef</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode bson.dbref.DBRef.&quot;&quot;&quot;</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>    <span class="n">buf</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x03</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>    <span class="n">begin</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>    <span class="n">buf</span> <span class="o">+=</span> <span class="n">_name_value_to_bson</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;$ref</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">collection</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>    <span class="n">buf</span> <span class="o">+=</span> <span class="n">_name_value_to_bson</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;$id</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>    <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>        <span class="n">buf</span> <span class="o">+=</span> <span class="n">_name_value_to_bson</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;$db</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">_DBRef__kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>        <span class="n">buf</span> <span class="o">+=</span> <span class="n">_element_to_bson</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>    <span class="n">buf</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>    <span class="n">buf</span><span class="p">[</span><span class="n">begin</span> <span class="p">:</span> <span class="n">begin</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">_PACK_INT</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">begin</span><span class="p">)</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>    <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="k">def</span> <span class="nf">_encode_list</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">check_keys</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a list/tuple.&quot;&quot;&quot;</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>    <span class="n">lname</span> <span class="o">=</span> <span class="n">gen_list_name</span><span class="p">()</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>    <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">_name_value_to_bson</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">lname</span><span class="p">),</span> <span class="n">item</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">])</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x04</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_PACK_INT</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="k">def</span> <span class="nf">_encode_text</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a python str.&quot;&quot;&quot;</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>    <span class="n">bvalue</span> <span class="o">=</span> <span class="n">_utf_8_encode</span><span class="p">(</span><span class="n">value</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x02</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_PACK_INT</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bvalue</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">bvalue</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="k">def</span> <span class="nf">_encode_binary</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Binary</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode bson.binary.Binary.&quot;&quot;&quot;</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>    <span class="n">subtype</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">subtype</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>    <span class="k">if</span> <span class="n">subtype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>        <span class="n">value</span> <span class="o">=</span> <span class="n">_PACK_INT</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="o">+</span> <span class="n">value</span>  <span class="c1"># type: ignore</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x05</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_PACK_LENGTH_SUBTYPE</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">subtype</span><span class="p">)</span> <span class="o">+</span> <span class="n">value</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="k">def</span> <span class="nf">_encode_uuid</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">,</span> <span class="n">dummy</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode uuid.UUID.&quot;&quot;&quot;</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>    <span class="n">uuid_representation</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">uuid_representation</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>    <span class="n">binval</span> <span class="o">=</span> <span class="n">Binary</span><span class="o">.</span><span class="n">from_uuid</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">uuid_representation</span><span class="o">=</span><span class="n">uuid_representation</span><span class="p">)</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>    <span class="k">return</span> <span class="n">_encode_binary</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">binval</span><span class="p">,</span> <span class="n">dummy</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="k">def</span> <span class="nf">_encode_objectid</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ObjectId</span><span class="p">,</span> <span class="n">dummy</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode bson.objectid.ObjectId.&quot;&quot;&quot;</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x07</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">value</span><span class="o">.</span><span class="n">binary</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="k">def</span> <span class="nf">_encode_bool</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a python boolean (True/False).&quot;&quot;&quot;</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x08</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="p">(</span><span class="n">value</span> <span class="ow">and</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x01</span><span class="s2">&quot;</span> <span class="ow">or</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="k">def</span> <span class="nf">_encode_datetime</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode datetime.datetime.&quot;&quot;&quot;</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>    <span class="n">millis</span> <span class="o">=</span> <span class="n">_datetime_to_millis</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x09</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_PACK_LONG</span><span class="p">(</span><span class="n">millis</span><span class="p">)</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="k">def</span> <span class="nf">_encode_datetime_ms</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">DatetimeMS</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode datetime.datetime.&quot;&quot;&quot;</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>    <span class="n">millis</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x09</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_PACK_LONG</span><span class="p">(</span><span class="n">millis</span><span class="p">)</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="k">def</span> <span class="nf">_encode_none</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy2</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode python None.&quot;&quot;&quot;</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x0A</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a><span class="k">def</span> <span class="nf">_encode_regex</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Regex</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a python regex or bson.regex.Regex.&quot;&quot;&quot;</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>    <span class="n">flags</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">flags</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>    <span class="c1"># Python 3 common case</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>    <span class="k">if</span> <span class="n">flags</span> <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">:</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x0B</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_make_c_string_check</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">pattern</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;u</span><span class="se">\x00</span><span class="s2">&quot;</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>    <span class="k">elif</span> <span class="n">flags</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>        <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x0B</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_make_c_string_check</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">pattern</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>        <span class="n">sflags</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>        <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">:</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>            <span class="n">sflags</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;i&quot;</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>        <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">re</span><span class="o">.</span><span class="n">LOCALE</span><span class="p">:</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>            <span class="n">sflags</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;l&quot;</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>        <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">:</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>            <span class="n">sflags</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;m&quot;</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>        <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">:</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>            <span class="n">sflags</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;s&quot;</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>        <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span><span class="p">:</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>            <span class="n">sflags</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;u&quot;</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>        <span class="k">if</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span><span class="p">:</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>            <span class="n">sflags</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;x&quot;</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="n">sflags</span> <span class="o">+=</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>        <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x0B</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_make_c_string_check</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">pattern</span><span class="p">)</span> <span class="o">+</span> <span class="n">sflags</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a><span class="k">def</span> <span class="nf">_encode_code</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Code</span><span class="p">,</span> <span class="n">dummy</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode bson.code.Code.&quot;&quot;&quot;</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>    <span class="n">cstring</span> <span class="o">=</span> <span class="n">_make_c_string</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>    <span class="n">cstrlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cstring</span><span class="p">)</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>    <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>        <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x0D</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_PACK_INT</span><span class="p">(</span><span class="n">cstrlen</span><span class="p">)</span> <span class="o">+</span> <span class="n">cstring</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>    <span class="n">scope</span> <span class="o">=</span> <span class="n">_dict_to_bson</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">scope</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>    <span class="n">full_length</span> <span class="o">=</span> <span class="n">_PACK_INT</span><span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="n">cstrlen</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">scope</span><span class="p">))</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x0F</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">full_length</span> <span class="o">+</span> <span class="n">_PACK_INT</span><span class="p">(</span><span class="n">cstrlen</span><span class="p">)</span> <span class="o">+</span> <span class="n">cstring</span> <span class="o">+</span> <span class="n">scope</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a><span class="k">def</span> <span class="nf">_encode_int</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a python int.&quot;&quot;&quot;</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>    <span class="k">if</span> <span class="o">-</span><span class="mi">2147483648</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">2147483647</span><span class="p">:</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>        <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x10</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_PACK_INT</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>            <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x12</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_PACK_LONG</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>        <span class="k">except</span> <span class="n">struct</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>            <span class="k">raise</span> <span class="ne">OverflowError</span><span class="p">(</span><span class="s2">&quot;BSON can only handle up to 8-byte ints&quot;</span><span class="p">)</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="k">def</span> <span class="nf">_encode_timestamp</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode bson.timestamp.Timestamp.&quot;&quot;&quot;</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x11</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_PACK_TIMESTAMP</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">inc</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="k">def</span> <span class="nf">_encode_long</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a python long (python 2.x)&quot;&quot;&quot;</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>        <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x12</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">_PACK_LONG</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>    <span class="k">except</span> <span class="n">struct</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>        <span class="k">raise</span> <span class="ne">OverflowError</span><span class="p">(</span><span class="s2">&quot;BSON can only handle up to 8-byte ints&quot;</span><span class="p">)</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="k">def</span> <span class="nf">_encode_decimal128</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Decimal128</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode bson.decimal128.Decimal128.&quot;&quot;&quot;</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x13</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="n">value</span><span class="o">.</span><span class="n">bid</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a><span class="k">def</span> <span class="nf">_encode_minkey</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy2</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode bson.min_key.MinKey.&quot;&quot;&quot;</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\xFF</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a><span class="k">def</span> <span class="nf">_encode_maxkey</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">dummy0</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy1</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dummy2</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode bson.max_key.MaxKey.&quot;&quot;&quot;</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x7F</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a><span class="c1"># Each encoder function&#39;s signature is:</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a><span class="c1">#   - name: utf-8 bytes</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="c1">#   - value: a Python data type, e.g. a Python int for _encode_int</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a><span class="c1">#   - check_keys: bool, whether to check for invalid names</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a><span class="c1">#   - opts: a CodecOptions</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a><span class="n">_ENCODERS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>    <span class="nb">bool</span><span class="p">:</span> <span class="n">_encode_bool</span><span class="p">,</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>    <span class="nb">bytes</span><span class="p">:</span> <span class="n">_encode_bytes</span><span class="p">,</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>    <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span> <span class="n">_encode_datetime</span><span class="p">,</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>    <span class="n">DatetimeMS</span><span class="p">:</span> <span class="n">_encode_datetime_ms</span><span class="p">,</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>    <span class="nb">dict</span><span class="p">:</span> <span class="n">_encode_mapping</span><span class="p">,</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>    <span class="nb">float</span><span class="p">:</span> <span class="n">_encode_float</span><span class="p">,</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>    <span class="nb">int</span><span class="p">:</span> <span class="n">_encode_int</span><span class="p">,</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>    <span class="nb">list</span><span class="p">:</span> <span class="n">_encode_list</span><span class="p">,</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>    <span class="nb">str</span><span class="p">:</span> <span class="n">_encode_text</span><span class="p">,</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>    <span class="nb">tuple</span><span class="p">:</span> <span class="n">_encode_list</span><span class="p">,</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>    <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">):</span> <span class="n">_encode_none</span><span class="p">,</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>    <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">:</span> <span class="n">_encode_uuid</span><span class="p">,</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>    <span class="n">Binary</span><span class="p">:</span> <span class="n">_encode_binary</span><span class="p">,</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>    <span class="n">Int64</span><span class="p">:</span> <span class="n">_encode_long</span><span class="p">,</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>    <span class="n">Code</span><span class="p">:</span> <span class="n">_encode_code</span><span class="p">,</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>    <span class="n">DBRef</span><span class="p">:</span> <span class="n">_encode_dbref</span><span class="p">,</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>    <span class="n">MaxKey</span><span class="p">:</span> <span class="n">_encode_maxkey</span><span class="p">,</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>    <span class="n">MinKey</span><span class="p">:</span> <span class="n">_encode_minkey</span><span class="p">,</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>    <span class="n">ObjectId</span><span class="p">:</span> <span class="n">_encode_objectid</span><span class="p">,</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>    <span class="n">Regex</span><span class="p">:</span> <span class="n">_encode_regex</span><span class="p">,</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>    <span class="n">RE_TYPE</span><span class="p">:</span> <span class="n">_encode_regex</span><span class="p">,</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>    <span class="n">SON</span><span class="p">:</span> <span class="n">_encode_mapping</span><span class="p">,</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>    <span class="n">Timestamp</span><span class="p">:</span> <span class="n">_encode_timestamp</span><span class="p">,</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>    <span class="n">Decimal128</span><span class="p">:</span> <span class="n">_encode_decimal128</span><span class="p">,</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>    <span class="c1"># Special case. This will never be looked up directly.</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>    <span class="n">_abc</span><span class="o">.</span><span class="n">Mapping</span><span class="p">:</span> <span class="n">_encode_mapping</span><span class="p">,</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a><span class="p">}</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a><span class="n">_MARKERS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>    <span class="mi">5</span><span class="p">:</span> <span class="n">_encode_binary</span><span class="p">,</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>    <span class="mi">7</span><span class="p">:</span> <span class="n">_encode_objectid</span><span class="p">,</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>    <span class="mi">11</span><span class="p">:</span> <span class="n">_encode_regex</span><span class="p">,</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>    <span class="mi">13</span><span class="p">:</span> <span class="n">_encode_code</span><span class="p">,</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>    <span class="mi">17</span><span class="p">:</span> <span class="n">_encode_timestamp</span><span class="p">,</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>    <span class="mi">18</span><span class="p">:</span> <span class="n">_encode_long</span><span class="p">,</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>    <span class="mi">100</span><span class="p">:</span> <span class="n">_encode_dbref</span><span class="p">,</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>    <span class="mi">127</span><span class="p">:</span> <span class="n">_encode_maxkey</span><span class="p">,</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>    <span class="mi">255</span><span class="p">:</span> <span class="n">_encode_minkey</span><span class="p">,</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="p">}</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a><span class="n">_BUILT_IN_TYPES</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">_ENCODERS</span><span class="p">)</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="k">def</span> <span class="nf">_name_value_to_bson</span><span class="p">(</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>    <span class="n">check_keys</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>    <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>    <span class="n">in_custom_call</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>    <span class="n">in_fallback_call</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a single name, value pair.&quot;&quot;&quot;</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>    <span class="c1"># First see if the type is already cached. KeyError will only ever</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>    <span class="c1"># happen once per subtype.</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>        <span class="k">return</span> <span class="n">_ENCODERS</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)](</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>        <span class="k">pass</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>    <span class="c1"># Second, fall back to trying _type_marker. This has to be done</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>    <span class="c1"># before the loop below since users could subclass one of our</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>    <span class="c1"># custom types that subclasses a python built-in (e.g. Binary)</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>    <span class="n">marker</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;_type_marker&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">marker</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">marker</span> <span class="ow">in</span> <span class="n">_MARKERS</span><span class="p">:</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>        <span class="n">func</span> <span class="o">=</span> <span class="n">_MARKERS</span><span class="p">[</span><span class="n">marker</span><span class="p">]</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>        <span class="c1"># Cache this type for faster subsequent lookup.</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>        <span class="n">_ENCODERS</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>    <span class="c1"># Third, check if a type encoder is registered for this type.</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>    <span class="c1"># Note that subtypes of registered custom types are not auto-encoded.</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">in_custom_call</span> <span class="ow">and</span> <span class="n">opts</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">_encoder_map</span><span class="p">:</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>        <span class="n">custom_encoder</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">_encoder_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>        <span class="k">if</span> <span class="n">custom_encoder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>            <span class="k">return</span> <span class="n">_name_value_to_bson</span><span class="p">(</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>                <span class="n">name</span><span class="p">,</span> <span class="n">custom_encoder</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">in_custom_call</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>            <span class="p">)</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>    <span class="c1"># Fourth, test each base type. This will only happen once for</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>    <span class="c1"># a subtype of a supported base type. Unlike in the C-extensions, this</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>    <span class="c1"># is done after trying the custom type encoder because checking for each</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>    <span class="c1"># subtype is expensive.</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>    <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">_BUILT_IN_TYPES</span><span class="p">:</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">base</span><span class="p">):</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>            <span class="n">func</span> <span class="o">=</span> <span class="n">_ENCODERS</span><span class="p">[</span><span class="n">base</span><span class="p">]</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>            <span class="c1"># Cache this type for faster subsequent lookup.</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>            <span class="n">_ENCODERS</span><span class="p">[</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span> <span class="o">=</span> <span class="n">func</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>    <span class="c1"># As a last resort, try using the fallback encoder, if the user has</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>    <span class="c1"># provided one.</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>    <span class="n">fallback_encoder</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">_fallback_encoder</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">in_fallback_call</span> <span class="ow">and</span> <span class="n">fallback_encoder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>        <span class="k">return</span> <span class="n">_name_value_to_bson</span><span class="p">(</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>            <span class="n">name</span><span class="p">,</span> <span class="n">fallback_encoder</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">opts</span><span class="p">,</span> <span class="n">in_fallback_call</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>        <span class="p">)</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>    <span class="k">raise</span> <span class="n">InvalidDocument</span><span class="p">(</span><span class="s2">&quot;cannot encode object: </span><span class="si">%r</span><span class="s2">, of type: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="k">def</span> <span class="nf">_element_to_bson</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a single key, value pair.&quot;&quot;&quot;</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>        <span class="k">raise</span> <span class="n">InvalidDocument</span><span class="p">(</span><span class="s2">&quot;documents must have only string keys, key was </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,))</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>    <span class="k">if</span> <span class="n">check_keys</span><span class="p">:</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>        <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">):</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>            <span class="k">raise</span> <span class="n">InvalidDocument</span><span class="p">(</span><span class="s2">&quot;key </span><span class="si">%r</span><span class="s2"> must not start with &#39;$&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,))</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>        <span class="k">if</span> <span class="s2">&quot;.&quot;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>            <span class="k">raise</span> <span class="n">InvalidDocument</span><span class="p">(</span><span class="s2">&quot;key </span><span class="si">%r</span><span class="s2"> must not contain &#39;.&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,))</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">_make_name</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>    <span class="k">return</span> <span class="n">_name_value_to_bson</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a><span class="k">def</span> <span class="nf">_dict_to_bson</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span> <span class="n">top_level</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a document to BSON.&quot;&quot;&quot;</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>    <span class="k">if</span> <span class="n">_raw_document_class</span><span class="p">(</span><span class="n">doc</span><span class="p">):</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">doc</span><span class="o">.</span><span class="n">raw</span><span class="p">)</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>        <span class="k">if</span> <span class="n">top_level</span> <span class="ow">and</span> <span class="s2">&quot;_id&quot;</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_name_value_to_bson</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;_id</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">],</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">opts</span><span class="p">))</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">top_level</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;_id&quot;</span><span class="p">:</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_element_to_bson</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">opts</span><span class="p">))</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;encoder expected a mapping type but got: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">doc</span><span class="p">,))</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>    <span class="n">encoded</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>    <span class="k">return</span> <span class="n">_PACK_INT</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">encoded</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">encoded</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="k">if</span> <span class="n">_USE_C</span><span class="p">:</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>    <span class="n">_dict_to_bson</span> <span class="o">=</span> <span class="n">_cbson</span><span class="o">.</span><span class="n">_dict_to_bson</span>  <span class="c1"># noqa: F811</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a><span class="n">_CODEC_OPTIONS_TYPE_ERROR</span> <span class="o">=</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;codec_options must be an instance of CodecOptions&quot;</span><span class="p">)</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a><span class="n">_DocumentIn</span> <span class="o">=</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a><span class="n">_ReadableBuffer</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">,</span> <span class="s2">&quot;mmap&quot;</span><span class="p">,</span> <span class="s2">&quot;array&quot;</span><span class="p">]</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a><span class="k">def</span> <span class="nf">encode</span><span class="p">(</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>    <span class="n">document</span><span class="p">:</span> <span class="n">_DocumentIn</span><span class="p">,</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>    <span class="n">check_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>    <span class="n">codec_options</span><span class="p">:</span> <span class="n">CodecOptions</span> <span class="o">=</span> <span class="n">DEFAULT_CODEC_OPTIONS</span><span class="p">,</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a document to BSON.</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="sd">    A document can be any mapping type (like :class:`dict`).</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a><span class="sd">    Raises :class:`TypeError` if `document` is not a mapping type,</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="sd">    or contains keys that are not instances of</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="sd">    :class:`basestring` (:class:`str` in python 3). Raises</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a><span class="sd">    :class:`~bson.errors.InvalidDocument` if `document` cannot be</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a><span class="sd">    converted to :class:`BSON`.</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a><span class="sd">    :Parameters:</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a><span class="sd">      - `document`: mapping type representing a document</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a><span class="sd">      - `check_keys` (optional): check if keys start with &#39;$&#39; or</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a><span class="sd">        contain &#39;.&#39;, raising :class:`~bson.errors.InvalidDocument` in</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a><span class="sd">        either case</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a><span class="sd">      - `codec_options` (optional): An instance of</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a><span class="sd">        :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="sd">    .. versionadded:: 3.9</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">codec_options</span><span class="p">,</span> <span class="n">CodecOptions</span><span class="p">):</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>        <span class="k">raise</span> <span class="n">_CODEC_OPTIONS_TYPE_ERROR</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>    <span class="k">return</span> <span class="n">_dict_to_bson</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">)</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a><span class="k">def</span> <span class="nf">decode</span><span class="p">(</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">_ReadableBuffer</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">:</span> <span class="s2">&quot;Optional[CodecOptions[_DocumentType]]&quot;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DocumentType</span><span class="p">:</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode BSON to a document.</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a><span class="sd">    By default, returns a BSON document represented as a Python</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="sd">    :class:`dict`. To use a different :class:`MutableMapping` class,</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a><span class="sd">    configure a :class:`~bson.codec_options.CodecOptions`::</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">        &gt;&gt;&gt; import collections  # From Python standard library.</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="sd">        &gt;&gt;&gt; import bson</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">        &gt;&gt;&gt; from .codec_options import CodecOptions</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="sd">        &gt;&gt;&gt; data = bson.encode({&#39;a&#39;: 1})</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a><span class="sd">        &gt;&gt;&gt; decoded_doc = bson.decode(data)</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">        &lt;type &#39;dict&#39;&gt;</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="sd">        &gt;&gt;&gt; options = CodecOptions(document_class=collections.OrderedDict)</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a><span class="sd">        &gt;&gt;&gt; decoded_doc = bson.decode(data, codec_options=options)</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">        &gt;&gt;&gt; type(decoded_doc)</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a><span class="sd">        &lt;class &#39;collections.OrderedDict&#39;&gt;</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a><span class="sd">    :Parameters:</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a><span class="sd">      - `data`: the BSON to decode. Any bytes-like object that implements</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a><span class="sd">        the buffer protocol.</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a><span class="sd">      - `codec_options` (optional): An instance of</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a><span class="sd">        :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a><span class="sd">    .. versionadded:: 3.9</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>    <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span> <span class="o">=</span> <span class="n">codec_options</span> <span class="ow">or</span> <span class="n">DEFAULT_CODEC_OPTIONS</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">CodecOptions</span><span class="p">):</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="k">raise</span> <span class="n">_CODEC_OPTIONS_TYPE_ERROR</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>    <span class="k">return</span> <span class="n">_bson_to_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a><span class="k">def</span> <span class="nf">_decode_all</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">_ReadableBuffer</span><span class="p">,</span> <span class="n">opts</span><span class="p">:</span> <span class="s2">&quot;CodecOptions[_DocumentType]&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">_DocumentType</span><span class="p">]:</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON data to multiple documents.&quot;&quot;&quot;</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>    <span class="n">data</span><span class="p">,</span> <span class="n">view</span> <span class="o">=</span> <span class="n">get_data_and_view</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>    <span class="n">data_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>    <span class="n">docs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_DocumentType</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>    <span class="n">position</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>    <span class="n">end</span> <span class="o">=</span> <span class="n">data_len</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>    <span class="n">use_raw</span> <span class="o">=</span> <span class="n">_raw_document_class</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">document_class</span><span class="p">)</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>        <span class="k">while</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>            <span class="n">obj_size</span> <span class="o">=</span> <span class="n">_UNPACK_INT_FROM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>            <span class="k">if</span> <span class="n">data_len</span> <span class="o">-</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="n">obj_size</span><span class="p">:</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>                <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;invalid object size&quot;</span><span class="p">)</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>            <span class="n">obj_end</span> <span class="o">=</span> <span class="n">position</span> <span class="o">+</span> <span class="n">obj_size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">obj_end</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>                <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;bad eoo&quot;</span><span class="p">)</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>            <span class="k">if</span> <span class="n">use_raw</span><span class="p">:</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>                <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">document_class</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">obj_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">opts</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>                <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_elements_to_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">position</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span> <span class="n">obj_end</span><span class="p">,</span> <span class="n">opts</span><span class="p">))</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>            <span class="n">position</span> <span class="o">+=</span> <span class="n">obj_size</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>        <span class="k">return</span> <span class="n">docs</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>    <span class="k">except</span> <span class="n">InvalidBSON</span><span class="p">:</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>        <span class="k">raise</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>        <span class="c1"># Change exception type to InvalidBSON but preserve traceback.</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>        <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc_value</span><span class="p">))</span><span class="o">.</span><span class="n">with_traceback</span><span class="p">(</span><span class="n">exc_tb</span><span class="p">)</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="k">if</span> <span class="n">_USE_C</span><span class="p">:</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>    <span class="n">_decode_all</span> <span class="o">=</span> <span class="n">_cbson</span><span class="o">.</span><span class="n">_decode_all</span>  <span class="c1"># noqa: F811</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a><span class="k">def</span> <span class="nf">decode_all</span><span class="p">(</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">_ReadableBuffer</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">:</span> <span class="s2">&quot;Optional[CodecOptions[_DocumentType]]&quot;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">_DocumentType</span><span class="p">]:</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode BSON data to multiple documents.</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a><span class="sd">    `data` must be a bytes-like object implementing the buffer protocol that</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a><span class="sd">    provides concatenated, valid, BSON-encoded documents.</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a><span class="sd">    :Parameters:</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a><span class="sd">      - `data`: BSON data</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a><span class="sd">      - `codec_options` (optional): An instance of</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="sd">        :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="sd">    .. versionchanged:: 3.9</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a><span class="sd">       Supports bytes-like objects that implement the buffer protocol.</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a><span class="sd">    .. versionchanged:: 3.0</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a><span class="sd">       Removed `compile_re` option: PyMongo now always represents BSON regular</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="sd">       expressions as :class:`~bson.regex.Regex` objects. Use</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a><span class="sd">       :meth:`~bson.regex.Regex.try_compile` to attempt to convert from a</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a><span class="sd">       BSON regular expression to a Python regular expression object.</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a><span class="sd">       Replaced `as_class`, `tz_aware`, and `uuid_subtype` options with</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a><span class="sd">       `codec_options`.</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>    <span class="n">opts</span> <span class="o">=</span> <span class="n">codec_options</span> <span class="ow">or</span> <span class="n">DEFAULT_CODEC_OPTIONS</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">CodecOptions</span><span class="p">):</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>        <span class="k">raise</span> <span class="n">_CODEC_OPTIONS_TYPE_ERROR</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>    <span class="k">return</span> <span class="n">_decode_all</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a><span class="k">def</span> <span class="nf">_decode_selective</span><span class="p">(</span><span class="n">rawdoc</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>    <span class="k">if</span> <span class="n">_raw_document_class</span><span class="p">(</span><span class="n">codec_options</span><span class="o">.</span><span class="n">document_class</span><span class="p">):</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>        <span class="c1"># If document_class is RawBSONDocument, use vanilla dictionary for</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>        <span class="c1"># decoding command response.</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>        <span class="n">doc</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>        <span class="c1"># Else, use the specified document_class.</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>        <span class="n">doc</span> <span class="o">=</span> <span class="n">codec_options</span><span class="o">.</span><span class="n">document_class</span><span class="p">()</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">rawdoc</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>            <span class="k">if</span> <span class="n">fields</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>                <span class="n">doc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">_bson_to_dict</span><span class="p">(</span><span class="n">rawdoc</span><span class="o">.</span><span class="n">raw</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">)[</span><span class="n">key</span><span class="p">]</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>                <span class="n">doc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">_decode_selective</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">fields</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">codec_options</span><span class="p">)</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>            <span class="n">doc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>    <span class="k">return</span> <span class="n">doc</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a><span class="k">def</span> <span class="nf">_array_of_documents_to_buffer</span><span class="p">(</span><span class="n">view</span><span class="p">:</span> <span class="nb">memoryview</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>    <span class="c1"># Extract the raw bytes of each document.</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>    <span class="n">position</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>    <span class="n">_</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">_get_object_size</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">view</span><span class="p">))</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>    <span class="n">position</span> <span class="o">+=</span> <span class="mi">4</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>    <span class="n">buffers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">memoryview</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>    <span class="n">append</span> <span class="o">=</span> <span class="n">buffers</span><span class="o">.</span><span class="n">append</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>    <span class="k">while</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="n">end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>        <span class="c1"># Just skip the keys.</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>        <span class="k">while</span> <span class="n">view</span><span class="p">[</span><span class="n">position</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>            <span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>        <span class="n">position</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>        <span class="n">obj_size</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">_get_object_size</span><span class="p">(</span><span class="n">view</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>        <span class="n">append</span><span class="p">(</span><span class="n">view</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="n">obj_size</span><span class="p">])</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>        <span class="n">position</span> <span class="o">+=</span> <span class="n">obj_size</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>    <span class="k">if</span> <span class="n">position</span> <span class="o">!=</span> <span class="n">end</span><span class="p">:</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>        <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;bad object or element length&quot;</span><span class="p">)</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>    <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">buffers</span><span class="p">)</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a><span class="k">if</span> <span class="n">_USE_C</span><span class="p">:</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>    <span class="n">_array_of_documents_to_buffer</span> <span class="o">=</span> <span class="n">_cbson</span><span class="o">.</span><span class="n">_array_of_documents_to_buffer</span>  <span class="c1"># noqa: F811</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a><span class="k">def</span> <span class="nf">_convert_raw_document_lists_to_streams</span><span class="p">(</span><span class="n">document</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert raw array of documents to a stream of BSON documents.&quot;&quot;&quot;</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>    <span class="n">cursor</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cursor&quot;</span><span class="p">)</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">cursor</span><span class="p">:</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>        <span class="k">return</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;firstBatch&quot;</span><span class="p">,</span> <span class="s2">&quot;nextBatch&quot;</span><span class="p">):</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>        <span class="n">batch</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">batch</span><span class="p">:</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>            <span class="k">continue</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">_array_of_documents_to_buffer</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>            <span class="n">cursor</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>            <span class="n">cursor</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="k">def</span> <span class="nf">_decode_all_selective</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">:</span> <span class="n">CodecOptions</span><span class="p">,</span> <span class="n">fields</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode BSON data to a single document while using user-provided</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="sd">    custom decoding logic.</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a><span class="sd">    `data` must be a string representing a valid, BSON-encoded document.</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a><span class="sd">    :Parameters:</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a><span class="sd">      - `data`: BSON data</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a><span class="sd">      - `codec_options`: An instance of</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a><span class="sd">        :class:`~bson.codec_options.CodecOptions` with user-specified type</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a><span class="sd">        decoders. If no decoders are found, this method is the same as</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a><span class="sd">        ``decode_all``.</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a><span class="sd">      - `fields`: Map of document namespaces where data that needs</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a><span class="sd">        to be custom decoded lives or None. For example, to custom decode a</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a><span class="sd">        list of objects in &#39;field1.subfield1&#39;, the specified value should be</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a><span class="sd">        ``{&#39;field1&#39;: {&#39;subfield1&#39;: 1}}``. If ``fields``  is an empty map or</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a><span class="sd">        None, this method is the same as ``decode_all``.</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a><span class="sd">    :Returns:</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a><span class="sd">      - `document_list`: Single-member list containing the decoded document.</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a><span class="sd">    .. versionadded:: 3.8</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">codec_options</span><span class="o">.</span><span class="n">type_registry</span><span class="o">.</span><span class="n">_decoder_map</span><span class="p">:</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>        <span class="k">return</span> <span class="n">decode_all</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">)</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>        <span class="k">return</span> <span class="n">decode_all</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">codec_options</span><span class="o">.</span><span class="n">with_options</span><span class="p">(</span><span class="n">type_registry</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>    <span class="c1"># Decode documents for internal use.</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>    <span class="kn">from</span> <span class="nn">.raw_bson</span> <span class="kn">import</span> <span class="n">RawBSONDocument</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>    <span class="n">internal_codec_options</span> <span class="o">=</span> <span class="n">codec_options</span><span class="o">.</span><span class="n">with_options</span><span class="p">(</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>        <span class="n">document_class</span><span class="o">=</span><span class="n">RawBSONDocument</span><span class="p">,</span> <span class="n">type_registry</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>    <span class="p">)</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>    <span class="n">_doc</span> <span class="o">=</span> <span class="n">_bson_to_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">internal_codec_options</span><span class="p">)</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>    <span class="k">return</span> <span class="p">[</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>        <span class="n">_decode_selective</span><span class="p">(</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>            <span class="n">_doc</span><span class="p">,</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>            <span class="n">fields</span><span class="p">,</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>            <span class="n">codec_options</span><span class="p">,</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>        <span class="p">)</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>    <span class="p">]</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a><span class="k">def</span> <span class="nf">decode_iter</span><span class="p">(</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>    <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">:</span> <span class="s2">&quot;Optional[CodecOptions[_DocumentType]]&quot;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_DocumentType</span><span class="p">]:</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode BSON data to multiple documents as a generator.</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a><span class="sd">    Works similarly to the decode_all function, but yields one document at a</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a><span class="sd">    time.</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a><span class="sd">    `data` must be a string of concatenated, valid, BSON-encoded</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a><span class="sd">    documents.</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a><span class="sd">    :Parameters:</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a><span class="sd">      - `data`: BSON data</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a><span class="sd">      - `codec_options` (optional): An instance of</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a><span class="sd">        :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a><span class="sd">    .. versionchanged:: 3.0</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a><span class="sd">       Replaced `as_class`, `tz_aware`, and `uuid_subtype` options with</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a><span class="sd">       `codec_options`.</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a><span class="sd">    .. versionadded:: 2.8</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>    <span class="n">opts</span> <span class="o">=</span> <span class="n">codec_options</span> <span class="ow">or</span> <span class="n">DEFAULT_CODEC_OPTIONS</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">CodecOptions</span><span class="p">):</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>        <span class="k">raise</span> <span class="n">_CODEC_OPTIONS_TYPE_ERROR</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>    <span class="n">position</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>    <span class="n">end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>    <span class="k">while</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>        <span class="n">obj_size</span> <span class="o">=</span> <span class="n">_UNPACK_INT_FROM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>        <span class="n">elements</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="n">obj_size</span><span class="p">]</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>        <span class="n">position</span> <span class="o">+=</span> <span class="n">obj_size</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>        <span class="k">yield</span> <span class="n">_bson_to_dict</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a><span class="k">def</span> <span class="nf">decode_file_iter</span><span class="p">(</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>    <span class="n">file_obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BinaryIO</span><span class="p">,</span> <span class="n">IO</span><span class="p">],</span> <span class="n">codec_options</span><span class="p">:</span> <span class="s2">&quot;Optional[CodecOptions[_DocumentType]]&quot;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_DocumentType</span><span class="p">]:</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode bson data from a file to multiple documents as a generator.</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a><span class="sd">    Works similarly to the decode_all function, but reads from the file object</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a><span class="sd">    in chunks and parses bson in chunks, yielding one document at a time.</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a><span class="sd">    :Parameters:</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a><span class="sd">      - `file_obj`: A file object containing BSON data.</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a><span class="sd">      - `codec_options` (optional): An instance of</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a><span class="sd">        :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">    .. versionchanged:: 3.0</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a><span class="sd">       Replaced `as_class`, `tz_aware`, and `uuid_subtype` options with</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a><span class="sd">       `codec_options`.</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="sd">    .. versionadded:: 2.8</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>    <span class="n">opts</span> <span class="o">=</span> <span class="n">codec_options</span> <span class="ow">or</span> <span class="n">DEFAULT_CODEC_OPTIONS</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>        <span class="c1"># Read size of next object.</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>        <span class="n">size_data</span> <span class="o">=</span> <span class="n">file_obj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">size_data</span><span class="p">:</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>            <span class="k">break</span>  <span class="c1"># Finished with file normaly.</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">size_data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>            <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;cut off in middle of objsize&quot;</span><span class="p">)</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>        <span class="n">obj_size</span> <span class="o">=</span> <span class="n">_UNPACK_INT_FROM</span><span class="p">(</span><span class="n">size_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>        <span class="n">elements</span> <span class="o">=</span> <span class="n">size_data</span> <span class="o">+</span> <span class="n">file_obj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">obj_size</span><span class="p">))</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>        <span class="k">yield</span> <span class="n">_bson_to_dict</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a><span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="n">bson</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that the given string represents valid :class:`BSON` data.</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a><span class="sd">    Raises :class:`TypeError` if `bson` is not an instance of</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a><span class="sd">    :class:`str` (:class:`bytes` in python 3). Returns ``True``</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a><span class="sd">    if `bson` is valid :class:`BSON`, ``False`` otherwise.</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a><span class="sd">    :Parameters:</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a><span class="sd">      - `bson`: the data to be validated</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bson</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;BSON data must be an instance of a subclass of bytes&quot;</span><span class="p">)</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>        <span class="n">_bson_to_dict</span><span class="p">(</span><span class="n">bson</span><span class="p">,</span> <span class="n">DEFAULT_CODEC_OPTIONS</span><span class="p">)</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a><span class="k">class</span> <span class="nc">BSON</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;BSON (Binary JSON) data.</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a><span class="sd">    .. warning:: Using this class to encode and decode BSON adds a performance</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a><span class="sd">       cost. For better performance use the module level functions</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a><span class="sd">       :func:`encode` and :func:`decode` instead.</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;BSON&quot;</span><span class="p">],</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>        <span class="n">document</span><span class="p">:</span> <span class="n">_DocumentIn</span><span class="p">,</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>        <span class="n">check_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>        <span class="n">codec_options</span><span class="p">:</span> <span class="n">CodecOptions</span> <span class="o">=</span> <span class="n">DEFAULT_CODEC_OPTIONS</span><span class="p">,</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BSON&quot;</span><span class="p">:</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Encode a document to a new :class:`BSON` instance.</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a><span class="sd">        A document can be any mapping type (like :class:`dict`).</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a><span class="sd">        Raises :class:`TypeError` if `document` is not a mapping type,</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a><span class="sd">        or contains keys that are not instances of</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a><span class="sd">        :class:`basestring` (:class:`str` in python 3). Raises</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a><span class="sd">        :class:`~bson.errors.InvalidDocument` if `document` cannot be</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a><span class="sd">        converted to :class:`BSON`.</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a><span class="sd">        :Parameters:</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a><span class="sd">          - `document`: mapping type representing a document</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a><span class="sd">          - `check_keys` (optional): check if keys start with &#39;$&#39; or</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a><span class="sd">            contain &#39;.&#39;, raising :class:`~bson.errors.InvalidDocument` in</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a><span class="sd">            either case</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a><span class="sd">          - `codec_options` (optional): An instance of</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a><span class="sd">            :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a><span class="sd">        .. versionchanged:: 3.0</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a><span class="sd">           Replaced `uuid_subtype` option with `codec_options`.</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">))</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">:</span> <span class="s2">&quot;CodecOptions[_DocumentType]&quot;</span> <span class="o">=</span> <span class="n">DEFAULT_CODEC_OPTIONS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DocumentType</span><span class="p">:</span>  <span class="c1"># type: ignore[override,assignment]</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Decode this BSON data.</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a><span class="sd">        By default, returns a BSON document represented as a Python</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a><span class="sd">        :class:`dict`. To use a different :class:`MutableMapping` class,</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a><span class="sd">        configure a :class:`~bson.codec_options.CodecOptions`::</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a><span class="sd">            &gt;&gt;&gt; import collections  # From Python standard library.</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a><span class="sd">            &gt;&gt;&gt; import bson</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a><span class="sd">            &gt;&gt;&gt; from .codec_options import CodecOptions</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a><span class="sd">            &gt;&gt;&gt; data = bson.BSON.encode({&#39;a&#39;: 1})</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a><span class="sd">            &gt;&gt;&gt; decoded_doc = bson.BSON(data).decode()</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a><span class="sd">            &lt;type &#39;dict&#39;&gt;</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a><span class="sd">            &gt;&gt;&gt; options = CodecOptions(document_class=collections.OrderedDict)</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a><span class="sd">            &gt;&gt;&gt; decoded_doc = bson.BSON(data).decode(codec_options=options)</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a><span class="sd">            &gt;&gt;&gt; type(decoded_doc)</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a><span class="sd">            &lt;class &#39;collections.OrderedDict&#39;&gt;</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a><span class="sd">        :Parameters:</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a><span class="sd">          - `codec_options` (optional): An instance of</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a><span class="sd">            :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a><span class="sd">        .. versionchanged:: 3.0</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a><span class="sd">           Removed `compile_re` option: PyMongo now always represents BSON</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a><span class="sd">           regular expressions as :class:`~bson.regex.Regex` objects. Use</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a><span class="sd">           :meth:`~bson.regex.Regex.try_compile` to attempt to convert from a</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a><span class="sd">           BSON regular expression to a Python regular expression object.</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a><span class="sd">           Replaced `as_class`, `tz_aware`, and `uuid_subtype` options with</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a><span class="sd">           `codec_options`.</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>        <span class="k">return</span> <span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">)</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a><span class="k">def</span> <span class="nf">has_c</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Is the C extension installed?&quot;&quot;&quot;</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>    <span class="k">return</span> <span class="n">_USE_C</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a><span class="k">def</span> <span class="nf">_after_fork</span><span class="p">():</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Releases the ObjectID lock child.&quot;&quot;&quot;</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>    <span class="k">if</span> <span class="n">ObjectId</span><span class="o">.</span><span class="n">_inc_lock</span><span class="o">.</span><span class="n">locked</span><span class="p">():</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>        <span class="n">ObjectId</span><span class="o">.</span><span class="n">_inc_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a><span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s2">&quot;register_at_fork&quot;</span><span class="p">):</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>    <span class="c1"># This will run in the same thread as the fork was called.</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>    <span class="c1"># If we fork in a critical region on the same thread, it should break.</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>    <span class="c1"># This is fine since we would never call fork directly from a critical region.</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">register_at_fork</span><span class="p">(</span><span class="n">after_in_child</span><span class="o">=</span><span class="n">_after_fork</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="ALL_UUID_SUBTYPES">
                    <div class="attr variable">
            <span class="name">ALL_UUID_SUBTYPES</span>        =
<span class="default_value">(3, 4)</span>

        
    </div>
    <a class="headerlink" href="#ALL_UUID_SUBTYPES"></a>
    
    

                </section>
                <section id="CSHARP_LEGACY">
                    <div class="attr variable">
            <span class="name">CSHARP_LEGACY</span>        =
<span class="default_value">6</span>

        
    </div>
    <a class="headerlink" href="#CSHARP_LEGACY"></a>
    
    

                </section>
                <section id="JAVA_LEGACY">
                    <div class="attr variable">
            <span class="name">JAVA_LEGACY</span>        =
<span class="default_value">5</span>

        
    </div>
    <a class="headerlink" href="#JAVA_LEGACY"></a>
    
    

                </section>
                <section id="OLD_UUID_SUBTYPE">
                    <div class="attr variable">
            <span class="name">OLD_UUID_SUBTYPE</span>        =
<span class="default_value">3</span>

        
    </div>
    <a class="headerlink" href="#OLD_UUID_SUBTYPE"></a>
    
    

                </section>
                <section id="STANDARD">
                    <div class="attr variable">
            <span class="name">STANDARD</span>        =
<span class="default_value">4</span>

        
    </div>
    <a class="headerlink" href="#STANDARD"></a>
    
    

                </section>
                <section id="UUID_SUBTYPE">
                    <div class="attr variable">
            <span class="name">UUID_SUBTYPE</span>        =
<span class="default_value">4</span>

        
    </div>
    <a class="headerlink" href="#UUID_SUBTYPE"></a>
    
    

                </section>
                <section id="Binary">
                            <input id="Binary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Binary</span><wbr>(<span class="base">builtins.bytes</span>):

                <label class="view-source-button" for="Binary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Binary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Binary-192"><a href="#Binary-192"><span class="linenos">192</span></a><span class="k">class</span> <span class="nc">Binary</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
</span><span id="Binary-193"><a href="#Binary-193"><span class="linenos">193</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Representation of BSON binary data.</span>
</span><span id="Binary-194"><a href="#Binary-194"><span class="linenos">194</span></a>
</span><span id="Binary-195"><a href="#Binary-195"><span class="linenos">195</span></a><span class="sd">    This is necessary because we want to represent Python strings as</span>
</span><span id="Binary-196"><a href="#Binary-196"><span class="linenos">196</span></a><span class="sd">    the BSON string type. We need to wrap binary data so we can tell</span>
</span><span id="Binary-197"><a href="#Binary-197"><span class="linenos">197</span></a><span class="sd">    the difference between what should be considered binary data and</span>
</span><span id="Binary-198"><a href="#Binary-198"><span class="linenos">198</span></a><span class="sd">    what should be considered a string when we encode to BSON.</span>
</span><span id="Binary-199"><a href="#Binary-199"><span class="linenos">199</span></a>
</span><span id="Binary-200"><a href="#Binary-200"><span class="linenos">200</span></a><span class="sd">    Raises TypeError if `data` is not an instance of :class:`bytes`</span>
</span><span id="Binary-201"><a href="#Binary-201"><span class="linenos">201</span></a><span class="sd">    (:class:`str` in python 2) or `subtype` is not an instance of</span>
</span><span id="Binary-202"><a href="#Binary-202"><span class="linenos">202</span></a><span class="sd">    :class:`int`. Raises ValueError if `subtype` is not in [0, 256).</span>
</span><span id="Binary-203"><a href="#Binary-203"><span class="linenos">203</span></a>
</span><span id="Binary-204"><a href="#Binary-204"><span class="linenos">204</span></a><span class="sd">    .. note::</span>
</span><span id="Binary-205"><a href="#Binary-205"><span class="linenos">205</span></a><span class="sd">      In python 3 instances of Binary with subtype 0 will be decoded</span>
</span><span id="Binary-206"><a href="#Binary-206"><span class="linenos">206</span></a><span class="sd">      directly to :class:`bytes`.</span>
</span><span id="Binary-207"><a href="#Binary-207"><span class="linenos">207</span></a>
</span><span id="Binary-208"><a href="#Binary-208"><span class="linenos">208</span></a><span class="sd">    :Parameters:</span>
</span><span id="Binary-209"><a href="#Binary-209"><span class="linenos">209</span></a><span class="sd">      - `data`: the binary data to represent. Can be any bytes-like type</span>
</span><span id="Binary-210"><a href="#Binary-210"><span class="linenos">210</span></a><span class="sd">        that implements the buffer protocol.</span>
</span><span id="Binary-211"><a href="#Binary-211"><span class="linenos">211</span></a><span class="sd">      - `subtype` (optional): the `binary subtype</span>
</span><span id="Binary-212"><a href="#Binary-212"><span class="linenos">212</span></a><span class="sd">        &lt;https://bsonspec.org/spec.html&gt;`_</span>
</span><span id="Binary-213"><a href="#Binary-213"><span class="linenos">213</span></a><span class="sd">        to use</span>
</span><span id="Binary-214"><a href="#Binary-214"><span class="linenos">214</span></a>
</span><span id="Binary-215"><a href="#Binary-215"><span class="linenos">215</span></a><span class="sd">    .. versionchanged:: 3.9</span>
</span><span id="Binary-216"><a href="#Binary-216"><span class="linenos">216</span></a><span class="sd">      Support any bytes-like type that implements the buffer protocol.</span>
</span><span id="Binary-217"><a href="#Binary-217"><span class="linenos">217</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Binary-218"><a href="#Binary-218"><span class="linenos">218</span></a>
</span><span id="Binary-219"><a href="#Binary-219"><span class="linenos">219</span></a>    <span class="n">_type_marker</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="Binary-220"><a href="#Binary-220"><span class="linenos">220</span></a>    <span class="n">__subtype</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="Binary-221"><a href="#Binary-221"><span class="linenos">221</span></a>
</span><span id="Binary-222"><a href="#Binary-222"><span class="linenos">222</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="Binary-223"><a href="#Binary-223"><span class="linenos">223</span></a>        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Binary&quot;</span><span class="p">],</span>
</span><span id="Binary-224"><a href="#Binary-224"><span class="linenos">224</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">memoryview</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="s2">&quot;_mmap&quot;</span><span class="p">,</span> <span class="s2">&quot;_array&quot;</span><span class="p">],</span>
</span><span id="Binary-225"><a href="#Binary-225"><span class="linenos">225</span></a>        <span class="n">subtype</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">BINARY_SUBTYPE</span><span class="p">,</span>
</span><span id="Binary-226"><a href="#Binary-226"><span class="linenos">226</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Binary&quot;</span><span class="p">:</span>
</span><span id="Binary-227"><a href="#Binary-227"><span class="linenos">227</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subtype</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Binary-228"><a href="#Binary-228"><span class="linenos">228</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;subtype must be an instance of int&quot;</span><span class="p">)</span>
</span><span id="Binary-229"><a href="#Binary-229"><span class="linenos">229</span></a>        <span class="k">if</span> <span class="n">subtype</span> <span class="o">&gt;=</span> <span class="mi">256</span> <span class="ow">or</span> <span class="n">subtype</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Binary-230"><a href="#Binary-230"><span class="linenos">230</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;subtype must be contained in [0, 256)&quot;</span><span class="p">)</span>
</span><span id="Binary-231"><a href="#Binary-231"><span class="linenos">231</span></a>        <span class="c1"># Support any type that implements the buffer protocol.</span>
</span><span id="Binary-232"><a href="#Binary-232"><span class="linenos">232</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">tobytes</span><span class="p">())</span>
</span><span id="Binary-233"><a href="#Binary-233"><span class="linenos">233</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__subtype</span> <span class="o">=</span> <span class="n">subtype</span>
</span><span id="Binary-234"><a href="#Binary-234"><span class="linenos">234</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Binary-235"><a href="#Binary-235"><span class="linenos">235</span></a>
</span><span id="Binary-236"><a href="#Binary-236"><span class="linenos">236</span></a>    <span class="nd">@classmethod</span>
</span><span id="Binary-237"><a href="#Binary-237"><span class="linenos">237</span></a>    <span class="k">def</span> <span class="nf">from_uuid</span><span class="p">(</span>
</span><span id="Binary-238"><a href="#Binary-238"><span class="linenos">238</span></a>        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Binary&quot;</span><span class="p">],</span> <span class="n">uuid</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span> <span class="n">uuid_representation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">STANDARD</span>
</span><span id="Binary-239"><a href="#Binary-239"><span class="linenos">239</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Binary&quot;</span><span class="p">:</span>
</span><span id="Binary-240"><a href="#Binary-240"><span class="linenos">240</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a BSON Binary object from a Python UUID.</span>
</span><span id="Binary-241"><a href="#Binary-241"><span class="linenos">241</span></a>
</span><span id="Binary-242"><a href="#Binary-242"><span class="linenos">242</span></a><span class="sd">        Creates a :class:`~bson.binary.Binary` object from a</span>
</span><span id="Binary-243"><a href="#Binary-243"><span class="linenos">243</span></a><span class="sd">        :class:`uuid.UUID` instance. Assumes that the native</span>
</span><span id="Binary-244"><a href="#Binary-244"><span class="linenos">244</span></a><span class="sd">        :class:`uuid.UUID` instance uses the byte-order implied by the</span>
</span><span id="Binary-245"><a href="#Binary-245"><span class="linenos">245</span></a><span class="sd">        provided ``uuid_representation``.</span>
</span><span id="Binary-246"><a href="#Binary-246"><span class="linenos">246</span></a>
</span><span id="Binary-247"><a href="#Binary-247"><span class="linenos">247</span></a><span class="sd">        Raises :exc:`TypeError` if `uuid` is not an instance of</span>
</span><span id="Binary-248"><a href="#Binary-248"><span class="linenos">248</span></a><span class="sd">        :class:`~uuid.UUID`.</span>
</span><span id="Binary-249"><a href="#Binary-249"><span class="linenos">249</span></a>
</span><span id="Binary-250"><a href="#Binary-250"><span class="linenos">250</span></a><span class="sd">        :Parameters:</span>
</span><span id="Binary-251"><a href="#Binary-251"><span class="linenos">251</span></a><span class="sd">          - `uuid`: A :class:`uuid.UUID` instance.</span>
</span><span id="Binary-252"><a href="#Binary-252"><span class="linenos">252</span></a><span class="sd">          - `uuid_representation`: A member of</span>
</span><span id="Binary-253"><a href="#Binary-253"><span class="linenos">253</span></a><span class="sd">            :class:`~bson.binary.UuidRepresentation`. Default:</span>
</span><span id="Binary-254"><a href="#Binary-254"><span class="linenos">254</span></a><span class="sd">            :const:`~bson.binary.UuidRepresentation.STANDARD`.</span>
</span><span id="Binary-255"><a href="#Binary-255"><span class="linenos">255</span></a><span class="sd">            See :ref:`handling-uuid-data-example` for details.</span>
</span><span id="Binary-256"><a href="#Binary-256"><span class="linenos">256</span></a>
</span><span id="Binary-257"><a href="#Binary-257"><span class="linenos">257</span></a><span class="sd">        .. versionadded:: 3.11</span>
</span><span id="Binary-258"><a href="#Binary-258"><span class="linenos">258</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Binary-259"><a href="#Binary-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">UUID</span><span class="p">):</span>
</span><span id="Binary-260"><a href="#Binary-260"><span class="linenos">260</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;uuid must be an instance of uuid.UUID&quot;</span><span class="p">)</span>
</span><span id="Binary-261"><a href="#Binary-261"><span class="linenos">261</span></a>
</span><span id="Binary-262"><a href="#Binary-262"><span class="linenos">262</span></a>        <span class="k">if</span> <span class="n">uuid_representation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALL_UUID_REPRESENTATIONS</span><span class="p">:</span>
</span><span id="Binary-263"><a href="#Binary-263"><span class="linenos">263</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Binary-264"><a href="#Binary-264"><span class="linenos">264</span></a>                <span class="s2">&quot;uuid_representation must be a value from .binary.UuidRepresentation&quot;</span>
</span><span id="Binary-265"><a href="#Binary-265"><span class="linenos">265</span></a>            <span class="p">)</span>
</span><span id="Binary-266"><a href="#Binary-266"><span class="linenos">266</span></a>
</span><span id="Binary-267"><a href="#Binary-267"><span class="linenos">267</span></a>        <span class="k">if</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">UNSPECIFIED</span><span class="p">:</span>
</span><span id="Binary-268"><a href="#Binary-268"><span class="linenos">268</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Binary-269"><a href="#Binary-269"><span class="linenos">269</span></a>                <span class="s2">&quot;cannot encode native uuid.UUID with &quot;</span>
</span><span id="Binary-270"><a href="#Binary-270"><span class="linenos">270</span></a>                <span class="s2">&quot;UuidRepresentation.UNSPECIFIED. UUIDs can be manually &quot;</span>
</span><span id="Binary-271"><a href="#Binary-271"><span class="linenos">271</span></a>                <span class="s2">&quot;converted to bson.Binary instances using &quot;</span>
</span><span id="Binary-272"><a href="#Binary-272"><span class="linenos">272</span></a>                <span class="s2">&quot;bson.Binary.from_uuid() or a different UuidRepresentation &quot;</span>
</span><span id="Binary-273"><a href="#Binary-273"><span class="linenos">273</span></a>                <span class="s2">&quot;can be configured. See the documentation for &quot;</span>
</span><span id="Binary-274"><a href="#Binary-274"><span class="linenos">274</span></a>                <span class="s2">&quot;UuidRepresentation for more information.&quot;</span>
</span><span id="Binary-275"><a href="#Binary-275"><span class="linenos">275</span></a>            <span class="p">)</span>
</span><span id="Binary-276"><a href="#Binary-276"><span class="linenos">276</span></a>
</span><span id="Binary-277"><a href="#Binary-277"><span class="linenos">277</span></a>        <span class="n">subtype</span> <span class="o">=</span> <span class="n">OLD_UUID_SUBTYPE</span>
</span><span id="Binary-278"><a href="#Binary-278"><span class="linenos">278</span></a>        <span class="k">if</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">PYTHON_LEGACY</span><span class="p">:</span>
</span><span id="Binary-279"><a href="#Binary-279"><span class="linenos">279</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">bytes</span>
</span><span id="Binary-280"><a href="#Binary-280"><span class="linenos">280</span></a>        <span class="k">elif</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">JAVA_LEGACY</span><span class="p">:</span>
</span><span id="Binary-281"><a href="#Binary-281"><span class="linenos">281</span></a>            <span class="n">from_uuid</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">bytes</span>
</span><span id="Binary-282"><a href="#Binary-282"><span class="linenos">282</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">from_uuid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">from_uuid</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">16</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Binary-283"><a href="#Binary-283"><span class="linenos">283</span></a>        <span class="k">elif</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">CSHARP_LEGACY</span><span class="p">:</span>
</span><span id="Binary-284"><a href="#Binary-284"><span class="linenos">284</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">bytes_le</span>
</span><span id="Binary-285"><a href="#Binary-285"><span class="linenos">285</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Binary-286"><a href="#Binary-286"><span class="linenos">286</span></a>            <span class="c1"># uuid_representation == UuidRepresentation.STANDARD</span>
</span><span id="Binary-287"><a href="#Binary-287"><span class="linenos">287</span></a>            <span class="n">subtype</span> <span class="o">=</span> <span class="n">UUID_SUBTYPE</span>
</span><span id="Binary-288"><a href="#Binary-288"><span class="linenos">288</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">bytes</span>
</span><span id="Binary-289"><a href="#Binary-289"><span class="linenos">289</span></a>
</span><span id="Binary-290"><a href="#Binary-290"><span class="linenos">290</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">subtype</span><span class="p">)</span>
</span><span id="Binary-291"><a href="#Binary-291"><span class="linenos">291</span></a>
</span><span id="Binary-292"><a href="#Binary-292"><span class="linenos">292</span></a>    <span class="k">def</span> <span class="nf">as_uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uuid_representation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">STANDARD</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UUID</span><span class="p">:</span>
</span><span id="Binary-293"><a href="#Binary-293"><span class="linenos">293</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Python UUID from this BSON Binary object.</span>
</span><span id="Binary-294"><a href="#Binary-294"><span class="linenos">294</span></a>
</span><span id="Binary-295"><a href="#Binary-295"><span class="linenos">295</span></a><span class="sd">        Decodes this binary object as a native :class:`uuid.UUID` instance</span>
</span><span id="Binary-296"><a href="#Binary-296"><span class="linenos">296</span></a><span class="sd">        with the provided ``uuid_representation``.</span>
</span><span id="Binary-297"><a href="#Binary-297"><span class="linenos">297</span></a>
</span><span id="Binary-298"><a href="#Binary-298"><span class="linenos">298</span></a><span class="sd">        Raises :exc:`ValueError` if this :class:`~bson.binary.Binary` instance</span>
</span><span id="Binary-299"><a href="#Binary-299"><span class="linenos">299</span></a><span class="sd">        does not contain a UUID.</span>
</span><span id="Binary-300"><a href="#Binary-300"><span class="linenos">300</span></a>
</span><span id="Binary-301"><a href="#Binary-301"><span class="linenos">301</span></a><span class="sd">        :Parameters:</span>
</span><span id="Binary-302"><a href="#Binary-302"><span class="linenos">302</span></a><span class="sd">          - `uuid_representation`: A member of</span>
</span><span id="Binary-303"><a href="#Binary-303"><span class="linenos">303</span></a><span class="sd">            :class:`~bson.binary.UuidRepresentation`. Default:</span>
</span><span id="Binary-304"><a href="#Binary-304"><span class="linenos">304</span></a><span class="sd">            :const:`~bson.binary.UuidRepresentation.STANDARD`.</span>
</span><span id="Binary-305"><a href="#Binary-305"><span class="linenos">305</span></a><span class="sd">            See :ref:`handling-uuid-data-example` for details.</span>
</span><span id="Binary-306"><a href="#Binary-306"><span class="linenos">306</span></a>
</span><span id="Binary-307"><a href="#Binary-307"><span class="linenos">307</span></a><span class="sd">        .. versionadded:: 3.11</span>
</span><span id="Binary-308"><a href="#Binary-308"><span class="linenos">308</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Binary-309"><a href="#Binary-309"><span class="linenos">309</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALL_UUID_SUBTYPES</span><span class="p">:</span>
</span><span id="Binary-310"><a href="#Binary-310"><span class="linenos">310</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot decode subtype </span><span class="si">%s</span><span class="s2"> as a uuid&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subtype</span><span class="p">,))</span>
</span><span id="Binary-311"><a href="#Binary-311"><span class="linenos">311</span></a>
</span><span id="Binary-312"><a href="#Binary-312"><span class="linenos">312</span></a>        <span class="k">if</span> <span class="n">uuid_representation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALL_UUID_REPRESENTATIONS</span><span class="p">:</span>
</span><span id="Binary-313"><a href="#Binary-313"><span class="linenos">313</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Binary-314"><a href="#Binary-314"><span class="linenos">314</span></a>                <span class="s2">&quot;uuid_representation must be a value from .binary.UuidRepresentation&quot;</span>
</span><span id="Binary-315"><a href="#Binary-315"><span class="linenos">315</span></a>            <span class="p">)</span>
</span><span id="Binary-316"><a href="#Binary-316"><span class="linenos">316</span></a>
</span><span id="Binary-317"><a href="#Binary-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">UNSPECIFIED</span><span class="p">:</span>
</span><span id="Binary-318"><a href="#Binary-318"><span class="linenos">318</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;uuid_representation cannot be UNSPECIFIED&quot;</span><span class="p">)</span>
</span><span id="Binary-319"><a href="#Binary-319"><span class="linenos">319</span></a>        <span class="k">elif</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">PYTHON_LEGACY</span><span class="p">:</span>
</span><span id="Binary-320"><a href="#Binary-320"><span class="linenos">320</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtype</span> <span class="o">==</span> <span class="n">OLD_UUID_SUBTYPE</span><span class="p">:</span>
</span><span id="Binary-321"><a href="#Binary-321"><span class="linenos">321</span></a>                <span class="k">return</span> <span class="n">UUID</span><span class="p">(</span><span class="nb">bytes</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Binary-322"><a href="#Binary-322"><span class="linenos">322</span></a>        <span class="k">elif</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">JAVA_LEGACY</span><span class="p">:</span>
</span><span id="Binary-323"><a href="#Binary-323"><span class="linenos">323</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtype</span> <span class="o">==</span> <span class="n">OLD_UUID_SUBTYPE</span><span class="p">:</span>
</span><span id="Binary-324"><a href="#Binary-324"><span class="linenos">324</span></a>                <span class="k">return</span> <span class="n">UUID</span><span class="p">(</span><span class="nb">bytes</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">16</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Binary-325"><a href="#Binary-325"><span class="linenos">325</span></a>        <span class="k">elif</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">CSHARP_LEGACY</span><span class="p">:</span>
</span><span id="Binary-326"><a href="#Binary-326"><span class="linenos">326</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtype</span> <span class="o">==</span> <span class="n">OLD_UUID_SUBTYPE</span><span class="p">:</span>
</span><span id="Binary-327"><a href="#Binary-327"><span class="linenos">327</span></a>                <span class="k">return</span> <span class="n">UUID</span><span class="p">(</span><span class="n">bytes_le</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Binary-328"><a href="#Binary-328"><span class="linenos">328</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Binary-329"><a href="#Binary-329"><span class="linenos">329</span></a>            <span class="c1"># uuid_representation == UuidRepresentation.STANDARD</span>
</span><span id="Binary-330"><a href="#Binary-330"><span class="linenos">330</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtype</span> <span class="o">==</span> <span class="n">UUID_SUBTYPE</span><span class="p">:</span>
</span><span id="Binary-331"><a href="#Binary-331"><span class="linenos">331</span></a>                <span class="k">return</span> <span class="n">UUID</span><span class="p">(</span><span class="nb">bytes</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Binary-332"><a href="#Binary-332"><span class="linenos">332</span></a>
</span><span id="Binary-333"><a href="#Binary-333"><span class="linenos">333</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Binary-334"><a href="#Binary-334"><span class="linenos">334</span></a>            <span class="s2">&quot;cannot decode subtype </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span>
</span><span id="Binary-335"><a href="#Binary-335"><span class="linenos">335</span></a>            <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subtype</span><span class="p">,</span> <span class="n">UUID_REPRESENTATION_NAMES</span><span class="p">[</span><span class="n">uuid_representation</span><span class="p">])</span>
</span><span id="Binary-336"><a href="#Binary-336"><span class="linenos">336</span></a>        <span class="p">)</span>
</span><span id="Binary-337"><a href="#Binary-337"><span class="linenos">337</span></a>
</span><span id="Binary-338"><a href="#Binary-338"><span class="linenos">338</span></a>    <span class="nd">@property</span>
</span><span id="Binary-339"><a href="#Binary-339"><span class="linenos">339</span></a>    <span class="k">def</span> <span class="nf">subtype</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Binary-340"><a href="#Binary-340"><span class="linenos">340</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Subtype of this binary data.&quot;&quot;&quot;</span>
</span><span id="Binary-341"><a href="#Binary-341"><span class="linenos">341</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__subtype</span>
</span><span id="Binary-342"><a href="#Binary-342"><span class="linenos">342</span></a>
</span><span id="Binary-343"><a href="#Binary-343"><span class="linenos">343</span></a>    <span class="k">def</span> <span class="nf">__getnewargs__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>  <span class="c1"># type: ignore[override]</span>
</span><span id="Binary-344"><a href="#Binary-344"><span class="linenos">344</span></a>        <span class="c1"># Work around http://bugs.python.org/issue7382</span>
</span><span id="Binary-345"><a href="#Binary-345"><span class="linenos">345</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Binary</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__getnewargs__</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Binary-346"><a href="#Binary-346"><span class="linenos">346</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="Binary-347"><a href="#Binary-347"><span class="linenos">347</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span>
</span><span id="Binary-348"><a href="#Binary-348"><span class="linenos">348</span></a>        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__subtype</span>
</span><span id="Binary-349"><a href="#Binary-349"><span class="linenos">349</span></a>
</span><span id="Binary-350"><a href="#Binary-350"><span class="linenos">350</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Binary-351"><a href="#Binary-351"><span class="linenos">351</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Binary</span><span class="p">):</span>
</span><span id="Binary-352"><a href="#Binary-352"><span class="linenos">352</span></a>            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__subtype</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">==</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">subtype</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
</span><span id="Binary-353"><a href="#Binary-353"><span class="linenos">353</span></a>        <span class="c1"># We don&#39;t return NotImplemented here because if we did then</span>
</span><span id="Binary-354"><a href="#Binary-354"><span class="linenos">354</span></a>        <span class="c1"># Binary(&quot;foo&quot;) == &quot;foo&quot; would return True, since Binary is a</span>
</span><span id="Binary-355"><a href="#Binary-355"><span class="linenos">355</span></a>        <span class="c1"># subclass of str...</span>
</span><span id="Binary-356"><a href="#Binary-356"><span class="linenos">356</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Binary-357"><a href="#Binary-357"><span class="linenos">357</span></a>
</span><span id="Binary-358"><a href="#Binary-358"><span class="linenos">358</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Binary-359"><a href="#Binary-359"><span class="linenos">359</span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Binary</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span> <span class="o">^</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__subtype</span><span class="p">)</span>
</span><span id="Binary-360"><a href="#Binary-360"><span class="linenos">360</span></a>
</span><span id="Binary-361"><a href="#Binary-361"><span class="linenos">361</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Binary-362"><a href="#Binary-362"><span class="linenos">362</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="Binary-363"><a href="#Binary-363"><span class="linenos">363</span></a>
</span><span id="Binary-364"><a href="#Binary-364"><span class="linenos">364</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Binary-365"><a href="#Binary-365"><span class="linenos">365</span></a>        <span class="k">return</span> <span class="s2">&quot;Binary(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">bytes</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__subtype</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Representation of BSON binary data.</p>

<p>This is necessary because we want to represent Python strings as
the BSON string type. We need to wrap binary data so we can tell
the difference between what should be considered binary data and
what should be considered a string when we encode to BSON.</p>

<p>Raises TypeError if <code>data</code> is not an instance of <code>bytes</code>
(<code>str</code> in python 2) or <code><a href="#Binary.subtype">subtype</a></code> is not an instance of
<code>int</code>. Raises ValueError if <code><a href="#Binary.subtype">subtype</a></code> is not in [0, 256).</p>

<div class="pdoc-alert pdoc-alert-note">

<p>In python 3 instances of Binary with subtype 0 will be decoded
directly to <code>bytes</code>.</p>

</div>

<p>:Parameters:</p>

<ul>
<li><code>data</code>: the binary data to represent. Can be any bytes-like type
that implements the buffer protocol.</li>
<li><code><a href="#Binary.subtype">subtype</a></code> (optional): the <a href="https://bsonspec.org/spec.html">binary subtype
</a>
to use</li>
</ul>

<p><em>Changed in version 3.9:</em>
Support any bytes-like type that implements the buffer protocol.</p>
</div>


                            <div id="Binary.from_uuid" class="classattr">
                                        <input id="Binary.from_uuid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_uuid</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n"><a href="#Binary">xtquant.xtbson.bson37.Binary</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">uuid</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span>,</span><span class="param">	<span class="n">uuid_representation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span></span><span class="return-annotation">) -> <span class="n"><a href="#Binary">xtquant.xtbson.bson37.Binary</a></span>:</span></span>

                <label class="view-source-button" for="Binary.from_uuid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Binary.from_uuid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Binary.from_uuid-236"><a href="#Binary.from_uuid-236"><span class="linenos">236</span></a>    <span class="nd">@classmethod</span>
</span><span id="Binary.from_uuid-237"><a href="#Binary.from_uuid-237"><span class="linenos">237</span></a>    <span class="k">def</span> <span class="nf">from_uuid</span><span class="p">(</span>
</span><span id="Binary.from_uuid-238"><a href="#Binary.from_uuid-238"><span class="linenos">238</span></a>        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Binary&quot;</span><span class="p">],</span> <span class="n">uuid</span><span class="p">:</span> <span class="n">UUID</span><span class="p">,</span> <span class="n">uuid_representation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">STANDARD</span>
</span><span id="Binary.from_uuid-239"><a href="#Binary.from_uuid-239"><span class="linenos">239</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Binary&quot;</span><span class="p">:</span>
</span><span id="Binary.from_uuid-240"><a href="#Binary.from_uuid-240"><span class="linenos">240</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a BSON Binary object from a Python UUID.</span>
</span><span id="Binary.from_uuid-241"><a href="#Binary.from_uuid-241"><span class="linenos">241</span></a>
</span><span id="Binary.from_uuid-242"><a href="#Binary.from_uuid-242"><span class="linenos">242</span></a><span class="sd">        Creates a :class:`~bson.binary.Binary` object from a</span>
</span><span id="Binary.from_uuid-243"><a href="#Binary.from_uuid-243"><span class="linenos">243</span></a><span class="sd">        :class:`uuid.UUID` instance. Assumes that the native</span>
</span><span id="Binary.from_uuid-244"><a href="#Binary.from_uuid-244"><span class="linenos">244</span></a><span class="sd">        :class:`uuid.UUID` instance uses the byte-order implied by the</span>
</span><span id="Binary.from_uuid-245"><a href="#Binary.from_uuid-245"><span class="linenos">245</span></a><span class="sd">        provided ``uuid_representation``.</span>
</span><span id="Binary.from_uuid-246"><a href="#Binary.from_uuid-246"><span class="linenos">246</span></a>
</span><span id="Binary.from_uuid-247"><a href="#Binary.from_uuid-247"><span class="linenos">247</span></a><span class="sd">        Raises :exc:`TypeError` if `uuid` is not an instance of</span>
</span><span id="Binary.from_uuid-248"><a href="#Binary.from_uuid-248"><span class="linenos">248</span></a><span class="sd">        :class:`~uuid.UUID`.</span>
</span><span id="Binary.from_uuid-249"><a href="#Binary.from_uuid-249"><span class="linenos">249</span></a>
</span><span id="Binary.from_uuid-250"><a href="#Binary.from_uuid-250"><span class="linenos">250</span></a><span class="sd">        :Parameters:</span>
</span><span id="Binary.from_uuid-251"><a href="#Binary.from_uuid-251"><span class="linenos">251</span></a><span class="sd">          - `uuid`: A :class:`uuid.UUID` instance.</span>
</span><span id="Binary.from_uuid-252"><a href="#Binary.from_uuid-252"><span class="linenos">252</span></a><span class="sd">          - `uuid_representation`: A member of</span>
</span><span id="Binary.from_uuid-253"><a href="#Binary.from_uuid-253"><span class="linenos">253</span></a><span class="sd">            :class:`~bson.binary.UuidRepresentation`. Default:</span>
</span><span id="Binary.from_uuid-254"><a href="#Binary.from_uuid-254"><span class="linenos">254</span></a><span class="sd">            :const:`~bson.binary.UuidRepresentation.STANDARD`.</span>
</span><span id="Binary.from_uuid-255"><a href="#Binary.from_uuid-255"><span class="linenos">255</span></a><span class="sd">            See :ref:`handling-uuid-data-example` for details.</span>
</span><span id="Binary.from_uuid-256"><a href="#Binary.from_uuid-256"><span class="linenos">256</span></a>
</span><span id="Binary.from_uuid-257"><a href="#Binary.from_uuid-257"><span class="linenos">257</span></a><span class="sd">        .. versionadded:: 3.11</span>
</span><span id="Binary.from_uuid-258"><a href="#Binary.from_uuid-258"><span class="linenos">258</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Binary.from_uuid-259"><a href="#Binary.from_uuid-259"><span class="linenos">259</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uuid</span><span class="p">,</span> <span class="n">UUID</span><span class="p">):</span>
</span><span id="Binary.from_uuid-260"><a href="#Binary.from_uuid-260"><span class="linenos">260</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;uuid must be an instance of uuid.UUID&quot;</span><span class="p">)</span>
</span><span id="Binary.from_uuid-261"><a href="#Binary.from_uuid-261"><span class="linenos">261</span></a>
</span><span id="Binary.from_uuid-262"><a href="#Binary.from_uuid-262"><span class="linenos">262</span></a>        <span class="k">if</span> <span class="n">uuid_representation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALL_UUID_REPRESENTATIONS</span><span class="p">:</span>
</span><span id="Binary.from_uuid-263"><a href="#Binary.from_uuid-263"><span class="linenos">263</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Binary.from_uuid-264"><a href="#Binary.from_uuid-264"><span class="linenos">264</span></a>                <span class="s2">&quot;uuid_representation must be a value from .binary.UuidRepresentation&quot;</span>
</span><span id="Binary.from_uuid-265"><a href="#Binary.from_uuid-265"><span class="linenos">265</span></a>            <span class="p">)</span>
</span><span id="Binary.from_uuid-266"><a href="#Binary.from_uuid-266"><span class="linenos">266</span></a>
</span><span id="Binary.from_uuid-267"><a href="#Binary.from_uuid-267"><span class="linenos">267</span></a>        <span class="k">if</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">UNSPECIFIED</span><span class="p">:</span>
</span><span id="Binary.from_uuid-268"><a href="#Binary.from_uuid-268"><span class="linenos">268</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Binary.from_uuid-269"><a href="#Binary.from_uuid-269"><span class="linenos">269</span></a>                <span class="s2">&quot;cannot encode native uuid.UUID with &quot;</span>
</span><span id="Binary.from_uuid-270"><a href="#Binary.from_uuid-270"><span class="linenos">270</span></a>                <span class="s2">&quot;UuidRepresentation.UNSPECIFIED. UUIDs can be manually &quot;</span>
</span><span id="Binary.from_uuid-271"><a href="#Binary.from_uuid-271"><span class="linenos">271</span></a>                <span class="s2">&quot;converted to bson.Binary instances using &quot;</span>
</span><span id="Binary.from_uuid-272"><a href="#Binary.from_uuid-272"><span class="linenos">272</span></a>                <span class="s2">&quot;bson.Binary.from_uuid() or a different UuidRepresentation &quot;</span>
</span><span id="Binary.from_uuid-273"><a href="#Binary.from_uuid-273"><span class="linenos">273</span></a>                <span class="s2">&quot;can be configured. See the documentation for &quot;</span>
</span><span id="Binary.from_uuid-274"><a href="#Binary.from_uuid-274"><span class="linenos">274</span></a>                <span class="s2">&quot;UuidRepresentation for more information.&quot;</span>
</span><span id="Binary.from_uuid-275"><a href="#Binary.from_uuid-275"><span class="linenos">275</span></a>            <span class="p">)</span>
</span><span id="Binary.from_uuid-276"><a href="#Binary.from_uuid-276"><span class="linenos">276</span></a>
</span><span id="Binary.from_uuid-277"><a href="#Binary.from_uuid-277"><span class="linenos">277</span></a>        <span class="n">subtype</span> <span class="o">=</span> <span class="n">OLD_UUID_SUBTYPE</span>
</span><span id="Binary.from_uuid-278"><a href="#Binary.from_uuid-278"><span class="linenos">278</span></a>        <span class="k">if</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">PYTHON_LEGACY</span><span class="p">:</span>
</span><span id="Binary.from_uuid-279"><a href="#Binary.from_uuid-279"><span class="linenos">279</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">bytes</span>
</span><span id="Binary.from_uuid-280"><a href="#Binary.from_uuid-280"><span class="linenos">280</span></a>        <span class="k">elif</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">JAVA_LEGACY</span><span class="p">:</span>
</span><span id="Binary.from_uuid-281"><a href="#Binary.from_uuid-281"><span class="linenos">281</span></a>            <span class="n">from_uuid</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">bytes</span>
</span><span id="Binary.from_uuid-282"><a href="#Binary.from_uuid-282"><span class="linenos">282</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">from_uuid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">from_uuid</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">16</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Binary.from_uuid-283"><a href="#Binary.from_uuid-283"><span class="linenos">283</span></a>        <span class="k">elif</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">CSHARP_LEGACY</span><span class="p">:</span>
</span><span id="Binary.from_uuid-284"><a href="#Binary.from_uuid-284"><span class="linenos">284</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">bytes_le</span>
</span><span id="Binary.from_uuid-285"><a href="#Binary.from_uuid-285"><span class="linenos">285</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Binary.from_uuid-286"><a href="#Binary.from_uuid-286"><span class="linenos">286</span></a>            <span class="c1"># uuid_representation == UuidRepresentation.STANDARD</span>
</span><span id="Binary.from_uuid-287"><a href="#Binary.from_uuid-287"><span class="linenos">287</span></a>            <span class="n">subtype</span> <span class="o">=</span> <span class="n">UUID_SUBTYPE</span>
</span><span id="Binary.from_uuid-288"><a href="#Binary.from_uuid-288"><span class="linenos">288</span></a>            <span class="n">payload</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">bytes</span>
</span><span id="Binary.from_uuid-289"><a href="#Binary.from_uuid-289"><span class="linenos">289</span></a>
</span><span id="Binary.from_uuid-290"><a href="#Binary.from_uuid-290"><span class="linenos">290</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">subtype</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a BSON Binary object from a Python UUID.</p>

<p>Creates a <code>~bson.binary.Binary</code> object from a
<code>uuid.UUID</code> instance. Assumes that the native
<code>uuid.UUID</code> instance uses the byte-order implied by the
provided <code>uuid_representation</code>.</p>

<p>Raises <code>TypeError</code> if <code>uuid</code> is not an instance of
<code>~uuid.UUID</code>.</p>

<p>:Parameters:</p>

<ul>
<li><code>uuid</code>: A <code>uuid.UUID</code> instance.</li>
<li><code>uuid_representation</code>: A member of
<code>~bson.binary.UuidRepresentation</code>. Default:
<code>~bson.binary.UuidRepresentation.STANDARD</code>.
See :ref:<code>handling-uuid-data-example</code> for details.</li>
</ul>

<p><em>New in version 3.11.</em></p>
</div>


                            </div>
                            <div id="Binary.as_uuid" class="classattr">
                                        <input id="Binary.as_uuid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">as_uuid</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">uuid_representation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span></span><span class="return-annotation">) -> <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span>:</span></span>

                <label class="view-source-button" for="Binary.as_uuid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Binary.as_uuid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Binary.as_uuid-292"><a href="#Binary.as_uuid-292"><span class="linenos">292</span></a>    <span class="k">def</span> <span class="nf">as_uuid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uuid_representation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">STANDARD</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">UUID</span><span class="p">:</span>
</span><span id="Binary.as_uuid-293"><a href="#Binary.as_uuid-293"><span class="linenos">293</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Python UUID from this BSON Binary object.</span>
</span><span id="Binary.as_uuid-294"><a href="#Binary.as_uuid-294"><span class="linenos">294</span></a>
</span><span id="Binary.as_uuid-295"><a href="#Binary.as_uuid-295"><span class="linenos">295</span></a><span class="sd">        Decodes this binary object as a native :class:`uuid.UUID` instance</span>
</span><span id="Binary.as_uuid-296"><a href="#Binary.as_uuid-296"><span class="linenos">296</span></a><span class="sd">        with the provided ``uuid_representation``.</span>
</span><span id="Binary.as_uuid-297"><a href="#Binary.as_uuid-297"><span class="linenos">297</span></a>
</span><span id="Binary.as_uuid-298"><a href="#Binary.as_uuid-298"><span class="linenos">298</span></a><span class="sd">        Raises :exc:`ValueError` if this :class:`~bson.binary.Binary` instance</span>
</span><span id="Binary.as_uuid-299"><a href="#Binary.as_uuid-299"><span class="linenos">299</span></a><span class="sd">        does not contain a UUID.</span>
</span><span id="Binary.as_uuid-300"><a href="#Binary.as_uuid-300"><span class="linenos">300</span></a>
</span><span id="Binary.as_uuid-301"><a href="#Binary.as_uuid-301"><span class="linenos">301</span></a><span class="sd">        :Parameters:</span>
</span><span id="Binary.as_uuid-302"><a href="#Binary.as_uuid-302"><span class="linenos">302</span></a><span class="sd">          - `uuid_representation`: A member of</span>
</span><span id="Binary.as_uuid-303"><a href="#Binary.as_uuid-303"><span class="linenos">303</span></a><span class="sd">            :class:`~bson.binary.UuidRepresentation`. Default:</span>
</span><span id="Binary.as_uuid-304"><a href="#Binary.as_uuid-304"><span class="linenos">304</span></a><span class="sd">            :const:`~bson.binary.UuidRepresentation.STANDARD`.</span>
</span><span id="Binary.as_uuid-305"><a href="#Binary.as_uuid-305"><span class="linenos">305</span></a><span class="sd">            See :ref:`handling-uuid-data-example` for details.</span>
</span><span id="Binary.as_uuid-306"><a href="#Binary.as_uuid-306"><span class="linenos">306</span></a>
</span><span id="Binary.as_uuid-307"><a href="#Binary.as_uuid-307"><span class="linenos">307</span></a><span class="sd">        .. versionadded:: 3.11</span>
</span><span id="Binary.as_uuid-308"><a href="#Binary.as_uuid-308"><span class="linenos">308</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Binary.as_uuid-309"><a href="#Binary.as_uuid-309"><span class="linenos">309</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALL_UUID_SUBTYPES</span><span class="p">:</span>
</span><span id="Binary.as_uuid-310"><a href="#Binary.as_uuid-310"><span class="linenos">310</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot decode subtype </span><span class="si">%s</span><span class="s2"> as a uuid&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subtype</span><span class="p">,))</span>
</span><span id="Binary.as_uuid-311"><a href="#Binary.as_uuid-311"><span class="linenos">311</span></a>
</span><span id="Binary.as_uuid-312"><a href="#Binary.as_uuid-312"><span class="linenos">312</span></a>        <span class="k">if</span> <span class="n">uuid_representation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALL_UUID_REPRESENTATIONS</span><span class="p">:</span>
</span><span id="Binary.as_uuid-313"><a href="#Binary.as_uuid-313"><span class="linenos">313</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Binary.as_uuid-314"><a href="#Binary.as_uuid-314"><span class="linenos">314</span></a>                <span class="s2">&quot;uuid_representation must be a value from .binary.UuidRepresentation&quot;</span>
</span><span id="Binary.as_uuid-315"><a href="#Binary.as_uuid-315"><span class="linenos">315</span></a>            <span class="p">)</span>
</span><span id="Binary.as_uuid-316"><a href="#Binary.as_uuid-316"><span class="linenos">316</span></a>
</span><span id="Binary.as_uuid-317"><a href="#Binary.as_uuid-317"><span class="linenos">317</span></a>        <span class="k">if</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">UNSPECIFIED</span><span class="p">:</span>
</span><span id="Binary.as_uuid-318"><a href="#Binary.as_uuid-318"><span class="linenos">318</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;uuid_representation cannot be UNSPECIFIED&quot;</span><span class="p">)</span>
</span><span id="Binary.as_uuid-319"><a href="#Binary.as_uuid-319"><span class="linenos">319</span></a>        <span class="k">elif</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">PYTHON_LEGACY</span><span class="p">:</span>
</span><span id="Binary.as_uuid-320"><a href="#Binary.as_uuid-320"><span class="linenos">320</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtype</span> <span class="o">==</span> <span class="n">OLD_UUID_SUBTYPE</span><span class="p">:</span>
</span><span id="Binary.as_uuid-321"><a href="#Binary.as_uuid-321"><span class="linenos">321</span></a>                <span class="k">return</span> <span class="n">UUID</span><span class="p">(</span><span class="nb">bytes</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Binary.as_uuid-322"><a href="#Binary.as_uuid-322"><span class="linenos">322</span></a>        <span class="k">elif</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">JAVA_LEGACY</span><span class="p">:</span>
</span><span id="Binary.as_uuid-323"><a href="#Binary.as_uuid-323"><span class="linenos">323</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtype</span> <span class="o">==</span> <span class="n">OLD_UUID_SUBTYPE</span><span class="p">:</span>
</span><span id="Binary.as_uuid-324"><a href="#Binary.as_uuid-324"><span class="linenos">324</span></a>                <span class="k">return</span> <span class="n">UUID</span><span class="p">(</span><span class="nb">bytes</span><span class="o">=</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">8</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="mi">8</span><span class="p">:</span><span class="mi">16</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Binary.as_uuid-325"><a href="#Binary.as_uuid-325"><span class="linenos">325</span></a>        <span class="k">elif</span> <span class="n">uuid_representation</span> <span class="o">==</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">CSHARP_LEGACY</span><span class="p">:</span>
</span><span id="Binary.as_uuid-326"><a href="#Binary.as_uuid-326"><span class="linenos">326</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtype</span> <span class="o">==</span> <span class="n">OLD_UUID_SUBTYPE</span><span class="p">:</span>
</span><span id="Binary.as_uuid-327"><a href="#Binary.as_uuid-327"><span class="linenos">327</span></a>                <span class="k">return</span> <span class="n">UUID</span><span class="p">(</span><span class="n">bytes_le</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Binary.as_uuid-328"><a href="#Binary.as_uuid-328"><span class="linenos">328</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Binary.as_uuid-329"><a href="#Binary.as_uuid-329"><span class="linenos">329</span></a>            <span class="c1"># uuid_representation == UuidRepresentation.STANDARD</span>
</span><span id="Binary.as_uuid-330"><a href="#Binary.as_uuid-330"><span class="linenos">330</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">subtype</span> <span class="o">==</span> <span class="n">UUID_SUBTYPE</span><span class="p">:</span>
</span><span id="Binary.as_uuid-331"><a href="#Binary.as_uuid-331"><span class="linenos">331</span></a>                <span class="k">return</span> <span class="n">UUID</span><span class="p">(</span><span class="nb">bytes</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Binary.as_uuid-332"><a href="#Binary.as_uuid-332"><span class="linenos">332</span></a>
</span><span id="Binary.as_uuid-333"><a href="#Binary.as_uuid-333"><span class="linenos">333</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Binary.as_uuid-334"><a href="#Binary.as_uuid-334"><span class="linenos">334</span></a>            <span class="s2">&quot;cannot decode subtype </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span>
</span><span id="Binary.as_uuid-335"><a href="#Binary.as_uuid-335"><span class="linenos">335</span></a>            <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subtype</span><span class="p">,</span> <span class="n">UUID_REPRESENTATION_NAMES</span><span class="p">[</span><span class="n">uuid_representation</span><span class="p">])</span>
</span><span id="Binary.as_uuid-336"><a href="#Binary.as_uuid-336"><span class="linenos">336</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a Python UUID from this BSON Binary object.</p>

<p>Decodes this binary object as a native <code>uuid.UUID</code> instance
with the provided <code>uuid_representation</code>.</p>

<p>Raises <code>ValueError</code> if this <code>~bson.binary.Binary</code> instance
does not contain a UUID.</p>

<p>:Parameters:</p>

<ul>
<li><code>uuid_representation</code>: A member of
<code>~bson.binary.UuidRepresentation</code>. Default:
<code>~bson.binary.UuidRepresentation.STANDARD</code>.
See :ref:<code>handling-uuid-data-example</code> for details.</li>
</ul>

<p><em>New in version 3.11.</em></p>
</div>


                            </div>
                            <div id="Binary.subtype" class="classattr">
                                <div class="attr variable">
            <span class="name">subtype</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Binary.subtype"></a>
    
            <div class="docstring"><p>Subtype of this binary data.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.bytes</dt>
                                <dd id="Binary.capitalize" class="function">capitalize</dd>
                <dd id="Binary.center" class="function">center</dd>
                <dd id="Binary.count" class="function">count</dd>
                <dd id="Binary.decode" class="function">decode</dd>
                <dd id="Binary.endswith" class="function">endswith</dd>
                <dd id="Binary.expandtabs" class="function">expandtabs</dd>
                <dd id="Binary.find" class="function">find</dd>
                <dd id="Binary.fromhex" class="function">fromhex</dd>
                <dd id="Binary.hex" class="function">hex</dd>
                <dd id="Binary.index" class="function">index</dd>
                <dd id="Binary.isalnum" class="function">isalnum</dd>
                <dd id="Binary.isalpha" class="function">isalpha</dd>
                <dd id="Binary.isascii" class="function">isascii</dd>
                <dd id="Binary.isdigit" class="function">isdigit</dd>
                <dd id="Binary.islower" class="function">islower</dd>
                <dd id="Binary.isspace" class="function">isspace</dd>
                <dd id="Binary.istitle" class="function">istitle</dd>
                <dd id="Binary.isupper" class="function">isupper</dd>
                <dd id="Binary.join" class="function">join</dd>
                <dd id="Binary.ljust" class="function">ljust</dd>
                <dd id="Binary.lower" class="function">lower</dd>
                <dd id="Binary.lstrip" class="function">lstrip</dd>
                <dd id="Binary.maketrans" class="function">maketrans</dd>
                <dd id="Binary.partition" class="function">partition</dd>
                <dd id="Binary.replace" class="function">replace</dd>
                <dd id="Binary.removeprefix" class="function">removeprefix</dd>
                <dd id="Binary.removesuffix" class="function">removesuffix</dd>
                <dd id="Binary.rfind" class="function">rfind</dd>
                <dd id="Binary.rindex" class="function">rindex</dd>
                <dd id="Binary.rjust" class="function">rjust</dd>
                <dd id="Binary.rpartition" class="function">rpartition</dd>
                <dd id="Binary.rsplit" class="function">rsplit</dd>
                <dd id="Binary.rstrip" class="function">rstrip</dd>
                <dd id="Binary.split" class="function">split</dd>
                <dd id="Binary.splitlines" class="function">splitlines</dd>
                <dd id="Binary.startswith" class="function">startswith</dd>
                <dd id="Binary.strip" class="function">strip</dd>
                <dd id="Binary.swapcase" class="function">swapcase</dd>
                <dd id="Binary.title" class="function">title</dd>
                <dd id="Binary.translate" class="function">translate</dd>
                <dd id="Binary.upper" class="function">upper</dd>
                <dd id="Binary.zfill" class="function">zfill</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="UuidRepresentation">
                            <input id="UuidRepresentation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">UuidRepresentation</span>:

                <label class="view-source-button" for="UuidRepresentation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UuidRepresentation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UuidRepresentation-66"><a href="#UuidRepresentation-66"><span class="linenos"> 66</span></a><span class="k">class</span> <span class="nc">UuidRepresentation</span><span class="p">:</span>
</span><span id="UuidRepresentation-67"><a href="#UuidRepresentation-67"><span class="linenos"> 67</span></a>    <span class="n">UNSPECIFIED</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="UuidRepresentation-68"><a href="#UuidRepresentation-68"><span class="linenos"> 68</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;An unspecified UUID representation.</span>
</span><span id="UuidRepresentation-69"><a href="#UuidRepresentation-69"><span class="linenos"> 69</span></a>
</span><span id="UuidRepresentation-70"><a href="#UuidRepresentation-70"><span class="linenos"> 70</span></a><span class="sd">    When configured, :class:`uuid.UUID` instances will **not** be</span>
</span><span id="UuidRepresentation-71"><a href="#UuidRepresentation-71"><span class="linenos"> 71</span></a><span class="sd">    automatically encoded to or decoded from :class:`~bson.binary.Binary`.</span>
</span><span id="UuidRepresentation-72"><a href="#UuidRepresentation-72"><span class="linenos"> 72</span></a><span class="sd">    When encoding a :class:`uuid.UUID` instance, an error will be raised.</span>
</span><span id="UuidRepresentation-73"><a href="#UuidRepresentation-73"><span class="linenos"> 73</span></a><span class="sd">    To encode a :class:`uuid.UUID` instance with this configuration, it must</span>
</span><span id="UuidRepresentation-74"><a href="#UuidRepresentation-74"><span class="linenos"> 74</span></a><span class="sd">    be wrapped in the :class:`~bson.binary.Binary` class by the application</span>
</span><span id="UuidRepresentation-75"><a href="#UuidRepresentation-75"><span class="linenos"> 75</span></a><span class="sd">    code. When decoding a BSON binary field with a UUID subtype, a</span>
</span><span id="UuidRepresentation-76"><a href="#UuidRepresentation-76"><span class="linenos"> 76</span></a><span class="sd">    :class:`~bson.binary.Binary` instance will be returned instead of a</span>
</span><span id="UuidRepresentation-77"><a href="#UuidRepresentation-77"><span class="linenos"> 77</span></a><span class="sd">    :class:`uuid.UUID` instance.</span>
</span><span id="UuidRepresentation-78"><a href="#UuidRepresentation-78"><span class="linenos"> 78</span></a>
</span><span id="UuidRepresentation-79"><a href="#UuidRepresentation-79"><span class="linenos"> 79</span></a><span class="sd">    See :ref:`unspecified-representation-details` for details.</span>
</span><span id="UuidRepresentation-80"><a href="#UuidRepresentation-80"><span class="linenos"> 80</span></a>
</span><span id="UuidRepresentation-81"><a href="#UuidRepresentation-81"><span class="linenos"> 81</span></a><span class="sd">    .. versionadded:: 3.11</span>
</span><span id="UuidRepresentation-82"><a href="#UuidRepresentation-82"><span class="linenos"> 82</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="UuidRepresentation-83"><a href="#UuidRepresentation-83"><span class="linenos"> 83</span></a>
</span><span id="UuidRepresentation-84"><a href="#UuidRepresentation-84"><span class="linenos"> 84</span></a>    <span class="n">STANDARD</span> <span class="o">=</span> <span class="n">UUID_SUBTYPE</span>
</span><span id="UuidRepresentation-85"><a href="#UuidRepresentation-85"><span class="linenos"> 85</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The standard UUID representation.</span>
</span><span id="UuidRepresentation-86"><a href="#UuidRepresentation-86"><span class="linenos"> 86</span></a>
</span><span id="UuidRepresentation-87"><a href="#UuidRepresentation-87"><span class="linenos"> 87</span></a><span class="sd">    :class:`uuid.UUID` instances will automatically be encoded to</span>
</span><span id="UuidRepresentation-88"><a href="#UuidRepresentation-88"><span class="linenos"> 88</span></a><span class="sd">    and decoded from . binary, using RFC-4122 byte order with</span>
</span><span id="UuidRepresentation-89"><a href="#UuidRepresentation-89"><span class="linenos"> 89</span></a><span class="sd">    binary subtype :data:`UUID_SUBTYPE`.</span>
</span><span id="UuidRepresentation-90"><a href="#UuidRepresentation-90"><span class="linenos"> 90</span></a>
</span><span id="UuidRepresentation-91"><a href="#UuidRepresentation-91"><span class="linenos"> 91</span></a><span class="sd">    See :ref:`standard-representation-details` for details.</span>
</span><span id="UuidRepresentation-92"><a href="#UuidRepresentation-92"><span class="linenos"> 92</span></a>
</span><span id="UuidRepresentation-93"><a href="#UuidRepresentation-93"><span class="linenos"> 93</span></a><span class="sd">    .. versionadded:: 3.11</span>
</span><span id="UuidRepresentation-94"><a href="#UuidRepresentation-94"><span class="linenos"> 94</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="UuidRepresentation-95"><a href="#UuidRepresentation-95"><span class="linenos"> 95</span></a>
</span><span id="UuidRepresentation-96"><a href="#UuidRepresentation-96"><span class="linenos"> 96</span></a>    <span class="n">PYTHON_LEGACY</span> <span class="o">=</span> <span class="n">OLD_UUID_SUBTYPE</span>
</span><span id="UuidRepresentation-97"><a href="#UuidRepresentation-97"><span class="linenos"> 97</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The Python legacy UUID representation.</span>
</span><span id="UuidRepresentation-98"><a href="#UuidRepresentation-98"><span class="linenos"> 98</span></a>
</span><span id="UuidRepresentation-99"><a href="#UuidRepresentation-99"><span class="linenos"> 99</span></a><span class="sd">    :class:`uuid.UUID` instances will automatically be encoded to</span>
</span><span id="UuidRepresentation-100"><a href="#UuidRepresentation-100"><span class="linenos">100</span></a><span class="sd">    and decoded from . binary, using RFC-4122 byte order with</span>
</span><span id="UuidRepresentation-101"><a href="#UuidRepresentation-101"><span class="linenos">101</span></a><span class="sd">    binary subtype :data:`OLD_UUID_SUBTYPE`.</span>
</span><span id="UuidRepresentation-102"><a href="#UuidRepresentation-102"><span class="linenos">102</span></a>
</span><span id="UuidRepresentation-103"><a href="#UuidRepresentation-103"><span class="linenos">103</span></a><span class="sd">    See :ref:`python-legacy-representation-details` for details.</span>
</span><span id="UuidRepresentation-104"><a href="#UuidRepresentation-104"><span class="linenos">104</span></a>
</span><span id="UuidRepresentation-105"><a href="#UuidRepresentation-105"><span class="linenos">105</span></a><span class="sd">    .. versionadded:: 3.11</span>
</span><span id="UuidRepresentation-106"><a href="#UuidRepresentation-106"><span class="linenos">106</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="UuidRepresentation-107"><a href="#UuidRepresentation-107"><span class="linenos">107</span></a>
</span><span id="UuidRepresentation-108"><a href="#UuidRepresentation-108"><span class="linenos">108</span></a>    <span class="n">JAVA_LEGACY</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="UuidRepresentation-109"><a href="#UuidRepresentation-109"><span class="linenos">109</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The Java legacy UUID representation.</span>
</span><span id="UuidRepresentation-110"><a href="#UuidRepresentation-110"><span class="linenos">110</span></a>
</span><span id="UuidRepresentation-111"><a href="#UuidRepresentation-111"><span class="linenos">111</span></a><span class="sd">    :class:`uuid.UUID` instances will automatically be encoded to</span>
</span><span id="UuidRepresentation-112"><a href="#UuidRepresentation-112"><span class="linenos">112</span></a><span class="sd">    and decoded from . binary subtype :data:`OLD_UUID_SUBTYPE`,</span>
</span><span id="UuidRepresentation-113"><a href="#UuidRepresentation-113"><span class="linenos">113</span></a><span class="sd">    using the Java driver&#39;s legacy byte order.</span>
</span><span id="UuidRepresentation-114"><a href="#UuidRepresentation-114"><span class="linenos">114</span></a>
</span><span id="UuidRepresentation-115"><a href="#UuidRepresentation-115"><span class="linenos">115</span></a><span class="sd">    See :ref:`java-legacy-representation-details` for details.</span>
</span><span id="UuidRepresentation-116"><a href="#UuidRepresentation-116"><span class="linenos">116</span></a>
</span><span id="UuidRepresentation-117"><a href="#UuidRepresentation-117"><span class="linenos">117</span></a><span class="sd">    .. versionadded:: 3.11</span>
</span><span id="UuidRepresentation-118"><a href="#UuidRepresentation-118"><span class="linenos">118</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="UuidRepresentation-119"><a href="#UuidRepresentation-119"><span class="linenos">119</span></a>
</span><span id="UuidRepresentation-120"><a href="#UuidRepresentation-120"><span class="linenos">120</span></a>    <span class="n">CSHARP_LEGACY</span> <span class="o">=</span> <span class="mi">6</span>
</span><span id="UuidRepresentation-121"><a href="#UuidRepresentation-121"><span class="linenos">121</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The C#/.net legacy UUID representation.</span>
</span><span id="UuidRepresentation-122"><a href="#UuidRepresentation-122"><span class="linenos">122</span></a>
</span><span id="UuidRepresentation-123"><a href="#UuidRepresentation-123"><span class="linenos">123</span></a><span class="sd">    :class:`uuid.UUID` instances will automatically be encoded to</span>
</span><span id="UuidRepresentation-124"><a href="#UuidRepresentation-124"><span class="linenos">124</span></a><span class="sd">    and decoded from . binary subtype :data:`OLD_UUID_SUBTYPE`,</span>
</span><span id="UuidRepresentation-125"><a href="#UuidRepresentation-125"><span class="linenos">125</span></a><span class="sd">    using the C# driver&#39;s legacy byte order.</span>
</span><span id="UuidRepresentation-126"><a href="#UuidRepresentation-126"><span class="linenos">126</span></a>
</span><span id="UuidRepresentation-127"><a href="#UuidRepresentation-127"><span class="linenos">127</span></a><span class="sd">    See :ref:`csharp-legacy-representation-details` for details.</span>
</span><span id="UuidRepresentation-128"><a href="#UuidRepresentation-128"><span class="linenos">128</span></a>
</span><span id="UuidRepresentation-129"><a href="#UuidRepresentation-129"><span class="linenos">129</span></a><span class="sd">    .. versionadded:: 3.11</span>
</span><span id="UuidRepresentation-130"><a href="#UuidRepresentation-130"><span class="linenos">130</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


    

                            <div id="UuidRepresentation.UNSPECIFIED" class="classattr">
                                <div class="attr variable">
            <span class="name">UNSPECIFIED</span>        =
<span class="default_value">0</span>

        
    </div>
    <a class="headerlink" href="#UuidRepresentation.UNSPECIFIED"></a>
    
            <div class="docstring"><p>An unspecified UUID representation.</p>

<p>When configured, <code>uuid.UUID</code> instances will <strong>not</strong> be
automatically encoded to or decoded from <code>~bson.binary.Binary</code>.
When encoding a <code>uuid.UUID</code> instance, an error will be raised.
To encode a <code>uuid.UUID</code> instance with this configuration, it must
be wrapped in the <code>~bson.binary.Binary</code> class by the application
code. When decoding a BSON binary field with a UUID subtype, a
<code>~bson.binary.Binary</code> instance will be returned instead of a
<code>uuid.UUID</code> instance.</p>

<p>See :ref:<code>unspecified-representation-details</code> for details.</p>

<p><em>New in version 3.11.</em></p>
</div>


                            </div>
                            <div id="UuidRepresentation.STANDARD" class="classattr">
                                <div class="attr variable">
            <span class="name">STANDARD</span>        =
<span class="default_value">4</span>

        
    </div>
    <a class="headerlink" href="#UuidRepresentation.STANDARD"></a>
    
            <div class="docstring"><p>The standard UUID representation.</p>

<p><code>uuid.UUID</code> instances will automatically be encoded to
and decoded from . binary, using RFC-4122 byte order with
binary subtype <code><a href="#UUID_SUBTYPE">UUID_SUBTYPE</a></code>.</p>

<p>See :ref:<code>standard-representation-details</code> for details.</p>

<p><em>New in version 3.11.</em></p>
</div>


                            </div>
                            <div id="UuidRepresentation.PYTHON_LEGACY" class="classattr">
                                <div class="attr variable">
            <span class="name">PYTHON_LEGACY</span>        =
<span class="default_value">3</span>

        
    </div>
    <a class="headerlink" href="#UuidRepresentation.PYTHON_LEGACY"></a>
    
            <div class="docstring"><p>The Python legacy UUID representation.</p>

<p><code>uuid.UUID</code> instances will automatically be encoded to
and decoded from . binary, using RFC-4122 byte order with
binary subtype <code><a href="#OLD_UUID_SUBTYPE">OLD_UUID_SUBTYPE</a></code>.</p>

<p>See :ref:<code>python-legacy-representation-details</code> for details.</p>

<p><em>New in version 3.11.</em></p>
</div>


                            </div>
                            <div id="UuidRepresentation.JAVA_LEGACY" class="classattr">
                                <div class="attr variable">
            <span class="name">JAVA_LEGACY</span>        =
<span class="default_value">5</span>

        
    </div>
    <a class="headerlink" href="#UuidRepresentation.JAVA_LEGACY"></a>
    
            <div class="docstring"><p>The Java legacy UUID representation.</p>

<p><code>uuid.UUID</code> instances will automatically be encoded to
and decoded from . binary subtype <code><a href="#OLD_UUID_SUBTYPE">OLD_UUID_SUBTYPE</a></code>,
using the Java driver's legacy byte order.</p>

<p>See :ref:<code>java-legacy-representation-details</code> for details.</p>

<p><em>New in version 3.11.</em></p>
</div>


                            </div>
                            <div id="UuidRepresentation.CSHARP_LEGACY" class="classattr">
                                <div class="attr variable">
            <span class="name">CSHARP_LEGACY</span>        =
<span class="default_value">6</span>

        
    </div>
    <a class="headerlink" href="#UuidRepresentation.CSHARP_LEGACY"></a>
    
            <div class="docstring"><p>The C#/.net legacy UUID representation.</p>

<p><code>uuid.UUID</code> instances will automatically be encoded to
and decoded from . binary subtype <code><a href="#OLD_UUID_SUBTYPE">OLD_UUID_SUBTYPE</a></code>,
using the C# driver's legacy byte order.</p>

<p>See :ref:<code>csharp-legacy-representation-details</code> for details.</p>

<p><em>New in version 3.11.</em></p>
</div>


                            </div>
                </section>
                <section id="Code">
                            <input id="Code-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Code</span><wbr>(<span class="base">builtins.str</span>):

                <label class="view-source-button" for="Code-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Code"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Code-23"><a href="#Code-23"><span class="linenos"> 23</span></a><span class="k">class</span> <span class="nc">Code</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
</span><span id="Code-24"><a href="#Code-24"><span class="linenos"> 24</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;BSON&#39;s JavaScript code type.</span>
</span><span id="Code-25"><a href="#Code-25"><span class="linenos"> 25</span></a>
</span><span id="Code-26"><a href="#Code-26"><span class="linenos"> 26</span></a><span class="sd">    Raises :class:`TypeError` if `code` is not an instance of</span>
</span><span id="Code-27"><a href="#Code-27"><span class="linenos"> 27</span></a><span class="sd">    :class:`basestring` (:class:`str` in python 3) or `scope`</span>
</span><span id="Code-28"><a href="#Code-28"><span class="linenos"> 28</span></a><span class="sd">    is not ``None`` or an instance of :class:`dict`.</span>
</span><span id="Code-29"><a href="#Code-29"><span class="linenos"> 29</span></a>
</span><span id="Code-30"><a href="#Code-30"><span class="linenos"> 30</span></a><span class="sd">    Scope variables can be set by passing a dictionary as the `scope`</span>
</span><span id="Code-31"><a href="#Code-31"><span class="linenos"> 31</span></a><span class="sd">    argument or by using keyword arguments. If a variable is set as a</span>
</span><span id="Code-32"><a href="#Code-32"><span class="linenos"> 32</span></a><span class="sd">    keyword argument it will override any setting for that variable in</span>
</span><span id="Code-33"><a href="#Code-33"><span class="linenos"> 33</span></a><span class="sd">    the `scope` dictionary.</span>
</span><span id="Code-34"><a href="#Code-34"><span class="linenos"> 34</span></a>
</span><span id="Code-35"><a href="#Code-35"><span class="linenos"> 35</span></a><span class="sd">    :Parameters:</span>
</span><span id="Code-36"><a href="#Code-36"><span class="linenos"> 36</span></a><span class="sd">      - `code`: A string containing JavaScript code to be evaluated or another</span>
</span><span id="Code-37"><a href="#Code-37"><span class="linenos"> 37</span></a><span class="sd">        instance of Code. In the latter case, the scope of `code` becomes this</span>
</span><span id="Code-38"><a href="#Code-38"><span class="linenos"> 38</span></a><span class="sd">        Code&#39;s :attr:`scope`.</span>
</span><span id="Code-39"><a href="#Code-39"><span class="linenos"> 39</span></a><span class="sd">      - `scope` (optional): dictionary representing the scope in which</span>
</span><span id="Code-40"><a href="#Code-40"><span class="linenos"> 40</span></a><span class="sd">        `code` should be evaluated - a mapping from identifiers (as</span>
</span><span id="Code-41"><a href="#Code-41"><span class="linenos"> 41</span></a><span class="sd">        strings) to values. Defaults to ``None``. This is applied after any</span>
</span><span id="Code-42"><a href="#Code-42"><span class="linenos"> 42</span></a><span class="sd">        scope associated with a given `code` above.</span>
</span><span id="Code-43"><a href="#Code-43"><span class="linenos"> 43</span></a><span class="sd">      - `**kwargs` (optional): scope variables can also be passed as</span>
</span><span id="Code-44"><a href="#Code-44"><span class="linenos"> 44</span></a><span class="sd">        keyword arguments. These are applied after `scope` and `code`.</span>
</span><span id="Code-45"><a href="#Code-45"><span class="linenos"> 45</span></a>
</span><span id="Code-46"><a href="#Code-46"><span class="linenos"> 46</span></a><span class="sd">    .. versionchanged:: 3.4</span>
</span><span id="Code-47"><a href="#Code-47"><span class="linenos"> 47</span></a><span class="sd">      The default value for :attr:`scope` is ``None`` instead of ``{}``.</span>
</span><span id="Code-48"><a href="#Code-48"><span class="linenos"> 48</span></a>
</span><span id="Code-49"><a href="#Code-49"><span class="linenos"> 49</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Code-50"><a href="#Code-50"><span class="linenos"> 50</span></a>
</span><span id="Code-51"><a href="#Code-51"><span class="linenos"> 51</span></a>    <span class="n">_type_marker</span> <span class="o">=</span> <span class="mi">13</span>
</span><span id="Code-52"><a href="#Code-52"><span class="linenos"> 52</span></a>    <span class="n">__scope</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Code-53"><a href="#Code-53"><span class="linenos"> 53</span></a>
</span><span id="Code-54"><a href="#Code-54"><span class="linenos"> 54</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="Code-55"><a href="#Code-55"><span class="linenos"> 55</span></a>        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Code&quot;</span><span class="p">],</span>
</span><span id="Code-56"><a href="#Code-56"><span class="linenos"> 56</span></a>        <span class="n">code</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Code&quot;</span><span class="p">],</span>
</span><span id="Code-57"><a href="#Code-57"><span class="linenos"> 57</span></a>        <span class="n">scope</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Code-58"><a href="#Code-58"><span class="linenos"> 58</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="Code-59"><a href="#Code-59"><span class="linenos"> 59</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Code&quot;</span><span class="p">:</span>
</span><span id="Code-60"><a href="#Code-60"><span class="linenos"> 60</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Code-61"><a href="#Code-61"><span class="linenos"> 61</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;code must be an instance of str&quot;</span><span class="p">)</span>
</span><span id="Code-62"><a href="#Code-62"><span class="linenos"> 62</span></a>
</span><span id="Code-63"><a href="#Code-63"><span class="linenos"> 63</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
</span><span id="Code-64"><a href="#Code-64"><span class="linenos"> 64</span></a>
</span><span id="Code-65"><a href="#Code-65"><span class="linenos"> 65</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Code-66"><a href="#Code-66"><span class="linenos"> 66</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__scope</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">scope</span>  <span class="c1"># type: ignore</span>
</span><span id="Code-67"><a href="#Code-67"><span class="linenos"> 67</span></a>        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="Code-68"><a href="#Code-68"><span class="linenos"> 68</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__scope</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Code-69"><a href="#Code-69"><span class="linenos"> 69</span></a>
</span><span id="Code-70"><a href="#Code-70"><span class="linenos"> 70</span></a>        <span class="k">if</span> <span class="n">scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Code-71"><a href="#Code-71"><span class="linenos"> 71</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scope</span><span class="p">,</span> <span class="n">_Mapping</span><span class="p">):</span>
</span><span id="Code-72"><a href="#Code-72"><span class="linenos"> 72</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;scope must be an instance of dict&quot;</span><span class="p">)</span>
</span><span id="Code-73"><a href="#Code-73"><span class="linenos"> 73</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Code-74"><a href="#Code-74"><span class="linenos"> 74</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__scope</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">scope</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="Code-75"><a href="#Code-75"><span class="linenos"> 75</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Code-76"><a href="#Code-76"><span class="linenos"> 76</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__scope</span> <span class="o">=</span> <span class="n">scope</span>
</span><span id="Code-77"><a href="#Code-77"><span class="linenos"> 77</span></a>
</span><span id="Code-78"><a href="#Code-78"><span class="linenos"> 78</span></a>        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Code-79"><a href="#Code-79"><span class="linenos"> 79</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scope</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Code-80"><a href="#Code-80"><span class="linenos"> 80</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__scope</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span><span id="Code-81"><a href="#Code-81"><span class="linenos"> 81</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Code-82"><a href="#Code-82"><span class="linenos"> 82</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__scope</span> <span class="o">=</span> <span class="n">kwargs</span>
</span><span id="Code-83"><a href="#Code-83"><span class="linenos"> 83</span></a>
</span><span id="Code-84"><a href="#Code-84"><span class="linenos"> 84</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Code-85"><a href="#Code-85"><span class="linenos"> 85</span></a>
</span><span id="Code-86"><a href="#Code-86"><span class="linenos"> 86</span></a>    <span class="nd">@property</span>
</span><span id="Code-87"><a href="#Code-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="nf">scope</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="Code-88"><a href="#Code-88"><span class="linenos"> 88</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Scope dictionary for this instance or ``None``.&quot;&quot;&quot;</span>
</span><span id="Code-89"><a href="#Code-89"><span class="linenos"> 89</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scope</span>
</span><span id="Code-90"><a href="#Code-90"><span class="linenos"> 90</span></a>
</span><span id="Code-91"><a href="#Code-91"><span class="linenos"> 91</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Code-92"><a href="#Code-92"><span class="linenos"> 92</span></a>        <span class="k">return</span> <span class="s2">&quot;Code(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__scope</span><span class="p">)</span>
</span><span id="Code-93"><a href="#Code-93"><span class="linenos"> 93</span></a>
</span><span id="Code-94"><a href="#Code-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Code-95"><a href="#Code-95"><span class="linenos"> 95</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Code</span><span class="p">):</span>
</span><span id="Code-96"><a href="#Code-96"><span class="linenos"> 96</span></a>            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__scope</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">==</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">__scope</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">other</span><span class="p">))</span>
</span><span id="Code-97"><a href="#Code-97"><span class="linenos"> 97</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Code-98"><a href="#Code-98"><span class="linenos"> 98</span></a>
</span><span id="Code-99"><a href="#Code-99"><span class="linenos"> 99</span></a>    <span class="fm">__hash__</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Code-100"><a href="#Code-100"><span class="linenos">100</span></a>
</span><span id="Code-101"><a href="#Code-101"><span class="linenos">101</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Code-102"><a href="#Code-102"><span class="linenos">102</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>BSON's JavaScript code type.</p>

<p>Raises <code>TypeError</code> if <code>code</code> is not an instance of
<code>basestring</code> (<code>str</code> in python 3) or <code><a href="#Code.scope">scope</a></code>
is not <code>None</code> or an instance of <code>dict</code>.</p>

<p>Scope variables can be set by passing a dictionary as the <code><a href="#Code.scope">scope</a></code>
argument or by using keyword arguments. If a variable is set as a
keyword argument it will override any setting for that variable in
the <code><a href="#Code.scope">scope</a></code> dictionary.</p>

<p>:Parameters:</p>

<ul>
<li><code>code</code>: A string containing JavaScript code to be evaluated or another
instance of Code. In the latter case, the scope of <code>code</code> becomes this
Code's <code><a href="#Code.scope">scope</a></code>.</li>
<li><code><a href="#Code.scope">scope</a></code> (optional): dictionary representing the scope in which
<code>code</code> should be evaluated - a mapping from identifiers (as
strings) to values. Defaults to <code>None</code>. This is applied after any
scope associated with a given <code>code</code> above.</li>
<li><code>**kwargs</code> (optional): scope variables can also be passed as
keyword arguments. These are applied after <code><a href="#Code.scope">scope</a></code> and <code>code</code>.</li>
</ul>

<p><em>Changed in version 3.4:</em>
The default value for <code><a href="#Code.scope">scope</a></code> is <code>None</code> instead of <code>{}</code>.</p>
</div>


                            <div id="Code.scope" class="classattr">
                                <div class="attr variable">
            <span class="name">scope</span><span class="annotation">: Optional[Mapping[str, Any]]</span>

        
    </div>
    <a class="headerlink" href="#Code.scope"></a>
    
            <div class="docstring"><p>Scope dictionary for this instance or <code>None</code>.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.str</dt>
                                <dd id="Code.encode" class="function">encode</dd>
                <dd id="Code.replace" class="function">replace</dd>
                <dd id="Code.split" class="function">split</dd>
                <dd id="Code.rsplit" class="function">rsplit</dd>
                <dd id="Code.join" class="function">join</dd>
                <dd id="Code.capitalize" class="function">capitalize</dd>
                <dd id="Code.casefold" class="function">casefold</dd>
                <dd id="Code.title" class="function">title</dd>
                <dd id="Code.center" class="function">center</dd>
                <dd id="Code.count" class="function">count</dd>
                <dd id="Code.expandtabs" class="function">expandtabs</dd>
                <dd id="Code.find" class="function">find</dd>
                <dd id="Code.partition" class="function">partition</dd>
                <dd id="Code.index" class="function">index</dd>
                <dd id="Code.ljust" class="function">ljust</dd>
                <dd id="Code.lower" class="function">lower</dd>
                <dd id="Code.lstrip" class="function">lstrip</dd>
                <dd id="Code.rfind" class="function">rfind</dd>
                <dd id="Code.rindex" class="function">rindex</dd>
                <dd id="Code.rjust" class="function">rjust</dd>
                <dd id="Code.rstrip" class="function">rstrip</dd>
                <dd id="Code.rpartition" class="function">rpartition</dd>
                <dd id="Code.splitlines" class="function">splitlines</dd>
                <dd id="Code.strip" class="function">strip</dd>
                <dd id="Code.swapcase" class="function">swapcase</dd>
                <dd id="Code.translate" class="function">translate</dd>
                <dd id="Code.upper" class="function">upper</dd>
                <dd id="Code.startswith" class="function">startswith</dd>
                <dd id="Code.endswith" class="function">endswith</dd>
                <dd id="Code.removeprefix" class="function">removeprefix</dd>
                <dd id="Code.removesuffix" class="function">removesuffix</dd>
                <dd id="Code.isascii" class="function">isascii</dd>
                <dd id="Code.islower" class="function">islower</dd>
                <dd id="Code.isupper" class="function">isupper</dd>
                <dd id="Code.istitle" class="function">istitle</dd>
                <dd id="Code.isspace" class="function">isspace</dd>
                <dd id="Code.isdecimal" class="function">isdecimal</dd>
                <dd id="Code.isdigit" class="function">isdigit</dd>
                <dd id="Code.isnumeric" class="function">isnumeric</dd>
                <dd id="Code.isalpha" class="function">isalpha</dd>
                <dd id="Code.isalnum" class="function">isalnum</dd>
                <dd id="Code.isidentifier" class="function">isidentifier</dd>
                <dd id="Code.isprintable" class="function">isprintable</dd>
                <dd id="Code.zfill" class="function">zfill</dd>
                <dd id="Code.format" class="function">format</dd>
                <dd id="Code.format_map" class="function">format_map</dd>
                <dd id="Code.maketrans" class="function">maketrans</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DEFAULT_CODEC_OPTIONS">
                    <div class="attr variable">
            <span class="name">DEFAULT_CODEC_OPTIONS</span>        =
<input id="DEFAULT_CODEC_OPTIONS-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="DEFAULT_CODEC_OPTIONS-view-value"></label><span class="default_value">CodecOptions(document_class=dict, tz_aware=False, uuid_representation=UuidRepresentation.UNSPECIFIED, unicode_decode_error_handler=&#39;strict&#39;, tzinfo=None, type_registry=TypeRegistry(type_codecs=[], fallback_encoder=None), datetime_conversion=DatetimeConversion.DATETIME)</span>

        
    </div>
    <a class="headerlink" href="#DEFAULT_CODEC_OPTIONS"></a>
    
    

                </section>
                <section id="CodecOptions">
                            <input id="CodecOptions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CodecOptions</span><wbr>(<span class="base">typing.NamedTuple</span>):

                <label class="view-source-button" for="CodecOptions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CodecOptions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CodecOptions-248"><a href="#CodecOptions-248"><span class="linenos">248</span></a><span class="k">class</span> <span class="nc">CodecOptions</span><span class="p">(</span><span class="n">_BaseCodecOptions</span><span class="p">):</span>
</span><span id="CodecOptions-249"><a href="#CodecOptions-249"><span class="linenos">249</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encapsulates options used encoding and / or decoding BSON.</span>
</span><span id="CodecOptions-250"><a href="#CodecOptions-250"><span class="linenos">250</span></a>
</span><span id="CodecOptions-251"><a href="#CodecOptions-251"><span class="linenos">251</span></a><span class="sd">    The `document_class` option is used to define a custom type for use</span>
</span><span id="CodecOptions-252"><a href="#CodecOptions-252"><span class="linenos">252</span></a><span class="sd">    decoding BSON documents. Access to the underlying raw BSON bytes for</span>
</span><span id="CodecOptions-253"><a href="#CodecOptions-253"><span class="linenos">253</span></a><span class="sd">    a document is available using the :class:`~bson.raw_bson.RawBSONDocument`</span>
</span><span id="CodecOptions-254"><a href="#CodecOptions-254"><span class="linenos">254</span></a><span class="sd">    type::</span>
</span><span id="CodecOptions-255"><a href="#CodecOptions-255"><span class="linenos">255</span></a>
</span><span id="CodecOptions-256"><a href="#CodecOptions-256"><span class="linenos">256</span></a><span class="sd">      &gt;&gt;&gt; from .raw_bson import RawBSONDocument</span>
</span><span id="CodecOptions-257"><a href="#CodecOptions-257"><span class="linenos">257</span></a><span class="sd">      &gt;&gt;&gt; from .codec_options import CodecOptions</span>
</span><span id="CodecOptions-258"><a href="#CodecOptions-258"><span class="linenos">258</span></a><span class="sd">      &gt;&gt;&gt; codec_options = CodecOptions(document_class=RawBSONDocument)</span>
</span><span id="CodecOptions-259"><a href="#CodecOptions-259"><span class="linenos">259</span></a><span class="sd">      &gt;&gt;&gt; coll = db.get_collection(&#39;test&#39;, codec_options=codec_options)</span>
</span><span id="CodecOptions-260"><a href="#CodecOptions-260"><span class="linenos">260</span></a><span class="sd">      &gt;&gt;&gt; doc = coll.find_one()</span>
</span><span id="CodecOptions-261"><a href="#CodecOptions-261"><span class="linenos">261</span></a><span class="sd">      &gt;&gt;&gt; doc.raw</span>
</span><span id="CodecOptions-262"><a href="#CodecOptions-262"><span class="linenos">262</span></a><span class="sd">      &#39;\\x16\\x00\\x00\\x00\\x07_id\\x00[0\\x165\\x91\\x10\\xea\\x14\\xe8\\xc5\\x8b\\x93\\x00&#39;</span>
</span><span id="CodecOptions-263"><a href="#CodecOptions-263"><span class="linenos">263</span></a>
</span><span id="CodecOptions-264"><a href="#CodecOptions-264"><span class="linenos">264</span></a><span class="sd">    The document class can be any type that inherits from</span>
</span><span id="CodecOptions-265"><a href="#CodecOptions-265"><span class="linenos">265</span></a><span class="sd">    :class:`~collections.abc.MutableMapping`::</span>
</span><span id="CodecOptions-266"><a href="#CodecOptions-266"><span class="linenos">266</span></a>
</span><span id="CodecOptions-267"><a href="#CodecOptions-267"><span class="linenos">267</span></a><span class="sd">      &gt;&gt;&gt; class AttributeDict(dict):</span>
</span><span id="CodecOptions-268"><a href="#CodecOptions-268"><span class="linenos">268</span></a><span class="sd">      ...     # A dict that supports attribute access.</span>
</span><span id="CodecOptions-269"><a href="#CodecOptions-269"><span class="linenos">269</span></a><span class="sd">      ...     def __getattr__(self, key):</span>
</span><span id="CodecOptions-270"><a href="#CodecOptions-270"><span class="linenos">270</span></a><span class="sd">      ...         return self[key]</span>
</span><span id="CodecOptions-271"><a href="#CodecOptions-271"><span class="linenos">271</span></a><span class="sd">      ...     def __setattr__(self, key, value):</span>
</span><span id="CodecOptions-272"><a href="#CodecOptions-272"><span class="linenos">272</span></a><span class="sd">      ...         self[key] = value</span>
</span><span id="CodecOptions-273"><a href="#CodecOptions-273"><span class="linenos">273</span></a><span class="sd">      ...</span>
</span><span id="CodecOptions-274"><a href="#CodecOptions-274"><span class="linenos">274</span></a><span class="sd">      &gt;&gt;&gt; codec_options = CodecOptions(document_class=AttributeDict)</span>
</span><span id="CodecOptions-275"><a href="#CodecOptions-275"><span class="linenos">275</span></a><span class="sd">      &gt;&gt;&gt; coll = db.get_collection(&#39;test&#39;, codec_options=codec_options)</span>
</span><span id="CodecOptions-276"><a href="#CodecOptions-276"><span class="linenos">276</span></a><span class="sd">      &gt;&gt;&gt; doc = coll.find_one()</span>
</span><span id="CodecOptions-277"><a href="#CodecOptions-277"><span class="linenos">277</span></a><span class="sd">      &gt;&gt;&gt; doc._id</span>
</span><span id="CodecOptions-278"><a href="#CodecOptions-278"><span class="linenos">278</span></a><span class="sd">      ObjectId(&#39;5b3016359110ea14e8c58b93&#39;)</span>
</span><span id="CodecOptions-279"><a href="#CodecOptions-279"><span class="linenos">279</span></a>
</span><span id="CodecOptions-280"><a href="#CodecOptions-280"><span class="linenos">280</span></a><span class="sd">    See :doc:`/examples/datetimes` for examples using the `tz_aware` and</span>
</span><span id="CodecOptions-281"><a href="#CodecOptions-281"><span class="linenos">281</span></a><span class="sd">    `tzinfo` options.</span>
</span><span id="CodecOptions-282"><a href="#CodecOptions-282"><span class="linenos">282</span></a>
</span><span id="CodecOptions-283"><a href="#CodecOptions-283"><span class="linenos">283</span></a><span class="sd">    See :doc:`/examples/uuid` for examples using the `uuid_representation`</span>
</span><span id="CodecOptions-284"><a href="#CodecOptions-284"><span class="linenos">284</span></a><span class="sd">    option.</span>
</span><span id="CodecOptions-285"><a href="#CodecOptions-285"><span class="linenos">285</span></a>
</span><span id="CodecOptions-286"><a href="#CodecOptions-286"><span class="linenos">286</span></a><span class="sd">    :Parameters:</span>
</span><span id="CodecOptions-287"><a href="#CodecOptions-287"><span class="linenos">287</span></a><span class="sd">      - `document_class`: BSON documents returned in queries will be decoded</span>
</span><span id="CodecOptions-288"><a href="#CodecOptions-288"><span class="linenos">288</span></a><span class="sd">        to an instance of this class. Must be a subclass of</span>
</span><span id="CodecOptions-289"><a href="#CodecOptions-289"><span class="linenos">289</span></a><span class="sd">        :class:`~collections.abc.MutableMapping`. Defaults to :class:`dict`.</span>
</span><span id="CodecOptions-290"><a href="#CodecOptions-290"><span class="linenos">290</span></a><span class="sd">      - `tz_aware`: If ``True``, BSON datetimes will be decoded to timezone</span>
</span><span id="CodecOptions-291"><a href="#CodecOptions-291"><span class="linenos">291</span></a><span class="sd">        aware instances of :class:`~datetime.datetime`. Otherwise they will be</span>
</span><span id="CodecOptions-292"><a href="#CodecOptions-292"><span class="linenos">292</span></a><span class="sd">        naive. Defaults to ``False``.</span>
</span><span id="CodecOptions-293"><a href="#CodecOptions-293"><span class="linenos">293</span></a><span class="sd">      - `uuid_representation`: The BSON representation to use when encoding</span>
</span><span id="CodecOptions-294"><a href="#CodecOptions-294"><span class="linenos">294</span></a><span class="sd">        and decoding instances of :class:`~uuid.UUID`. Defaults to</span>
</span><span id="CodecOptions-295"><a href="#CodecOptions-295"><span class="linenos">295</span></a><span class="sd">        :data:`~bson.binary.UuidRepresentation.UNSPECIFIED`. New</span>
</span><span id="CodecOptions-296"><a href="#CodecOptions-296"><span class="linenos">296</span></a><span class="sd">        applications should consider setting this to</span>
</span><span id="CodecOptions-297"><a href="#CodecOptions-297"><span class="linenos">297</span></a><span class="sd">        :data:`~bson.binary.UuidRepresentation.STANDARD` for cross language</span>
</span><span id="CodecOptions-298"><a href="#CodecOptions-298"><span class="linenos">298</span></a><span class="sd">        compatibility. See :ref:`handling-uuid-data-example` for details.</span>
</span><span id="CodecOptions-299"><a href="#CodecOptions-299"><span class="linenos">299</span></a><span class="sd">      - `unicode_decode_error_handler`: The error handler to apply when</span>
</span><span id="CodecOptions-300"><a href="#CodecOptions-300"><span class="linenos">300</span></a><span class="sd">        a Unicode-related error occurs during BSON decoding that would</span>
</span><span id="CodecOptions-301"><a href="#CodecOptions-301"><span class="linenos">301</span></a><span class="sd">        otherwise raise :exc:`UnicodeDecodeError`. Valid options include</span>
</span><span id="CodecOptions-302"><a href="#CodecOptions-302"><span class="linenos">302</span></a><span class="sd">        &#39;strict&#39;, &#39;replace&#39;, &#39;backslashreplace&#39;, &#39;surrogateescape&#39;, and</span>
</span><span id="CodecOptions-303"><a href="#CodecOptions-303"><span class="linenos">303</span></a><span class="sd">        &#39;ignore&#39;. Defaults to &#39;strict&#39;.</span>
</span><span id="CodecOptions-304"><a href="#CodecOptions-304"><span class="linenos">304</span></a><span class="sd">      - `tzinfo`: A :class:`~datetime.tzinfo` subclass that specifies the</span>
</span><span id="CodecOptions-305"><a href="#CodecOptions-305"><span class="linenos">305</span></a><span class="sd">        timezone to/from which :class:`~datetime.datetime` objects should be</span>
</span><span id="CodecOptions-306"><a href="#CodecOptions-306"><span class="linenos">306</span></a><span class="sd">        encoded/decoded.</span>
</span><span id="CodecOptions-307"><a href="#CodecOptions-307"><span class="linenos">307</span></a><span class="sd">      - `type_registry`: Instance of :class:`TypeRegistry` used to customize</span>
</span><span id="CodecOptions-308"><a href="#CodecOptions-308"><span class="linenos">308</span></a><span class="sd">        encoding and decoding behavior.</span>
</span><span id="CodecOptions-309"><a href="#CodecOptions-309"><span class="linenos">309</span></a><span class="sd">      - `datetime_conversion`: Specifies how UTC datetimes should be decoded</span>
</span><span id="CodecOptions-310"><a href="#CodecOptions-310"><span class="linenos">310</span></a><span class="sd">        within BSON. Valid options include &#39;datetime_ms&#39; to return as a</span>
</span><span id="CodecOptions-311"><a href="#CodecOptions-311"><span class="linenos">311</span></a><span class="sd">        DatetimeMS, &#39;datetime&#39; to return as a datetime.datetime and</span>
</span><span id="CodecOptions-312"><a href="#CodecOptions-312"><span class="linenos">312</span></a><span class="sd">        raising a ValueError for out-of-range values, &#39;datetime_auto&#39; to</span>
</span><span id="CodecOptions-313"><a href="#CodecOptions-313"><span class="linenos">313</span></a><span class="sd">        return DatetimeMS objects when the underlying datetime is</span>
</span><span id="CodecOptions-314"><a href="#CodecOptions-314"><span class="linenos">314</span></a><span class="sd">        out-of-range and &#39;datetime_clamp&#39; to clamp to the minimum and</span>
</span><span id="CodecOptions-315"><a href="#CodecOptions-315"><span class="linenos">315</span></a><span class="sd">        maximum possible datetimes. Defaults to &#39;datetime&#39;.</span>
</span><span id="CodecOptions-316"><a href="#CodecOptions-316"><span class="linenos">316</span></a><span class="sd">    .. versionchanged:: 4.0</span>
</span><span id="CodecOptions-317"><a href="#CodecOptions-317"><span class="linenos">317</span></a><span class="sd">       The default for `uuid_representation` was changed from</span>
</span><span id="CodecOptions-318"><a href="#CodecOptions-318"><span class="linenos">318</span></a><span class="sd">       :const:`~bson.binary.UuidRepresentation.PYTHON_LEGACY` to</span>
</span><span id="CodecOptions-319"><a href="#CodecOptions-319"><span class="linenos">319</span></a><span class="sd">       :const:`~bson.binary.UuidRepresentation.UNSPECIFIED`.</span>
</span><span id="CodecOptions-320"><a href="#CodecOptions-320"><span class="linenos">320</span></a>
</span><span id="CodecOptions-321"><a href="#CodecOptions-321"><span class="linenos">321</span></a><span class="sd">    .. versionadded:: 3.8</span>
</span><span id="CodecOptions-322"><a href="#CodecOptions-322"><span class="linenos">322</span></a><span class="sd">       `type_registry` attribute.</span>
</span><span id="CodecOptions-323"><a href="#CodecOptions-323"><span class="linenos">323</span></a>
</span><span id="CodecOptions-324"><a href="#CodecOptions-324"><span class="linenos">324</span></a><span class="sd">    .. warning:: Care must be taken when changing</span>
</span><span id="CodecOptions-325"><a href="#CodecOptions-325"><span class="linenos">325</span></a><span class="sd">       `unicode_decode_error_handler` from its default value (&#39;strict&#39;).</span>
</span><span id="CodecOptions-326"><a href="#CodecOptions-326"><span class="linenos">326</span></a><span class="sd">       The &#39;replace&#39; and &#39;ignore&#39; modes should not be used when documents</span>
</span><span id="CodecOptions-327"><a href="#CodecOptions-327"><span class="linenos">327</span></a><span class="sd">       retrieved from the server will be modified in the client application</span>
</span><span id="CodecOptions-328"><a href="#CodecOptions-328"><span class="linenos">328</span></a><span class="sd">       and stored back to the server.</span>
</span><span id="CodecOptions-329"><a href="#CodecOptions-329"><span class="linenos">329</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="CodecOptions-330"><a href="#CodecOptions-330"><span class="linenos">330</span></a>
</span><span id="CodecOptions-331"><a href="#CodecOptions-331"><span class="linenos">331</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
</span><span id="CodecOptions-332"><a href="#CodecOptions-332"><span class="linenos">332</span></a>        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;CodecOptions&quot;</span><span class="p">],</span>
</span><span id="CodecOptions-333"><a href="#CodecOptions-333"><span class="linenos">333</span></a>        <span class="n">document_class</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CodecOptions-334"><a href="#CodecOptions-334"><span class="linenos">334</span></a>        <span class="n">tz_aware</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="CodecOptions-335"><a href="#CodecOptions-335"><span class="linenos">335</span></a>        <span class="n">uuid_representation</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">UuidRepresentation</span><span class="o">.</span><span class="n">UNSPECIFIED</span><span class="p">,</span>
</span><span id="CodecOptions-336"><a href="#CodecOptions-336"><span class="linenos">336</span></a>        <span class="n">unicode_decode_error_handler</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;strict&quot;</span><span class="p">,</span>
</span><span id="CodecOptions-337"><a href="#CodecOptions-337"><span class="linenos">337</span></a>        <span class="n">tzinfo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CodecOptions-338"><a href="#CodecOptions-338"><span class="linenos">338</span></a>        <span class="n">type_registry</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TypeRegistry</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="CodecOptions-339"><a href="#CodecOptions-339"><span class="linenos">339</span></a>        <span class="n">datetime_conversion</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DatetimeConversion</span><span class="p">]</span> <span class="o">=</span> <span class="n">DatetimeConversion</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span>
</span><span id="CodecOptions-340"><a href="#CodecOptions-340"><span class="linenos">340</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CodecOptions&quot;</span><span class="p">:</span>
</span><span id="CodecOptions-341"><a href="#CodecOptions-341"><span class="linenos">341</span></a>        <span class="n">doc_class</span> <span class="o">=</span> <span class="n">document_class</span> <span class="ow">or</span> <span class="nb">dict</span>
</span><span id="CodecOptions-342"><a href="#CodecOptions-342"><span class="linenos">342</span></a>        <span class="c1"># issubclass can raise TypeError for generic aliases like SON[str, Any].</span>
</span><span id="CodecOptions-343"><a href="#CodecOptions-343"><span class="linenos">343</span></a>        <span class="c1"># In that case we can use the base class for the comparison.</span>
</span><span id="CodecOptions-344"><a href="#CodecOptions-344"><span class="linenos">344</span></a>        <span class="n">is_mapping</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="CodecOptions-345"><a href="#CodecOptions-345"><span class="linenos">345</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="CodecOptions-346"><a href="#CodecOptions-346"><span class="linenos">346</span></a>            <span class="n">is_mapping</span> <span class="o">=</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">doc_class</span><span class="p">,</span> <span class="n">_MutableMapping</span><span class="p">)</span>
</span><span id="CodecOptions-347"><a href="#CodecOptions-347"><span class="linenos">347</span></a>        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
</span><span id="CodecOptions-348"><a href="#CodecOptions-348"><span class="linenos">348</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">doc_class</span><span class="p">,</span> <span class="s2">&quot;__origin__&quot;</span><span class="p">):</span>
</span><span id="CodecOptions-349"><a href="#CodecOptions-349"><span class="linenos">349</span></a>                <span class="n">is_mapping</span> <span class="o">=</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">doc_class</span><span class="o">.</span><span class="n">__origin__</span><span class="p">,</span> <span class="n">_MutableMapping</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
</span><span id="CodecOptions-350"><a href="#CodecOptions-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">is_mapping</span> <span class="ow">or</span> <span class="n">_raw_document_class</span><span class="p">(</span><span class="n">doc_class</span><span class="p">)):</span>
</span><span id="CodecOptions-351"><a href="#CodecOptions-351"><span class="linenos">351</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="CodecOptions-352"><a href="#CodecOptions-352"><span class="linenos">352</span></a>                <span class="s2">&quot;document_class must be dict, bson.son.SON, &quot;</span>
</span><span id="CodecOptions-353"><a href="#CodecOptions-353"><span class="linenos">353</span></a>                <span class="s2">&quot;bson.raw_bson.RawBSONDocument, or a &quot;</span>
</span><span id="CodecOptions-354"><a href="#CodecOptions-354"><span class="linenos">354</span></a>                <span class="s2">&quot;subclass of collections.abc.MutableMapping&quot;</span>
</span><span id="CodecOptions-355"><a href="#CodecOptions-355"><span class="linenos">355</span></a>            <span class="p">)</span>
</span><span id="CodecOptions-356"><a href="#CodecOptions-356"><span class="linenos">356</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tz_aware</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="CodecOptions-357"><a href="#CodecOptions-357"><span class="linenos">357</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;tz_aware must be True or False&quot;</span><span class="p">)</span>
</span><span id="CodecOptions-358"><a href="#CodecOptions-358"><span class="linenos">358</span></a>        <span class="k">if</span> <span class="n">uuid_representation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALL_UUID_REPRESENTATIONS</span><span class="p">:</span>
</span><span id="CodecOptions-359"><a href="#CodecOptions-359"><span class="linenos">359</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="CodecOptions-360"><a href="#CodecOptions-360"><span class="linenos">360</span></a>                <span class="s2">&quot;uuid_representation must be a value from .binary.UuidRepresentation&quot;</span>
</span><span id="CodecOptions-361"><a href="#CodecOptions-361"><span class="linenos">361</span></a>            <span class="p">)</span>
</span><span id="CodecOptions-362"><a href="#CodecOptions-362"><span class="linenos">362</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">unicode_decode_error_handler</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="CodecOptions-363"><a href="#CodecOptions-363"><span class="linenos">363</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;unicode_decode_error_handler must be a string&quot;</span><span class="p">)</span>
</span><span id="CodecOptions-364"><a href="#CodecOptions-364"><span class="linenos">364</span></a>        <span class="k">if</span> <span class="n">tzinfo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CodecOptions-365"><a href="#CodecOptions-365"><span class="linenos">365</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tzinfo</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">):</span>
</span><span id="CodecOptions-366"><a href="#CodecOptions-366"><span class="linenos">366</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;tzinfo must be an instance of datetime.tzinfo&quot;</span><span class="p">)</span>
</span><span id="CodecOptions-367"><a href="#CodecOptions-367"><span class="linenos">367</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">tz_aware</span><span class="p">:</span>
</span><span id="CodecOptions-368"><a href="#CodecOptions-368"><span class="linenos">368</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;cannot specify tzinfo without also setting tz_aware=True&quot;</span><span class="p">)</span>
</span><span id="CodecOptions-369"><a href="#CodecOptions-369"><span class="linenos">369</span></a>
</span><span id="CodecOptions-370"><a href="#CodecOptions-370"><span class="linenos">370</span></a>        <span class="n">type_registry</span> <span class="o">=</span> <span class="n">type_registry</span> <span class="ow">or</span> <span class="n">TypeRegistry</span><span class="p">()</span>
</span><span id="CodecOptions-371"><a href="#CodecOptions-371"><span class="linenos">371</span></a>
</span><span id="CodecOptions-372"><a href="#CodecOptions-372"><span class="linenos">372</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">type_registry</span><span class="p">,</span> <span class="n">TypeRegistry</span><span class="p">):</span>
</span><span id="CodecOptions-373"><a href="#CodecOptions-373"><span class="linenos">373</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;type_registry must be an instance of TypeRegistry&quot;</span><span class="p">)</span>
</span><span id="CodecOptions-374"><a href="#CodecOptions-374"><span class="linenos">374</span></a>
</span><span id="CodecOptions-375"><a href="#CodecOptions-375"><span class="linenos">375</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span>
</span><span id="CodecOptions-376"><a href="#CodecOptions-376"><span class="linenos">376</span></a>            <span class="bp">cls</span><span class="p">,</span>
</span><span id="CodecOptions-377"><a href="#CodecOptions-377"><span class="linenos">377</span></a>            <span class="p">(</span>
</span><span id="CodecOptions-378"><a href="#CodecOptions-378"><span class="linenos">378</span></a>                <span class="n">doc_class</span><span class="p">,</span>
</span><span id="CodecOptions-379"><a href="#CodecOptions-379"><span class="linenos">379</span></a>                <span class="n">tz_aware</span><span class="p">,</span>
</span><span id="CodecOptions-380"><a href="#CodecOptions-380"><span class="linenos">380</span></a>                <span class="n">uuid_representation</span><span class="p">,</span>
</span><span id="CodecOptions-381"><a href="#CodecOptions-381"><span class="linenos">381</span></a>                <span class="n">unicode_decode_error_handler</span><span class="p">,</span>
</span><span id="CodecOptions-382"><a href="#CodecOptions-382"><span class="linenos">382</span></a>                <span class="n">tzinfo</span><span class="p">,</span>
</span><span id="CodecOptions-383"><a href="#CodecOptions-383"><span class="linenos">383</span></a>                <span class="n">type_registry</span><span class="p">,</span>
</span><span id="CodecOptions-384"><a href="#CodecOptions-384"><span class="linenos">384</span></a>                <span class="n">datetime_conversion</span><span class="p">,</span>
</span><span id="CodecOptions-385"><a href="#CodecOptions-385"><span class="linenos">385</span></a>            <span class="p">),</span>
</span><span id="CodecOptions-386"><a href="#CodecOptions-386"><span class="linenos">386</span></a>        <span class="p">)</span>
</span><span id="CodecOptions-387"><a href="#CodecOptions-387"><span class="linenos">387</span></a>
</span><span id="CodecOptions-388"><a href="#CodecOptions-388"><span class="linenos">388</span></a>    <span class="k">def</span> <span class="nf">_arguments_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="CodecOptions-389"><a href="#CodecOptions-389"><span class="linenos">389</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Representation of the arguments used to create this object.&quot;&quot;&quot;</span>
</span><span id="CodecOptions-390"><a href="#CodecOptions-390"><span class="linenos">390</span></a>        <span class="n">document_class_repr</span> <span class="o">=</span> <span class="s2">&quot;dict&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_class</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="k">else</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">document_class</span><span class="p">)</span>
</span><span id="CodecOptions-391"><a href="#CodecOptions-391"><span class="linenos">391</span></a>
</span><span id="CodecOptions-392"><a href="#CodecOptions-392"><span class="linenos">392</span></a>        <span class="n">uuid_rep_repr</span> <span class="o">=</span> <span class="n">UUID_REPRESENTATION_NAMES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="CodecOptions-393"><a href="#CodecOptions-393"><span class="linenos">393</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">uuid_representation</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uuid_representation</span>
</span><span id="CodecOptions-394"><a href="#CodecOptions-394"><span class="linenos">394</span></a>        <span class="p">)</span>
</span><span id="CodecOptions-395"><a href="#CodecOptions-395"><span class="linenos">395</span></a>
</span><span id="CodecOptions-396"><a href="#CodecOptions-396"><span class="linenos">396</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="CodecOptions-397"><a href="#CodecOptions-397"><span class="linenos">397</span></a>            <span class="s2">&quot;document_class=</span><span class="si">%s</span><span class="s2">, tz_aware=</span><span class="si">%r</span><span class="s2">, uuid_representation=</span><span class="si">%s</span><span class="s2">, &quot;</span>
</span><span id="CodecOptions-398"><a href="#CodecOptions-398"><span class="linenos">398</span></a>            <span class="s2">&quot;unicode_decode_error_handler=</span><span class="si">%r</span><span class="s2">, tzinfo=</span><span class="si">%r</span><span class="s2">, &quot;</span>
</span><span id="CodecOptions-399"><a href="#CodecOptions-399"><span class="linenos">399</span></a>            <span class="s2">&quot;type_registry=</span><span class="si">%r</span><span class="s2">, datetime_conversion=</span><span class="si">%s</span><span class="s2">&quot;</span>
</span><span id="CodecOptions-400"><a href="#CodecOptions-400"><span class="linenos">400</span></a>            <span class="o">%</span> <span class="p">(</span>
</span><span id="CodecOptions-401"><a href="#CodecOptions-401"><span class="linenos">401</span></a>                <span class="n">document_class_repr</span><span class="p">,</span>
</span><span id="CodecOptions-402"><a href="#CodecOptions-402"><span class="linenos">402</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tz_aware</span><span class="p">,</span>
</span><span id="CodecOptions-403"><a href="#CodecOptions-403"><span class="linenos">403</span></a>                <span class="n">uuid_rep_repr</span><span class="p">,</span>
</span><span id="CodecOptions-404"><a href="#CodecOptions-404"><span class="linenos">404</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">unicode_decode_error_handler</span><span class="p">,</span>
</span><span id="CodecOptions-405"><a href="#CodecOptions-405"><span class="linenos">405</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">,</span>
</span><span id="CodecOptions-406"><a href="#CodecOptions-406"><span class="linenos">406</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">type_registry</span><span class="p">,</span>
</span><span id="CodecOptions-407"><a href="#CodecOptions-407"><span class="linenos">407</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">datetime_conversion</span><span class="p">,</span>
</span><span id="CodecOptions-408"><a href="#CodecOptions-408"><span class="linenos">408</span></a>            <span class="p">)</span>
</span><span id="CodecOptions-409"><a href="#CodecOptions-409"><span class="linenos">409</span></a>        <span class="p">)</span>
</span><span id="CodecOptions-410"><a href="#CodecOptions-410"><span class="linenos">410</span></a>
</span><span id="CodecOptions-411"><a href="#CodecOptions-411"><span class="linenos">411</span></a>    <span class="k">def</span> <span class="nf">_options_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="CodecOptions-412"><a href="#CodecOptions-412"><span class="linenos">412</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Dictionary of the arguments used to create this object.&quot;&quot;&quot;</span>
</span><span id="CodecOptions-413"><a href="#CodecOptions-413"><span class="linenos">413</span></a>        <span class="c1"># TODO: PYTHON-2442 use _asdict() instead</span>
</span><span id="CodecOptions-414"><a href="#CodecOptions-414"><span class="linenos">414</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="CodecOptions-415"><a href="#CodecOptions-415"><span class="linenos">415</span></a>            <span class="s2">&quot;document_class&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">document_class</span><span class="p">,</span>
</span><span id="CodecOptions-416"><a href="#CodecOptions-416"><span class="linenos">416</span></a>            <span class="s2">&quot;tz_aware&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tz_aware</span><span class="p">,</span>
</span><span id="CodecOptions-417"><a href="#CodecOptions-417"><span class="linenos">417</span></a>            <span class="s2">&quot;uuid_representation&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uuid_representation</span><span class="p">,</span>
</span><span id="CodecOptions-418"><a href="#CodecOptions-418"><span class="linenos">418</span></a>            <span class="s2">&quot;unicode_decode_error_handler&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">unicode_decode_error_handler</span><span class="p">,</span>
</span><span id="CodecOptions-419"><a href="#CodecOptions-419"><span class="linenos">419</span></a>            <span class="s2">&quot;tzinfo&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">,</span>
</span><span id="CodecOptions-420"><a href="#CodecOptions-420"><span class="linenos">420</span></a>            <span class="s2">&quot;type_registry&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">type_registry</span><span class="p">,</span>
</span><span id="CodecOptions-421"><a href="#CodecOptions-421"><span class="linenos">421</span></a>            <span class="s2">&quot;datetime_conversion&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime_conversion</span><span class="p">,</span>
</span><span id="CodecOptions-422"><a href="#CodecOptions-422"><span class="linenos">422</span></a>        <span class="p">}</span>
</span><span id="CodecOptions-423"><a href="#CodecOptions-423"><span class="linenos">423</span></a>
</span><span id="CodecOptions-424"><a href="#CodecOptions-424"><span class="linenos">424</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="CodecOptions-425"><a href="#CodecOptions-425"><span class="linenos">425</span></a>        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_arguments_repr</span><span class="p">())</span>
</span><span id="CodecOptions-426"><a href="#CodecOptions-426"><span class="linenos">426</span></a>
</span><span id="CodecOptions-427"><a href="#CodecOptions-427"><span class="linenos">427</span></a>    <span class="k">def</span> <span class="nf">with_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CodecOptions&quot;</span><span class="p">:</span>
</span><span id="CodecOptions-428"><a href="#CodecOptions-428"><span class="linenos">428</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a copy of this CodecOptions, overriding some options::</span>
</span><span id="CodecOptions-429"><a href="#CodecOptions-429"><span class="linenos">429</span></a>
</span><span id="CodecOptions-430"><a href="#CodecOptions-430"><span class="linenos">430</span></a><span class="sd">            &gt;&gt;&gt; from .codec_options import DEFAULT_CODEC_OPTIONS</span>
</span><span id="CodecOptions-431"><a href="#CodecOptions-431"><span class="linenos">431</span></a><span class="sd">            &gt;&gt;&gt; DEFAULT_CODEC_OPTIONS.tz_aware</span>
</span><span id="CodecOptions-432"><a href="#CodecOptions-432"><span class="linenos">432</span></a><span class="sd">            False</span>
</span><span id="CodecOptions-433"><a href="#CodecOptions-433"><span class="linenos">433</span></a><span class="sd">            &gt;&gt;&gt; options = DEFAULT_CODEC_OPTIONS.with_options(tz_aware=True)</span>
</span><span id="CodecOptions-434"><a href="#CodecOptions-434"><span class="linenos">434</span></a><span class="sd">            &gt;&gt;&gt; options.tz_aware</span>
</span><span id="CodecOptions-435"><a href="#CodecOptions-435"><span class="linenos">435</span></a><span class="sd">            True</span>
</span><span id="CodecOptions-436"><a href="#CodecOptions-436"><span class="linenos">436</span></a>
</span><span id="CodecOptions-437"><a href="#CodecOptions-437"><span class="linenos">437</span></a><span class="sd">        .. versionadded:: 3.5</span>
</span><span id="CodecOptions-438"><a href="#CodecOptions-438"><span class="linenos">438</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CodecOptions-439"><a href="#CodecOptions-439"><span class="linenos">439</span></a>        <span class="n">opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options_dict</span><span class="p">()</span>
</span><span id="CodecOptions-440"><a href="#CodecOptions-440"><span class="linenos">440</span></a>        <span class="n">opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="CodecOptions-441"><a href="#CodecOptions-441"><span class="linenos">441</span></a>        <span class="k">return</span> <span class="n">CodecOptions</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Encapsulates options used encoding and / or decoding BSON.</p>

<p>The <code><a href="#CodecOptions.document_class">document_class</a></code> option is used to define a custom type for use
decoding BSON documents. Access to the underlying raw BSON bytes for
a document is available using the <code>~bson.raw_bson.RawBSONDocument</code>
type::</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">.raw_bson</span> <span class="kn">import</span> <span class="n">RawBSONDocument</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">.codec_options</span> <span class="kn">import</span> <span class="n">CodecOptions</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">codec_options</span> <span class="o">=</span> <span class="n">CodecOptions</span><span class="p">(</span><span class="n">document_class</span><span class="o">=</span><span class="n">RawBSONDocument</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coll</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">codec_options</span><span class="o">=</span><span class="n">codec_options</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">find_one</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">raw</span>
<span class="go">&#39;\x16\x00\x00\x00\x07_id\x00[0\x165\x91\x10\xea\x14\xe8\xc5\x8b\x93\x00&#39;</span>
</code></pre>
</div>

<p>The document class can be any type that inherits from
<code>~collections.abc.MutableMapping</code>::</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">AttributeDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="gp">... </span>    <span class="c1"># A dict that supports attribute access.</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">codec_options</span> <span class="o">=</span> <span class="n">CodecOptions</span><span class="p">(</span><span class="n">document_class</span><span class="o">=</span><span class="n">AttributeDict</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coll</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_collection</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">codec_options</span><span class="o">=</span><span class="n">codec_options</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">coll</span><span class="o">.</span><span class="n">find_one</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span><span class="o">.</span><span class="n">_id</span>
<span class="go">ObjectId(&#39;5b3016359110ea14e8c58b93&#39;)</span>
</code></pre>
</div>

<p>See :doc:<code>/examples/datetimes</code> for examples using the <code><a href="#CodecOptions.tz_aware">tz_aware</a></code> and
<code><a href="#CodecOptions.tzinfo">tzinfo</a></code> options.</p>

<p>See :doc:<code>/examples/uuid</code> for examples using the <code><a href="#CodecOptions.uuid_representation">uuid_representation</a></code>
option.</p>

<p>:Parameters:</p>

<ul>
<li><code><a href="#CodecOptions.document_class">document_class</a></code>: BSON documents returned in queries will be decoded
to an instance of this class. Must be a subclass of
<code>~collections.abc.MutableMapping</code>. Defaults to <code>dict</code>.</li>
<li><code><a href="#CodecOptions.tz_aware">tz_aware</a></code>: If <code>True</code>, BSON datetimes will be decoded to timezone
aware instances of <code>~datetime.datetime</code>. Otherwise they will be
naive. Defaults to <code>False</code>.</li>
<li><code><a href="#CodecOptions.uuid_representation">uuid_representation</a></code>: The BSON representation to use when encoding
and decoding instances of <code>~uuid.UUID</code>. Defaults to
<code>~bson.binary.UuidRepresentation.UNSPECIFIED</code>. New
applications should consider setting this to
<code>~bson.binary.UuidRepresentation.STANDARD</code> for cross language
compatibility. See :ref:<code>handling-uuid-data-example</code> for details.</li>
<li><code><a href="#CodecOptions.unicode_decode_error_handler">unicode_decode_error_handler</a></code>: The error handler to apply when
a Unicode-related error occurs during BSON decoding that would
otherwise raise <code>UnicodeDecodeError</code>. Valid options include
'strict', 'replace', 'backslashreplace', 'surrogateescape', and
'ignore'. Defaults to 'strict'.</li>
<li><code><a href="#CodecOptions.tzinfo">tzinfo</a></code>: A <code>~datetime.tzinfo</code> subclass that specifies the
timezone to/from which <code>~datetime.datetime</code> objects should be
encoded/decoded.</li>
<li><code><a href="#CodecOptions.type_registry">type_registry</a></code>: Instance of <code>TypeRegistry</code> used to customize
encoding and decoding behavior.</li>
<li><code><a href="#CodecOptions.datetime_conversion">datetime_conversion</a></code>: Specifies how UTC datetimes should be decoded
within BSON. Valid options include 'datetime_ms' to return as a
DatetimeMS, 'datetime' to return as a datetime.datetime and
raising a ValueError for out-of-range values, 'datetime_auto' to
return DatetimeMS objects when the underlying datetime is
out-of-range and 'datetime_clamp' to clamp to the minimum and
maximum possible datetimes. Defaults to 'datetime'.
<em>Changed in version 4.0:</em>
The default for <code><a href="#CodecOptions.uuid_representation">uuid_representation</a></code> was changed from
<code>~bson.binary.UuidRepresentation.PYTHON_LEGACY</code> to
<code>~bson.binary.UuidRepresentation.UNSPECIFIED</code>.</li>
</ul>

<p><em>New in version 3.8:</em>
<code><a href="#CodecOptions.type_registry">type_registry</a></code> attribute.</p>

<div class="pdoc-alert pdoc-alert-warning">

<h6 id="care-must-be-taken-when-changing">Care must be taken when changing</h6>

<p><code><a href="#CodecOptions.unicode_decode_error_handler">unicode_decode_error_handler</a></code> from its default value ('strict').
The 'replace' and 'ignore' modes should not be used when documents
retrieved from the server will be modified in the client application
and stored back to the server.</p>

</div>
</div>


                            <div id="CodecOptions.with_options" class="classattr">
                                        <input id="CodecOptions.with_options-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">with_options</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n"><a href="#CodecOptions">xtquant.xtbson.bson37.CodecOptions</a></span>:</span></span>

                <label class="view-source-button" for="CodecOptions.with_options-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CodecOptions.with_options"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CodecOptions.with_options-427"><a href="#CodecOptions.with_options-427"><span class="linenos">427</span></a>    <span class="k">def</span> <span class="nf">with_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CodecOptions&quot;</span><span class="p">:</span>
</span><span id="CodecOptions.with_options-428"><a href="#CodecOptions.with_options-428"><span class="linenos">428</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a copy of this CodecOptions, overriding some options::</span>
</span><span id="CodecOptions.with_options-429"><a href="#CodecOptions.with_options-429"><span class="linenos">429</span></a>
</span><span id="CodecOptions.with_options-430"><a href="#CodecOptions.with_options-430"><span class="linenos">430</span></a><span class="sd">            &gt;&gt;&gt; from .codec_options import DEFAULT_CODEC_OPTIONS</span>
</span><span id="CodecOptions.with_options-431"><a href="#CodecOptions.with_options-431"><span class="linenos">431</span></a><span class="sd">            &gt;&gt;&gt; DEFAULT_CODEC_OPTIONS.tz_aware</span>
</span><span id="CodecOptions.with_options-432"><a href="#CodecOptions.with_options-432"><span class="linenos">432</span></a><span class="sd">            False</span>
</span><span id="CodecOptions.with_options-433"><a href="#CodecOptions.with_options-433"><span class="linenos">433</span></a><span class="sd">            &gt;&gt;&gt; options = DEFAULT_CODEC_OPTIONS.with_options(tz_aware=True)</span>
</span><span id="CodecOptions.with_options-434"><a href="#CodecOptions.with_options-434"><span class="linenos">434</span></a><span class="sd">            &gt;&gt;&gt; options.tz_aware</span>
</span><span id="CodecOptions.with_options-435"><a href="#CodecOptions.with_options-435"><span class="linenos">435</span></a><span class="sd">            True</span>
</span><span id="CodecOptions.with_options-436"><a href="#CodecOptions.with_options-436"><span class="linenos">436</span></a>
</span><span id="CodecOptions.with_options-437"><a href="#CodecOptions.with_options-437"><span class="linenos">437</span></a><span class="sd">        .. versionadded:: 3.5</span>
</span><span id="CodecOptions.with_options-438"><a href="#CodecOptions.with_options-438"><span class="linenos">438</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="CodecOptions.with_options-439"><a href="#CodecOptions.with_options-439"><span class="linenos">439</span></a>        <span class="n">opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options_dict</span><span class="p">()</span>
</span><span id="CodecOptions.with_options-440"><a href="#CodecOptions.with_options-440"><span class="linenos">440</span></a>        <span class="n">opts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="CodecOptions.with_options-441"><a href="#CodecOptions.with_options-441"><span class="linenos">441</span></a>        <span class="k">return</span> <span class="n">CodecOptions</span><span class="p">(</span><span class="o">**</span><span class="n">opts</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Make a copy of this CodecOptions, overriding some options::</p>

<pre><code>&gt;&gt;&gt; from .codec_options import DEFAULT_CODEC_OPTIONS
&gt;&gt;&gt; DEFAULT_CODEC_OPTIONS.tz_aware
False
&gt;&gt;&gt; options = DEFAULT_CODEC_OPTIONS.with_options(tz_aware=True)
&gt;&gt;&gt; options.tz_aware
True
</code></pre>

<p><em>New in version 3.5.</em></p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>xtquant.xtbson.bson37.codec_options._BaseCodecOptions</dt>
                                <dd id="CodecOptions.document_class" class="variable">document_class</dd>
                <dd id="CodecOptions.tz_aware" class="variable">tz_aware</dd>
                <dd id="CodecOptions.uuid_representation" class="variable">uuid_representation</dd>
                <dd id="CodecOptions.unicode_decode_error_handler" class="variable">unicode_decode_error_handler</dd>
                <dd id="CodecOptions.tzinfo" class="variable">tzinfo</dd>
                <dd id="CodecOptions.type_registry" class="variable">type_registry</dd>
                <dd id="CodecOptions.datetime_conversion" class="variable">datetime_conversion</dd>

            </div>
            <div><dt>builtins.tuple</dt>
                                <dd id="CodecOptions.index" class="function">index</dd>
                <dd id="CodecOptions.count" class="function">count</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DBRef">
                            <input id="DBRef-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DBRef</span>:

                <label class="view-source-button" for="DBRef-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DBRef"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DBRef-25"><a href="#DBRef-25"><span class="linenos"> 25</span></a><span class="k">class</span> <span class="nc">DBRef</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="DBRef-26"><a href="#DBRef-26"><span class="linenos"> 26</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A reference to a document stored in MongoDB.&quot;&quot;&quot;</span>
</span><span id="DBRef-27"><a href="#DBRef-27"><span class="linenos"> 27</span></a>
</span><span id="DBRef-28"><a href="#DBRef-28"><span class="linenos"> 28</span></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="s2">&quot;__collection&quot;</span><span class="p">,</span> <span class="s2">&quot;__id&quot;</span><span class="p">,</span> <span class="s2">&quot;__database&quot;</span><span class="p">,</span> <span class="s2">&quot;__kwargs&quot;</span>
</span><span id="DBRef-29"><a href="#DBRef-29"><span class="linenos"> 29</span></a>    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_slots</span>
</span><span id="DBRef-30"><a href="#DBRef-30"><span class="linenos"> 30</span></a>    <span class="n">__setstate__</span> <span class="o">=</span> <span class="n">_setstate_slots</span>
</span><span id="DBRef-31"><a href="#DBRef-31"><span class="linenos"> 31</span></a>    <span class="c1"># DBRef isn&#39;t actually a BSON &quot;type&quot; so this number was arbitrarily chosen.</span>
</span><span id="DBRef-32"><a href="#DBRef-32"><span class="linenos"> 32</span></a>    <span class="n">_type_marker</span> <span class="o">=</span> <span class="mi">100</span>
</span><span id="DBRef-33"><a href="#DBRef-33"><span class="linenos"> 33</span></a>
</span><span id="DBRef-34"><a href="#DBRef-34"><span class="linenos"> 34</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="DBRef-35"><a href="#DBRef-35"><span class="linenos"> 35</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DBRef-36"><a href="#DBRef-36"><span class="linenos"> 36</span></a>        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="DBRef-37"><a href="#DBRef-37"><span class="linenos"> 37</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="DBRef-38"><a href="#DBRef-38"><span class="linenos"> 38</span></a>        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DBRef-39"><a href="#DBRef-39"><span class="linenos"> 39</span></a>        <span class="n">_extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DBRef-40"><a href="#DBRef-40"><span class="linenos"> 40</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="DBRef-41"><a href="#DBRef-41"><span class="linenos"> 41</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DBRef-42"><a href="#DBRef-42"><span class="linenos"> 42</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a new :class:`DBRef`.</span>
</span><span id="DBRef-43"><a href="#DBRef-43"><span class="linenos"> 43</span></a>
</span><span id="DBRef-44"><a href="#DBRef-44"><span class="linenos"> 44</span></a><span class="sd">        Raises :class:`TypeError` if `collection` or `database` is not</span>
</span><span id="DBRef-45"><a href="#DBRef-45"><span class="linenos"> 45</span></a><span class="sd">        an instance of :class:`basestring` (:class:`str` in python 3).</span>
</span><span id="DBRef-46"><a href="#DBRef-46"><span class="linenos"> 46</span></a><span class="sd">        `database` is optional and allows references to documents to work</span>
</span><span id="DBRef-47"><a href="#DBRef-47"><span class="linenos"> 47</span></a><span class="sd">        across databases. Any additional keyword arguments will create</span>
</span><span id="DBRef-48"><a href="#DBRef-48"><span class="linenos"> 48</span></a><span class="sd">        additional fields in the resultant embedded document.</span>
</span><span id="DBRef-49"><a href="#DBRef-49"><span class="linenos"> 49</span></a>
</span><span id="DBRef-50"><a href="#DBRef-50"><span class="linenos"> 50</span></a><span class="sd">        :Parameters:</span>
</span><span id="DBRef-51"><a href="#DBRef-51"><span class="linenos"> 51</span></a><span class="sd">          - `collection`: name of the collection the document is stored in</span>
</span><span id="DBRef-52"><a href="#DBRef-52"><span class="linenos"> 52</span></a><span class="sd">          - `id`: the value of the document&#39;s ``&quot;_id&quot;`` field</span>
</span><span id="DBRef-53"><a href="#DBRef-53"><span class="linenos"> 53</span></a><span class="sd">          - `database` (optional): name of the database to reference</span>
</span><span id="DBRef-54"><a href="#DBRef-54"><span class="linenos"> 54</span></a><span class="sd">          - `**kwargs` (optional): additional keyword arguments will</span>
</span><span id="DBRef-55"><a href="#DBRef-55"><span class="linenos"> 55</span></a><span class="sd">            create additional, custom fields</span>
</span><span id="DBRef-56"><a href="#DBRef-56"><span class="linenos"> 56</span></a>
</span><span id="DBRef-57"><a href="#DBRef-57"><span class="linenos"> 57</span></a><span class="sd">        .. seealso:: The MongoDB documentation on `dbrefs &lt;https://dochub.mongodb.org/core/dbrefs&gt;`_.</span>
</span><span id="DBRef-58"><a href="#DBRef-58"><span class="linenos"> 58</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DBRef-59"><a href="#DBRef-59"><span class="linenos"> 59</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DBRef-60"><a href="#DBRef-60"><span class="linenos"> 60</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;collection must be an instance of str&quot;</span><span class="p">)</span>
</span><span id="DBRef-61"><a href="#DBRef-61"><span class="linenos"> 61</span></a>        <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DBRef-62"><a href="#DBRef-62"><span class="linenos"> 62</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;database must be an instance of str&quot;</span><span class="p">)</span>
</span><span id="DBRef-63"><a href="#DBRef-63"><span class="linenos"> 63</span></a>
</span><span id="DBRef-64"><a href="#DBRef-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__collection</span> <span class="o">=</span> <span class="n">collection</span>
</span><span id="DBRef-65"><a href="#DBRef-65"><span class="linenos"> 65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">=</span> <span class="nb">id</span>
</span><span id="DBRef-66"><a href="#DBRef-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__database</span> <span class="o">=</span> <span class="n">database</span>
</span><span id="DBRef-67"><a href="#DBRef-67"><span class="linenos"> 67</span></a>        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_extra</span> <span class="ow">or</span> <span class="p">{})</span>
</span><span id="DBRef-68"><a href="#DBRef-68"><span class="linenos"> 68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</span><span id="DBRef-69"><a href="#DBRef-69"><span class="linenos"> 69</span></a>
</span><span id="DBRef-70"><a href="#DBRef-70"><span class="linenos"> 70</span></a>    <span class="nd">@property</span>
</span><span id="DBRef-71"><a href="#DBRef-71"><span class="linenos"> 71</span></a>    <span class="k">def</span> <span class="nf">collection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DBRef-72"><a href="#DBRef-72"><span class="linenos"> 72</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the name of this DBRef&#39;s collection.&quot;&quot;&quot;</span>
</span><span id="DBRef-73"><a href="#DBRef-73"><span class="linenos"> 73</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__collection</span>
</span><span id="DBRef-74"><a href="#DBRef-74"><span class="linenos"> 74</span></a>
</span><span id="DBRef-75"><a href="#DBRef-75"><span class="linenos"> 75</span></a>    <span class="nd">@property</span>
</span><span id="DBRef-76"><a href="#DBRef-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="DBRef-77"><a href="#DBRef-77"><span class="linenos"> 77</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get this DBRef&#39;s _id.&quot;&quot;&quot;</span>
</span><span id="DBRef-78"><a href="#DBRef-78"><span class="linenos"> 78</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span>
</span><span id="DBRef-79"><a href="#DBRef-79"><span class="linenos"> 79</span></a>
</span><span id="DBRef-80"><a href="#DBRef-80"><span class="linenos"> 80</span></a>    <span class="nd">@property</span>
</span><span id="DBRef-81"><a href="#DBRef-81"><span class="linenos"> 81</span></a>    <span class="k">def</span> <span class="nf">database</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="DBRef-82"><a href="#DBRef-82"><span class="linenos"> 82</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the name of this DBRef&#39;s database.</span>
</span><span id="DBRef-83"><a href="#DBRef-83"><span class="linenos"> 83</span></a>
</span><span id="DBRef-84"><a href="#DBRef-84"><span class="linenos"> 84</span></a><span class="sd">        Returns None if this DBRef doesn&#39;t specify a database.</span>
</span><span id="DBRef-85"><a href="#DBRef-85"><span class="linenos"> 85</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DBRef-86"><a href="#DBRef-86"><span class="linenos"> 86</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__database</span>
</span><span id="DBRef-87"><a href="#DBRef-87"><span class="linenos"> 87</span></a>
</span><span id="DBRef-88"><a href="#DBRef-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="DBRef-89"><a href="#DBRef-89"><span class="linenos"> 89</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="DBRef-90"><a href="#DBRef-90"><span class="linenos"> 90</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="DBRef-91"><a href="#DBRef-91"><span class="linenos"> 91</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="DBRef-92"><a href="#DBRef-92"><span class="linenos"> 92</span></a>            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="DBRef-93"><a href="#DBRef-93"><span class="linenos"> 93</span></a>
</span><span id="DBRef-94"><a href="#DBRef-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="nf">as_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SON</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="DBRef-95"><a href="#DBRef-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the SON document representation of this DBRef.</span>
</span><span id="DBRef-96"><a href="#DBRef-96"><span class="linenos"> 96</span></a>
</span><span id="DBRef-97"><a href="#DBRef-97"><span class="linenos"> 97</span></a><span class="sd">        Generally not needed by application developers</span>
</span><span id="DBRef-98"><a href="#DBRef-98"><span class="linenos"> 98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DBRef-99"><a href="#DBRef-99"><span class="linenos"> 99</span></a>        <span class="n">doc</span> <span class="o">=</span> <span class="n">SON</span><span class="p">([(</span><span class="s2">&quot;$ref&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;$id&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
</span><span id="DBRef-100"><a href="#DBRef-100"><span class="linenos">100</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DBRef-101"><a href="#DBRef-101"><span class="linenos">101</span></a>            <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;$db&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
</span><span id="DBRef-102"><a href="#DBRef-102"><span class="linenos">102</span></a>        <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__kwargs</span><span class="p">)</span>
</span><span id="DBRef-103"><a href="#DBRef-103"><span class="linenos">103</span></a>        <span class="k">return</span> <span class="n">doc</span>
</span><span id="DBRef-104"><a href="#DBRef-104"><span class="linenos">104</span></a>
</span><span id="DBRef-105"><a href="#DBRef-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="DBRef-106"><a href="#DBRef-106"><span class="linenos">106</span></a>        <span class="n">extra</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;, </span><span class="si">%s</span><span class="s2">=</span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="DBRef-107"><a href="#DBRef-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DBRef-108"><a href="#DBRef-108"><span class="linenos">108</span></a>            <span class="k">return</span> <span class="s2">&quot;DBRef(</span><span class="si">%r</span><span class="s2">, </span><span class="si">%r%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">extra</span><span class="p">)</span>
</span><span id="DBRef-109"><a href="#DBRef-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="s2">&quot;DBRef(</span><span class="si">%r</span><span class="s2">, </span><span class="si">%r</span><span class="s2">, </span><span class="si">%r%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">,</span> <span class="n">extra</span><span class="p">)</span>
</span><span id="DBRef-110"><a href="#DBRef-110"><span class="linenos">110</span></a>
</span><span id="DBRef-111"><a href="#DBRef-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="DBRef-112"><a href="#DBRef-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DBRef</span><span class="p">):</span>
</span><span id="DBRef-113"><a href="#DBRef-113"><span class="linenos">113</span></a>            <span class="n">us</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__database</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__collection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__kwargs</span><span class="p">)</span>
</span><span id="DBRef-114"><a href="#DBRef-114"><span class="linenos">114</span></a>            <span class="n">them</span> <span class="o">=</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">__database</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">__collection</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">__id</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">__kwargs</span><span class="p">)</span>
</span><span id="DBRef-115"><a href="#DBRef-115"><span class="linenos">115</span></a>            <span class="k">return</span> <span class="n">us</span> <span class="o">==</span> <span class="n">them</span>
</span><span id="DBRef-116"><a href="#DBRef-116"><span class="linenos">116</span></a>        <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="DBRef-117"><a href="#DBRef-117"><span class="linenos">117</span></a>
</span><span id="DBRef-118"><a href="#DBRef-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="DBRef-119"><a href="#DBRef-119"><span class="linenos">119</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="DBRef-120"><a href="#DBRef-120"><span class="linenos">120</span></a>
</span><span id="DBRef-121"><a href="#DBRef-121"><span class="linenos">121</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="DBRef-122"><a href="#DBRef-122"><span class="linenos">122</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a hash value for this :class:`DBRef`.&quot;&quot;&quot;</span>
</span><span id="DBRef-123"><a href="#DBRef-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span>
</span><span id="DBRef-124"><a href="#DBRef-124"><span class="linenos">124</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__collection</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__database</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">())))</span>
</span><span id="DBRef-125"><a href="#DBRef-125"><span class="linenos">125</span></a>        <span class="p">)</span>
</span><span id="DBRef-126"><a href="#DBRef-126"><span class="linenos">126</span></a>
</span><span id="DBRef-127"><a href="#DBRef-127"><span class="linenos">127</span></a>    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;DBRef&quot;</span><span class="p">:</span>
</span><span id="DBRef-128"><a href="#DBRef-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Support function for `copy.deepcopy()`.&quot;&quot;&quot;</span>
</span><span id="DBRef-129"><a href="#DBRef-129"><span class="linenos">129</span></a>        <span class="k">return</span> <span class="n">DBRef</span><span class="p">(</span>
</span><span id="DBRef-130"><a href="#DBRef-130"><span class="linenos">130</span></a>            <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__collection</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
</span><span id="DBRef-131"><a href="#DBRef-131"><span class="linenos">131</span></a>            <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__id</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
</span><span id="DBRef-132"><a href="#DBRef-132"><span class="linenos">132</span></a>            <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__database</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
</span><span id="DBRef-133"><a href="#DBRef-133"><span class="linenos">133</span></a>            <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__kwargs</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
</span><span id="DBRef-134"><a href="#DBRef-134"><span class="linenos">134</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A reference to a document stored in MongoDB.</p>
</div>


                            <div id="DBRef.__init__" class="classattr">
                                        <input id="DBRef.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DBRef</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">collection</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="nb">id</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">_extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span>)</span>

                <label class="view-source-button" for="DBRef.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DBRef.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DBRef.__init__-34"><a href="#DBRef.__init__-34"><span class="linenos">34</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="DBRef.__init__-35"><a href="#DBRef.__init__-35"><span class="linenos">35</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="DBRef.__init__-36"><a href="#DBRef.__init__-36"><span class="linenos">36</span></a>        <span class="n">collection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="DBRef.__init__-37"><a href="#DBRef.__init__-37"><span class="linenos">37</span></a>        <span class="nb">id</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="DBRef.__init__-38"><a href="#DBRef.__init__-38"><span class="linenos">38</span></a>        <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DBRef.__init__-39"><a href="#DBRef.__init__-39"><span class="linenos">39</span></a>        <span class="n">_extra</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="DBRef.__init__-40"><a href="#DBRef.__init__-40"><span class="linenos">40</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="DBRef.__init__-41"><a href="#DBRef.__init__-41"><span class="linenos">41</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DBRef.__init__-42"><a href="#DBRef.__init__-42"><span class="linenos">42</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a new :class:`DBRef`.</span>
</span><span id="DBRef.__init__-43"><a href="#DBRef.__init__-43"><span class="linenos">43</span></a>
</span><span id="DBRef.__init__-44"><a href="#DBRef.__init__-44"><span class="linenos">44</span></a><span class="sd">        Raises :class:`TypeError` if `collection` or `database` is not</span>
</span><span id="DBRef.__init__-45"><a href="#DBRef.__init__-45"><span class="linenos">45</span></a><span class="sd">        an instance of :class:`basestring` (:class:`str` in python 3).</span>
</span><span id="DBRef.__init__-46"><a href="#DBRef.__init__-46"><span class="linenos">46</span></a><span class="sd">        `database` is optional and allows references to documents to work</span>
</span><span id="DBRef.__init__-47"><a href="#DBRef.__init__-47"><span class="linenos">47</span></a><span class="sd">        across databases. Any additional keyword arguments will create</span>
</span><span id="DBRef.__init__-48"><a href="#DBRef.__init__-48"><span class="linenos">48</span></a><span class="sd">        additional fields in the resultant embedded document.</span>
</span><span id="DBRef.__init__-49"><a href="#DBRef.__init__-49"><span class="linenos">49</span></a>
</span><span id="DBRef.__init__-50"><a href="#DBRef.__init__-50"><span class="linenos">50</span></a><span class="sd">        :Parameters:</span>
</span><span id="DBRef.__init__-51"><a href="#DBRef.__init__-51"><span class="linenos">51</span></a><span class="sd">          - `collection`: name of the collection the document is stored in</span>
</span><span id="DBRef.__init__-52"><a href="#DBRef.__init__-52"><span class="linenos">52</span></a><span class="sd">          - `id`: the value of the document&#39;s ``&quot;_id&quot;`` field</span>
</span><span id="DBRef.__init__-53"><a href="#DBRef.__init__-53"><span class="linenos">53</span></a><span class="sd">          - `database` (optional): name of the database to reference</span>
</span><span id="DBRef.__init__-54"><a href="#DBRef.__init__-54"><span class="linenos">54</span></a><span class="sd">          - `**kwargs` (optional): additional keyword arguments will</span>
</span><span id="DBRef.__init__-55"><a href="#DBRef.__init__-55"><span class="linenos">55</span></a><span class="sd">            create additional, custom fields</span>
</span><span id="DBRef.__init__-56"><a href="#DBRef.__init__-56"><span class="linenos">56</span></a>
</span><span id="DBRef.__init__-57"><a href="#DBRef.__init__-57"><span class="linenos">57</span></a><span class="sd">        .. seealso:: The MongoDB documentation on `dbrefs &lt;https://dochub.mongodb.org/core/dbrefs&gt;`_.</span>
</span><span id="DBRef.__init__-58"><a href="#DBRef.__init__-58"><span class="linenos">58</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DBRef.__init__-59"><a href="#DBRef.__init__-59"><span class="linenos">59</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DBRef.__init__-60"><a href="#DBRef.__init__-60"><span class="linenos">60</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;collection must be an instance of str&quot;</span><span class="p">)</span>
</span><span id="DBRef.__init__-61"><a href="#DBRef.__init__-61"><span class="linenos">61</span></a>        <span class="k">if</span> <span class="n">database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">database</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="DBRef.__init__-62"><a href="#DBRef.__init__-62"><span class="linenos">62</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;database must be an instance of str&quot;</span><span class="p">)</span>
</span><span id="DBRef.__init__-63"><a href="#DBRef.__init__-63"><span class="linenos">63</span></a>
</span><span id="DBRef.__init__-64"><a href="#DBRef.__init__-64"><span class="linenos">64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__collection</span> <span class="o">=</span> <span class="n">collection</span>
</span><span id="DBRef.__init__-65"><a href="#DBRef.__init__-65"><span class="linenos">65</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">=</span> <span class="nb">id</span>
</span><span id="DBRef.__init__-66"><a href="#DBRef.__init__-66"><span class="linenos">66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__database</span> <span class="o">=</span> <span class="n">database</span>
</span><span id="DBRef.__init__-67"><a href="#DBRef.__init__-67"><span class="linenos">67</span></a>        <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_extra</span> <span class="ow">or</span> <span class="p">{})</span>
</span><span id="DBRef.__init__-68"><a href="#DBRef.__init__-68"><span class="linenos">68</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a new <code><a href="#DBRef">DBRef</a></code>.</p>

<p>Raises <code>TypeError</code> if <code><a href="#DBRef.collection">collection</a></code> or <code><a href="#DBRef.database">database</a></code> is not
an instance of <code>basestring</code> (<code>str</code> in python 3).
<code><a href="#DBRef.database">database</a></code> is optional and allows references to documents to work
across databases. Any additional keyword arguments will create
additional fields in the resultant embedded document.</p>

<p>:Parameters:</p>

<ul>
<li><code><a href="#DBRef.collection">collection</a></code>: name of the collection the document is stored in</li>
<li><code><a href="#DBRef.id">id</a></code>: the value of the document's <code>"_id"</code> field</li>
<li><code><a href="#DBRef.database">database</a></code> (optional): name of the database to reference</li>
<li><code>**kwargs</code> (optional): additional keyword arguments will
create additional, custom fields</li>
</ul>

<p><em>seealso The MongoDB documentation on <a href="https://dochub.mongodb.org/core/dbrefs">dbrefs </a>..</em></p>
</div>


                            </div>
                            <div id="DBRef.collection" class="classattr">
                                <div class="attr variable">
            <span class="name">collection</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#DBRef.collection"></a>
    
            <div class="docstring"><p>Get the name of this DBRef's collection.</p>
</div>


                            </div>
                            <div id="DBRef.id" class="classattr">
                                <div class="attr variable">
            <span class="name">id</span><span class="annotation">: Any</span>

        
    </div>
    <a class="headerlink" href="#DBRef.id"></a>
    
            <div class="docstring"><p>Get this DBRef's _id.</p>
</div>


                            </div>
                            <div id="DBRef.database" class="classattr">
                                <div class="attr variable">
            <span class="name">database</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#DBRef.database"></a>
    
            <div class="docstring"><p>Get the name of this DBRef's database.</p>

<p>Returns None if this DBRef doesn't specify a database.</p>
</div>


                            </div>
                            <div id="DBRef.as_doc" class="classattr">
                                        <input id="DBRef.as_doc-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">as_doc</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#SON">xtquant.xtbson.bson37.SON</a></span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="DBRef.as_doc-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DBRef.as_doc"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DBRef.as_doc-94"><a href="#DBRef.as_doc-94"><span class="linenos"> 94</span></a>    <span class="k">def</span> <span class="nf">as_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SON</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="DBRef.as_doc-95"><a href="#DBRef.as_doc-95"><span class="linenos"> 95</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the SON document representation of this DBRef.</span>
</span><span id="DBRef.as_doc-96"><a href="#DBRef.as_doc-96"><span class="linenos"> 96</span></a>
</span><span id="DBRef.as_doc-97"><a href="#DBRef.as_doc-97"><span class="linenos"> 97</span></a><span class="sd">        Generally not needed by application developers</span>
</span><span id="DBRef.as_doc-98"><a href="#DBRef.as_doc-98"><span class="linenos"> 98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DBRef.as_doc-99"><a href="#DBRef.as_doc-99"><span class="linenos"> 99</span></a>        <span class="n">doc</span> <span class="o">=</span> <span class="n">SON</span><span class="p">([(</span><span class="s2">&quot;$ref&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;$id&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
</span><span id="DBRef.as_doc-100"><a href="#DBRef.as_doc-100"><span class="linenos">100</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DBRef.as_doc-101"><a href="#DBRef.as_doc-101"><span class="linenos">101</span></a>            <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;$db&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span>
</span><span id="DBRef.as_doc-102"><a href="#DBRef.as_doc-102"><span class="linenos">102</span></a>        <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__kwargs</span><span class="p">)</span>
</span><span id="DBRef.as_doc-103"><a href="#DBRef.as_doc-103"><span class="linenos">103</span></a>        <span class="k">return</span> <span class="n">doc</span>
</span></pre></div>


            <div class="docstring"><p>Get the SON document representation of this DBRef.</p>

<p>Generally not needed by application developers</p>
</div>


                            </div>
                </section>
                <section id="Decimal128">
                            <input id="Decimal128-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Decimal128</span>:

                <label class="view-source-button" for="Decimal128-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Decimal128"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Decimal128-119"><a href="#Decimal128-119"><span class="linenos">119</span></a><span class="k">class</span> <span class="nc">Decimal128</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="Decimal128-120"><a href="#Decimal128-120"><span class="linenos">120</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;BSON Decimal128 type::</span>
</span><span id="Decimal128-121"><a href="#Decimal128-121"><span class="linenos">121</span></a>
</span><span id="Decimal128-122"><a href="#Decimal128-122"><span class="linenos">122</span></a><span class="sd">      &gt;&gt;&gt; Decimal128(Decimal(&quot;0.0005&quot;))</span>
</span><span id="Decimal128-123"><a href="#Decimal128-123"><span class="linenos">123</span></a><span class="sd">      Decimal128(&#39;0.0005&#39;)</span>
</span><span id="Decimal128-124"><a href="#Decimal128-124"><span class="linenos">124</span></a><span class="sd">      &gt;&gt;&gt; Decimal128(&quot;0.0005&quot;)</span>
</span><span id="Decimal128-125"><a href="#Decimal128-125"><span class="linenos">125</span></a><span class="sd">      Decimal128(&#39;0.0005&#39;)</span>
</span><span id="Decimal128-126"><a href="#Decimal128-126"><span class="linenos">126</span></a><span class="sd">      &gt;&gt;&gt; Decimal128((3474527112516337664, 5))</span>
</span><span id="Decimal128-127"><a href="#Decimal128-127"><span class="linenos">127</span></a><span class="sd">      Decimal128(&#39;0.0005&#39;)</span>
</span><span id="Decimal128-128"><a href="#Decimal128-128"><span class="linenos">128</span></a>
</span><span id="Decimal128-129"><a href="#Decimal128-129"><span class="linenos">129</span></a><span class="sd">    :Parameters:</span>
</span><span id="Decimal128-130"><a href="#Decimal128-130"><span class="linenos">130</span></a><span class="sd">      - `value`: An instance of :class:`decimal.Decimal`, string, or tuple of</span>
</span><span id="Decimal128-131"><a href="#Decimal128-131"><span class="linenos">131</span></a><span class="sd">        (high bits, low bits) from Binary Integer Decimal (BID) format.</span>
</span><span id="Decimal128-132"><a href="#Decimal128-132"><span class="linenos">132</span></a>
</span><span id="Decimal128-133"><a href="#Decimal128-133"><span class="linenos">133</span></a><span class="sd">    .. note:: :class:`~Decimal128` uses an instance of :class:`decimal.Context`</span>
</span><span id="Decimal128-134"><a href="#Decimal128-134"><span class="linenos">134</span></a><span class="sd">      configured for IEEE-754 Decimal128 when validating parameters.</span>
</span><span id="Decimal128-135"><a href="#Decimal128-135"><span class="linenos">135</span></a><span class="sd">      Signals like :class:`decimal.InvalidOperation`, :class:`decimal.Inexact`,</span>
</span><span id="Decimal128-136"><a href="#Decimal128-136"><span class="linenos">136</span></a><span class="sd">      and :class:`decimal.Overflow` are trapped and raised as exceptions::</span>
</span><span id="Decimal128-137"><a href="#Decimal128-137"><span class="linenos">137</span></a>
</span><span id="Decimal128-138"><a href="#Decimal128-138"><span class="linenos">138</span></a><span class="sd">        &gt;&gt;&gt; Decimal128(&quot;.13.1&quot;)</span>
</span><span id="Decimal128-139"><a href="#Decimal128-139"><span class="linenos">139</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="Decimal128-140"><a href="#Decimal128-140"><span class="linenos">140</span></a><span class="sd">          File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
</span><span id="Decimal128-141"><a href="#Decimal128-141"><span class="linenos">141</span></a><span class="sd">          ...</span>
</span><span id="Decimal128-142"><a href="#Decimal128-142"><span class="linenos">142</span></a><span class="sd">        decimal.InvalidOperation: [&lt;class &#39;decimal.ConversionSyntax&#39;&gt;]</span>
</span><span id="Decimal128-143"><a href="#Decimal128-143"><span class="linenos">143</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Decimal128-144"><a href="#Decimal128-144"><span class="linenos">144</span></a><span class="sd">        &gt;&gt;&gt; Decimal128(&quot;1E-6177&quot;)</span>
</span><span id="Decimal128-145"><a href="#Decimal128-145"><span class="linenos">145</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="Decimal128-146"><a href="#Decimal128-146"><span class="linenos">146</span></a><span class="sd">          File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
</span><span id="Decimal128-147"><a href="#Decimal128-147"><span class="linenos">147</span></a><span class="sd">          ...</span>
</span><span id="Decimal128-148"><a href="#Decimal128-148"><span class="linenos">148</span></a><span class="sd">        decimal.Inexact: [&lt;class &#39;decimal.Inexact&#39;&gt;]</span>
</span><span id="Decimal128-149"><a href="#Decimal128-149"><span class="linenos">149</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Decimal128-150"><a href="#Decimal128-150"><span class="linenos">150</span></a><span class="sd">        &gt;&gt;&gt; Decimal128(&quot;1E6145&quot;)</span>
</span><span id="Decimal128-151"><a href="#Decimal128-151"><span class="linenos">151</span></a><span class="sd">        Traceback (most recent call last):</span>
</span><span id="Decimal128-152"><a href="#Decimal128-152"><span class="linenos">152</span></a><span class="sd">          File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
</span><span id="Decimal128-153"><a href="#Decimal128-153"><span class="linenos">153</span></a><span class="sd">          ...</span>
</span><span id="Decimal128-154"><a href="#Decimal128-154"><span class="linenos">154</span></a><span class="sd">        decimal.Overflow: [&lt;class &#39;decimal.Overflow&#39;&gt;, &lt;class &#39;decimal.Rounded&#39;&gt;]</span>
</span><span id="Decimal128-155"><a href="#Decimal128-155"><span class="linenos">155</span></a>
</span><span id="Decimal128-156"><a href="#Decimal128-156"><span class="linenos">156</span></a><span class="sd">      To ensure the result of a calculation can always be stored as BSON</span>
</span><span id="Decimal128-157"><a href="#Decimal128-157"><span class="linenos">157</span></a><span class="sd">      Decimal128 use the context returned by</span>
</span><span id="Decimal128-158"><a href="#Decimal128-158"><span class="linenos">158</span></a><span class="sd">      :func:`create_decimal128_context`::</span>
</span><span id="Decimal128-159"><a href="#Decimal128-159"><span class="linenos">159</span></a>
</span><span id="Decimal128-160"><a href="#Decimal128-160"><span class="linenos">160</span></a><span class="sd">        &gt;&gt;&gt; import decimal</span>
</span><span id="Decimal128-161"><a href="#Decimal128-161"><span class="linenos">161</span></a><span class="sd">        &gt;&gt;&gt; decimal128_ctx = create_decimal128_context()</span>
</span><span id="Decimal128-162"><a href="#Decimal128-162"><span class="linenos">162</span></a><span class="sd">        &gt;&gt;&gt; with decimal.localcontext(decimal128_ctx) as ctx:</span>
</span><span id="Decimal128-163"><a href="#Decimal128-163"><span class="linenos">163</span></a><span class="sd">        ...     Decimal128(ctx.create_decimal(&quot;.13.3&quot;))</span>
</span><span id="Decimal128-164"><a href="#Decimal128-164"><span class="linenos">164</span></a><span class="sd">        ...</span>
</span><span id="Decimal128-165"><a href="#Decimal128-165"><span class="linenos">165</span></a><span class="sd">        Decimal128(&#39;NaN&#39;)</span>
</span><span id="Decimal128-166"><a href="#Decimal128-166"><span class="linenos">166</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Decimal128-167"><a href="#Decimal128-167"><span class="linenos">167</span></a><span class="sd">        &gt;&gt;&gt; with decimal.localcontext(decimal128_ctx) as ctx:</span>
</span><span id="Decimal128-168"><a href="#Decimal128-168"><span class="linenos">168</span></a><span class="sd">        ...     Decimal128(ctx.create_decimal(&quot;1E-6177&quot;))</span>
</span><span id="Decimal128-169"><a href="#Decimal128-169"><span class="linenos">169</span></a><span class="sd">        ...</span>
</span><span id="Decimal128-170"><a href="#Decimal128-170"><span class="linenos">170</span></a><span class="sd">        Decimal128(&#39;0E-6176&#39;)</span>
</span><span id="Decimal128-171"><a href="#Decimal128-171"><span class="linenos">171</span></a><span class="sd">        &gt;&gt;&gt;</span>
</span><span id="Decimal128-172"><a href="#Decimal128-172"><span class="linenos">172</span></a><span class="sd">        &gt;&gt;&gt; with decimal.localcontext(DECIMAL128_CTX) as ctx:</span>
</span><span id="Decimal128-173"><a href="#Decimal128-173"><span class="linenos">173</span></a><span class="sd">        ...     Decimal128(ctx.create_decimal(&quot;1E6145&quot;))</span>
</span><span id="Decimal128-174"><a href="#Decimal128-174"><span class="linenos">174</span></a><span class="sd">        ...</span>
</span><span id="Decimal128-175"><a href="#Decimal128-175"><span class="linenos">175</span></a><span class="sd">        Decimal128(&#39;Infinity&#39;)</span>
</span><span id="Decimal128-176"><a href="#Decimal128-176"><span class="linenos">176</span></a>
</span><span id="Decimal128-177"><a href="#Decimal128-177"><span class="linenos">177</span></a><span class="sd">      To match the behavior of MongoDB&#39;s Decimal128 implementation</span>
</span><span id="Decimal128-178"><a href="#Decimal128-178"><span class="linenos">178</span></a><span class="sd">      str(Decimal(value)) may not match str(Decimal128(value)) for NaN values::</span>
</span><span id="Decimal128-179"><a href="#Decimal128-179"><span class="linenos">179</span></a>
</span><span id="Decimal128-180"><a href="#Decimal128-180"><span class="linenos">180</span></a><span class="sd">        &gt;&gt;&gt; Decimal128(Decimal(&#39;NaN&#39;))</span>
</span><span id="Decimal128-181"><a href="#Decimal128-181"><span class="linenos">181</span></a><span class="sd">        Decimal128(&#39;NaN&#39;)</span>
</span><span id="Decimal128-182"><a href="#Decimal128-182"><span class="linenos">182</span></a><span class="sd">        &gt;&gt;&gt; Decimal128(Decimal(&#39;-NaN&#39;))</span>
</span><span id="Decimal128-183"><a href="#Decimal128-183"><span class="linenos">183</span></a><span class="sd">        Decimal128(&#39;NaN&#39;)</span>
</span><span id="Decimal128-184"><a href="#Decimal128-184"><span class="linenos">184</span></a><span class="sd">        &gt;&gt;&gt; Decimal128(Decimal(&#39;sNaN&#39;))</span>
</span><span id="Decimal128-185"><a href="#Decimal128-185"><span class="linenos">185</span></a><span class="sd">        Decimal128(&#39;NaN&#39;)</span>
</span><span id="Decimal128-186"><a href="#Decimal128-186"><span class="linenos">186</span></a><span class="sd">        &gt;&gt;&gt; Decimal128(Decimal(&#39;-sNaN&#39;))</span>
</span><span id="Decimal128-187"><a href="#Decimal128-187"><span class="linenos">187</span></a><span class="sd">        Decimal128(&#39;NaN&#39;)</span>
</span><span id="Decimal128-188"><a href="#Decimal128-188"><span class="linenos">188</span></a>
</span><span id="Decimal128-189"><a href="#Decimal128-189"><span class="linenos">189</span></a><span class="sd">      However, :meth:`~Decimal128.to_decimal` will return the exact value::</span>
</span><span id="Decimal128-190"><a href="#Decimal128-190"><span class="linenos">190</span></a>
</span><span id="Decimal128-191"><a href="#Decimal128-191"><span class="linenos">191</span></a><span class="sd">        &gt;&gt;&gt; Decimal128(Decimal(&#39;NaN&#39;)).to_decimal()</span>
</span><span id="Decimal128-192"><a href="#Decimal128-192"><span class="linenos">192</span></a><span class="sd">        Decimal(&#39;NaN&#39;)</span>
</span><span id="Decimal128-193"><a href="#Decimal128-193"><span class="linenos">193</span></a><span class="sd">        &gt;&gt;&gt; Decimal128(Decimal(&#39;-NaN&#39;)).to_decimal()</span>
</span><span id="Decimal128-194"><a href="#Decimal128-194"><span class="linenos">194</span></a><span class="sd">        Decimal(&#39;-NaN&#39;)</span>
</span><span id="Decimal128-195"><a href="#Decimal128-195"><span class="linenos">195</span></a><span class="sd">        &gt;&gt;&gt; Decimal128(Decimal(&#39;sNaN&#39;)).to_decimal()</span>
</span><span id="Decimal128-196"><a href="#Decimal128-196"><span class="linenos">196</span></a><span class="sd">        Decimal(&#39;sNaN&#39;)</span>
</span><span id="Decimal128-197"><a href="#Decimal128-197"><span class="linenos">197</span></a><span class="sd">        &gt;&gt;&gt; Decimal128(Decimal(&#39;-sNaN&#39;)).to_decimal()</span>
</span><span id="Decimal128-198"><a href="#Decimal128-198"><span class="linenos">198</span></a><span class="sd">        Decimal(&#39;-sNaN&#39;)</span>
</span><span id="Decimal128-199"><a href="#Decimal128-199"><span class="linenos">199</span></a>
</span><span id="Decimal128-200"><a href="#Decimal128-200"><span class="linenos">200</span></a><span class="sd">      Two instances of :class:`Decimal128` compare equal if their Binary</span>
</span><span id="Decimal128-201"><a href="#Decimal128-201"><span class="linenos">201</span></a><span class="sd">      Integer Decimal encodings are equal::</span>
</span><span id="Decimal128-202"><a href="#Decimal128-202"><span class="linenos">202</span></a>
</span><span id="Decimal128-203"><a href="#Decimal128-203"><span class="linenos">203</span></a><span class="sd">        &gt;&gt;&gt; Decimal128(&#39;NaN&#39;) == Decimal128(&#39;NaN&#39;)</span>
</span><span id="Decimal128-204"><a href="#Decimal128-204"><span class="linenos">204</span></a><span class="sd">        True</span>
</span><span id="Decimal128-205"><a href="#Decimal128-205"><span class="linenos">205</span></a><span class="sd">        &gt;&gt;&gt; Decimal128(&#39;NaN&#39;).bid == Decimal128(&#39;NaN&#39;).bid</span>
</span><span id="Decimal128-206"><a href="#Decimal128-206"><span class="linenos">206</span></a><span class="sd">        True</span>
</span><span id="Decimal128-207"><a href="#Decimal128-207"><span class="linenos">207</span></a>
</span><span id="Decimal128-208"><a href="#Decimal128-208"><span class="linenos">208</span></a><span class="sd">      This differs from :class:`decimal.Decimal` comparisons for NaN::</span>
</span><span id="Decimal128-209"><a href="#Decimal128-209"><span class="linenos">209</span></a>
</span><span id="Decimal128-210"><a href="#Decimal128-210"><span class="linenos">210</span></a><span class="sd">        &gt;&gt;&gt; Decimal(&#39;NaN&#39;) == Decimal(&#39;NaN&#39;)</span>
</span><span id="Decimal128-211"><a href="#Decimal128-211"><span class="linenos">211</span></a><span class="sd">        False</span>
</span><span id="Decimal128-212"><a href="#Decimal128-212"><span class="linenos">212</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Decimal128-213"><a href="#Decimal128-213"><span class="linenos">213</span></a>
</span><span id="Decimal128-214"><a href="#Decimal128-214"><span class="linenos">214</span></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;__high&quot;</span><span class="p">,</span> <span class="s2">&quot;__low&quot;</span><span class="p">)</span>
</span><span id="Decimal128-215"><a href="#Decimal128-215"><span class="linenos">215</span></a>
</span><span id="Decimal128-216"><a href="#Decimal128-216"><span class="linenos">216</span></a>    <span class="n">_type_marker</span> <span class="o">=</span> <span class="mi">19</span>
</span><span id="Decimal128-217"><a href="#Decimal128-217"><span class="linenos">217</span></a>
</span><span id="Decimal128-218"><a href="#Decimal128-218"><span class="linenos">218</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_VALUE_OPTIONS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Decimal128-219"><a href="#Decimal128-219"><span class="linenos">219</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">)):</span>
</span><span id="Decimal128-220"><a href="#Decimal128-220"><span class="linenos">220</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__high</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__low</span> <span class="o">=</span> <span class="n">_decimal_to_128</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="Decimal128-221"><a href="#Decimal128-221"><span class="linenos">221</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><span id="Decimal128-222"><a href="#Decimal128-222"><span class="linenos">222</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Decimal128-223"><a href="#Decimal128-223"><span class="linenos">223</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Decimal128-224"><a href="#Decimal128-224"><span class="linenos">224</span></a>                    <span class="s2">&quot;Invalid size for creation of Decimal128 &quot;</span>
</span><span id="Decimal128-225"><a href="#Decimal128-225"><span class="linenos">225</span></a>                    <span class="s2">&quot;from list or tuple. Must have exactly 2 &quot;</span>
</span><span id="Decimal128-226"><a href="#Decimal128-226"><span class="linenos">226</span></a>                    <span class="s2">&quot;elements.&quot;</span>
</span><span id="Decimal128-227"><a href="#Decimal128-227"><span class="linenos">227</span></a>                <span class="p">)</span>
</span><span id="Decimal128-228"><a href="#Decimal128-228"><span class="linenos">228</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__high</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__low</span> <span class="o">=</span> <span class="n">value</span>  <span class="c1"># type: ignore</span>
</span><span id="Decimal128-229"><a href="#Decimal128-229"><span class="linenos">229</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Decimal128-230"><a href="#Decimal128-230"><span class="linenos">230</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Cannot convert </span><span class="si">%r</span><span class="s2"> to Decimal128&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,))</span>
</span><span id="Decimal128-231"><a href="#Decimal128-231"><span class="linenos">231</span></a>
</span><span id="Decimal128-232"><a href="#Decimal128-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">to_decimal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">:</span>
</span><span id="Decimal128-233"><a href="#Decimal128-233"><span class="linenos">233</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an instance of :class:`decimal.Decimal` for this</span>
</span><span id="Decimal128-234"><a href="#Decimal128-234"><span class="linenos">234</span></a><span class="sd">        :class:`Decimal128`.</span>
</span><span id="Decimal128-235"><a href="#Decimal128-235"><span class="linenos">235</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Decimal128-236"><a href="#Decimal128-236"><span class="linenos">236</span></a>        <span class="n">high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__high</span>
</span><span id="Decimal128-237"><a href="#Decimal128-237"><span class="linenos">237</span></a>        <span class="n">low</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__low</span>
</span><span id="Decimal128-238"><a href="#Decimal128-238"><span class="linenos">238</span></a>        <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">high</span> <span class="o">&amp;</span> <span class="n">_SIGN</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="Decimal128-239"><a href="#Decimal128-239"><span class="linenos">239</span></a>
</span><span id="Decimal128-240"><a href="#Decimal128-240"><span class="linenos">240</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">high</span> <span class="o">&amp;</span> <span class="n">_SNAN</span><span class="p">)</span> <span class="o">==</span> <span class="n">_SNAN</span><span class="p">:</span>
</span><span id="Decimal128-241"><a href="#Decimal128-241"><span class="linenos">241</span></a>            <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">((</span><span class="n">sign</span><span class="p">,</span> <span class="p">(),</span> <span class="s2">&quot;N&quot;</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="Decimal128-242"><a href="#Decimal128-242"><span class="linenos">242</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">high</span> <span class="o">&amp;</span> <span class="n">_NAN</span><span class="p">)</span> <span class="o">==</span> <span class="n">_NAN</span><span class="p">:</span>
</span><span id="Decimal128-243"><a href="#Decimal128-243"><span class="linenos">243</span></a>            <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">((</span><span class="n">sign</span><span class="p">,</span> <span class="p">(),</span> <span class="s2">&quot;n&quot;</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="Decimal128-244"><a href="#Decimal128-244"><span class="linenos">244</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">high</span> <span class="o">&amp;</span> <span class="n">_INF</span><span class="p">)</span> <span class="o">==</span> <span class="n">_INF</span><span class="p">:</span>
</span><span id="Decimal128-245"><a href="#Decimal128-245"><span class="linenos">245</span></a>            <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">((</span><span class="n">sign</span><span class="p">,</span> <span class="p">(),</span> <span class="s2">&quot;F&quot;</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="Decimal128-246"><a href="#Decimal128-246"><span class="linenos">246</span></a>
</span><span id="Decimal128-247"><a href="#Decimal128-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">high</span> <span class="o">&amp;</span> <span class="n">_EXPONENT_MASK</span><span class="p">)</span> <span class="o">==</span> <span class="n">_EXPONENT_MASK</span><span class="p">:</span>
</span><span id="Decimal128-248"><a href="#Decimal128-248"><span class="linenos">248</span></a>            <span class="n">exponent</span> <span class="o">=</span> <span class="p">((</span><span class="n">high</span> <span class="o">&amp;</span> <span class="mh">0x1FFFE00000000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">47</span><span class="p">)</span> <span class="o">-</span> <span class="n">_EXPONENT_BIAS</span>
</span><span id="Decimal128-249"><a href="#Decimal128-249"><span class="linenos">249</span></a>            <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">((</span><span class="n">sign</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">exponent</span><span class="p">))</span>
</span><span id="Decimal128-250"><a href="#Decimal128-250"><span class="linenos">250</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Decimal128-251"><a href="#Decimal128-251"><span class="linenos">251</span></a>            <span class="n">exponent</span> <span class="o">=</span> <span class="p">((</span><span class="n">high</span> <span class="o">&amp;</span> <span class="mh">0x7FFF800000000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">49</span><span class="p">)</span> <span class="o">-</span> <span class="n">_EXPONENT_BIAS</span>
</span><span id="Decimal128-252"><a href="#Decimal128-252"><span class="linenos">252</span></a>
</span><span id="Decimal128-253"><a href="#Decimal128-253"><span class="linenos">253</span></a>        <span class="n">arr</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</span><span id="Decimal128-254"><a href="#Decimal128-254"><span class="linenos">254</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="mh">0x00000000000000FF</span>
</span><span id="Decimal128-255"><a href="#Decimal128-255"><span class="linenos">255</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Decimal128-256"><a href="#Decimal128-256"><span class="linenos">256</span></a>            <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="p">((</span><span class="mi">14</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="Decimal128-257"><a href="#Decimal128-257"><span class="linenos">257</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span>
</span><span id="Decimal128-258"><a href="#Decimal128-258"><span class="linenos">258</span></a>
</span><span id="Decimal128-259"><a href="#Decimal128-259"><span class="linenos">259</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="mh">0x00000000000000FF</span>
</span><span id="Decimal128-260"><a href="#Decimal128-260"><span class="linenos">260</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Decimal128-261"><a href="#Decimal128-261"><span class="linenos">261</span></a>            <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">high</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="p">((</span><span class="mi">6</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="Decimal128-262"><a href="#Decimal128-262"><span class="linenos">262</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span>
</span><span id="Decimal128-263"><a href="#Decimal128-263"><span class="linenos">263</span></a>
</span><span id="Decimal128-264"><a href="#Decimal128-264"><span class="linenos">264</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="mh">0x0001000000000000</span>
</span><span id="Decimal128-265"><a href="#Decimal128-265"><span class="linenos">265</span></a>        <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">high</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">48</span>
</span><span id="Decimal128-266"><a href="#Decimal128-266"><span class="linenos">266</span></a>
</span><span id="Decimal128-267"><a href="#Decimal128-267"><span class="linenos">267</span></a>        <span class="c1"># cdecimal only accepts a tuple for digits.</span>
</span><span id="Decimal128-268"><a href="#Decimal128-268"><span class="linenos">268</span></a>        <span class="n">digits</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span> <span class="k">for</span> <span class="n">digit</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)))</span>
</span><span id="Decimal128-269"><a href="#Decimal128-269"><span class="linenos">269</span></a>
</span><span id="Decimal128-270"><a href="#Decimal128-270"><span class="linenos">270</span></a>        <span class="k">with</span> <span class="n">decimal</span><span class="o">.</span><span class="n">localcontext</span><span class="p">(</span><span class="n">_DEC128_CTX</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
</span><span id="Decimal128-271"><a href="#Decimal128-271"><span class="linenos">271</span></a>            <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">create_decimal</span><span class="p">((</span><span class="n">sign</span><span class="p">,</span> <span class="n">digits</span><span class="p">,</span> <span class="n">exponent</span><span class="p">))</span>
</span><span id="Decimal128-272"><a href="#Decimal128-272"><span class="linenos">272</span></a>
</span><span id="Decimal128-273"><a href="#Decimal128-273"><span class="linenos">273</span></a>    <span class="nd">@classmethod</span>
</span><span id="Decimal128-274"><a href="#Decimal128-274"><span class="linenos">274</span></a>    <span class="k">def</span> <span class="nf">from_bid</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Decimal128&quot;</span><span class="p">],</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Decimal128&quot;</span><span class="p">:</span>
</span><span id="Decimal128-275"><a href="#Decimal128-275"><span class="linenos">275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an instance of :class:`Decimal128` from Binary Integer</span>
</span><span id="Decimal128-276"><a href="#Decimal128-276"><span class="linenos">276</span></a><span class="sd">        Decimal string.</span>
</span><span id="Decimal128-277"><a href="#Decimal128-277"><span class="linenos">277</span></a>
</span><span id="Decimal128-278"><a href="#Decimal128-278"><span class="linenos">278</span></a><span class="sd">        :Parameters:</span>
</span><span id="Decimal128-279"><a href="#Decimal128-279"><span class="linenos">279</span></a><span class="sd">          - `value`: 16 byte string (128-bit IEEE 754-2008 decimal floating</span>
</span><span id="Decimal128-280"><a href="#Decimal128-280"><span class="linenos">280</span></a><span class="sd">            point in Binary Integer Decimal (BID) format).</span>
</span><span id="Decimal128-281"><a href="#Decimal128-281"><span class="linenos">281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Decimal128-282"><a href="#Decimal128-282"><span class="linenos">282</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="Decimal128-283"><a href="#Decimal128-283"><span class="linenos">283</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;value must be an instance of bytes&quot;</span><span class="p">)</span>
</span><span id="Decimal128-284"><a href="#Decimal128-284"><span class="linenos">284</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">16</span><span class="p">:</span>
</span><span id="Decimal128-285"><a href="#Decimal128-285"><span class="linenos">285</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value must be exactly 16 bytes&quot;</span><span class="p">)</span>
</span><span id="Decimal128-286"><a href="#Decimal128-286"><span class="linenos">286</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">((</span><span class="n">_UNPACK_64</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">8</span><span class="p">:])[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_UNPACK_64</span><span class="p">(</span><span class="n">value</span><span class="p">[:</span><span class="mi">8</span><span class="p">])[</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># type: ignore</span>
</span><span id="Decimal128-287"><a href="#Decimal128-287"><span class="linenos">287</span></a>
</span><span id="Decimal128-288"><a href="#Decimal128-288"><span class="linenos">288</span></a>    <span class="nd">@property</span>
</span><span id="Decimal128-289"><a href="#Decimal128-289"><span class="linenos">289</span></a>    <span class="k">def</span> <span class="nf">bid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="Decimal128-290"><a href="#Decimal128-290"><span class="linenos">290</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;The Binary Integer Decimal (BID) encoding of this instance.&quot;&quot;&quot;</span>
</span><span id="Decimal128-291"><a href="#Decimal128-291"><span class="linenos">291</span></a>        <span class="k">return</span> <span class="n">_PACK_64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__low</span><span class="p">)</span> <span class="o">+</span> <span class="n">_PACK_64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__high</span><span class="p">)</span>
</span><span id="Decimal128-292"><a href="#Decimal128-292"><span class="linenos">292</span></a>
</span><span id="Decimal128-293"><a href="#Decimal128-293"><span class="linenos">293</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="Decimal128-294"><a href="#Decimal128-294"><span class="linenos">294</span></a>        <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">()</span>
</span><span id="Decimal128-295"><a href="#Decimal128-295"><span class="linenos">295</span></a>        <span class="k">if</span> <span class="n">dec</span><span class="o">.</span><span class="n">is_nan</span><span class="p">():</span>
</span><span id="Decimal128-296"><a href="#Decimal128-296"><span class="linenos">296</span></a>            <span class="c1"># Required by the drivers spec to match MongoDB behavior.</span>
</span><span id="Decimal128-297"><a href="#Decimal128-297"><span class="linenos">297</span></a>            <span class="k">return</span> <span class="s2">&quot;NaN&quot;</span>
</span><span id="Decimal128-298"><a href="#Decimal128-298"><span class="linenos">298</span></a>        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
</span><span id="Decimal128-299"><a href="#Decimal128-299"><span class="linenos">299</span></a>
</span><span id="Decimal128-300"><a href="#Decimal128-300"><span class="linenos">300</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Decimal128-301"><a href="#Decimal128-301"><span class="linenos">301</span></a>        <span class="k">return</span> <span class="s2">&quot;Decimal128(&#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),)</span>
</span><span id="Decimal128-302"><a href="#Decimal128-302"><span class="linenos">302</span></a>
</span><span id="Decimal128-303"><a href="#Decimal128-303"><span class="linenos">303</span></a>    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Decimal128-304"><a href="#Decimal128-304"><span class="linenos">304</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__high</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__low</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Decimal128-305"><a href="#Decimal128-305"><span class="linenos">305</span></a>
</span><span id="Decimal128-306"><a href="#Decimal128-306"><span class="linenos">306</span></a>    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
</span><span id="Decimal128-307"><a href="#Decimal128-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__high</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__low</span>
</span><span id="Decimal128-308"><a href="#Decimal128-308"><span class="linenos">308</span></a>
</span><span id="Decimal128-309"><a href="#Decimal128-309"><span class="linenos">309</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Decimal128-310"><a href="#Decimal128-310"><span class="linenos">310</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Decimal128</span><span class="p">):</span>
</span><span id="Decimal128-311"><a href="#Decimal128-311"><span class="linenos">311</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bid</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">bid</span>
</span><span id="Decimal128-312"><a href="#Decimal128-312"><span class="linenos">312</span></a>        <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Decimal128-313"><a href="#Decimal128-313"><span class="linenos">313</span></a>
</span><span id="Decimal128-314"><a href="#Decimal128-314"><span class="linenos">314</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Decimal128-315"><a href="#Decimal128-315"><span class="linenos">315</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>BSON Decimal128 type::</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">&quot;0.0005&quot;</span><span class="p">))</span>
<span class="go">Decimal128(&#39;0.0005&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="s2">&quot;0.0005&quot;</span><span class="p">)</span>
<span class="go">Decimal128(&#39;0.0005&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">((</span><span class="mi">3474527112516337664</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="go">Decimal128(&#39;0.0005&#39;)</span>
</code></pre>
</div>

<p>:Parameters:</p>

<ul>
<li><code>value</code>: An instance of <code>decimal.Decimal</code>, string, or tuple of
(high bits, low bits) from Binary Integer Decimal (BID) format.</li>
</ul>

<div class="pdoc-alert pdoc-alert-note">

<h6 id="decimal128-uses-an-instance-of-decimalcontext"><code>~Decimal128</code> uses an instance of <code>decimal.Context</code></h6>

<p>configured for IEEE-754 Decimal128 when validating parameters.
Signals like <code>decimal.InvalidOperation</code>, <code>decimal.Inexact</code>,
and <code>decimal.Overflow</code> are trapped and raised as exceptions::</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="s2">&quot;.13.1&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">decimal.InvalidOperation</span>: <span class="n">[&lt;class &#39;decimal.ConversionSyntax&#39;&gt;]</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="s2">&quot;1E-6177&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">decimal.Inexact</span>: <span class="n">[&lt;class &#39;decimal.Inexact&#39;&gt;]</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="s2">&quot;1E6145&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="w">  </span><span class="c">...</span>
<span class="gr">decimal.Overflow</span>: <span class="n">[&lt;class &#39;decimal.Overflow&#39;&gt;, &lt;class &#39;decimal.Rounded&#39;&gt;]</span>
</code></pre>
</div>

<p>To ensure the result of a calculation can always be stored as BSON
Decimal128 use the context returned by
<code>create_decimal128_context()</code>::</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">decimal</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">decimal128_ctx</span> <span class="o">=</span> <span class="n">create_decimal128_context</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">decimal</span><span class="o">.</span><span class="n">localcontext</span><span class="p">(</span><span class="n">decimal128_ctx</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">Decimal128</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">create_decimal</span><span class="p">(</span><span class="s2">&quot;.13.3&quot;</span><span class="p">))</span>
<span class="gp">...</span>
<span class="go">Decimal128(&#39;NaN&#39;)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">decimal</span><span class="o">.</span><span class="n">localcontext</span><span class="p">(</span><span class="n">decimal128_ctx</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">Decimal128</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">create_decimal</span><span class="p">(</span><span class="s2">&quot;1E-6177&quot;</span><span class="p">))</span>
<span class="gp">...</span>
<span class="go">Decimal128(&#39;0E-6176&#39;)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">decimal</span><span class="o">.</span><span class="n">localcontext</span><span class="p">(</span><span class="n">DECIMAL128_CTX</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">Decimal128</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">create_decimal</span><span class="p">(</span><span class="s2">&quot;1E6145&quot;</span><span class="p">))</span>
<span class="gp">...</span>
<span class="go">Decimal128(&#39;Infinity&#39;)</span>
</code></pre>
</div>

<p>To match the behavior of MongoDB's Decimal128 implementation
str(Decimal(value)) may not match str(Decimal128(value)) for NaN values::</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">))</span>
<span class="go">Decimal128(&#39;NaN&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;-NaN&#39;</span><span class="p">))</span>
<span class="go">Decimal128(&#39;NaN&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;sNaN&#39;</span><span class="p">))</span>
<span class="go">Decimal128(&#39;NaN&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;-sNaN&#39;</span><span class="p">))</span>
<span class="go">Decimal128(&#39;NaN&#39;)</span>
</code></pre>
</div>

<p>However, <code>~<a href="#Decimal128.to_decimal">Decimal128.to_decimal()</a></code> will return the exact value::</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">()</span>
<span class="go">Decimal(&#39;NaN&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;-NaN&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">()</span>
<span class="go">Decimal(&#39;-NaN&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;sNaN&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">()</span>
<span class="go">Decimal(&#39;sNaN&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;-sNaN&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">to_decimal</span><span class="p">()</span>
<span class="go">Decimal(&#39;-sNaN&#39;)</span>
</code></pre>
</div>

<p>Two instances of <code><a href="#Decimal128">Decimal128</a></code> compare equal if their Binary
Integer Decimal encodings are equal::</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">Decimal128</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal128</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bid</span> <span class="o">==</span> <span class="n">Decimal128</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bid</span>
<span class="go">True</span>
</code></pre>
</div>

<p>This differs from <code>decimal.Decimal</code> comparisons for NaN::</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;NaN&#39;</span><span class="p">)</span>
<span class="go">False</span>
</code></pre>
</div>

</div>
</div>


                            <div id="Decimal128.__init__" class="classattr">
                                        <input id="Decimal128.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Decimal128</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">int</span><span class="p">]]</span></span>)</span>

                <label class="view-source-button" for="Decimal128.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Decimal128.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Decimal128.__init__-218"><a href="#Decimal128.__init__-218"><span class="linenos">218</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_VALUE_OPTIONS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Decimal128.__init__-219"><a href="#Decimal128.__init__-219"><span class="linenos">219</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">)):</span>
</span><span id="Decimal128.__init__-220"><a href="#Decimal128.__init__-220"><span class="linenos">220</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__high</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__low</span> <span class="o">=</span> <span class="n">_decimal_to_128</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="Decimal128.__init__-221"><a href="#Decimal128.__init__-221"><span class="linenos">221</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
</span><span id="Decimal128.__init__-222"><a href="#Decimal128.__init__-222"><span class="linenos">222</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Decimal128.__init__-223"><a href="#Decimal128.__init__-223"><span class="linenos">223</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Decimal128.__init__-224"><a href="#Decimal128.__init__-224"><span class="linenos">224</span></a>                    <span class="s2">&quot;Invalid size for creation of Decimal128 &quot;</span>
</span><span id="Decimal128.__init__-225"><a href="#Decimal128.__init__-225"><span class="linenos">225</span></a>                    <span class="s2">&quot;from list or tuple. Must have exactly 2 &quot;</span>
</span><span id="Decimal128.__init__-226"><a href="#Decimal128.__init__-226"><span class="linenos">226</span></a>                    <span class="s2">&quot;elements.&quot;</span>
</span><span id="Decimal128.__init__-227"><a href="#Decimal128.__init__-227"><span class="linenos">227</span></a>                <span class="p">)</span>
</span><span id="Decimal128.__init__-228"><a href="#Decimal128.__init__-228"><span class="linenos">228</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__high</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__low</span> <span class="o">=</span> <span class="n">value</span>  <span class="c1"># type: ignore</span>
</span><span id="Decimal128.__init__-229"><a href="#Decimal128.__init__-229"><span class="linenos">229</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Decimal128.__init__-230"><a href="#Decimal128.__init__-230"><span class="linenos">230</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Cannot convert </span><span class="si">%r</span><span class="s2"> to Decimal128&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">value</span><span class="p">,))</span>
</span></pre></div>


    

                            </div>
                            <div id="Decimal128.to_decimal" class="classattr">
                                        <input id="Decimal128.to_decimal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_decimal</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span>:</span></span>

                <label class="view-source-button" for="Decimal128.to_decimal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Decimal128.to_decimal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Decimal128.to_decimal-232"><a href="#Decimal128.to_decimal-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">to_decimal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">:</span>
</span><span id="Decimal128.to_decimal-233"><a href="#Decimal128.to_decimal-233"><span class="linenos">233</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns an instance of :class:`decimal.Decimal` for this</span>
</span><span id="Decimal128.to_decimal-234"><a href="#Decimal128.to_decimal-234"><span class="linenos">234</span></a><span class="sd">        :class:`Decimal128`.</span>
</span><span id="Decimal128.to_decimal-235"><a href="#Decimal128.to_decimal-235"><span class="linenos">235</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Decimal128.to_decimal-236"><a href="#Decimal128.to_decimal-236"><span class="linenos">236</span></a>        <span class="n">high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__high</span>
</span><span id="Decimal128.to_decimal-237"><a href="#Decimal128.to_decimal-237"><span class="linenos">237</span></a>        <span class="n">low</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__low</span>
</span><span id="Decimal128.to_decimal-238"><a href="#Decimal128.to_decimal-238"><span class="linenos">238</span></a>        <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">high</span> <span class="o">&amp;</span> <span class="n">_SIGN</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="Decimal128.to_decimal-239"><a href="#Decimal128.to_decimal-239"><span class="linenos">239</span></a>
</span><span id="Decimal128.to_decimal-240"><a href="#Decimal128.to_decimal-240"><span class="linenos">240</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">high</span> <span class="o">&amp;</span> <span class="n">_SNAN</span><span class="p">)</span> <span class="o">==</span> <span class="n">_SNAN</span><span class="p">:</span>
</span><span id="Decimal128.to_decimal-241"><a href="#Decimal128.to_decimal-241"><span class="linenos">241</span></a>            <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">((</span><span class="n">sign</span><span class="p">,</span> <span class="p">(),</span> <span class="s2">&quot;N&quot;</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="Decimal128.to_decimal-242"><a href="#Decimal128.to_decimal-242"><span class="linenos">242</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">high</span> <span class="o">&amp;</span> <span class="n">_NAN</span><span class="p">)</span> <span class="o">==</span> <span class="n">_NAN</span><span class="p">:</span>
</span><span id="Decimal128.to_decimal-243"><a href="#Decimal128.to_decimal-243"><span class="linenos">243</span></a>            <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">((</span><span class="n">sign</span><span class="p">,</span> <span class="p">(),</span> <span class="s2">&quot;n&quot;</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="Decimal128.to_decimal-244"><a href="#Decimal128.to_decimal-244"><span class="linenos">244</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">high</span> <span class="o">&amp;</span> <span class="n">_INF</span><span class="p">)</span> <span class="o">==</span> <span class="n">_INF</span><span class="p">:</span>
</span><span id="Decimal128.to_decimal-245"><a href="#Decimal128.to_decimal-245"><span class="linenos">245</span></a>            <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">((</span><span class="n">sign</span><span class="p">,</span> <span class="p">(),</span> <span class="s2">&quot;F&quot;</span><span class="p">))</span>  <span class="c1"># type: ignore</span>
</span><span id="Decimal128.to_decimal-246"><a href="#Decimal128.to_decimal-246"><span class="linenos">246</span></a>
</span><span id="Decimal128.to_decimal-247"><a href="#Decimal128.to_decimal-247"><span class="linenos">247</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">high</span> <span class="o">&amp;</span> <span class="n">_EXPONENT_MASK</span><span class="p">)</span> <span class="o">==</span> <span class="n">_EXPONENT_MASK</span><span class="p">:</span>
</span><span id="Decimal128.to_decimal-248"><a href="#Decimal128.to_decimal-248"><span class="linenos">248</span></a>            <span class="n">exponent</span> <span class="o">=</span> <span class="p">((</span><span class="n">high</span> <span class="o">&amp;</span> <span class="mh">0x1FFFE00000000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">47</span><span class="p">)</span> <span class="o">-</span> <span class="n">_EXPONENT_BIAS</span>
</span><span id="Decimal128.to_decimal-249"><a href="#Decimal128.to_decimal-249"><span class="linenos">249</span></a>            <span class="k">return</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">((</span><span class="n">sign</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,),</span> <span class="n">exponent</span><span class="p">))</span>
</span><span id="Decimal128.to_decimal-250"><a href="#Decimal128.to_decimal-250"><span class="linenos">250</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Decimal128.to_decimal-251"><a href="#Decimal128.to_decimal-251"><span class="linenos">251</span></a>            <span class="n">exponent</span> <span class="o">=</span> <span class="p">((</span><span class="n">high</span> <span class="o">&amp;</span> <span class="mh">0x7FFF800000000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">49</span><span class="p">)</span> <span class="o">-</span> <span class="n">_EXPONENT_BIAS</span>
</span><span id="Decimal128.to_decimal-252"><a href="#Decimal128.to_decimal-252"><span class="linenos">252</span></a>
</span><span id="Decimal128.to_decimal-253"><a href="#Decimal128.to_decimal-253"><span class="linenos">253</span></a>        <span class="n">arr</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</span><span id="Decimal128.to_decimal-254"><a href="#Decimal128.to_decimal-254"><span class="linenos">254</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="mh">0x00000000000000FF</span>
</span><span id="Decimal128.to_decimal-255"><a href="#Decimal128.to_decimal-255"><span class="linenos">255</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Decimal128.to_decimal-256"><a href="#Decimal128.to_decimal-256"><span class="linenos">256</span></a>            <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">low</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="p">((</span><span class="mi">14</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="Decimal128.to_decimal-257"><a href="#Decimal128.to_decimal-257"><span class="linenos">257</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span>
</span><span id="Decimal128.to_decimal-258"><a href="#Decimal128.to_decimal-258"><span class="linenos">258</span></a>
</span><span id="Decimal128.to_decimal-259"><a href="#Decimal128.to_decimal-259"><span class="linenos">259</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="mh">0x00000000000000FF</span>
</span><span id="Decimal128.to_decimal-260"><a href="#Decimal128.to_decimal-260"><span class="linenos">260</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Decimal128.to_decimal-261"><a href="#Decimal128.to_decimal-261"><span class="linenos">261</span></a>            <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">high</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="p">((</span><span class="mi">6</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span>
</span><span id="Decimal128.to_decimal-262"><a href="#Decimal128.to_decimal-262"><span class="linenos">262</span></a>            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span>
</span><span id="Decimal128.to_decimal-263"><a href="#Decimal128.to_decimal-263"><span class="linenos">263</span></a>
</span><span id="Decimal128.to_decimal-264"><a href="#Decimal128.to_decimal-264"><span class="linenos">264</span></a>        <span class="n">mask</span> <span class="o">=</span> <span class="mh">0x0001000000000000</span>
</span><span id="Decimal128.to_decimal-265"><a href="#Decimal128.to_decimal-265"><span class="linenos">265</span></a>        <span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">high</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">48</span>
</span><span id="Decimal128.to_decimal-266"><a href="#Decimal128.to_decimal-266"><span class="linenos">266</span></a>
</span><span id="Decimal128.to_decimal-267"><a href="#Decimal128.to_decimal-267"><span class="linenos">267</span></a>        <span class="c1"># cdecimal only accepts a tuple for digits.</span>
</span><span id="Decimal128.to_decimal-268"><a href="#Decimal128.to_decimal-268"><span class="linenos">268</span></a>        <span class="n">digits</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">digit</span><span class="p">)</span> <span class="k">for</span> <span class="n">digit</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="s2">&quot;big&quot;</span><span class="p">)))</span>
</span><span id="Decimal128.to_decimal-269"><a href="#Decimal128.to_decimal-269"><span class="linenos">269</span></a>
</span><span id="Decimal128.to_decimal-270"><a href="#Decimal128.to_decimal-270"><span class="linenos">270</span></a>        <span class="k">with</span> <span class="n">decimal</span><span class="o">.</span><span class="n">localcontext</span><span class="p">(</span><span class="n">_DEC128_CTX</span><span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
</span><span id="Decimal128.to_decimal-271"><a href="#Decimal128.to_decimal-271"><span class="linenos">271</span></a>            <span class="k">return</span> <span class="n">ctx</span><span class="o">.</span><span class="n">create_decimal</span><span class="p">((</span><span class="n">sign</span><span class="p">,</span> <span class="n">digits</span><span class="p">,</span> <span class="n">exponent</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Returns an instance of <code>decimal.Decimal</code> for this
<code><a href="#Decimal128">Decimal128</a></code>.</p>
</div>


                            </div>
                            <div id="Decimal128.from_bid" class="classattr">
                                        <input id="Decimal128.from_bid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_bid</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n"><a href="#Decimal128">xtquant.xtbson.bson37.Decimal128</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">value</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="n"><a href="#Decimal128">xtquant.xtbson.bson37.Decimal128</a></span>:</span></span>

                <label class="view-source-button" for="Decimal128.from_bid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Decimal128.from_bid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Decimal128.from_bid-273"><a href="#Decimal128.from_bid-273"><span class="linenos">273</span></a>    <span class="nd">@classmethod</span>
</span><span id="Decimal128.from_bid-274"><a href="#Decimal128.from_bid-274"><span class="linenos">274</span></a>    <span class="k">def</span> <span class="nf">from_bid</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Decimal128&quot;</span><span class="p">],</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Decimal128&quot;</span><span class="p">:</span>
</span><span id="Decimal128.from_bid-275"><a href="#Decimal128.from_bid-275"><span class="linenos">275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an instance of :class:`Decimal128` from Binary Integer</span>
</span><span id="Decimal128.from_bid-276"><a href="#Decimal128.from_bid-276"><span class="linenos">276</span></a><span class="sd">        Decimal string.</span>
</span><span id="Decimal128.from_bid-277"><a href="#Decimal128.from_bid-277"><span class="linenos">277</span></a>
</span><span id="Decimal128.from_bid-278"><a href="#Decimal128.from_bid-278"><span class="linenos">278</span></a><span class="sd">        :Parameters:</span>
</span><span id="Decimal128.from_bid-279"><a href="#Decimal128.from_bid-279"><span class="linenos">279</span></a><span class="sd">          - `value`: 16 byte string (128-bit IEEE 754-2008 decimal floating</span>
</span><span id="Decimal128.from_bid-280"><a href="#Decimal128.from_bid-280"><span class="linenos">280</span></a><span class="sd">            point in Binary Integer Decimal (BID) format).</span>
</span><span id="Decimal128.from_bid-281"><a href="#Decimal128.from_bid-281"><span class="linenos">281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Decimal128.from_bid-282"><a href="#Decimal128.from_bid-282"><span class="linenos">282</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="Decimal128.from_bid-283"><a href="#Decimal128.from_bid-283"><span class="linenos">283</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;value must be an instance of bytes&quot;</span><span class="p">)</span>
</span><span id="Decimal128.from_bid-284"><a href="#Decimal128.from_bid-284"><span class="linenos">284</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">16</span><span class="p">:</span>
</span><span id="Decimal128.from_bid-285"><a href="#Decimal128.from_bid-285"><span class="linenos">285</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;value must be exactly 16 bytes&quot;</span><span class="p">)</span>
</span><span id="Decimal128.from_bid-286"><a href="#Decimal128.from_bid-286"><span class="linenos">286</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">((</span><span class="n">_UNPACK_64</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">8</span><span class="p">:])[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_UNPACK_64</span><span class="p">(</span><span class="n">value</span><span class="p">[:</span><span class="mi">8</span><span class="p">])[</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>Create an instance of <code><a href="#Decimal128">Decimal128</a></code> from Binary Integer
Decimal string.</p>

<p>:Parameters:</p>

<ul>
<li><code>value</code>: 16 byte string (128-bit IEEE 754-2008 decimal floating
point in Binary Integer Decimal (BID) format).</li>
</ul>
</div>


                            </div>
                            <div id="Decimal128.bid" class="classattr">
                                <div class="attr variable">
            <span class="name">bid</span><span class="annotation">: bytes</span>

        
    </div>
    <a class="headerlink" href="#Decimal128.bid"></a>
    
            <div class="docstring"><p>The Binary Integer Decimal (BID) encoding of this instance.</p>
</div>


                            </div>
                </section>
                <section id="InvalidBSON">
                            <input id="InvalidBSON-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">InvalidBSON</span><wbr>(<span class="base">xtquant.xtbson.bson37.errors.BSONError</span>):

                <label class="view-source-button" for="InvalidBSON-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InvalidBSON"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InvalidBSON-23"><a href="#InvalidBSON-23"><span class="linenos">23</span></a><span class="k">class</span> <span class="nc">InvalidBSON</span><span class="p">(</span><span class="n">BSONError</span><span class="p">):</span>
</span><span id="InvalidBSON-24"><a href="#InvalidBSON-24"><span class="linenos">24</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when trying to create a BSON object from invalid data.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Raised when trying to create a BSON object from invalid data.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.Exception</dt>
                                <dd id="InvalidBSON.__init__" class="function">Exception</dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="InvalidBSON.with_traceback" class="function">with_traceback</dd>
                <dd id="InvalidBSON.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="InvalidDocument">
                            <input id="InvalidDocument-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">InvalidDocument</span><wbr>(<span class="base">xtquant.xtbson.bson37.errors.BSONError</span>):

                <label class="view-source-button" for="InvalidDocument-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InvalidDocument"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InvalidDocument-31"><a href="#InvalidDocument-31"><span class="linenos">31</span></a><span class="k">class</span> <span class="nc">InvalidDocument</span><span class="p">(</span><span class="n">BSONError</span><span class="p">):</span>
</span><span id="InvalidDocument-32"><a href="#InvalidDocument-32"><span class="linenos">32</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when trying to create a BSON object from an invalid document.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Raised when trying to create a BSON object from an invalid document.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.Exception</dt>
                                <dd id="InvalidDocument.__init__" class="function">Exception</dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="InvalidDocument.with_traceback" class="function">with_traceback</dd>
                <dd id="InvalidDocument.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="InvalidStringData">
                            <input id="InvalidStringData-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">InvalidStringData</span><wbr>(<span class="base">xtquant.xtbson.bson37.errors.BSONError</span>):

                <label class="view-source-button" for="InvalidStringData-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#InvalidStringData"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="InvalidStringData-27"><a href="#InvalidStringData-27"><span class="linenos">27</span></a><span class="k">class</span> <span class="nc">InvalidStringData</span><span class="p">(</span><span class="n">BSONError</span><span class="p">):</span>
</span><span id="InvalidStringData-28"><a href="#InvalidStringData-28"><span class="linenos">28</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when trying to encode a string containing non-UTF8 data.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Raised when trying to encode a string containing non-UTF8 data.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.Exception</dt>
                                <dd id="InvalidStringData.__init__" class="function">Exception</dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="InvalidStringData.with_traceback" class="function">with_traceback</dd>
                <dd id="InvalidStringData.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Int64">
                            <input id="Int64-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Int64</span><wbr>(<span class="base">builtins.int</span>):

                <label class="view-source-button" for="Int64-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Int64"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Int64-21"><a href="#Int64-21"><span class="linenos">21</span></a><span class="k">class</span> <span class="nc">Int64</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
</span><span id="Int64-22"><a href="#Int64-22"><span class="linenos">22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Representation of the BSON int64 type.</span>
</span><span id="Int64-23"><a href="#Int64-23"><span class="linenos">23</span></a>
</span><span id="Int64-24"><a href="#Int64-24"><span class="linenos">24</span></a><span class="sd">    This is necessary because every integral number is an :class:`int` in</span>
</span><span id="Int64-25"><a href="#Int64-25"><span class="linenos">25</span></a><span class="sd">    Python 3. Small integral numbers are encoded to BSON int32 by default,</span>
</span><span id="Int64-26"><a href="#Int64-26"><span class="linenos">26</span></a><span class="sd">    but Int64 numbers will always be encoded to BSON int64.</span>
</span><span id="Int64-27"><a href="#Int64-27"><span class="linenos">27</span></a>
</span><span id="Int64-28"><a href="#Int64-28"><span class="linenos">28</span></a><span class="sd">    :Parameters:</span>
</span><span id="Int64-29"><a href="#Int64-29"><span class="linenos">29</span></a><span class="sd">      - `value`: the numeric value to represent</span>
</span><span id="Int64-30"><a href="#Int64-30"><span class="linenos">30</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Int64-31"><a href="#Int64-31"><span class="linenos">31</span></a>
</span><span id="Int64-32"><a href="#Int64-32"><span class="linenos">32</span></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="Int64-33"><a href="#Int64-33"><span class="linenos">33</span></a>
</span><span id="Int64-34"><a href="#Int64-34"><span class="linenos">34</span></a>    <span class="n">_type_marker</span> <span class="o">=</span> <span class="mi">18</span>
</span><span id="Int64-35"><a href="#Int64-35"><span class="linenos">35</span></a>
</span><span id="Int64-36"><a href="#Int64-36"><span class="linenos">36</span></a>    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="Int64-37"><a href="#Int64-37"><span class="linenos">37</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="Int64-38"><a href="#Int64-38"><span class="linenos">38</span></a>
</span><span id="Int64-39"><a href="#Int64-39"><span class="linenos">39</span></a>    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Int64-40"><a href="#Int64-40"><span class="linenos">40</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Representation of the BSON int64 type.</p>

<p>This is necessary because every integral number is an <code>int</code> in
Python 3. Small integral numbers are encoded to BSON int32 by default,
but Int64 numbers will always be encoded to BSON int64.</p>

<p>:Parameters:</p>

<ul>
<li><code>value</code>: the numeric value to represent</li>
</ul>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.int</dt>
                                <dd id="Int64.conjugate" class="function">conjugate</dd>
                <dd id="Int64.bit_length" class="function">bit_length</dd>
                <dd id="Int64.bit_count" class="function">bit_count</dd>
                <dd id="Int64.to_bytes" class="function">to_bytes</dd>
                <dd id="Int64.from_bytes" class="function">from_bytes</dd>
                <dd id="Int64.as_integer_ratio" class="function">as_integer_ratio</dd>
                <dd id="Int64.real" class="variable">real</dd>
                <dd id="Int64.imag" class="variable">imag</dd>
                <dd id="Int64.numerator" class="variable">numerator</dd>
                <dd id="Int64.denominator" class="variable">denominator</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MaxKey">
                            <input id="MaxKey-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MaxKey</span>:

                <label class="view-source-button" for="MaxKey-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MaxKey"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MaxKey-21"><a href="#MaxKey-21"><span class="linenos">21</span></a><span class="k">class</span> <span class="nc">MaxKey</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="MaxKey-22"><a href="#MaxKey-22"><span class="linenos">22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;MongoDB internal MaxKey type.&quot;&quot;&quot;</span>
</span><span id="MaxKey-23"><a href="#MaxKey-23"><span class="linenos">23</span></a>
</span><span id="MaxKey-24"><a href="#MaxKey-24"><span class="linenos">24</span></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="MaxKey-25"><a href="#MaxKey-25"><span class="linenos">25</span></a>
</span><span id="MaxKey-26"><a href="#MaxKey-26"><span class="linenos">26</span></a>    <span class="n">_type_marker</span> <span class="o">=</span> <span class="mi">127</span>
</span><span id="MaxKey-27"><a href="#MaxKey-27"><span class="linenos">27</span></a>
</span><span id="MaxKey-28"><a href="#MaxKey-28"><span class="linenos">28</span></a>    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="MaxKey-29"><a href="#MaxKey-29"><span class="linenos">29</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="MaxKey-30"><a href="#MaxKey-30"><span class="linenos">30</span></a>
</span><span id="MaxKey-31"><a href="#MaxKey-31"><span class="linenos">31</span></a>    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MaxKey-32"><a href="#MaxKey-32"><span class="linenos">32</span></a>        <span class="k">pass</span>
</span><span id="MaxKey-33"><a href="#MaxKey-33"><span class="linenos">33</span></a>
</span><span id="MaxKey-34"><a href="#MaxKey-34"><span class="linenos">34</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MaxKey-35"><a href="#MaxKey-35"><span class="linenos">35</span></a>        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MaxKey</span><span class="p">)</span>
</span><span id="MaxKey-36"><a href="#MaxKey-36"><span class="linenos">36</span></a>
</span><span id="MaxKey-37"><a href="#MaxKey-37"><span class="linenos">37</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MaxKey-38"><a href="#MaxKey-38"><span class="linenos">38</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_type_marker</span><span class="p">)</span>
</span><span id="MaxKey-39"><a href="#MaxKey-39"><span class="linenos">39</span></a>
</span><span id="MaxKey-40"><a href="#MaxKey-40"><span class="linenos">40</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MaxKey-41"><a href="#MaxKey-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="MaxKey-42"><a href="#MaxKey-42"><span class="linenos">42</span></a>
</span><span id="MaxKey-43"><a href="#MaxKey-43"><span class="linenos">43</span></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MaxKey-44"><a href="#MaxKey-44"><span class="linenos">44</span></a>        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MaxKey</span><span class="p">)</span>
</span><span id="MaxKey-45"><a href="#MaxKey-45"><span class="linenos">45</span></a>
</span><span id="MaxKey-46"><a href="#MaxKey-46"><span class="linenos">46</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dummy</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MaxKey-47"><a href="#MaxKey-47"><span class="linenos">47</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="MaxKey-48"><a href="#MaxKey-48"><span class="linenos">48</span></a>
</span><span id="MaxKey-49"><a href="#MaxKey-49"><span class="linenos">49</span></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dummy</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MaxKey-50"><a href="#MaxKey-50"><span class="linenos">50</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="MaxKey-51"><a href="#MaxKey-51"><span class="linenos">51</span></a>
</span><span id="MaxKey-52"><a href="#MaxKey-52"><span class="linenos">52</span></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MaxKey-53"><a href="#MaxKey-53"><span class="linenos">53</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MaxKey</span><span class="p">)</span>
</span><span id="MaxKey-54"><a href="#MaxKey-54"><span class="linenos">54</span></a>
</span><span id="MaxKey-55"><a href="#MaxKey-55"><span class="linenos">55</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MaxKey-56"><a href="#MaxKey-56"><span class="linenos">56</span></a>        <span class="k">return</span> <span class="s2">&quot;MaxKey()&quot;</span>
</span></pre></div>


            <div class="docstring"><p>MongoDB internal MaxKey type.</p>
</div>


                </section>
                <section id="MinKey">
                            <input id="MinKey-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MinKey</span>:

                <label class="view-source-button" for="MinKey-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MinKey"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MinKey-21"><a href="#MinKey-21"><span class="linenos">21</span></a><span class="k">class</span> <span class="nc">MinKey</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="MinKey-22"><a href="#MinKey-22"><span class="linenos">22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;MongoDB internal MinKey type.&quot;&quot;&quot;</span>
</span><span id="MinKey-23"><a href="#MinKey-23"><span class="linenos">23</span></a>
</span><span id="MinKey-24"><a href="#MinKey-24"><span class="linenos">24</span></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">()</span>
</span><span id="MinKey-25"><a href="#MinKey-25"><span class="linenos">25</span></a>
</span><span id="MinKey-26"><a href="#MinKey-26"><span class="linenos">26</span></a>    <span class="n">_type_marker</span> <span class="o">=</span> <span class="mi">255</span>
</span><span id="MinKey-27"><a href="#MinKey-27"><span class="linenos">27</span></a>
</span><span id="MinKey-28"><a href="#MinKey-28"><span class="linenos">28</span></a>    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="MinKey-29"><a href="#MinKey-29"><span class="linenos">29</span></a>        <span class="k">return</span> <span class="p">{}</span>
</span><span id="MinKey-30"><a href="#MinKey-30"><span class="linenos">30</span></a>
</span><span id="MinKey-31"><a href="#MinKey-31"><span class="linenos">31</span></a>    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MinKey-32"><a href="#MinKey-32"><span class="linenos">32</span></a>        <span class="k">pass</span>
</span><span id="MinKey-33"><a href="#MinKey-33"><span class="linenos">33</span></a>
</span><span id="MinKey-34"><a href="#MinKey-34"><span class="linenos">34</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MinKey-35"><a href="#MinKey-35"><span class="linenos">35</span></a>        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MinKey</span><span class="p">)</span>
</span><span id="MinKey-36"><a href="#MinKey-36"><span class="linenos">36</span></a>
</span><span id="MinKey-37"><a href="#MinKey-37"><span class="linenos">37</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="MinKey-38"><a href="#MinKey-38"><span class="linenos">38</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_type_marker</span><span class="p">)</span>
</span><span id="MinKey-39"><a href="#MinKey-39"><span class="linenos">39</span></a>
</span><span id="MinKey-40"><a href="#MinKey-40"><span class="linenos">40</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MinKey-41"><a href="#MinKey-41"><span class="linenos">41</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="MinKey-42"><a href="#MinKey-42"><span class="linenos">42</span></a>
</span><span id="MinKey-43"><a href="#MinKey-43"><span class="linenos">43</span></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dummy</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MinKey-44"><a href="#MinKey-44"><span class="linenos">44</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="MinKey-45"><a href="#MinKey-45"><span class="linenos">45</span></a>
</span><span id="MinKey-46"><a href="#MinKey-46"><span class="linenos">46</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MinKey-47"><a href="#MinKey-47"><span class="linenos">47</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MinKey</span><span class="p">)</span>
</span><span id="MinKey-48"><a href="#MinKey-48"><span class="linenos">48</span></a>
</span><span id="MinKey-49"><a href="#MinKey-49"><span class="linenos">49</span></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MinKey-50"><a href="#MinKey-50"><span class="linenos">50</span></a>        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">MinKey</span><span class="p">)</span>
</span><span id="MinKey-51"><a href="#MinKey-51"><span class="linenos">51</span></a>
</span><span id="MinKey-52"><a href="#MinKey-52"><span class="linenos">52</span></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dummy</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="MinKey-53"><a href="#MinKey-53"><span class="linenos">53</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="MinKey-54"><a href="#MinKey-54"><span class="linenos">54</span></a>
</span><span id="MinKey-55"><a href="#MinKey-55"><span class="linenos">55</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MinKey-56"><a href="#MinKey-56"><span class="linenos">56</span></a>        <span class="k">return</span> <span class="s2">&quot;MinKey()&quot;</span>
</span></pre></div>


            <div class="docstring"><p>MongoDB internal MinKey type.</p>
</div>


                </section>
                <section id="ObjectId">
                            <input id="ObjectId-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ObjectId</span>:

                <label class="view-source-button" for="ObjectId-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ObjectId"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ObjectId-47"><a href="#ObjectId-47"><span class="linenos"> 47</span></a><span class="k">class</span> <span class="nc">ObjectId</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="ObjectId-48"><a href="#ObjectId-48"><span class="linenos"> 48</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;A MongoDB ObjectId.&quot;&quot;&quot;</span>
</span><span id="ObjectId-49"><a href="#ObjectId-49"><span class="linenos"> 49</span></a>
</span><span id="ObjectId-50"><a href="#ObjectId-50"><span class="linenos"> 50</span></a>    <span class="n">_pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
</span><span id="ObjectId-51"><a href="#ObjectId-51"><span class="linenos"> 51</span></a>
</span><span id="ObjectId-52"><a href="#ObjectId-52"><span class="linenos"> 52</span></a>    <span class="n">_inc</span> <span class="o">=</span> <span class="n">SystemRandom</span><span class="p">()</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">_MAX_COUNTER_VALUE</span><span class="p">)</span>
</span><span id="ObjectId-53"><a href="#ObjectId-53"><span class="linenos"> 53</span></a>    <span class="n">_inc_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="ObjectId-54"><a href="#ObjectId-54"><span class="linenos"> 54</span></a>
</span><span id="ObjectId-55"><a href="#ObjectId-55"><span class="linenos"> 55</span></a>    <span class="n">__random</span> <span class="o">=</span> <span class="n">_random_bytes</span><span class="p">()</span>
</span><span id="ObjectId-56"><a href="#ObjectId-56"><span class="linenos"> 56</span></a>
</span><span id="ObjectId-57"><a href="#ObjectId-57"><span class="linenos"> 57</span></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;__id&quot;</span><span class="p">,)</span>
</span><span id="ObjectId-58"><a href="#ObjectId-58"><span class="linenos"> 58</span></a>
</span><span id="ObjectId-59"><a href="#ObjectId-59"><span class="linenos"> 59</span></a>    <span class="n">_type_marker</span> <span class="o">=</span> <span class="mi">7</span>
</span><span id="ObjectId-60"><a href="#ObjectId-60"><span class="linenos"> 60</span></a>
</span><span id="ObjectId-61"><a href="#ObjectId-61"><span class="linenos"> 61</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;ObjectId&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ObjectId-62"><a href="#ObjectId-62"><span class="linenos"> 62</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a new ObjectId.</span>
</span><span id="ObjectId-63"><a href="#ObjectId-63"><span class="linenos"> 63</span></a>
</span><span id="ObjectId-64"><a href="#ObjectId-64"><span class="linenos"> 64</span></a><span class="sd">        An ObjectId is a 12-byte unique identifier consisting of:</span>
</span><span id="ObjectId-65"><a href="#ObjectId-65"><span class="linenos"> 65</span></a>
</span><span id="ObjectId-66"><a href="#ObjectId-66"><span class="linenos"> 66</span></a><span class="sd">          - a 4-byte value representing the seconds since the Unix epoch,</span>
</span><span id="ObjectId-67"><a href="#ObjectId-67"><span class="linenos"> 67</span></a><span class="sd">          - a 5-byte random value,</span>
</span><span id="ObjectId-68"><a href="#ObjectId-68"><span class="linenos"> 68</span></a><span class="sd">          - a 3-byte counter, starting with a random value.</span>
</span><span id="ObjectId-69"><a href="#ObjectId-69"><span class="linenos"> 69</span></a>
</span><span id="ObjectId-70"><a href="#ObjectId-70"><span class="linenos"> 70</span></a><span class="sd">        By default, ``ObjectId()`` creates a new unique identifier. The</span>
</span><span id="ObjectId-71"><a href="#ObjectId-71"><span class="linenos"> 71</span></a><span class="sd">        optional parameter `oid` can be an :class:`ObjectId`, or any 12</span>
</span><span id="ObjectId-72"><a href="#ObjectId-72"><span class="linenos"> 72</span></a><span class="sd">        :class:`bytes`.</span>
</span><span id="ObjectId-73"><a href="#ObjectId-73"><span class="linenos"> 73</span></a>
</span><span id="ObjectId-74"><a href="#ObjectId-74"><span class="linenos"> 74</span></a><span class="sd">        For example, the 12 bytes b&#39;foo-bar-quux&#39; do not follow the ObjectId</span>
</span><span id="ObjectId-75"><a href="#ObjectId-75"><span class="linenos"> 75</span></a><span class="sd">        specification but they are acceptable input::</span>
</span><span id="ObjectId-76"><a href="#ObjectId-76"><span class="linenos"> 76</span></a>
</span><span id="ObjectId-77"><a href="#ObjectId-77"><span class="linenos"> 77</span></a><span class="sd">          &gt;&gt;&gt; ObjectId(b&#39;foo-bar-quux&#39;)</span>
</span><span id="ObjectId-78"><a href="#ObjectId-78"><span class="linenos"> 78</span></a><span class="sd">          ObjectId(&#39;666f6f2d6261722d71757578&#39;)</span>
</span><span id="ObjectId-79"><a href="#ObjectId-79"><span class="linenos"> 79</span></a>
</span><span id="ObjectId-80"><a href="#ObjectId-80"><span class="linenos"> 80</span></a><span class="sd">        `oid` can also be a :class:`str` of 24 hex digits::</span>
</span><span id="ObjectId-81"><a href="#ObjectId-81"><span class="linenos"> 81</span></a>
</span><span id="ObjectId-82"><a href="#ObjectId-82"><span class="linenos"> 82</span></a><span class="sd">          &gt;&gt;&gt; ObjectId(&#39;0123456789ab0123456789ab&#39;)</span>
</span><span id="ObjectId-83"><a href="#ObjectId-83"><span class="linenos"> 83</span></a><span class="sd">          ObjectId(&#39;0123456789ab0123456789ab&#39;)</span>
</span><span id="ObjectId-84"><a href="#ObjectId-84"><span class="linenos"> 84</span></a>
</span><span id="ObjectId-85"><a href="#ObjectId-85"><span class="linenos"> 85</span></a><span class="sd">        Raises :class:`~bson.errors.InvalidId` if `oid` is not 12 bytes nor</span>
</span><span id="ObjectId-86"><a href="#ObjectId-86"><span class="linenos"> 86</span></a><span class="sd">        24 hex digits, or :class:`TypeError` if `oid` is not an accepted type.</span>
</span><span id="ObjectId-87"><a href="#ObjectId-87"><span class="linenos"> 87</span></a>
</span><span id="ObjectId-88"><a href="#ObjectId-88"><span class="linenos"> 88</span></a><span class="sd">        :Parameters:</span>
</span><span id="ObjectId-89"><a href="#ObjectId-89"><span class="linenos"> 89</span></a><span class="sd">          - `oid` (optional): a valid ObjectId.</span>
</span><span id="ObjectId-90"><a href="#ObjectId-90"><span class="linenos"> 90</span></a>
</span><span id="ObjectId-91"><a href="#ObjectId-91"><span class="linenos"> 91</span></a><span class="sd">        .. seealso:: The MongoDB documentation on  `ObjectIds &lt;http://dochub.mongodb.org/core/objectids&gt;`_.</span>
</span><span id="ObjectId-92"><a href="#ObjectId-92"><span class="linenos"> 92</span></a>
</span><span id="ObjectId-93"><a href="#ObjectId-93"><span class="linenos"> 93</span></a><span class="sd">        .. versionchanged:: 3.8</span>
</span><span id="ObjectId-94"><a href="#ObjectId-94"><span class="linenos"> 94</span></a><span class="sd">           :class:`~bson.objectid.ObjectId` now implements the `ObjectID</span>
</span><span id="ObjectId-95"><a href="#ObjectId-95"><span class="linenos"> 95</span></a><span class="sd">           specification version 0.2</span>
</span><span id="ObjectId-96"><a href="#ObjectId-96"><span class="linenos"> 96</span></a><span class="sd">           &lt;https://github.com/mongodb/specifications/blob/master/source/</span>
</span><span id="ObjectId-97"><a href="#ObjectId-97"><span class="linenos"> 97</span></a><span class="sd">           objectid.rst&gt;`_.</span>
</span><span id="ObjectId-98"><a href="#ObjectId-98"><span class="linenos"> 98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ObjectId-99"><a href="#ObjectId-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="n">oid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ObjectId-100"><a href="#ObjectId-100"><span class="linenos">100</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__generate</span><span class="p">()</span>
</span><span id="ObjectId-101"><a href="#ObjectId-101"><span class="linenos">101</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oid</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
</span><span id="ObjectId-102"><a href="#ObjectId-102"><span class="linenos">102</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">=</span> <span class="n">oid</span>
</span><span id="ObjectId-103"><a href="#ObjectId-103"><span class="linenos">103</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ObjectId-104"><a href="#ObjectId-104"><span class="linenos">104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__validate</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>
</span><span id="ObjectId-105"><a href="#ObjectId-105"><span class="linenos">105</span></a>
</span><span id="ObjectId-106"><a href="#ObjectId-106"><span class="linenos">106</span></a>    <span class="nd">@classmethod</span>
</span><span id="ObjectId-107"><a href="#ObjectId-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">from_datetime</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;ObjectId&quot;</span><span class="p">],</span> <span class="n">generation_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ObjectId&quot;</span><span class="p">:</span>
</span><span id="ObjectId-108"><a href="#ObjectId-108"><span class="linenos">108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a dummy ObjectId instance with a specific generation time.</span>
</span><span id="ObjectId-109"><a href="#ObjectId-109"><span class="linenos">109</span></a>
</span><span id="ObjectId-110"><a href="#ObjectId-110"><span class="linenos">110</span></a><span class="sd">        This method is useful for doing range queries on a field</span>
</span><span id="ObjectId-111"><a href="#ObjectId-111"><span class="linenos">111</span></a><span class="sd">        containing :class:`ObjectId` instances.</span>
</span><span id="ObjectId-112"><a href="#ObjectId-112"><span class="linenos">112</span></a>
</span><span id="ObjectId-113"><a href="#ObjectId-113"><span class="linenos">113</span></a><span class="sd">        .. warning::</span>
</span><span id="ObjectId-114"><a href="#ObjectId-114"><span class="linenos">114</span></a><span class="sd">           It is not safe to insert a document containing an ObjectId</span>
</span><span id="ObjectId-115"><a href="#ObjectId-115"><span class="linenos">115</span></a><span class="sd">           generated using this method. This method deliberately</span>
</span><span id="ObjectId-116"><a href="#ObjectId-116"><span class="linenos">116</span></a><span class="sd">           eliminates the uniqueness guarantee that ObjectIds</span>
</span><span id="ObjectId-117"><a href="#ObjectId-117"><span class="linenos">117</span></a><span class="sd">           generally provide. ObjectIds generated with this method</span>
</span><span id="ObjectId-118"><a href="#ObjectId-118"><span class="linenos">118</span></a><span class="sd">           should be used exclusively in queries.</span>
</span><span id="ObjectId-119"><a href="#ObjectId-119"><span class="linenos">119</span></a>
</span><span id="ObjectId-120"><a href="#ObjectId-120"><span class="linenos">120</span></a><span class="sd">        `generation_time` will be converted to UTC. Naive datetime</span>
</span><span id="ObjectId-121"><a href="#ObjectId-121"><span class="linenos">121</span></a><span class="sd">        instances will be treated as though they already contain UTC.</span>
</span><span id="ObjectId-122"><a href="#ObjectId-122"><span class="linenos">122</span></a>
</span><span id="ObjectId-123"><a href="#ObjectId-123"><span class="linenos">123</span></a><span class="sd">        An example using this helper to get documents where ``&quot;_id&quot;``</span>
</span><span id="ObjectId-124"><a href="#ObjectId-124"><span class="linenos">124</span></a><span class="sd">        was generated before January 1, 2010 would be:</span>
</span><span id="ObjectId-125"><a href="#ObjectId-125"><span class="linenos">125</span></a>
</span><span id="ObjectId-126"><a href="#ObjectId-126"><span class="linenos">126</span></a><span class="sd">        &gt;&gt;&gt; gen_time = datetime.datetime(2010, 1, 1)</span>
</span><span id="ObjectId-127"><a href="#ObjectId-127"><span class="linenos">127</span></a><span class="sd">        &gt;&gt;&gt; dummy_id = ObjectId.from_datetime(gen_time)</span>
</span><span id="ObjectId-128"><a href="#ObjectId-128"><span class="linenos">128</span></a><span class="sd">        &gt;&gt;&gt; result = collection.find({&quot;_id&quot;: {&quot;$lt&quot;: dummy_id}})</span>
</span><span id="ObjectId-129"><a href="#ObjectId-129"><span class="linenos">129</span></a>
</span><span id="ObjectId-130"><a href="#ObjectId-130"><span class="linenos">130</span></a><span class="sd">        :Parameters:</span>
</span><span id="ObjectId-131"><a href="#ObjectId-131"><span class="linenos">131</span></a><span class="sd">          - `generation_time`: :class:`~datetime.datetime` to be used</span>
</span><span id="ObjectId-132"><a href="#ObjectId-132"><span class="linenos">132</span></a><span class="sd">            as the generation time for the resulting ObjectId.</span>
</span><span id="ObjectId-133"><a href="#ObjectId-133"><span class="linenos">133</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ObjectId-134"><a href="#ObjectId-134"><span class="linenos">134</span></a>        <span class="n">offset</span> <span class="o">=</span> <span class="n">generation_time</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">()</span>
</span><span id="ObjectId-135"><a href="#ObjectId-135"><span class="linenos">135</span></a>        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ObjectId-136"><a href="#ObjectId-136"><span class="linenos">136</span></a>            <span class="n">generation_time</span> <span class="o">=</span> <span class="n">generation_time</span> <span class="o">-</span> <span class="n">offset</span>
</span><span id="ObjectId-137"><a href="#ObjectId-137"><span class="linenos">137</span></a>        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">generation_time</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
</span><span id="ObjectId-138"><a href="#ObjectId-138"><span class="linenos">138</span></a>        <span class="n">oid</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;I&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">timestamp</span><span class="p">))</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
</span><span id="ObjectId-139"><a href="#ObjectId-139"><span class="linenos">139</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>
</span><span id="ObjectId-140"><a href="#ObjectId-140"><span class="linenos">140</span></a>
</span><span id="ObjectId-141"><a href="#ObjectId-141"><span class="linenos">141</span></a>    <span class="nd">@classmethod</span>
</span><span id="ObjectId-142"><a href="#ObjectId-142"><span class="linenos">142</span></a>    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;ObjectId&quot;</span><span class="p">],</span> <span class="n">oid</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ObjectId-143"><a href="#ObjectId-143"><span class="linenos">143</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if a `oid` string is valid or not.</span>
</span><span id="ObjectId-144"><a href="#ObjectId-144"><span class="linenos">144</span></a>
</span><span id="ObjectId-145"><a href="#ObjectId-145"><span class="linenos">145</span></a><span class="sd">        :Parameters:</span>
</span><span id="ObjectId-146"><a href="#ObjectId-146"><span class="linenos">146</span></a><span class="sd">          - `oid`: the object id to validate</span>
</span><span id="ObjectId-147"><a href="#ObjectId-147"><span class="linenos">147</span></a>
</span><span id="ObjectId-148"><a href="#ObjectId-148"><span class="linenos">148</span></a><span class="sd">        .. versionadded:: 2.3</span>
</span><span id="ObjectId-149"><a href="#ObjectId-149"><span class="linenos">149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ObjectId-150"><a href="#ObjectId-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">oid</span><span class="p">:</span>
</span><span id="ObjectId-151"><a href="#ObjectId-151"><span class="linenos">151</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ObjectId-152"><a href="#ObjectId-152"><span class="linenos">152</span></a>
</span><span id="ObjectId-153"><a href="#ObjectId-153"><span class="linenos">153</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ObjectId-154"><a href="#ObjectId-154"><span class="linenos">154</span></a>            <span class="n">ObjectId</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>
</span><span id="ObjectId-155"><a href="#ObjectId-155"><span class="linenos">155</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ObjectId-156"><a href="#ObjectId-156"><span class="linenos">156</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">InvalidId</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
</span><span id="ObjectId-157"><a href="#ObjectId-157"><span class="linenos">157</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ObjectId-158"><a href="#ObjectId-158"><span class="linenos">158</span></a>
</span><span id="ObjectId-159"><a href="#ObjectId-159"><span class="linenos">159</span></a>    <span class="nd">@classmethod</span>
</span><span id="ObjectId-160"><a href="#ObjectId-160"><span class="linenos">160</span></a>    <span class="k">def</span> <span class="nf">_random</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ObjectId-161"><a href="#ObjectId-161"><span class="linenos">161</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a 5-byte random number once per process.&quot;&quot;&quot;</span>
</span><span id="ObjectId-162"><a href="#ObjectId-162"><span class="linenos">162</span></a>        <span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">()</span>
</span><span id="ObjectId-163"><a href="#ObjectId-163"><span class="linenos">163</span></a>        <span class="k">if</span> <span class="n">pid</span> <span class="o">!=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_pid</span><span class="p">:</span>
</span><span id="ObjectId-164"><a href="#ObjectId-164"><span class="linenos">164</span></a>            <span class="bp">cls</span><span class="o">.</span><span class="n">_pid</span> <span class="o">=</span> <span class="n">pid</span>
</span><span id="ObjectId-165"><a href="#ObjectId-165"><span class="linenos">165</span></a>            <span class="bp">cls</span><span class="o">.</span><span class="n">__random</span> <span class="o">=</span> <span class="n">_random_bytes</span><span class="p">()</span>
</span><span id="ObjectId-166"><a href="#ObjectId-166"><span class="linenos">166</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__random</span>
</span><span id="ObjectId-167"><a href="#ObjectId-167"><span class="linenos">167</span></a>
</span><span id="ObjectId-168"><a href="#ObjectId-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="nf">__generate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ObjectId-169"><a href="#ObjectId-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a new value for this ObjectId.&quot;&quot;&quot;</span>
</span><span id="ObjectId-170"><a href="#ObjectId-170"><span class="linenos">170</span></a>
</span><span id="ObjectId-171"><a href="#ObjectId-171"><span class="linenos">171</span></a>        <span class="c1"># 4 bytes current time</span>
</span><span id="ObjectId-172"><a href="#ObjectId-172"><span class="linenos">172</span></a>        <span class="n">oid</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;I&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>
</span><span id="ObjectId-173"><a href="#ObjectId-173"><span class="linenos">173</span></a>
</span><span id="ObjectId-174"><a href="#ObjectId-174"><span class="linenos">174</span></a>        <span class="c1"># 5 bytes random</span>
</span><span id="ObjectId-175"><a href="#ObjectId-175"><span class="linenos">175</span></a>        <span class="n">oid</span> <span class="o">+=</span> <span class="n">ObjectId</span><span class="o">.</span><span class="n">_random</span><span class="p">()</span>
</span><span id="ObjectId-176"><a href="#ObjectId-176"><span class="linenos">176</span></a>
</span><span id="ObjectId-177"><a href="#ObjectId-177"><span class="linenos">177</span></a>        <span class="c1"># 3 bytes inc</span>
</span><span id="ObjectId-178"><a href="#ObjectId-178"><span class="linenos">178</span></a>        <span class="k">with</span> <span class="n">ObjectId</span><span class="o">.</span><span class="n">_inc_lock</span><span class="p">:</span>
</span><span id="ObjectId-179"><a href="#ObjectId-179"><span class="linenos">179</span></a>            <span class="n">oid</span> <span class="o">+=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;I&quot;</span><span class="p">,</span> <span class="n">ObjectId</span><span class="o">.</span><span class="n">_inc</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
</span><span id="ObjectId-180"><a href="#ObjectId-180"><span class="linenos">180</span></a>            <span class="n">ObjectId</span><span class="o">.</span><span class="n">_inc</span> <span class="o">=</span> <span class="p">(</span><span class="n">ObjectId</span><span class="o">.</span><span class="n">_inc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">_MAX_COUNTER_VALUE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="ObjectId-181"><a href="#ObjectId-181"><span class="linenos">181</span></a>
</span><span id="ObjectId-182"><a href="#ObjectId-182"><span class="linenos">182</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">=</span> <span class="n">oid</span>
</span><span id="ObjectId-183"><a href="#ObjectId-183"><span class="linenos">183</span></a>
</span><span id="ObjectId-184"><a href="#ObjectId-184"><span class="linenos">184</span></a>    <span class="k">def</span> <span class="nf">__validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oid</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ObjectId-185"><a href="#ObjectId-185"><span class="linenos">185</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate and use the given id for this ObjectId.</span>
</span><span id="ObjectId-186"><a href="#ObjectId-186"><span class="linenos">186</span></a>
</span><span id="ObjectId-187"><a href="#ObjectId-187"><span class="linenos">187</span></a><span class="sd">        Raises TypeError if id is not an instance of</span>
</span><span id="ObjectId-188"><a href="#ObjectId-188"><span class="linenos">188</span></a><span class="sd">        (:class:`basestring` (:class:`str` or :class:`bytes`</span>
</span><span id="ObjectId-189"><a href="#ObjectId-189"><span class="linenos">189</span></a><span class="sd">        in python 3), ObjectId) and InvalidId if it is not a</span>
</span><span id="ObjectId-190"><a href="#ObjectId-190"><span class="linenos">190</span></a><span class="sd">        valid ObjectId.</span>
</span><span id="ObjectId-191"><a href="#ObjectId-191"><span class="linenos">191</span></a>
</span><span id="ObjectId-192"><a href="#ObjectId-192"><span class="linenos">192</span></a><span class="sd">        :Parameters:</span>
</span><span id="ObjectId-193"><a href="#ObjectId-193"><span class="linenos">193</span></a><span class="sd">          - `oid`: a valid ObjectId</span>
</span><span id="ObjectId-194"><a href="#ObjectId-194"><span class="linenos">194</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ObjectId-195"><a href="#ObjectId-195"><span class="linenos">195</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oid</span><span class="p">,</span> <span class="n">ObjectId</span><span class="p">):</span>
</span><span id="ObjectId-196"><a href="#ObjectId-196"><span class="linenos">196</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">=</span> <span class="n">oid</span><span class="o">.</span><span class="n">binary</span>
</span><span id="ObjectId-197"><a href="#ObjectId-197"><span class="linenos">197</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oid</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ObjectId-198"><a href="#ObjectId-198"><span class="linenos">198</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span> <span class="o">==</span> <span class="mi">24</span><span class="p">:</span>
</span><span id="ObjectId-199"><a href="#ObjectId-199"><span class="linenos">199</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="ObjectId-200"><a href="#ObjectId-200"><span class="linenos">200</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>
</span><span id="ObjectId-201"><a href="#ObjectId-201"><span class="linenos">201</span></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
</span><span id="ObjectId-202"><a href="#ObjectId-202"><span class="linenos">202</span></a>                    <span class="n">_raise_invalid_id</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>
</span><span id="ObjectId-203"><a href="#ObjectId-203"><span class="linenos">203</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ObjectId-204"><a href="#ObjectId-204"><span class="linenos">204</span></a>                <span class="n">_raise_invalid_id</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>
</span><span id="ObjectId-205"><a href="#ObjectId-205"><span class="linenos">205</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ObjectId-206"><a href="#ObjectId-206"><span class="linenos">206</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="ObjectId-207"><a href="#ObjectId-207"><span class="linenos">207</span></a>                <span class="s2">&quot;id must be an instance of (bytes, str, ObjectId), not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">oid</span><span class="p">),)</span>
</span><span id="ObjectId-208"><a href="#ObjectId-208"><span class="linenos">208</span></a>            <span class="p">)</span>
</span><span id="ObjectId-209"><a href="#ObjectId-209"><span class="linenos">209</span></a>
</span><span id="ObjectId-210"><a href="#ObjectId-210"><span class="linenos">210</span></a>    <span class="nd">@property</span>
</span><span id="ObjectId-211"><a href="#ObjectId-211"><span class="linenos">211</span></a>    <span class="k">def</span> <span class="nf">binary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ObjectId-212"><a href="#ObjectId-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;12-byte binary representation of this ObjectId.&quot;&quot;&quot;</span>
</span><span id="ObjectId-213"><a href="#ObjectId-213"><span class="linenos">213</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span>
</span><span id="ObjectId-214"><a href="#ObjectId-214"><span class="linenos">214</span></a>
</span><span id="ObjectId-215"><a href="#ObjectId-215"><span class="linenos">215</span></a>    <span class="nd">@property</span>
</span><span id="ObjectId-216"><a href="#ObjectId-216"><span class="linenos">216</span></a>    <span class="k">def</span> <span class="nf">generation_time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
</span><span id="ObjectId-217"><a href="#ObjectId-217"><span class="linenos">217</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;A :class:`datetime.datetime` instance representing the time of</span>
</span><span id="ObjectId-218"><a href="#ObjectId-218"><span class="linenos">218</span></a><span class="sd">        generation for this :class:`ObjectId`.</span>
</span><span id="ObjectId-219"><a href="#ObjectId-219"><span class="linenos">219</span></a>
</span><span id="ObjectId-220"><a href="#ObjectId-220"><span class="linenos">220</span></a><span class="sd">        The :class:`datetime.datetime` is timezone aware, and</span>
</span><span id="ObjectId-221"><a href="#ObjectId-221"><span class="linenos">221</span></a><span class="sd">        represents the generation time in UTC. It is precise to the</span>
</span><span id="ObjectId-222"><a href="#ObjectId-222"><span class="linenos">222</span></a><span class="sd">        second.</span>
</span><span id="ObjectId-223"><a href="#ObjectId-223"><span class="linenos">223</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ObjectId-224"><a href="#ObjectId-224"><span class="linenos">224</span></a>        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s2">&quot;&gt;I&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ObjectId-225"><a href="#ObjectId-225"><span class="linenos">225</span></a>        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">timestamp</span><span class="p">,</span> <span class="n">utc</span><span class="p">)</span>
</span><span id="ObjectId-226"><a href="#ObjectId-226"><span class="linenos">226</span></a>
</span><span id="ObjectId-227"><a href="#ObjectId-227"><span class="linenos">227</span></a>    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="ObjectId-228"><a href="#ObjectId-228"><span class="linenos">228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;return value of object for pickling.</span>
</span><span id="ObjectId-229"><a href="#ObjectId-229"><span class="linenos">229</span></a><span class="sd">        needed explicitly because __slots__() defined.</span>
</span><span id="ObjectId-230"><a href="#ObjectId-230"><span class="linenos">230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ObjectId-231"><a href="#ObjectId-231"><span class="linenos">231</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span>
</span><span id="ObjectId-232"><a href="#ObjectId-232"><span class="linenos">232</span></a>
</span><span id="ObjectId-233"><a href="#ObjectId-233"><span class="linenos">233</span></a>    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ObjectId-234"><a href="#ObjectId-234"><span class="linenos">234</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;explicit state set from pickling&quot;&quot;&quot;</span>
</span><span id="ObjectId-235"><a href="#ObjectId-235"><span class="linenos">235</span></a>        <span class="c1"># Provide backwards compatability with OIDs</span>
</span><span id="ObjectId-236"><a href="#ObjectId-236"><span class="linenos">236</span></a>        <span class="c1"># pickled with pymongo-1.9 or older.</span>
</span><span id="ObjectId-237"><a href="#ObjectId-237"><span class="linenos">237</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="ObjectId-238"><a href="#ObjectId-238"><span class="linenos">238</span></a>            <span class="n">oid</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="s2">&quot;_ObjectId__id&quot;</span><span class="p">]</span>
</span><span id="ObjectId-239"><a href="#ObjectId-239"><span class="linenos">239</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ObjectId-240"><a href="#ObjectId-240"><span class="linenos">240</span></a>            <span class="n">oid</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="ObjectId-241"><a href="#ObjectId-241"><span class="linenos">241</span></a>        <span class="c1"># ObjectIds pickled in python 2.x used `str` for __id.</span>
</span><span id="ObjectId-242"><a href="#ObjectId-242"><span class="linenos">242</span></a>        <span class="c1"># In python 3.x this has to be converted to `bytes`</span>
</span><span id="ObjectId-243"><a href="#ObjectId-243"><span class="linenos">243</span></a>        <span class="c1"># by encoding latin-1.</span>
</span><span id="ObjectId-244"><a href="#ObjectId-244"><span class="linenos">244</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oid</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ObjectId-245"><a href="#ObjectId-245"><span class="linenos">245</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">=</span> <span class="n">oid</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;latin-1&quot;</span><span class="p">)</span>
</span><span id="ObjectId-246"><a href="#ObjectId-246"><span class="linenos">246</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ObjectId-247"><a href="#ObjectId-247"><span class="linenos">247</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">=</span> <span class="n">oid</span>
</span><span id="ObjectId-248"><a href="#ObjectId-248"><span class="linenos">248</span></a>
</span><span id="ObjectId-249"><a href="#ObjectId-249"><span class="linenos">249</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ObjectId-250"><a href="#ObjectId-250"><span class="linenos">250</span></a>        <span class="k">return</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__id</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span><span id="ObjectId-251"><a href="#ObjectId-251"><span class="linenos">251</span></a>
</span><span id="ObjectId-252"><a href="#ObjectId-252"><span class="linenos">252</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="ObjectId-253"><a href="#ObjectId-253"><span class="linenos">253</span></a>        <span class="k">return</span> <span class="s2">&quot;ObjectId(&#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),)</span>
</span><span id="ObjectId-254"><a href="#ObjectId-254"><span class="linenos">254</span></a>
</span><span id="ObjectId-255"><a href="#ObjectId-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ObjectId-256"><a href="#ObjectId-256"><span class="linenos">256</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ObjectId</span><span class="p">):</span>
</span><span id="ObjectId-257"><a href="#ObjectId-257"><span class="linenos">257</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">binary</span>
</span><span id="ObjectId-258"><a href="#ObjectId-258"><span class="linenos">258</span></a>        <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="ObjectId-259"><a href="#ObjectId-259"><span class="linenos">259</span></a>
</span><span id="ObjectId-260"><a href="#ObjectId-260"><span class="linenos">260</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ObjectId-261"><a href="#ObjectId-261"><span class="linenos">261</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ObjectId</span><span class="p">):</span>
</span><span id="ObjectId-262"><a href="#ObjectId-262"><span class="linenos">262</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">binary</span>
</span><span id="ObjectId-263"><a href="#ObjectId-263"><span class="linenos">263</span></a>        <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="ObjectId-264"><a href="#ObjectId-264"><span class="linenos">264</span></a>
</span><span id="ObjectId-265"><a href="#ObjectId-265"><span class="linenos">265</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ObjectId-266"><a href="#ObjectId-266"><span class="linenos">266</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ObjectId</span><span class="p">):</span>
</span><span id="ObjectId-267"><a href="#ObjectId-267"><span class="linenos">267</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">binary</span>
</span><span id="ObjectId-268"><a href="#ObjectId-268"><span class="linenos">268</span></a>        <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="ObjectId-269"><a href="#ObjectId-269"><span class="linenos">269</span></a>
</span><span id="ObjectId-270"><a href="#ObjectId-270"><span class="linenos">270</span></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ObjectId-271"><a href="#ObjectId-271"><span class="linenos">271</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ObjectId</span><span class="p">):</span>
</span><span id="ObjectId-272"><a href="#ObjectId-272"><span class="linenos">272</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">binary</span>
</span><span id="ObjectId-273"><a href="#ObjectId-273"><span class="linenos">273</span></a>        <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="ObjectId-274"><a href="#ObjectId-274"><span class="linenos">274</span></a>
</span><span id="ObjectId-275"><a href="#ObjectId-275"><span class="linenos">275</span></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ObjectId-276"><a href="#ObjectId-276"><span class="linenos">276</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ObjectId</span><span class="p">):</span>
</span><span id="ObjectId-277"><a href="#ObjectId-277"><span class="linenos">277</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">binary</span>
</span><span id="ObjectId-278"><a href="#ObjectId-278"><span class="linenos">278</span></a>        <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="ObjectId-279"><a href="#ObjectId-279"><span class="linenos">279</span></a>
</span><span id="ObjectId-280"><a href="#ObjectId-280"><span class="linenos">280</span></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ObjectId-281"><a href="#ObjectId-281"><span class="linenos">281</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ObjectId</span><span class="p">):</span>
</span><span id="ObjectId-282"><a href="#ObjectId-282"><span class="linenos">282</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">binary</span>
</span><span id="ObjectId-283"><a href="#ObjectId-283"><span class="linenos">283</span></a>        <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="ObjectId-284"><a href="#ObjectId-284"><span class="linenos">284</span></a>
</span><span id="ObjectId-285"><a href="#ObjectId-285"><span class="linenos">285</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="ObjectId-286"><a href="#ObjectId-286"><span class="linenos">286</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a hash value for this :class:`ObjectId`.&quot;&quot;&quot;</span>
</span><span id="ObjectId-287"><a href="#ObjectId-287"><span class="linenos">287</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__id</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A MongoDB ObjectId.</p>
</div>


                            <div id="ObjectId.__init__" class="classattr">
                                        <input id="ObjectId.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ObjectId</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">oid</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#ObjectId">xtquant.xtbson.bson37.ObjectId</a></span><span class="p">,</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="ObjectId.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ObjectId.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ObjectId.__init__-61"><a href="#ObjectId.__init__-61"><span class="linenos"> 61</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oid</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;ObjectId&quot;</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ObjectId.__init__-62"><a href="#ObjectId.__init__-62"><span class="linenos"> 62</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a new ObjectId.</span>
</span><span id="ObjectId.__init__-63"><a href="#ObjectId.__init__-63"><span class="linenos"> 63</span></a>
</span><span id="ObjectId.__init__-64"><a href="#ObjectId.__init__-64"><span class="linenos"> 64</span></a><span class="sd">        An ObjectId is a 12-byte unique identifier consisting of:</span>
</span><span id="ObjectId.__init__-65"><a href="#ObjectId.__init__-65"><span class="linenos"> 65</span></a>
</span><span id="ObjectId.__init__-66"><a href="#ObjectId.__init__-66"><span class="linenos"> 66</span></a><span class="sd">          - a 4-byte value representing the seconds since the Unix epoch,</span>
</span><span id="ObjectId.__init__-67"><a href="#ObjectId.__init__-67"><span class="linenos"> 67</span></a><span class="sd">          - a 5-byte random value,</span>
</span><span id="ObjectId.__init__-68"><a href="#ObjectId.__init__-68"><span class="linenos"> 68</span></a><span class="sd">          - a 3-byte counter, starting with a random value.</span>
</span><span id="ObjectId.__init__-69"><a href="#ObjectId.__init__-69"><span class="linenos"> 69</span></a>
</span><span id="ObjectId.__init__-70"><a href="#ObjectId.__init__-70"><span class="linenos"> 70</span></a><span class="sd">        By default, ``ObjectId()`` creates a new unique identifier. The</span>
</span><span id="ObjectId.__init__-71"><a href="#ObjectId.__init__-71"><span class="linenos"> 71</span></a><span class="sd">        optional parameter `oid` can be an :class:`ObjectId`, or any 12</span>
</span><span id="ObjectId.__init__-72"><a href="#ObjectId.__init__-72"><span class="linenos"> 72</span></a><span class="sd">        :class:`bytes`.</span>
</span><span id="ObjectId.__init__-73"><a href="#ObjectId.__init__-73"><span class="linenos"> 73</span></a>
</span><span id="ObjectId.__init__-74"><a href="#ObjectId.__init__-74"><span class="linenos"> 74</span></a><span class="sd">        For example, the 12 bytes b&#39;foo-bar-quux&#39; do not follow the ObjectId</span>
</span><span id="ObjectId.__init__-75"><a href="#ObjectId.__init__-75"><span class="linenos"> 75</span></a><span class="sd">        specification but they are acceptable input::</span>
</span><span id="ObjectId.__init__-76"><a href="#ObjectId.__init__-76"><span class="linenos"> 76</span></a>
</span><span id="ObjectId.__init__-77"><a href="#ObjectId.__init__-77"><span class="linenos"> 77</span></a><span class="sd">          &gt;&gt;&gt; ObjectId(b&#39;foo-bar-quux&#39;)</span>
</span><span id="ObjectId.__init__-78"><a href="#ObjectId.__init__-78"><span class="linenos"> 78</span></a><span class="sd">          ObjectId(&#39;666f6f2d6261722d71757578&#39;)</span>
</span><span id="ObjectId.__init__-79"><a href="#ObjectId.__init__-79"><span class="linenos"> 79</span></a>
</span><span id="ObjectId.__init__-80"><a href="#ObjectId.__init__-80"><span class="linenos"> 80</span></a><span class="sd">        `oid` can also be a :class:`str` of 24 hex digits::</span>
</span><span id="ObjectId.__init__-81"><a href="#ObjectId.__init__-81"><span class="linenos"> 81</span></a>
</span><span id="ObjectId.__init__-82"><a href="#ObjectId.__init__-82"><span class="linenos"> 82</span></a><span class="sd">          &gt;&gt;&gt; ObjectId(&#39;0123456789ab0123456789ab&#39;)</span>
</span><span id="ObjectId.__init__-83"><a href="#ObjectId.__init__-83"><span class="linenos"> 83</span></a><span class="sd">          ObjectId(&#39;0123456789ab0123456789ab&#39;)</span>
</span><span id="ObjectId.__init__-84"><a href="#ObjectId.__init__-84"><span class="linenos"> 84</span></a>
</span><span id="ObjectId.__init__-85"><a href="#ObjectId.__init__-85"><span class="linenos"> 85</span></a><span class="sd">        Raises :class:`~bson.errors.InvalidId` if `oid` is not 12 bytes nor</span>
</span><span id="ObjectId.__init__-86"><a href="#ObjectId.__init__-86"><span class="linenos"> 86</span></a><span class="sd">        24 hex digits, or :class:`TypeError` if `oid` is not an accepted type.</span>
</span><span id="ObjectId.__init__-87"><a href="#ObjectId.__init__-87"><span class="linenos"> 87</span></a>
</span><span id="ObjectId.__init__-88"><a href="#ObjectId.__init__-88"><span class="linenos"> 88</span></a><span class="sd">        :Parameters:</span>
</span><span id="ObjectId.__init__-89"><a href="#ObjectId.__init__-89"><span class="linenos"> 89</span></a><span class="sd">          - `oid` (optional): a valid ObjectId.</span>
</span><span id="ObjectId.__init__-90"><a href="#ObjectId.__init__-90"><span class="linenos"> 90</span></a>
</span><span id="ObjectId.__init__-91"><a href="#ObjectId.__init__-91"><span class="linenos"> 91</span></a><span class="sd">        .. seealso:: The MongoDB documentation on  `ObjectIds &lt;http://dochub.mongodb.org/core/objectids&gt;`_.</span>
</span><span id="ObjectId.__init__-92"><a href="#ObjectId.__init__-92"><span class="linenos"> 92</span></a>
</span><span id="ObjectId.__init__-93"><a href="#ObjectId.__init__-93"><span class="linenos"> 93</span></a><span class="sd">        .. versionchanged:: 3.8</span>
</span><span id="ObjectId.__init__-94"><a href="#ObjectId.__init__-94"><span class="linenos"> 94</span></a><span class="sd">           :class:`~bson.objectid.ObjectId` now implements the `ObjectID</span>
</span><span id="ObjectId.__init__-95"><a href="#ObjectId.__init__-95"><span class="linenos"> 95</span></a><span class="sd">           specification version 0.2</span>
</span><span id="ObjectId.__init__-96"><a href="#ObjectId.__init__-96"><span class="linenos"> 96</span></a><span class="sd">           &lt;https://github.com/mongodb/specifications/blob/master/source/</span>
</span><span id="ObjectId.__init__-97"><a href="#ObjectId.__init__-97"><span class="linenos"> 97</span></a><span class="sd">           objectid.rst&gt;`_.</span>
</span><span id="ObjectId.__init__-98"><a href="#ObjectId.__init__-98"><span class="linenos"> 98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ObjectId.__init__-99"><a href="#ObjectId.__init__-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="n">oid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ObjectId.__init__-100"><a href="#ObjectId.__init__-100"><span class="linenos">100</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__generate</span><span class="p">()</span>
</span><span id="ObjectId.__init__-101"><a href="#ObjectId.__init__-101"><span class="linenos">101</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">oid</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
</span><span id="ObjectId.__init__-102"><a href="#ObjectId.__init__-102"><span class="linenos">102</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__id</span> <span class="o">=</span> <span class="n">oid</span>
</span><span id="ObjectId.__init__-103"><a href="#ObjectId.__init__-103"><span class="linenos">103</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ObjectId.__init__-104"><a href="#ObjectId.__init__-104"><span class="linenos">104</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__validate</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a new ObjectId.</p>

<p>An ObjectId is a 12-byte unique identifier consisting of:</p>

<ul>
<li>a 4-byte value representing the seconds since the Unix epoch,</li>
<li>a 5-byte random value,</li>
<li>a 3-byte counter, starting with a random value.</li>
</ul>

<p>By default, <code><a href="#ObjectId">ObjectId()</a></code> creates a new unique identifier. The
optional parameter <code>oid</code> can be an <code><a href="#ObjectId">ObjectId</a></code>, or any 12
<code>bytes</code>.</p>

<p>For example, the 12 bytes b'foo-bar-quux' do not follow the ObjectId
specification but they are acceptable input::</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">ObjectId</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;foo-bar-quux&#39;</span><span class="p">)</span>
<span class="go">ObjectId(&#39;666f6f2d6261722d71757578&#39;)</span>
</code></pre>
</div>

<p><code>oid</code> can also be a <code>str</code> of 24 hex digits::</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">ObjectId</span><span class="p">(</span><span class="s1">&#39;0123456789ab0123456789ab&#39;</span><span class="p">)</span>
<span class="go">ObjectId(&#39;0123456789ab0123456789ab&#39;)</span>
</code></pre>
</div>

<p>Raises <code>~bson.errors.InvalidId</code> if <code>oid</code> is not 12 bytes nor
24 hex digits, or <code>TypeError</code> if <code>oid</code> is not an accepted type.</p>

<p>:Parameters:</p>

<ul>
<li><code>oid</code> (optional): a valid ObjectId.</li>
</ul>

<p><em>seealso The MongoDB documentation on  <a href="http://dochub.mongodb.org/core/objectids">ObjectIds </a>..</em></p>

<p><em>Changed in version 3.8:</em>
<code>~bson.objectid.ObjectId</code> now implements the <code>ObjectID
specification version 0.2
&lt;https://github.com/mongodb/specifications/blob/master/source/
objectid.rst&gt;</code>_.</p>
</div>


                            </div>
                            <div id="ObjectId.from_datetime" class="classattr">
                                        <input id="ObjectId.from_datetime-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_datetime</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n"><a href="#ObjectId">xtquant.xtbson.bson37.ObjectId</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">generation_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span></span><span class="return-annotation">) -> <span class="n"><a href="#ObjectId">xtquant.xtbson.bson37.ObjectId</a></span>:</span></span>

                <label class="view-source-button" for="ObjectId.from_datetime-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ObjectId.from_datetime"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ObjectId.from_datetime-106"><a href="#ObjectId.from_datetime-106"><span class="linenos">106</span></a>    <span class="nd">@classmethod</span>
</span><span id="ObjectId.from_datetime-107"><a href="#ObjectId.from_datetime-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">from_datetime</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;ObjectId&quot;</span><span class="p">],</span> <span class="n">generation_time</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ObjectId&quot;</span><span class="p">:</span>
</span><span id="ObjectId.from_datetime-108"><a href="#ObjectId.from_datetime-108"><span class="linenos">108</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a dummy ObjectId instance with a specific generation time.</span>
</span><span id="ObjectId.from_datetime-109"><a href="#ObjectId.from_datetime-109"><span class="linenos">109</span></a>
</span><span id="ObjectId.from_datetime-110"><a href="#ObjectId.from_datetime-110"><span class="linenos">110</span></a><span class="sd">        This method is useful for doing range queries on a field</span>
</span><span id="ObjectId.from_datetime-111"><a href="#ObjectId.from_datetime-111"><span class="linenos">111</span></a><span class="sd">        containing :class:`ObjectId` instances.</span>
</span><span id="ObjectId.from_datetime-112"><a href="#ObjectId.from_datetime-112"><span class="linenos">112</span></a>
</span><span id="ObjectId.from_datetime-113"><a href="#ObjectId.from_datetime-113"><span class="linenos">113</span></a><span class="sd">        .. warning::</span>
</span><span id="ObjectId.from_datetime-114"><a href="#ObjectId.from_datetime-114"><span class="linenos">114</span></a><span class="sd">           It is not safe to insert a document containing an ObjectId</span>
</span><span id="ObjectId.from_datetime-115"><a href="#ObjectId.from_datetime-115"><span class="linenos">115</span></a><span class="sd">           generated using this method. This method deliberately</span>
</span><span id="ObjectId.from_datetime-116"><a href="#ObjectId.from_datetime-116"><span class="linenos">116</span></a><span class="sd">           eliminates the uniqueness guarantee that ObjectIds</span>
</span><span id="ObjectId.from_datetime-117"><a href="#ObjectId.from_datetime-117"><span class="linenos">117</span></a><span class="sd">           generally provide. ObjectIds generated with this method</span>
</span><span id="ObjectId.from_datetime-118"><a href="#ObjectId.from_datetime-118"><span class="linenos">118</span></a><span class="sd">           should be used exclusively in queries.</span>
</span><span id="ObjectId.from_datetime-119"><a href="#ObjectId.from_datetime-119"><span class="linenos">119</span></a>
</span><span id="ObjectId.from_datetime-120"><a href="#ObjectId.from_datetime-120"><span class="linenos">120</span></a><span class="sd">        `generation_time` will be converted to UTC. Naive datetime</span>
</span><span id="ObjectId.from_datetime-121"><a href="#ObjectId.from_datetime-121"><span class="linenos">121</span></a><span class="sd">        instances will be treated as though they already contain UTC.</span>
</span><span id="ObjectId.from_datetime-122"><a href="#ObjectId.from_datetime-122"><span class="linenos">122</span></a>
</span><span id="ObjectId.from_datetime-123"><a href="#ObjectId.from_datetime-123"><span class="linenos">123</span></a><span class="sd">        An example using this helper to get documents where ``&quot;_id&quot;``</span>
</span><span id="ObjectId.from_datetime-124"><a href="#ObjectId.from_datetime-124"><span class="linenos">124</span></a><span class="sd">        was generated before January 1, 2010 would be:</span>
</span><span id="ObjectId.from_datetime-125"><a href="#ObjectId.from_datetime-125"><span class="linenos">125</span></a>
</span><span id="ObjectId.from_datetime-126"><a href="#ObjectId.from_datetime-126"><span class="linenos">126</span></a><span class="sd">        &gt;&gt;&gt; gen_time = datetime.datetime(2010, 1, 1)</span>
</span><span id="ObjectId.from_datetime-127"><a href="#ObjectId.from_datetime-127"><span class="linenos">127</span></a><span class="sd">        &gt;&gt;&gt; dummy_id = ObjectId.from_datetime(gen_time)</span>
</span><span id="ObjectId.from_datetime-128"><a href="#ObjectId.from_datetime-128"><span class="linenos">128</span></a><span class="sd">        &gt;&gt;&gt; result = collection.find({&quot;_id&quot;: {&quot;$lt&quot;: dummy_id}})</span>
</span><span id="ObjectId.from_datetime-129"><a href="#ObjectId.from_datetime-129"><span class="linenos">129</span></a>
</span><span id="ObjectId.from_datetime-130"><a href="#ObjectId.from_datetime-130"><span class="linenos">130</span></a><span class="sd">        :Parameters:</span>
</span><span id="ObjectId.from_datetime-131"><a href="#ObjectId.from_datetime-131"><span class="linenos">131</span></a><span class="sd">          - `generation_time`: :class:`~datetime.datetime` to be used</span>
</span><span id="ObjectId.from_datetime-132"><a href="#ObjectId.from_datetime-132"><span class="linenos">132</span></a><span class="sd">            as the generation time for the resulting ObjectId.</span>
</span><span id="ObjectId.from_datetime-133"><a href="#ObjectId.from_datetime-133"><span class="linenos">133</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ObjectId.from_datetime-134"><a href="#ObjectId.from_datetime-134"><span class="linenos">134</span></a>        <span class="n">offset</span> <span class="o">=</span> <span class="n">generation_time</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">()</span>
</span><span id="ObjectId.from_datetime-135"><a href="#ObjectId.from_datetime-135"><span class="linenos">135</span></a>        <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ObjectId.from_datetime-136"><a href="#ObjectId.from_datetime-136"><span class="linenos">136</span></a>            <span class="n">generation_time</span> <span class="o">=</span> <span class="n">generation_time</span> <span class="o">-</span> <span class="n">offset</span>
</span><span id="ObjectId.from_datetime-137"><a href="#ObjectId.from_datetime-137"><span class="linenos">137</span></a>        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">generation_time</span><span class="o">.</span><span class="n">timetuple</span><span class="p">())</span>
</span><span id="ObjectId.from_datetime-138"><a href="#ObjectId.from_datetime-138"><span class="linenos">138</span></a>        <span class="n">oid</span> <span class="o">=</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="s2">&quot;&gt;I&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">timestamp</span><span class="p">))</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00\x00</span><span class="s2">&quot;</span>
</span><span id="ObjectId.from_datetime-139"><a href="#ObjectId.from_datetime-139"><span class="linenos">139</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Create a dummy ObjectId instance with a specific generation time.</p>

<p>This method is useful for doing range queries on a field
containing <code><a href="#ObjectId">ObjectId</a></code> instances.</p>

<div class="pdoc-alert pdoc-alert-warning">

<p>It is not safe to insert a document containing an ObjectId
generated using this method. This method deliberately
eliminates the uniqueness guarantee that ObjectIds
generally provide. ObjectIds generated with this method
should be used exclusively in queries.</p>

</div>

<p><code><a href="#ObjectId.generation_time">generation_time</a></code> will be converted to UTC. Naive datetime
instances will be treated as though they already contain UTC.</p>

<p>An example using this helper to get documents where <code>"_id"</code>
was generated before January 1, 2010 would be:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">gen_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">dummy_id</span> <span class="o">=</span> <span class="n"><a href="#ObjectId.from_datetime">ObjectId.from_datetime</a></span><span class="p">(</span><span class="n">gen_time</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$lt&quot;</span><span class="p">:</span> <span class="n">dummy_id</span><span class="p">}})</span>
</code></pre>
</div>

<p>:Parameters:</p>

<ul>
<li><code><a href="#ObjectId.generation_time">generation_time</a></code>: <code>~datetime.datetime</code> to be used
as the generation time for the resulting ObjectId.</li>
</ul>
</div>


                            </div>
                            <div id="ObjectId.is_valid" class="classattr">
                                        <input id="ObjectId.is_valid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">is_valid</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n"><a href="#ObjectId">xtquant.xtbson.bson37.ObjectId</a></span><span class="p">]</span>, </span><span class="param"><span class="n">oid</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="ObjectId.is_valid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ObjectId.is_valid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ObjectId.is_valid-141"><a href="#ObjectId.is_valid-141"><span class="linenos">141</span></a>    <span class="nd">@classmethod</span>
</span><span id="ObjectId.is_valid-142"><a href="#ObjectId.is_valid-142"><span class="linenos">142</span></a>    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;ObjectId&quot;</span><span class="p">],</span> <span class="n">oid</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ObjectId.is_valid-143"><a href="#ObjectId.is_valid-143"><span class="linenos">143</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if a `oid` string is valid or not.</span>
</span><span id="ObjectId.is_valid-144"><a href="#ObjectId.is_valid-144"><span class="linenos">144</span></a>
</span><span id="ObjectId.is_valid-145"><a href="#ObjectId.is_valid-145"><span class="linenos">145</span></a><span class="sd">        :Parameters:</span>
</span><span id="ObjectId.is_valid-146"><a href="#ObjectId.is_valid-146"><span class="linenos">146</span></a><span class="sd">          - `oid`: the object id to validate</span>
</span><span id="ObjectId.is_valid-147"><a href="#ObjectId.is_valid-147"><span class="linenos">147</span></a>
</span><span id="ObjectId.is_valid-148"><a href="#ObjectId.is_valid-148"><span class="linenos">148</span></a><span class="sd">        .. versionadded:: 2.3</span>
</span><span id="ObjectId.is_valid-149"><a href="#ObjectId.is_valid-149"><span class="linenos">149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ObjectId.is_valid-150"><a href="#ObjectId.is_valid-150"><span class="linenos">150</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">oid</span><span class="p">:</span>
</span><span id="ObjectId.is_valid-151"><a href="#ObjectId.is_valid-151"><span class="linenos">151</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ObjectId.is_valid-152"><a href="#ObjectId.is_valid-152"><span class="linenos">152</span></a>
</span><span id="ObjectId.is_valid-153"><a href="#ObjectId.is_valid-153"><span class="linenos">153</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ObjectId.is_valid-154"><a href="#ObjectId.is_valid-154"><span class="linenos">154</span></a>            <span class="n">ObjectId</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>
</span><span id="ObjectId.is_valid-155"><a href="#ObjectId.is_valid-155"><span class="linenos">155</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ObjectId.is_valid-156"><a href="#ObjectId.is_valid-156"><span class="linenos">156</span></a>        <span class="k">except</span> <span class="p">(</span><span class="n">InvalidId</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
</span><span id="ObjectId.is_valid-157"><a href="#ObjectId.is_valid-157"><span class="linenos">157</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Checks if a <code>oid</code> string is valid or not.</p>

<p>:Parameters:</p>

<ul>
<li><code>oid</code>: the object id to validate</li>
</ul>

<p><em>New in version 2.3.</em></p>
</div>


                            </div>
                            <div id="ObjectId.binary" class="classattr">
                                <div class="attr variable">
            <span class="name">binary</span><span class="annotation">: bytes</span>

        
    </div>
    <a class="headerlink" href="#ObjectId.binary"></a>
    
            <div class="docstring"><p>12-byte binary representation of this ObjectId.</p>
</div>


                            </div>
                            <div id="ObjectId.generation_time" class="classattr">
                                <div class="attr variable">
            <span class="name">generation_time</span><span class="annotation">: datetime.datetime</span>

        
    </div>
    <a class="headerlink" href="#ObjectId.generation_time"></a>
    
            <div class="docstring"><p>A <code>datetime.datetime</code> instance representing the time of
generation for this <code><a href="#ObjectId">ObjectId</a></code>.</p>

<p>The <code>datetime.datetime</code> is timezone aware, and
represents the generation time in UTC. It is precise to the
second.</p>
</div>


                            </div>
                </section>
                <section id="Regex">
                            <input id="Regex-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Regex</span><wbr>(<span class="base">typing.Generic[~_T]</span>):

                <label class="view-source-button" for="Regex-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Regex"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Regex-47"><a href="#Regex-47"><span class="linenos"> 47</span></a><span class="k">class</span> <span class="nc">Regex</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">_T</span><span class="p">]):</span>
</span><span id="Regex-48"><a href="#Regex-48"><span class="linenos"> 48</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;BSON regular expression data.&quot;&quot;&quot;</span>
</span><span id="Regex-49"><a href="#Regex-49"><span class="linenos"> 49</span></a>
</span><span id="Regex-50"><a href="#Regex-50"><span class="linenos"> 50</span></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;pattern&quot;</span><span class="p">,</span> <span class="s2">&quot;flags&quot;</span><span class="p">)</span>
</span><span id="Regex-51"><a href="#Regex-51"><span class="linenos"> 51</span></a>
</span><span id="Regex-52"><a href="#Regex-52"><span class="linenos"> 52</span></a>    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_slots</span>
</span><span id="Regex-53"><a href="#Regex-53"><span class="linenos"> 53</span></a>    <span class="n">__setstate__</span> <span class="o">=</span> <span class="n">_setstate_slots</span>
</span><span id="Regex-54"><a href="#Regex-54"><span class="linenos"> 54</span></a>
</span><span id="Regex-55"><a href="#Regex-55"><span class="linenos"> 55</span></a>    <span class="n">_type_marker</span> <span class="o">=</span> <span class="mi">11</span>
</span><span id="Regex-56"><a href="#Regex-56"><span class="linenos"> 56</span></a>
</span><span id="Regex-57"><a href="#Regex-57"><span class="linenos"> 57</span></a>    <span class="nd">@classmethod</span>
</span><span id="Regex-58"><a href="#Regex-58"><span class="linenos"> 58</span></a>    <span class="k">def</span> <span class="nf">from_native</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Regex&quot;</span><span class="p">],</span> <span class="n">regex</span><span class="p">:</span> <span class="s2">&quot;Pattern[_T]&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Regex[_T]&quot;</span><span class="p">:</span>
</span><span id="Regex-59"><a href="#Regex-59"><span class="linenos"> 59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a Python regular expression into a ``Regex`` instance.</span>
</span><span id="Regex-60"><a href="#Regex-60"><span class="linenos"> 60</span></a>
</span><span id="Regex-61"><a href="#Regex-61"><span class="linenos"> 61</span></a><span class="sd">        Note that in Python 3, a regular expression compiled from a</span>
</span><span id="Regex-62"><a href="#Regex-62"><span class="linenos"> 62</span></a><span class="sd">        :class:`str` has the ``re.UNICODE`` flag set. If it is undesirable</span>
</span><span id="Regex-63"><a href="#Regex-63"><span class="linenos"> 63</span></a><span class="sd">        to store this flag in a BSON regular expression, unset it first::</span>
</span><span id="Regex-64"><a href="#Regex-64"><span class="linenos"> 64</span></a>
</span><span id="Regex-65"><a href="#Regex-65"><span class="linenos"> 65</span></a><span class="sd">          &gt;&gt;&gt; pattern = re.compile(&#39;.*&#39;)</span>
</span><span id="Regex-66"><a href="#Regex-66"><span class="linenos"> 66</span></a><span class="sd">          &gt;&gt;&gt; regex = Regex.from_native(pattern)</span>
</span><span id="Regex-67"><a href="#Regex-67"><span class="linenos"> 67</span></a><span class="sd">          &gt;&gt;&gt; regex.flags ^= re.UNICODE</span>
</span><span id="Regex-68"><a href="#Regex-68"><span class="linenos"> 68</span></a><span class="sd">          &gt;&gt;&gt; db.collection.insert_one({&#39;pattern&#39;: regex})</span>
</span><span id="Regex-69"><a href="#Regex-69"><span class="linenos"> 69</span></a>
</span><span id="Regex-70"><a href="#Regex-70"><span class="linenos"> 70</span></a><span class="sd">        :Parameters:</span>
</span><span id="Regex-71"><a href="#Regex-71"><span class="linenos"> 71</span></a><span class="sd">          - `regex`: A regular expression object from ``re.compile()``.</span>
</span><span id="Regex-72"><a href="#Regex-72"><span class="linenos"> 72</span></a>
</span><span id="Regex-73"><a href="#Regex-73"><span class="linenos"> 73</span></a><span class="sd">        .. warning::</span>
</span><span id="Regex-74"><a href="#Regex-74"><span class="linenos"> 74</span></a><span class="sd">           Python regular expressions use a different syntax and different</span>
</span><span id="Regex-75"><a href="#Regex-75"><span class="linenos"> 75</span></a><span class="sd">           set of flags than MongoDB, which uses `PCRE`_. A regular</span>
</span><span id="Regex-76"><a href="#Regex-76"><span class="linenos"> 76</span></a><span class="sd">           expression retrieved from the server may not compile in</span>
</span><span id="Regex-77"><a href="#Regex-77"><span class="linenos"> 77</span></a><span class="sd">           Python, or may match a different set of strings in Python than</span>
</span><span id="Regex-78"><a href="#Regex-78"><span class="linenos"> 78</span></a><span class="sd">           when used in a MongoDB query.</span>
</span><span id="Regex-79"><a href="#Regex-79"><span class="linenos"> 79</span></a>
</span><span id="Regex-80"><a href="#Regex-80"><span class="linenos"> 80</span></a><span class="sd">        .. _PCRE: http://www.pcre.org/</span>
</span><span id="Regex-81"><a href="#Regex-81"><span class="linenos"> 81</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Regex-82"><a href="#Regex-82"><span class="linenos"> 82</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">RE_TYPE</span><span class="p">):</span>
</span><span id="Regex-83"><a href="#Regex-83"><span class="linenos"> 83</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;regex must be a compiled regular expression, not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">regex</span><span class="p">))</span>
</span><span id="Regex-84"><a href="#Regex-84"><span class="linenos"> 84</span></a>
</span><span id="Regex-85"><a href="#Regex-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="n">Regex</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="n">regex</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
</span><span id="Regex-86"><a href="#Regex-86"><span class="linenos"> 86</span></a>
</span><span id="Regex-87"><a href="#Regex-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">_T</span><span class="p">,</span> <span class="n">flags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Regex-88"><a href="#Regex-88"><span class="linenos"> 88</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;BSON regular expression data.</span>
</span><span id="Regex-89"><a href="#Regex-89"><span class="linenos"> 89</span></a>
</span><span id="Regex-90"><a href="#Regex-90"><span class="linenos"> 90</span></a><span class="sd">        This class is useful to store and retrieve regular expressions that are</span>
</span><span id="Regex-91"><a href="#Regex-91"><span class="linenos"> 91</span></a><span class="sd">        incompatible with Python&#39;s regular expression dialect.</span>
</span><span id="Regex-92"><a href="#Regex-92"><span class="linenos"> 92</span></a>
</span><span id="Regex-93"><a href="#Regex-93"><span class="linenos"> 93</span></a><span class="sd">        :Parameters:</span>
</span><span id="Regex-94"><a href="#Regex-94"><span class="linenos"> 94</span></a><span class="sd">          - `pattern`: string</span>
</span><span id="Regex-95"><a href="#Regex-95"><span class="linenos"> 95</span></a><span class="sd">          - `flags`: (optional) an integer bitmask, or a string of flag</span>
</span><span id="Regex-96"><a href="#Regex-96"><span class="linenos"> 96</span></a><span class="sd">            characters like &quot;im&quot; for IGNORECASE and MULTILINE</span>
</span><span id="Regex-97"><a href="#Regex-97"><span class="linenos"> 97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Regex-98"><a href="#Regex-98"><span class="linenos"> 98</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
</span><span id="Regex-99"><a href="#Regex-99"><span class="linenos"> 99</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;pattern must be a string, not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
</span><span id="Regex-100"><a href="#Regex-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">:</span> <span class="n">_T</span> <span class="o">=</span> <span class="n">pattern</span>
</span><span id="Regex-101"><a href="#Regex-101"><span class="linenos">101</span></a>
</span><span id="Regex-102"><a href="#Regex-102"><span class="linenos">102</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Regex-103"><a href="#Regex-103"><span class="linenos">103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">str_flags_to_int</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
</span><span id="Regex-104"><a href="#Regex-104"><span class="linenos">104</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Regex-105"><a href="#Regex-105"><span class="linenos">105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span>
</span><span id="Regex-106"><a href="#Regex-106"><span class="linenos">106</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Regex-107"><a href="#Regex-107"><span class="linenos">107</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;flags must be a string or int, not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">flags</span><span class="p">))</span>
</span><span id="Regex-108"><a href="#Regex-108"><span class="linenos">108</span></a>
</span><span id="Regex-109"><a href="#Regex-109"><span class="linenos">109</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Regex-110"><a href="#Regex-110"><span class="linenos">110</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Regex</span><span class="p">):</span>
</span><span id="Regex-111"><a href="#Regex-111"><span class="linenos">111</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">pattern</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">flags</span>
</span><span id="Regex-112"><a href="#Regex-112"><span class="linenos">112</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Regex-113"><a href="#Regex-113"><span class="linenos">113</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Regex-114"><a href="#Regex-114"><span class="linenos">114</span></a>
</span><span id="Regex-115"><a href="#Regex-115"><span class="linenos">115</span></a>    <span class="fm">__hash__</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: ignore</span>
</span><span id="Regex-116"><a href="#Regex-116"><span class="linenos">116</span></a>
</span><span id="Regex-117"><a href="#Regex-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Regex-118"><a href="#Regex-118"><span class="linenos">118</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="Regex-119"><a href="#Regex-119"><span class="linenos">119</span></a>
</span><span id="Regex-120"><a href="#Regex-120"><span class="linenos">120</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Regex-121"><a href="#Regex-121"><span class="linenos">121</span></a>        <span class="k">return</span> <span class="s2">&quot;Regex(</span><span class="si">%r</span><span class="s2">, </span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
</span><span id="Regex-122"><a href="#Regex-122"><span class="linenos">122</span></a>
</span><span id="Regex-123"><a href="#Regex-123"><span class="linenos">123</span></a>    <span class="k">def</span> <span class="nf">try_compile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Pattern[_T]&quot;</span><span class="p">:</span>
</span><span id="Regex-124"><a href="#Regex-124"><span class="linenos">124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compile this :class:`Regex` as a Python regular expression.</span>
</span><span id="Regex-125"><a href="#Regex-125"><span class="linenos">125</span></a>
</span><span id="Regex-126"><a href="#Regex-126"><span class="linenos">126</span></a><span class="sd">        .. warning::</span>
</span><span id="Regex-127"><a href="#Regex-127"><span class="linenos">127</span></a><span class="sd">           Python regular expressions use a different syntax and different</span>
</span><span id="Regex-128"><a href="#Regex-128"><span class="linenos">128</span></a><span class="sd">           set of flags than MongoDB, which uses `PCRE`_. A regular</span>
</span><span id="Regex-129"><a href="#Regex-129"><span class="linenos">129</span></a><span class="sd">           expression retrieved from the server may not compile in</span>
</span><span id="Regex-130"><a href="#Regex-130"><span class="linenos">130</span></a><span class="sd">           Python, or may match a different set of strings in Python than</span>
</span><span id="Regex-131"><a href="#Regex-131"><span class="linenos">131</span></a><span class="sd">           when used in a MongoDB query. :meth:`try_compile()` may raise</span>
</span><span id="Regex-132"><a href="#Regex-132"><span class="linenos">132</span></a><span class="sd">           :exc:`re.error`.</span>
</span><span id="Regex-133"><a href="#Regex-133"><span class="linenos">133</span></a>
</span><span id="Regex-134"><a href="#Regex-134"><span class="linenos">134</span></a><span class="sd">        .. _PCRE: http://www.pcre.org/</span>
</span><span id="Regex-135"><a href="#Regex-135"><span class="linenos">135</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Regex-136"><a href="#Regex-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>BSON regular expression data.</p>
</div>


                            <div id="Regex.__init__" class="classattr">
                                        <input id="Regex.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Regex</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pattern</span><span class="p">:</span> <span class="o">~</span><span class="n">_T</span>, </span><span class="param"><span class="n">flags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></span>)</span>

                <label class="view-source-button" for="Regex.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Regex.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Regex.__init__-87"><a href="#Regex.__init__-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">_T</span><span class="p">,</span> <span class="n">flags</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Regex.__init__-88"><a href="#Regex.__init__-88"><span class="linenos"> 88</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;BSON regular expression data.</span>
</span><span id="Regex.__init__-89"><a href="#Regex.__init__-89"><span class="linenos"> 89</span></a>
</span><span id="Regex.__init__-90"><a href="#Regex.__init__-90"><span class="linenos"> 90</span></a><span class="sd">        This class is useful to store and retrieve regular expressions that are</span>
</span><span id="Regex.__init__-91"><a href="#Regex.__init__-91"><span class="linenos"> 91</span></a><span class="sd">        incompatible with Python&#39;s regular expression dialect.</span>
</span><span id="Regex.__init__-92"><a href="#Regex.__init__-92"><span class="linenos"> 92</span></a>
</span><span id="Regex.__init__-93"><a href="#Regex.__init__-93"><span class="linenos"> 93</span></a><span class="sd">        :Parameters:</span>
</span><span id="Regex.__init__-94"><a href="#Regex.__init__-94"><span class="linenos"> 94</span></a><span class="sd">          - `pattern`: string</span>
</span><span id="Regex.__init__-95"><a href="#Regex.__init__-95"><span class="linenos"> 95</span></a><span class="sd">          - `flags`: (optional) an integer bitmask, or a string of flag</span>
</span><span id="Regex.__init__-96"><a href="#Regex.__init__-96"><span class="linenos"> 96</span></a><span class="sd">            characters like &quot;im&quot; for IGNORECASE and MULTILINE</span>
</span><span id="Regex.__init__-97"><a href="#Regex.__init__-97"><span class="linenos"> 97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Regex.__init__-98"><a href="#Regex.__init__-98"><span class="linenos"> 98</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)):</span>
</span><span id="Regex.__init__-99"><a href="#Regex.__init__-99"><span class="linenos"> 99</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;pattern must be a string, not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
</span><span id="Regex.__init__-100"><a href="#Regex.__init__-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">:</span> <span class="n">_T</span> <span class="o">=</span> <span class="n">pattern</span>
</span><span id="Regex.__init__-101"><a href="#Regex.__init__-101"><span class="linenos">101</span></a>
</span><span id="Regex.__init__-102"><a href="#Regex.__init__-102"><span class="linenos">102</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Regex.__init__-103"><a href="#Regex.__init__-103"><span class="linenos">103</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">str_flags_to_int</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
</span><span id="Regex.__init__-104"><a href="#Regex.__init__-104"><span class="linenos">104</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Regex.__init__-105"><a href="#Regex.__init__-105"><span class="linenos">105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span>
</span><span id="Regex.__init__-106"><a href="#Regex.__init__-106"><span class="linenos">106</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Regex.__init__-107"><a href="#Regex.__init__-107"><span class="linenos">107</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;flags must be a string or int, not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">flags</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>BSON regular expression data.</p>

<p>This class is useful to store and retrieve regular expressions that are
incompatible with Python's regular expression dialect.</p>

<p>:Parameters:</p>

<ul>
<li><code><a href="#Regex.pattern">pattern</a></code>: string</li>
<li><code><a href="#Regex.flags">flags</a></code>: (optional) an integer bitmask, or a string of flag
characters like "im" for IGNORECASE and MULTILINE</li>
</ul>
</div>


                            </div>
                            <div id="Regex.from_native" class="classattr">
                                        <input id="Regex.from_native-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_native</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n"><a href="#Regex">xtquant.xtbson.bson37.Regex</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">regex</span><span class="p">:</span> <span class="n">Pattern</span><span class="p">[</span><span class="o">~</span><span class="n">_T</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Regex">xtquant.xtbson.bson37.Regex</a></span><span class="p">[</span><span class="o">~</span><span class="n">_T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Regex.from_native-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Regex.from_native"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Regex.from_native-57"><a href="#Regex.from_native-57"><span class="linenos">57</span></a>    <span class="nd">@classmethod</span>
</span><span id="Regex.from_native-58"><a href="#Regex.from_native-58"><span class="linenos">58</span></a>    <span class="k">def</span> <span class="nf">from_native</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Regex&quot;</span><span class="p">],</span> <span class="n">regex</span><span class="p">:</span> <span class="s2">&quot;Pattern[_T]&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Regex[_T]&quot;</span><span class="p">:</span>
</span><span id="Regex.from_native-59"><a href="#Regex.from_native-59"><span class="linenos">59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a Python regular expression into a ``Regex`` instance.</span>
</span><span id="Regex.from_native-60"><a href="#Regex.from_native-60"><span class="linenos">60</span></a>
</span><span id="Regex.from_native-61"><a href="#Regex.from_native-61"><span class="linenos">61</span></a><span class="sd">        Note that in Python 3, a regular expression compiled from a</span>
</span><span id="Regex.from_native-62"><a href="#Regex.from_native-62"><span class="linenos">62</span></a><span class="sd">        :class:`str` has the ``re.UNICODE`` flag set. If it is undesirable</span>
</span><span id="Regex.from_native-63"><a href="#Regex.from_native-63"><span class="linenos">63</span></a><span class="sd">        to store this flag in a BSON regular expression, unset it first::</span>
</span><span id="Regex.from_native-64"><a href="#Regex.from_native-64"><span class="linenos">64</span></a>
</span><span id="Regex.from_native-65"><a href="#Regex.from_native-65"><span class="linenos">65</span></a><span class="sd">          &gt;&gt;&gt; pattern = re.compile(&#39;.*&#39;)</span>
</span><span id="Regex.from_native-66"><a href="#Regex.from_native-66"><span class="linenos">66</span></a><span class="sd">          &gt;&gt;&gt; regex = Regex.from_native(pattern)</span>
</span><span id="Regex.from_native-67"><a href="#Regex.from_native-67"><span class="linenos">67</span></a><span class="sd">          &gt;&gt;&gt; regex.flags ^= re.UNICODE</span>
</span><span id="Regex.from_native-68"><a href="#Regex.from_native-68"><span class="linenos">68</span></a><span class="sd">          &gt;&gt;&gt; db.collection.insert_one({&#39;pattern&#39;: regex})</span>
</span><span id="Regex.from_native-69"><a href="#Regex.from_native-69"><span class="linenos">69</span></a>
</span><span id="Regex.from_native-70"><a href="#Regex.from_native-70"><span class="linenos">70</span></a><span class="sd">        :Parameters:</span>
</span><span id="Regex.from_native-71"><a href="#Regex.from_native-71"><span class="linenos">71</span></a><span class="sd">          - `regex`: A regular expression object from ``re.compile()``.</span>
</span><span id="Regex.from_native-72"><a href="#Regex.from_native-72"><span class="linenos">72</span></a>
</span><span id="Regex.from_native-73"><a href="#Regex.from_native-73"><span class="linenos">73</span></a><span class="sd">        .. warning::</span>
</span><span id="Regex.from_native-74"><a href="#Regex.from_native-74"><span class="linenos">74</span></a><span class="sd">           Python regular expressions use a different syntax and different</span>
</span><span id="Regex.from_native-75"><a href="#Regex.from_native-75"><span class="linenos">75</span></a><span class="sd">           set of flags than MongoDB, which uses `PCRE`_. A regular</span>
</span><span id="Regex.from_native-76"><a href="#Regex.from_native-76"><span class="linenos">76</span></a><span class="sd">           expression retrieved from the server may not compile in</span>
</span><span id="Regex.from_native-77"><a href="#Regex.from_native-77"><span class="linenos">77</span></a><span class="sd">           Python, or may match a different set of strings in Python than</span>
</span><span id="Regex.from_native-78"><a href="#Regex.from_native-78"><span class="linenos">78</span></a><span class="sd">           when used in a MongoDB query.</span>
</span><span id="Regex.from_native-79"><a href="#Regex.from_native-79"><span class="linenos">79</span></a>
</span><span id="Regex.from_native-80"><a href="#Regex.from_native-80"><span class="linenos">80</span></a><span class="sd">        .. _PCRE: http://www.pcre.org/</span>
</span><span id="Regex.from_native-81"><a href="#Regex.from_native-81"><span class="linenos">81</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Regex.from_native-82"><a href="#Regex.from_native-82"><span class="linenos">82</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">regex</span><span class="p">,</span> <span class="n">RE_TYPE</span><span class="p">):</span>
</span><span id="Regex.from_native-83"><a href="#Regex.from_native-83"><span class="linenos">83</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;regex must be a compiled regular expression, not </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">regex</span><span class="p">))</span>
</span><span id="Regex.from_native-84"><a href="#Regex.from_native-84"><span class="linenos">84</span></a>
</span><span id="Regex.from_native-85"><a href="#Regex.from_native-85"><span class="linenos">85</span></a>        <span class="k">return</span> <span class="n">Regex</span><span class="p">(</span><span class="n">regex</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="n">regex</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convert a Python regular expression into a <code><a href="#Regex">Regex</a></code> instance.</p>

<p>Note that in Python 3, a regular expression compiled from a
<code>str</code> has the <code>re.UNICODE</code> flag set. If it is undesirable
to store this flag in a BSON regular expression, unset it first::</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;.*&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">regex</span> <span class="o">=</span> <span class="n"><a href="#Regex.from_native">Regex.from_native</a></span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">regex</span><span class="o">.</span><span class="n">flags</span> <span class="o">^=</span> <span class="n">re</span><span class="o">.</span><span class="n">UNICODE</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">({</span><span class="s1">&#39;pattern&#39;</span><span class="p">:</span> <span class="n">regex</span><span class="p">})</span>
</code></pre>
</div>

<p>:Parameters:</p>

<ul>
<li><code>regex</code>: A regular expression object from <code>re.compile()</code>.</li>
</ul>

<div class="pdoc-alert pdoc-alert-warning">

<p>Python regular expressions use a different syntax and different
set of flags than MongoDB, which uses <a href="http://www.pcre.org/">PCRE</a>. A regular
expression retrieved from the server may not compile in
Python, or may match a different set of strings in Python than
when used in a MongoDB query.</p>

</div>
</div>


                            </div>
                            <div id="Regex.pattern" class="classattr">
                                <div class="attr variable">
            <span class="name">pattern</span><span class="annotation">: ~_T</span>

        
    </div>
    <a class="headerlink" href="#Regex.pattern"></a>
    
    

                            </div>
                            <div id="Regex.try_compile" class="classattr">
                                        <input id="Regex.try_compile-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">try_compile</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Pattern</span><span class="p">[</span><span class="o">~</span><span class="n">_T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Regex.try_compile-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Regex.try_compile"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Regex.try_compile-123"><a href="#Regex.try_compile-123"><span class="linenos">123</span></a>    <span class="k">def</span> <span class="nf">try_compile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Pattern[_T]&quot;</span><span class="p">:</span>
</span><span id="Regex.try_compile-124"><a href="#Regex.try_compile-124"><span class="linenos">124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Compile this :class:`Regex` as a Python regular expression.</span>
</span><span id="Regex.try_compile-125"><a href="#Regex.try_compile-125"><span class="linenos">125</span></a>
</span><span id="Regex.try_compile-126"><a href="#Regex.try_compile-126"><span class="linenos">126</span></a><span class="sd">        .. warning::</span>
</span><span id="Regex.try_compile-127"><a href="#Regex.try_compile-127"><span class="linenos">127</span></a><span class="sd">           Python regular expressions use a different syntax and different</span>
</span><span id="Regex.try_compile-128"><a href="#Regex.try_compile-128"><span class="linenos">128</span></a><span class="sd">           set of flags than MongoDB, which uses `PCRE`_. A regular</span>
</span><span id="Regex.try_compile-129"><a href="#Regex.try_compile-129"><span class="linenos">129</span></a><span class="sd">           expression retrieved from the server may not compile in</span>
</span><span id="Regex.try_compile-130"><a href="#Regex.try_compile-130"><span class="linenos">130</span></a><span class="sd">           Python, or may match a different set of strings in Python than</span>
</span><span id="Regex.try_compile-131"><a href="#Regex.try_compile-131"><span class="linenos">131</span></a><span class="sd">           when used in a MongoDB query. :meth:`try_compile()` may raise</span>
</span><span id="Regex.try_compile-132"><a href="#Regex.try_compile-132"><span class="linenos">132</span></a><span class="sd">           :exc:`re.error`.</span>
</span><span id="Regex.try_compile-133"><a href="#Regex.try_compile-133"><span class="linenos">133</span></a>
</span><span id="Regex.try_compile-134"><a href="#Regex.try_compile-134"><span class="linenos">134</span></a><span class="sd">        .. _PCRE: http://www.pcre.org/</span>
</span><span id="Regex.try_compile-135"><a href="#Regex.try_compile-135"><span class="linenos">135</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Regex.try_compile-136"><a href="#Regex.try_compile-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pattern</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flags</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compile this <code><a href="#Regex">Regex</a></code> as a Python regular expression.</p>

<div class="pdoc-alert pdoc-alert-warning">

<p>Python regular expressions use a different syntax and different
set of flags than MongoDB, which uses <a href="http://www.pcre.org/">PCRE</a>. A regular
expression retrieved from the server may not compile in
Python, or may match a different set of strings in Python than
when used in a MongoDB query. <code>try_compile()()</code> may raise
<code>re.error</code>.</p>

</div>
</div>


                            </div>
                            <div id="Regex.flags" class="classattr">
                                <div class="attr variable">
            <span class="name">flags</span>

        
    </div>
    <a class="headerlink" href="#Regex.flags"></a>
    
    

                            </div>
                </section>
                <section id="RE_TYPE">
                    <div class="attr variable">
            <span class="name">RE_TYPE</span>        =
<span class="default_value">&lt;class &#39;re.Pattern&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#RE_TYPE"></a>
    
    

                </section>
                <section id="SON">
                            <input id="SON-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SON</span><wbr>(<span class="base">typing.Dict[~_Key, ~_Value]</span>):

                <label class="view-source-button" for="SON-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SON"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SON-49"><a href="#SON-49"><span class="linenos"> 49</span></a><span class="k">class</span> <span class="nc">SON</span><span class="p">(</span><span class="n">Dict</span><span class="p">[</span><span class="n">_Key</span><span class="p">,</span> <span class="n">_Value</span><span class="p">]):</span>
</span><span id="SON-50"><a href="#SON-50"><span class="linenos"> 50</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;SON data.</span>
</span><span id="SON-51"><a href="#SON-51"><span class="linenos"> 51</span></a>
</span><span id="SON-52"><a href="#SON-52"><span class="linenos"> 52</span></a><span class="sd">    A subclass of dict that maintains ordering of keys and provides a</span>
</span><span id="SON-53"><a href="#SON-53"><span class="linenos"> 53</span></a><span class="sd">    few extra niceties for dealing with SON. SON provides an API</span>
</span><span id="SON-54"><a href="#SON-54"><span class="linenos"> 54</span></a><span class="sd">    similar to collections.OrderedDict.</span>
</span><span id="SON-55"><a href="#SON-55"><span class="linenos"> 55</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SON-56"><a href="#SON-56"><span class="linenos"> 56</span></a>
</span><span id="SON-57"><a href="#SON-57"><span class="linenos"> 57</span></a>    <span class="n">__keys</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span>
</span><span id="SON-58"><a href="#SON-58"><span class="linenos"> 58</span></a>
</span><span id="SON-59"><a href="#SON-59"><span class="linenos"> 59</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="SON-60"><a href="#SON-60"><span class="linenos"> 60</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="SON-61"><a href="#SON-61"><span class="linenos"> 61</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="n">_Key</span><span class="p">,</span> <span class="n">_Value</span><span class="p">],</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">_Key</span><span class="p">,</span> <span class="n">_Value</span><span class="p">]]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="SON-62"><a href="#SON-62"><span class="linenos"> 62</span></a>        <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span>
</span><span id="SON-63"><a href="#SON-63"><span class="linenos"> 63</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SON-64"><a href="#SON-64"><span class="linenos"> 64</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__keys</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SON-65"><a href="#SON-65"><span class="linenos"> 65</span></a>        <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="SON-66"><a href="#SON-66"><span class="linenos"> 66</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="SON-67"><a href="#SON-67"><span class="linenos"> 67</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="SON-68"><a href="#SON-68"><span class="linenos"> 68</span></a>
</span><span id="SON-69"><a href="#SON-69"><span class="linenos"> 69</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;SON[_Key, _Value]&quot;</span><span class="p">],</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SON[_Key, _Value]&quot;</span><span class="p">:</span>
</span><span id="SON-70"><a href="#SON-70"><span class="linenos"> 70</span></a>        <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SON</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="SON-71"><a href="#SON-71"><span class="linenos"> 71</span></a>        <span class="n">instance</span><span class="o">.</span><span class="n">__keys</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SON-72"><a href="#SON-72"><span class="linenos"> 72</span></a>        <span class="k">return</span> <span class="n">instance</span>
</span><span id="SON-73"><a href="#SON-73"><span class="linenos"> 73</span></a>
</span><span id="SON-74"><a href="#SON-74"><span class="linenos"> 74</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="SON-75"><a href="#SON-75"><span class="linenos"> 75</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SON-76"><a href="#SON-76"><span class="linenos"> 76</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__keys</span><span class="p">:</span>
</span><span id="SON-77"><a href="#SON-77"><span class="linenos"> 77</span></a>            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;(</span><span class="si">%r</span><span class="s2">, </span><span class="si">%r</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
</span><span id="SON-78"><a href="#SON-78"><span class="linenos"> 78</span></a>        <span class="k">return</span> <span class="s2">&quot;SON([</span><span class="si">%s</span><span class="s2">])&quot;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="SON-79"><a href="#SON-79"><span class="linenos"> 79</span></a>
</span><span id="SON-80"><a href="#SON-80"><span class="linenos"> 80</span></a>    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">_Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SON-81"><a href="#SON-81"><span class="linenos"> 81</span></a>        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__keys</span><span class="p">:</span>
</span><span id="SON-82"><a href="#SON-82"><span class="linenos"> 82</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="SON-83"><a href="#SON-83"><span class="linenos"> 83</span></a>        <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="SON-84"><a href="#SON-84"><span class="linenos"> 84</span></a>
</span><span id="SON-85"><a href="#SON-85"><span class="linenos"> 85</span></a>    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_Key</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SON-86"><a href="#SON-86"><span class="linenos"> 86</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__keys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="SON-87"><a href="#SON-87"><span class="linenos"> 87</span></a>        <span class="nb">dict</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="SON-88"><a href="#SON-88"><span class="linenos"> 88</span></a>
</span><span id="SON-89"><a href="#SON-89"><span class="linenos"> 89</span></a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SON[_Key, _Value]&quot;</span><span class="p">:</span>
</span><span id="SON-90"><a href="#SON-90"><span class="linenos"> 90</span></a>        <span class="n">other</span><span class="p">:</span> <span class="n">SON</span><span class="p">[</span><span class="n">_Key</span><span class="p">,</span> <span class="n">_Value</span><span class="p">]</span> <span class="o">=</span> <span class="n">SON</span><span class="p">()</span>
</span><span id="SON-91"><a href="#SON-91"><span class="linenos"> 91</span></a>        <span class="n">other</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="SON-92"><a href="#SON-92"><span class="linenos"> 92</span></a>        <span class="k">return</span> <span class="n">other</span>
</span><span id="SON-93"><a href="#SON-93"><span class="linenos"> 93</span></a>
</span><span id="SON-94"><a href="#SON-94"><span class="linenos"> 94</span></a>    <span class="c1"># TODO this is all from UserDict.DictMixin. it could probably be made more</span>
</span><span id="SON-95"><a href="#SON-95"><span class="linenos"> 95</span></a>    <span class="c1"># efficient.</span>
</span><span id="SON-96"><a href="#SON-96"><span class="linenos"> 96</span></a>    <span class="c1"># second level definitions support higher levels</span>
</span><span id="SON-97"><a href="#SON-97"><span class="linenos"> 97</span></a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_Key</span><span class="p">]:</span>
</span><span id="SON-98"><a href="#SON-98"><span class="linenos"> 98</span></a>        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__keys</span><span class="p">:</span>
</span><span id="SON-99"><a href="#SON-99"><span class="linenos"> 99</span></a>            <span class="k">yield</span> <span class="n">k</span>
</span><span id="SON-100"><a href="#SON-100"><span class="linenos">100</span></a>
</span><span id="SON-101"><a href="#SON-101"><span class="linenos">101</span></a>    <span class="k">def</span> <span class="nf">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_Key</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SON-102"><a href="#SON-102"><span class="linenos">102</span></a>        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__keys</span>
</span><span id="SON-103"><a href="#SON-103"><span class="linenos">103</span></a>
</span><span id="SON-104"><a href="#SON-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_Key</span><span class="p">]:</span>
</span><span id="SON-105"><a href="#SON-105"><span class="linenos">105</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">()</span>
</span><span id="SON-106"><a href="#SON-106"><span class="linenos">106</span></a>
</span><span id="SON-107"><a href="#SON-107"><span class="linenos">107</span></a>    <span class="c1"># fourth level uses definitions from lower levels</span>
</span><span id="SON-108"><a href="#SON-108"><span class="linenos">108</span></a>    <span class="k">def</span> <span class="nf">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_Value</span><span class="p">]:</span>
</span><span id="SON-109"><a href="#SON-109"><span class="linenos">109</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SON-110"><a href="#SON-110"><span class="linenos">110</span></a>            <span class="k">yield</span> <span class="n">v</span>
</span><span id="SON-111"><a href="#SON-111"><span class="linenos">111</span></a>
</span><span id="SON-112"><a href="#SON-112"><span class="linenos">112</span></a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">_Value</span><span class="p">]:</span>  <span class="c1"># type: ignore[override]</span>
</span><span id="SON-113"><a href="#SON-113"><span class="linenos">113</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
</span><span id="SON-114"><a href="#SON-114"><span class="linenos">114</span></a>
</span><span id="SON-115"><a href="#SON-115"><span class="linenos">115</span></a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SON-116"><a href="#SON-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__keys</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SON-117"><a href="#SON-117"><span class="linenos">117</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">SON</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span><span id="SON-118"><a href="#SON-118"><span class="linenos">118</span></a>
</span><span id="SON-119"><a href="#SON-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">_Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Value</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
</span><span id="SON-120"><a href="#SON-120"><span class="linenos">120</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SON-121"><a href="#SON-121"><span class="linenos">121</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="SON-122"><a href="#SON-122"><span class="linenos">122</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="SON-123"><a href="#SON-123"><span class="linenos">123</span></a>            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span>
</span><span id="SON-124"><a href="#SON-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="n">default</span>
</span><span id="SON-125"><a href="#SON-125"><span class="linenos">125</span></a>
</span><span id="SON-126"><a href="#SON-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_Key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_Value</span><span class="p">,</span> <span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">_Value</span><span class="p">,</span> <span class="n">_T</span><span class="p">]:</span>
</span><span id="SON-127"><a href="#SON-127"><span class="linenos">127</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SON-128"><a href="#SON-128"><span class="linenos">128</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;pop expected at most 2 arguments, got &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)))</span>
</span><span id="SON-129"><a href="#SON-129"><span class="linenos">129</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SON-130"><a href="#SON-130"><span class="linenos">130</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="SON-131"><a href="#SON-131"><span class="linenos">131</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="SON-132"><a href="#SON-132"><span class="linenos">132</span></a>            <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
</span><span id="SON-133"><a href="#SON-133"><span class="linenos">133</span></a>                <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SON-134"><a href="#SON-134"><span class="linenos">134</span></a>            <span class="k">raise</span>
</span><span id="SON-135"><a href="#SON-135"><span class="linenos">135</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="SON-136"><a href="#SON-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="n">value</span>
</span><span id="SON-137"><a href="#SON-137"><span class="linenos">137</span></a>
</span><span id="SON-138"><a href="#SON-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">popitem</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_Key</span><span class="p">,</span> <span class="n">_Value</span><span class="p">]:</span>
</span><span id="SON-139"><a href="#SON-139"><span class="linenos">139</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SON-140"><a href="#SON-140"><span class="linenos">140</span></a>            <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</span><span id="SON-141"><a href="#SON-141"><span class="linenos">141</span></a>        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
</span><span id="SON-142"><a href="#SON-142"><span class="linenos">142</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;container is empty&quot;</span><span class="p">)</span>
</span><span id="SON-143"><a href="#SON-143"><span class="linenos">143</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="SON-144"><a href="#SON-144"><span class="linenos">144</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="SON-145"><a href="#SON-145"><span class="linenos">145</span></a>
</span><span id="SON-146"><a href="#SON-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
</span><span id="SON-147"><a href="#SON-147"><span class="linenos">147</span></a>        <span class="c1"># Make progressively weaker assumptions about &quot;other&quot;</span>
</span><span id="SON-148"><a href="#SON-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SON-149"><a href="#SON-149"><span class="linenos">149</span></a>            <span class="k">pass</span>
</span><span id="SON-150"><a href="#SON-150"><span class="linenos">150</span></a>        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;items&quot;</span><span class="p">):</span>
</span><span id="SON-151"><a href="#SON-151"><span class="linenos">151</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SON-152"><a href="#SON-152"><span class="linenos">152</span></a>                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="SON-153"><a href="#SON-153"><span class="linenos">153</span></a>        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;keys&quot;</span><span class="p">):</span>
</span><span id="SON-154"><a href="#SON-154"><span class="linenos">154</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="SON-155"><a href="#SON-155"><span class="linenos">155</span></a>                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">other</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="SON-156"><a href="#SON-156"><span class="linenos">156</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SON-157"><a href="#SON-157"><span class="linenos">157</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
</span><span id="SON-158"><a href="#SON-158"><span class="linenos">158</span></a>                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="SON-159"><a href="#SON-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SON-160"><a href="#SON-160"><span class="linenos">160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="SON-161"><a href="#SON-161"><span class="linenos">161</span></a>
</span><span id="SON-162"><a href="#SON-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">_Value</span><span class="p">,</span> <span class="n">_T</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">_Value</span><span class="p">,</span> <span class="n">_T</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>  <span class="c1"># type: ignore[override]</span>
</span><span id="SON-163"><a href="#SON-163"><span class="linenos">163</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SON-164"><a href="#SON-164"><span class="linenos">164</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="SON-165"><a href="#SON-165"><span class="linenos">165</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="SON-166"><a href="#SON-166"><span class="linenos">166</span></a>            <span class="k">return</span> <span class="n">default</span>
</span><span id="SON-167"><a href="#SON-167"><span class="linenos">167</span></a>
</span><span id="SON-168"><a href="#SON-168"><span class="linenos">168</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SON-169"><a href="#SON-169"><span class="linenos">169</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Comparison to another SON is order-sensitive while comparison to a</span>
</span><span id="SON-170"><a href="#SON-170"><span class="linenos">170</span></a><span class="sd">        regular dictionary is order-insensitive.</span>
</span><span id="SON-171"><a href="#SON-171"><span class="linenos">171</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SON-172"><a href="#SON-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">SON</span><span class="p">):</span>
</span><span id="SON-173"><a href="#SON-173"><span class="linenos">173</span></a>            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="SON-174"><a href="#SON-174"><span class="linenos">174</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="SON-175"><a href="#SON-175"><span class="linenos">175</span></a>
</span><span id="SON-176"><a href="#SON-176"><span class="linenos">176</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SON-177"><a href="#SON-177"><span class="linenos">177</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="SON-178"><a href="#SON-178"><span class="linenos">178</span></a>
</span><span id="SON-179"><a href="#SON-179"><span class="linenos">179</span></a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="SON-180"><a href="#SON-180"><span class="linenos">180</span></a>        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__keys</span><span class="p">)</span>
</span><span id="SON-181"><a href="#SON-181"><span class="linenos">181</span></a>
</span><span id="SON-182"><a href="#SON-182"><span class="linenos">182</span></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">_Key</span><span class="p">,</span> <span class="n">_Value</span><span class="p">]:</span>
</span><span id="SON-183"><a href="#SON-183"><span class="linenos">183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a SON document to a normal Python dictionary instance.</span>
</span><span id="SON-184"><a href="#SON-184"><span class="linenos">184</span></a>
</span><span id="SON-185"><a href="#SON-185"><span class="linenos">185</span></a><span class="sd">        This is trickier than just *dict(...)* because it needs to be</span>
</span><span id="SON-186"><a href="#SON-186"><span class="linenos">186</span></a><span class="sd">        recursive.</span>
</span><span id="SON-187"><a href="#SON-187"><span class="linenos">187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SON-188"><a href="#SON-188"><span class="linenos">188</span></a>
</span><span id="SON-189"><a href="#SON-189"><span class="linenos">189</span></a>        <span class="k">def</span> <span class="nf">transform_value</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="SON-190"><a href="#SON-190"><span class="linenos">190</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="SON-191"><a href="#SON-191"><span class="linenos">191</span></a>                <span class="k">return</span> <span class="p">[</span><span class="n">transform_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
</span><span id="SON-192"><a href="#SON-192"><span class="linenos">192</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">_Mapping</span><span class="p">):</span>
</span><span id="SON-193"><a href="#SON-193"><span class="linenos">193</span></a>                <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">transform_value</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="SON-194"><a href="#SON-194"><span class="linenos">194</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SON-195"><a href="#SON-195"><span class="linenos">195</span></a>                <span class="k">return</span> <span class="n">value</span>
</span><span id="SON-196"><a href="#SON-196"><span class="linenos">196</span></a>
</span><span id="SON-197"><a href="#SON-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="n">transform_value</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span id="SON-198"><a href="#SON-198"><span class="linenos">198</span></a>
</span><span id="SON-199"><a href="#SON-199"><span class="linenos">199</span></a>    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="s2">&quot;SON[_Key, _Value]&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;SON[_Key, _Value]&quot;</span><span class="p">:</span>
</span><span id="SON-200"><a href="#SON-200"><span class="linenos">200</span></a>        <span class="n">out</span><span class="p">:</span> <span class="n">SON</span><span class="p">[</span><span class="n">_Key</span><span class="p">,</span> <span class="n">_Value</span><span class="p">]</span> <span class="o">=</span> <span class="n">SON</span><span class="p">()</span>
</span><span id="SON-201"><a href="#SON-201"><span class="linenos">201</span></a>        <span class="n">val_id</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="SON-202"><a href="#SON-202"><span class="linenos">202</span></a>        <span class="k">if</span> <span class="n">val_id</span> <span class="ow">in</span> <span class="n">memo</span><span class="p">:</span>
</span><span id="SON-203"><a href="#SON-203"><span class="linenos">203</span></a>            <span class="k">return</span> <span class="n">memo</span><span class="p">[</span><span class="n">val_id</span><span class="p">]</span>
</span><span id="SON-204"><a href="#SON-204"><span class="linenos">204</span></a>        <span class="n">memo</span><span class="p">[</span><span class="n">val_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
</span><span id="SON-205"><a href="#SON-205"><span class="linenos">205</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SON-206"><a href="#SON-206"><span class="linenos">206</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">RE_TYPE</span><span class="p">):</span>
</span><span id="SON-207"><a href="#SON-207"><span class="linenos">207</span></a>                <span class="n">v</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">memo</span><span class="p">)</span>
</span><span id="SON-208"><a href="#SON-208"><span class="linenos">208</span></a>            <span class="n">out</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="SON-209"><a href="#SON-209"><span class="linenos">209</span></a>        <span class="k">return</span> <span class="n">out</span>
</span></pre></div>


            <div class="docstring"><p>SON data.</p>

<p>A subclass of dict that maintains ordering of keys and provides a
few extra niceties for dealing with SON. SON provides an API
similar to collections.OrderedDict.</p>
</div>


                            <div id="SON.copy" class="classattr">
                                        <input id="SON.copy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">copy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n"><a href="#SON">xtquant.xtbson.bson37.SON</a></span><span class="p">[</span><span class="o">~</span><span class="n">_Key</span><span class="p">,</span> <span class="o">~</span><span class="n">_Value</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SON.copy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SON.copy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SON.copy-89"><a href="#SON.copy-89"><span class="linenos">89</span></a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SON[_Key, _Value]&quot;</span><span class="p">:</span>
</span><span id="SON.copy-90"><a href="#SON.copy-90"><span class="linenos">90</span></a>        <span class="n">other</span><span class="p">:</span> <span class="n">SON</span><span class="p">[</span><span class="n">_Key</span><span class="p">,</span> <span class="n">_Value</span><span class="p">]</span> <span class="o">=</span> <span class="n">SON</span><span class="p">()</span>
</span><span id="SON.copy-91"><a href="#SON.copy-91"><span class="linenos">91</span></a>        <span class="n">other</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="SON.copy-92"><a href="#SON.copy-92"><span class="linenos">92</span></a>        <span class="k">return</span> <span class="n">other</span>
</span></pre></div>


            <div class="docstring"><p>D.copy() -> a shallow copy of D</p>
</div>


                            </div>
                            <div id="SON.has_key" class="classattr">
                                        <input id="SON.has_key-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">has_key</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">key</span><span class="p">:</span> <span class="o">~</span><span class="n">_Key</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="SON.has_key-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SON.has_key"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SON.has_key-101"><a href="#SON.has_key-101"><span class="linenos">101</span></a>    <span class="k">def</span> <span class="nf">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_Key</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="SON.has_key-102"><a href="#SON.has_key-102"><span class="linenos">102</span></a>        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__keys</span>
</span></pre></div>


    

                            </div>
                            <div id="SON.iterkeys" class="classattr">
                                        <input id="SON.iterkeys-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">iterkeys</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Iterator</span><span class="p">[</span><span class="o">~</span><span class="n">_Key</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SON.iterkeys-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SON.iterkeys"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SON.iterkeys-104"><a href="#SON.iterkeys-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_Key</span><span class="p">]:</span>
</span><span id="SON.iterkeys-105"><a href="#SON.iterkeys-105"><span class="linenos">105</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">()</span>
</span></pre></div>


    

                            </div>
                            <div id="SON.itervalues" class="classattr">
                                        <input id="SON.itervalues-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">itervalues</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Iterator</span><span class="p">[</span><span class="o">~</span><span class="n">_Value</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SON.itervalues-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SON.itervalues"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SON.itervalues-108"><a href="#SON.itervalues-108"><span class="linenos">108</span></a>    <span class="k">def</span> <span class="nf">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_Value</span><span class="p">]:</span>
</span><span id="SON.itervalues-109"><a href="#SON.itervalues-109"><span class="linenos">109</span></a>        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SON.itervalues-110"><a href="#SON.itervalues-110"><span class="linenos">110</span></a>            <span class="k">yield</span> <span class="n">v</span>
</span></pre></div>


    

                            </div>
                            <div id="SON.values" class="classattr">
                                        <input id="SON.values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="o">~</span><span class="n">_Value</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SON.values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SON.values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SON.values-112"><a href="#SON.values-112"><span class="linenos">112</span></a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">_Value</span><span class="p">]:</span>  <span class="c1"># type: ignore[override]</span>
</span><span id="SON.values-113"><a href="#SON.values-113"><span class="linenos">113</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
</span></pre></div>


            <div class="docstring"><p>D.values() -> an object providing a view on D's values</p>
</div>


                            </div>
                            <div id="SON.clear" class="classattr">
                                        <input id="SON.clear-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clear</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="SON.clear-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SON.clear"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SON.clear-115"><a href="#SON.clear-115"><span class="linenos">115</span></a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SON.clear-116"><a href="#SON.clear-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__keys</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="SON.clear-117"><a href="#SON.clear-117"><span class="linenos">117</span></a>        <span class="nb">super</span><span class="p">(</span><span class="n">SON</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>D.clear() -> None.  Remove all items from D.</p>
</div>


                            </div>
                            <div id="SON.setdefault" class="classattr">
                                        <input id="SON.setdefault-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setdefault</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">key</span><span class="p">:</span> <span class="o">~</span><span class="n">_Key</span>, </span><span class="param"><span class="n">default</span><span class="p">:</span> <span class="o">~</span><span class="n">_Value</span></span><span class="return-annotation">) -> <span class="o">~</span><span class="n">_Value</span>:</span></span>

                <label class="view-source-button" for="SON.setdefault-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SON.setdefault"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SON.setdefault-119"><a href="#SON.setdefault-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">_Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Value</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
</span><span id="SON.setdefault-120"><a href="#SON.setdefault-120"><span class="linenos">120</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SON.setdefault-121"><a href="#SON.setdefault-121"><span class="linenos">121</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="SON.setdefault-122"><a href="#SON.setdefault-122"><span class="linenos">122</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="SON.setdefault-123"><a href="#SON.setdefault-123"><span class="linenos">123</span></a>            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span>
</span><span id="SON.setdefault-124"><a href="#SON.setdefault-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="n">default</span>
</span></pre></div>


            <div class="docstring"><p>Insert key with a value of default if key is not in the dictionary.</p>

<p>Return the value for key if key is in the dictionary, else default.</p>
</div>


                            </div>
                            <div id="SON.pop" class="classattr">
                                        <input id="SON.pop-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pop</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">key</span><span class="p">:</span> <span class="o">~</span><span class="n">_Key</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">_Value</span><span class="p">,</span> <span class="o">~</span><span class="n">_T</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">_Value</span><span class="p">,</span> <span class="o">~</span><span class="n">_T</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SON.pop-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SON.pop"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SON.pop-126"><a href="#SON.pop-126"><span class="linenos">126</span></a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_Key</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">_Value</span><span class="p">,</span> <span class="n">_T</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">_Value</span><span class="p">,</span> <span class="n">_T</span><span class="p">]:</span>
</span><span id="SON.pop-127"><a href="#SON.pop-127"><span class="linenos">127</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="SON.pop-128"><a href="#SON.pop-128"><span class="linenos">128</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;pop expected at most 2 arguments, got &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)))</span>
</span><span id="SON.pop-129"><a href="#SON.pop-129"><span class="linenos">129</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SON.pop-130"><a href="#SON.pop-130"><span class="linenos">130</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="SON.pop-131"><a href="#SON.pop-131"><span class="linenos">131</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="SON.pop-132"><a href="#SON.pop-132"><span class="linenos">132</span></a>            <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
</span><span id="SON.pop-133"><a href="#SON.pop-133"><span class="linenos">133</span></a>                <span class="k">return</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="SON.pop-134"><a href="#SON.pop-134"><span class="linenos">134</span></a>            <span class="k">raise</span>
</span><span id="SON.pop-135"><a href="#SON.pop-135"><span class="linenos">135</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="SON.pop-136"><a href="#SON.pop-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="n">value</span>
</span></pre></div>


            <div class="docstring"><p>D.pop(k[,d]) -> v, remove specified key and return the corresponding value.</p>

<p>If the key is not found, return the default if given; otherwise,
raise a KeyError.</p>
</div>


                            </div>
                            <div id="SON.popitem" class="classattr">
                                        <input id="SON.popitem-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">popitem</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="o">~</span><span class="n">_Key</span><span class="p">,</span> <span class="o">~</span><span class="n">_Value</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SON.popitem-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SON.popitem"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SON.popitem-138"><a href="#SON.popitem-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">popitem</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_Key</span><span class="p">,</span> <span class="n">_Value</span><span class="p">]:</span>
</span><span id="SON.popitem-139"><a href="#SON.popitem-139"><span class="linenos">139</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SON.popitem-140"><a href="#SON.popitem-140"><span class="linenos">140</span></a>            <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
</span><span id="SON.popitem-141"><a href="#SON.popitem-141"><span class="linenos">141</span></a>        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
</span><span id="SON.popitem-142"><a href="#SON.popitem-142"><span class="linenos">142</span></a>            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;container is empty&quot;</span><span class="p">)</span>
</span><span id="SON.popitem-143"><a href="#SON.popitem-143"><span class="linenos">143</span></a>        <span class="k">del</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="SON.popitem-144"><a href="#SON.popitem-144"><span class="linenos">144</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Remove and return a (key, value) pair as a 2-tuple.</p>

<p>Pairs are returned in LIFO (last-in, first-out) order.
Raises KeyError if the dict is empty.</p>
</div>


                            </div>
                            <div id="SON.update" class="classattr">
                                        <input id="SON.update-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">update</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">other</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="o">~</span><span class="n">_Value</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="SON.update-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SON.update"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SON.update-146"><a href="#SON.update-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">_Value</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
</span><span id="SON.update-147"><a href="#SON.update-147"><span class="linenos">147</span></a>        <span class="c1"># Make progressively weaker assumptions about &quot;other&quot;</span>
</span><span id="SON.update-148"><a href="#SON.update-148"><span class="linenos">148</span></a>        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SON.update-149"><a href="#SON.update-149"><span class="linenos">149</span></a>            <span class="k">pass</span>
</span><span id="SON.update-150"><a href="#SON.update-150"><span class="linenos">150</span></a>        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;items&quot;</span><span class="p">):</span>
</span><span id="SON.update-151"><a href="#SON.update-151"><span class="linenos">151</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="SON.update-152"><a href="#SON.update-152"><span class="linenos">152</span></a>                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="SON.update-153"><a href="#SON.update-153"><span class="linenos">153</span></a>        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s2">&quot;keys&quot;</span><span class="p">):</span>
</span><span id="SON.update-154"><a href="#SON.update-154"><span class="linenos">154</span></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="SON.update-155"><a href="#SON.update-155"><span class="linenos">155</span></a>                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">other</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="SON.update-156"><a href="#SON.update-156"><span class="linenos">156</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="SON.update-157"><a href="#SON.update-157"><span class="linenos">157</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
</span><span id="SON.update-158"><a href="#SON.update-158"><span class="linenos">158</span></a>                <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="SON.update-159"><a href="#SON.update-159"><span class="linenos">159</span></a>        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="SON.update-160"><a href="#SON.update-160"><span class="linenos">160</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>D.update([E, ]**F) -> None.  Update D from dict/iterable E and F.
If E is present and has a .keys() method, then does:  for k in E: D[k] = E[k]
If E is present and lacks a .keys() method, then does:  for k, v in E: D[k] = v
In either case, this is followed by: for k in F:  D[k] = F[k]</p>
</div>


                            </div>
                            <div id="SON.get" class="classattr">
                                        <input id="SON.get-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">key</span><span class="p">:</span> <span class="o">~</span><span class="n">_Key</span>,</span><span class="param">	<span class="n">default</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">_Value</span><span class="p">,</span> <span class="o">~</span><span class="n">_T</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="o">~</span><span class="n">_Value</span><span class="p">,</span> <span class="o">~</span><span class="n">_T</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SON.get-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SON.get"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SON.get-162"><a href="#SON.get-162"><span class="linenos">162</span></a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">_Key</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">_Value</span><span class="p">,</span> <span class="n">_T</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">_Value</span><span class="p">,</span> <span class="n">_T</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>  <span class="c1"># type: ignore[override]</span>
</span><span id="SON.get-163"><a href="#SON.get-163"><span class="linenos">163</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="SON.get-164"><a href="#SON.get-164"><span class="linenos">164</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span><span id="SON.get-165"><a href="#SON.get-165"><span class="linenos">165</span></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="SON.get-166"><a href="#SON.get-166"><span class="linenos">166</span></a>            <span class="k">return</span> <span class="n">default</span>
</span></pre></div>


            <div class="docstring"><p>Return the value for key if key is in the dictionary, else default.</p>
</div>


                            </div>
                            <div id="SON.to_dict" class="classattr">
                                        <input id="SON.to_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="o">~</span><span class="n">_Key</span><span class="p">,</span> <span class="o">~</span><span class="n">_Value</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="SON.to_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SON.to_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SON.to_dict-182"><a href="#SON.to_dict-182"><span class="linenos">182</span></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">_Key</span><span class="p">,</span> <span class="n">_Value</span><span class="p">]:</span>
</span><span id="SON.to_dict-183"><a href="#SON.to_dict-183"><span class="linenos">183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a SON document to a normal Python dictionary instance.</span>
</span><span id="SON.to_dict-184"><a href="#SON.to_dict-184"><span class="linenos">184</span></a>
</span><span id="SON.to_dict-185"><a href="#SON.to_dict-185"><span class="linenos">185</span></a><span class="sd">        This is trickier than just *dict(...)* because it needs to be</span>
</span><span id="SON.to_dict-186"><a href="#SON.to_dict-186"><span class="linenos">186</span></a><span class="sd">        recursive.</span>
</span><span id="SON.to_dict-187"><a href="#SON.to_dict-187"><span class="linenos">187</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="SON.to_dict-188"><a href="#SON.to_dict-188"><span class="linenos">188</span></a>
</span><span id="SON.to_dict-189"><a href="#SON.to_dict-189"><span class="linenos">189</span></a>        <span class="k">def</span> <span class="nf">transform_value</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="SON.to_dict-190"><a href="#SON.to_dict-190"><span class="linenos">190</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="SON.to_dict-191"><a href="#SON.to_dict-191"><span class="linenos">191</span></a>                <span class="k">return</span> <span class="p">[</span><span class="n">transform_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
</span><span id="SON.to_dict-192"><a href="#SON.to_dict-192"><span class="linenos">192</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">_Mapping</span><span class="p">):</span>
</span><span id="SON.to_dict-193"><a href="#SON.to_dict-193"><span class="linenos">193</span></a>                <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">transform_value</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
</span><span id="SON.to_dict-194"><a href="#SON.to_dict-194"><span class="linenos">194</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="SON.to_dict-195"><a href="#SON.to_dict-195"><span class="linenos">195</span></a>                <span class="k">return</span> <span class="n">value</span>
</span><span id="SON.to_dict-196"><a href="#SON.to_dict-196"><span class="linenos">196</span></a>
</span><span id="SON.to_dict-197"><a href="#SON.to_dict-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="n">transform_value</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Convert a SON document to a normal Python dictionary instance.</p>

<p>This is trickier than just <em>dict(...)</em> because it needs to be
recursive.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.dict</dt>
                                <dd id="SON.keys" class="function">keys</dd>
                <dd id="SON.items" class="function">items</dd>
                <dd id="SON.fromkeys" class="function">fromkeys</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Timestamp">
                            <input id="Timestamp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Timestamp</span>:

                <label class="view-source-button" for="Timestamp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Timestamp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Timestamp-29"><a href="#Timestamp-29"><span class="linenos"> 29</span></a><span class="k">class</span> <span class="nc">Timestamp</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="Timestamp-30"><a href="#Timestamp-30"><span class="linenos"> 30</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;MongoDB internal timestamps used in the opLog.&quot;&quot;&quot;</span>
</span><span id="Timestamp-31"><a href="#Timestamp-31"><span class="linenos"> 31</span></a>
</span><span id="Timestamp-32"><a href="#Timestamp-32"><span class="linenos"> 32</span></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;__time&quot;</span><span class="p">,</span> <span class="s2">&quot;__inc&quot;</span><span class="p">)</span>
</span><span id="Timestamp-33"><a href="#Timestamp-33"><span class="linenos"> 33</span></a>
</span><span id="Timestamp-34"><a href="#Timestamp-34"><span class="linenos"> 34</span></a>    <span class="n">__getstate__</span> <span class="o">=</span> <span class="n">_getstate_slots</span>
</span><span id="Timestamp-35"><a href="#Timestamp-35"><span class="linenos"> 35</span></a>    <span class="n">__setstate__</span> <span class="o">=</span> <span class="n">_setstate_slots</span>
</span><span id="Timestamp-36"><a href="#Timestamp-36"><span class="linenos"> 36</span></a>
</span><span id="Timestamp-37"><a href="#Timestamp-37"><span class="linenos"> 37</span></a>    <span class="n">_type_marker</span> <span class="o">=</span> <span class="mi">17</span>
</span><span id="Timestamp-38"><a href="#Timestamp-38"><span class="linenos"> 38</span></a>
</span><span id="Timestamp-39"><a href="#Timestamp-39"><span class="linenos"> 39</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">inc</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Timestamp-40"><a href="#Timestamp-40"><span class="linenos"> 40</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new :class:`Timestamp`.</span>
</span><span id="Timestamp-41"><a href="#Timestamp-41"><span class="linenos"> 41</span></a>
</span><span id="Timestamp-42"><a href="#Timestamp-42"><span class="linenos"> 42</span></a><span class="sd">        This class is only for use with the MongoDB opLog. If you need</span>
</span><span id="Timestamp-43"><a href="#Timestamp-43"><span class="linenos"> 43</span></a><span class="sd">        to store a regular timestamp, please use a</span>
</span><span id="Timestamp-44"><a href="#Timestamp-44"><span class="linenos"> 44</span></a><span class="sd">        :class:`~datetime.datetime`.</span>
</span><span id="Timestamp-45"><a href="#Timestamp-45"><span class="linenos"> 45</span></a>
</span><span id="Timestamp-46"><a href="#Timestamp-46"><span class="linenos"> 46</span></a><span class="sd">        Raises :class:`TypeError` if `time` is not an instance of</span>
</span><span id="Timestamp-47"><a href="#Timestamp-47"><span class="linenos"> 47</span></a><span class="sd">        :class: `int` or :class:`~datetime.datetime`, or `inc` is not</span>
</span><span id="Timestamp-48"><a href="#Timestamp-48"><span class="linenos"> 48</span></a><span class="sd">        an instance of :class:`int`. Raises :class:`ValueError` if</span>
</span><span id="Timestamp-49"><a href="#Timestamp-49"><span class="linenos"> 49</span></a><span class="sd">        `time` or `inc` is not in [0, 2**32).</span>
</span><span id="Timestamp-50"><a href="#Timestamp-50"><span class="linenos"> 50</span></a>
</span><span id="Timestamp-51"><a href="#Timestamp-51"><span class="linenos"> 51</span></a><span class="sd">        :Parameters:</span>
</span><span id="Timestamp-52"><a href="#Timestamp-52"><span class="linenos"> 52</span></a><span class="sd">          - `time`: time in seconds since epoch UTC, or a naive UTC</span>
</span><span id="Timestamp-53"><a href="#Timestamp-53"><span class="linenos"> 53</span></a><span class="sd">            :class:`~datetime.datetime`, or an aware</span>
</span><span id="Timestamp-54"><a href="#Timestamp-54"><span class="linenos"> 54</span></a><span class="sd">            :class:`~datetime.datetime`</span>
</span><span id="Timestamp-55"><a href="#Timestamp-55"><span class="linenos"> 55</span></a><span class="sd">          - `inc`: the incrementing counter</span>
</span><span id="Timestamp-56"><a href="#Timestamp-56"><span class="linenos"> 56</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Timestamp-57"><a href="#Timestamp-57"><span class="linenos"> 57</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
</span><span id="Timestamp-58"><a href="#Timestamp-58"><span class="linenos"> 58</span></a>            <span class="n">offset</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">()</span>
</span><span id="Timestamp-59"><a href="#Timestamp-59"><span class="linenos"> 59</span></a>            <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Timestamp-60"><a href="#Timestamp-60"><span class="linenos"> 60</span></a>                <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">-</span> <span class="n">offset</span>
</span><span id="Timestamp-61"><a href="#Timestamp-61"><span class="linenos"> 61</span></a>            <span class="n">time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()))</span>
</span><span id="Timestamp-62"><a href="#Timestamp-62"><span class="linenos"> 62</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Timestamp-63"><a href="#Timestamp-63"><span class="linenos"> 63</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;time must be an instance of int&quot;</span><span class="p">)</span>
</span><span id="Timestamp-64"><a href="#Timestamp-64"><span class="linenos"> 64</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inc</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Timestamp-65"><a href="#Timestamp-65"><span class="linenos"> 65</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;inc must be an instance of int&quot;</span><span class="p">)</span>
</span><span id="Timestamp-66"><a href="#Timestamp-66"><span class="linenos"> 66</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="n">UPPERBOUND</span><span class="p">:</span>
</span><span id="Timestamp-67"><a href="#Timestamp-67"><span class="linenos"> 67</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;time must be contained in [0, 2**32)&quot;</span><span class="p">)</span>
</span><span id="Timestamp-68"><a href="#Timestamp-68"><span class="linenos"> 68</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">inc</span> <span class="o">&lt;</span> <span class="n">UPPERBOUND</span><span class="p">:</span>
</span><span id="Timestamp-69"><a href="#Timestamp-69"><span class="linenos"> 69</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;inc must be contained in [0, 2**32)&quot;</span><span class="p">)</span>
</span><span id="Timestamp-70"><a href="#Timestamp-70"><span class="linenos"> 70</span></a>
</span><span id="Timestamp-71"><a href="#Timestamp-71"><span class="linenos"> 71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__time</span> <span class="o">=</span> <span class="n">time</span>
</span><span id="Timestamp-72"><a href="#Timestamp-72"><span class="linenos"> 72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__inc</span> <span class="o">=</span> <span class="n">inc</span>
</span><span id="Timestamp-73"><a href="#Timestamp-73"><span class="linenos"> 73</span></a>
</span><span id="Timestamp-74"><a href="#Timestamp-74"><span class="linenos"> 74</span></a>    <span class="nd">@property</span>
</span><span id="Timestamp-75"><a href="#Timestamp-75"><span class="linenos"> 75</span></a>    <span class="k">def</span> <span class="nf">time</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Timestamp-76"><a href="#Timestamp-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the time portion of this :class:`Timestamp`.&quot;&quot;&quot;</span>
</span><span id="Timestamp-77"><a href="#Timestamp-77"><span class="linenos"> 77</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__time</span>
</span><span id="Timestamp-78"><a href="#Timestamp-78"><span class="linenos"> 78</span></a>
</span><span id="Timestamp-79"><a href="#Timestamp-79"><span class="linenos"> 79</span></a>    <span class="nd">@property</span>
</span><span id="Timestamp-80"><a href="#Timestamp-80"><span class="linenos"> 80</span></a>    <span class="k">def</span> <span class="nf">inc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Timestamp-81"><a href="#Timestamp-81"><span class="linenos"> 81</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the inc portion of this :class:`Timestamp`.&quot;&quot;&quot;</span>
</span><span id="Timestamp-82"><a href="#Timestamp-82"><span class="linenos"> 82</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__inc</span>
</span><span id="Timestamp-83"><a href="#Timestamp-83"><span class="linenos"> 83</span></a>
</span><span id="Timestamp-84"><a href="#Timestamp-84"><span class="linenos"> 84</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Timestamp-85"><a href="#Timestamp-85"><span class="linenos"> 85</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Timestamp</span><span class="p">):</span>
</span><span id="Timestamp-86"><a href="#Timestamp-86"><span class="linenos"> 86</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__time</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">time</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__inc</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">inc</span>
</span><span id="Timestamp-87"><a href="#Timestamp-87"><span class="linenos"> 87</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Timestamp-88"><a href="#Timestamp-88"><span class="linenos"> 88</span></a>            <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Timestamp-89"><a href="#Timestamp-89"><span class="linenos"> 89</span></a>
</span><span id="Timestamp-90"><a href="#Timestamp-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Timestamp-91"><a href="#Timestamp-91"><span class="linenos"> 91</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">^</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inc</span><span class="p">)</span>
</span><span id="Timestamp-92"><a href="#Timestamp-92"><span class="linenos"> 92</span></a>
</span><span id="Timestamp-93"><a href="#Timestamp-93"><span class="linenos"> 93</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Timestamp-94"><a href="#Timestamp-94"><span class="linenos"> 94</span></a>        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span> <span class="o">==</span> <span class="n">other</span>
</span><span id="Timestamp-95"><a href="#Timestamp-95"><span class="linenos"> 95</span></a>
</span><span id="Timestamp-96"><a href="#Timestamp-96"><span class="linenos"> 96</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Timestamp-97"><a href="#Timestamp-97"><span class="linenos"> 97</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Timestamp</span><span class="p">):</span>
</span><span id="Timestamp-98"><a href="#Timestamp-98"><span class="linenos"> 98</span></a>            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inc</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">inc</span><span class="p">)</span>
</span><span id="Timestamp-99"><a href="#Timestamp-99"><span class="linenos"> 99</span></a>        <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Timestamp-100"><a href="#Timestamp-100"><span class="linenos">100</span></a>
</span><span id="Timestamp-101"><a href="#Timestamp-101"><span class="linenos">101</span></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Timestamp-102"><a href="#Timestamp-102"><span class="linenos">102</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Timestamp</span><span class="p">):</span>
</span><span id="Timestamp-103"><a href="#Timestamp-103"><span class="linenos">103</span></a>            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inc</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">inc</span><span class="p">)</span>
</span><span id="Timestamp-104"><a href="#Timestamp-104"><span class="linenos">104</span></a>        <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Timestamp-105"><a href="#Timestamp-105"><span class="linenos">105</span></a>
</span><span id="Timestamp-106"><a href="#Timestamp-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Timestamp-107"><a href="#Timestamp-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Timestamp</span><span class="p">):</span>
</span><span id="Timestamp-108"><a href="#Timestamp-108"><span class="linenos">108</span></a>            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">inc</span><span class="p">)</span>
</span><span id="Timestamp-109"><a href="#Timestamp-109"><span class="linenos">109</span></a>        <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Timestamp-110"><a href="#Timestamp-110"><span class="linenos">110</span></a>
</span><span id="Timestamp-111"><a href="#Timestamp-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Timestamp-112"><a href="#Timestamp-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Timestamp</span><span class="p">):</span>
</span><span id="Timestamp-113"><a href="#Timestamp-113"><span class="linenos">113</span></a>            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">inc</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">inc</span><span class="p">)</span>
</span><span id="Timestamp-114"><a href="#Timestamp-114"><span class="linenos">114</span></a>        <span class="k">return</span> <span class="bp">NotImplemented</span>
</span><span id="Timestamp-115"><a href="#Timestamp-115"><span class="linenos">115</span></a>
</span><span id="Timestamp-116"><a href="#Timestamp-116"><span class="linenos">116</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Timestamp-117"><a href="#Timestamp-117"><span class="linenos">117</span></a>        <span class="k">return</span> <span class="s2">&quot;Timestamp(</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__inc</span><span class="p">)</span>
</span><span id="Timestamp-118"><a href="#Timestamp-118"><span class="linenos">118</span></a>
</span><span id="Timestamp-119"><a href="#Timestamp-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">as_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
</span><span id="Timestamp-120"><a href="#Timestamp-120"><span class="linenos">120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a :class:`~datetime.datetime` instance corresponding</span>
</span><span id="Timestamp-121"><a href="#Timestamp-121"><span class="linenos">121</span></a><span class="sd">        to the time portion of this :class:`Timestamp`.</span>
</span><span id="Timestamp-122"><a href="#Timestamp-122"><span class="linenos">122</span></a>
</span><span id="Timestamp-123"><a href="#Timestamp-123"><span class="linenos">123</span></a><span class="sd">        The returned datetime&#39;s timezone is UTC.</span>
</span><span id="Timestamp-124"><a href="#Timestamp-124"><span class="linenos">124</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Timestamp-125"><a href="#Timestamp-125"><span class="linenos">125</span></a>        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__time</span><span class="p">,</span> <span class="n">utc</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>MongoDB internal timestamps used in the opLog.</p>
</div>


                            <div id="Timestamp.__init__" class="classattr">
                                        <input id="Timestamp.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Timestamp</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">time</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>, </span><span class="param"><span class="n">inc</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

                <label class="view-source-button" for="Timestamp.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Timestamp.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Timestamp.__init__-39"><a href="#Timestamp.__init__-39"><span class="linenos">39</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">inc</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Timestamp.__init__-40"><a href="#Timestamp.__init__-40"><span class="linenos">40</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a new :class:`Timestamp`.</span>
</span><span id="Timestamp.__init__-41"><a href="#Timestamp.__init__-41"><span class="linenos">41</span></a>
</span><span id="Timestamp.__init__-42"><a href="#Timestamp.__init__-42"><span class="linenos">42</span></a><span class="sd">        This class is only for use with the MongoDB opLog. If you need</span>
</span><span id="Timestamp.__init__-43"><a href="#Timestamp.__init__-43"><span class="linenos">43</span></a><span class="sd">        to store a regular timestamp, please use a</span>
</span><span id="Timestamp.__init__-44"><a href="#Timestamp.__init__-44"><span class="linenos">44</span></a><span class="sd">        :class:`~datetime.datetime`.</span>
</span><span id="Timestamp.__init__-45"><a href="#Timestamp.__init__-45"><span class="linenos">45</span></a>
</span><span id="Timestamp.__init__-46"><a href="#Timestamp.__init__-46"><span class="linenos">46</span></a><span class="sd">        Raises :class:`TypeError` if `time` is not an instance of</span>
</span><span id="Timestamp.__init__-47"><a href="#Timestamp.__init__-47"><span class="linenos">47</span></a><span class="sd">        :class: `int` or :class:`~datetime.datetime`, or `inc` is not</span>
</span><span id="Timestamp.__init__-48"><a href="#Timestamp.__init__-48"><span class="linenos">48</span></a><span class="sd">        an instance of :class:`int`. Raises :class:`ValueError` if</span>
</span><span id="Timestamp.__init__-49"><a href="#Timestamp.__init__-49"><span class="linenos">49</span></a><span class="sd">        `time` or `inc` is not in [0, 2**32).</span>
</span><span id="Timestamp.__init__-50"><a href="#Timestamp.__init__-50"><span class="linenos">50</span></a>
</span><span id="Timestamp.__init__-51"><a href="#Timestamp.__init__-51"><span class="linenos">51</span></a><span class="sd">        :Parameters:</span>
</span><span id="Timestamp.__init__-52"><a href="#Timestamp.__init__-52"><span class="linenos">52</span></a><span class="sd">          - `time`: time in seconds since epoch UTC, or a naive UTC</span>
</span><span id="Timestamp.__init__-53"><a href="#Timestamp.__init__-53"><span class="linenos">53</span></a><span class="sd">            :class:`~datetime.datetime`, or an aware</span>
</span><span id="Timestamp.__init__-54"><a href="#Timestamp.__init__-54"><span class="linenos">54</span></a><span class="sd">            :class:`~datetime.datetime`</span>
</span><span id="Timestamp.__init__-55"><a href="#Timestamp.__init__-55"><span class="linenos">55</span></a><span class="sd">          - `inc`: the incrementing counter</span>
</span><span id="Timestamp.__init__-56"><a href="#Timestamp.__init__-56"><span class="linenos">56</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Timestamp.__init__-57"><a href="#Timestamp.__init__-57"><span class="linenos">57</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
</span><span id="Timestamp.__init__-58"><a href="#Timestamp.__init__-58"><span class="linenos">58</span></a>            <span class="n">offset</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">utcoffset</span><span class="p">()</span>
</span><span id="Timestamp.__init__-59"><a href="#Timestamp.__init__-59"><span class="linenos">59</span></a>            <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Timestamp.__init__-60"><a href="#Timestamp.__init__-60"><span class="linenos">60</span></a>                <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">-</span> <span class="n">offset</span>
</span><span id="Timestamp.__init__-61"><a href="#Timestamp.__init__-61"><span class="linenos">61</span></a>            <span class="n">time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()))</span>
</span><span id="Timestamp.__init__-62"><a href="#Timestamp.__init__-62"><span class="linenos">62</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Timestamp.__init__-63"><a href="#Timestamp.__init__-63"><span class="linenos">63</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;time must be an instance of int&quot;</span><span class="p">)</span>
</span><span id="Timestamp.__init__-64"><a href="#Timestamp.__init__-64"><span class="linenos">64</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inc</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="Timestamp.__init__-65"><a href="#Timestamp.__init__-65"><span class="linenos">65</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;inc must be an instance of int&quot;</span><span class="p">)</span>
</span><span id="Timestamp.__init__-66"><a href="#Timestamp.__init__-66"><span class="linenos">66</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">time</span> <span class="o">&lt;</span> <span class="n">UPPERBOUND</span><span class="p">:</span>
</span><span id="Timestamp.__init__-67"><a href="#Timestamp.__init__-67"><span class="linenos">67</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;time must be contained in [0, 2**32)&quot;</span><span class="p">)</span>
</span><span id="Timestamp.__init__-68"><a href="#Timestamp.__init__-68"><span class="linenos">68</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">inc</span> <span class="o">&lt;</span> <span class="n">UPPERBOUND</span><span class="p">:</span>
</span><span id="Timestamp.__init__-69"><a href="#Timestamp.__init__-69"><span class="linenos">69</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;inc must be contained in [0, 2**32)&quot;</span><span class="p">)</span>
</span><span id="Timestamp.__init__-70"><a href="#Timestamp.__init__-70"><span class="linenos">70</span></a>
</span><span id="Timestamp.__init__-71"><a href="#Timestamp.__init__-71"><span class="linenos">71</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__time</span> <span class="o">=</span> <span class="n">time</span>
</span><span id="Timestamp.__init__-72"><a href="#Timestamp.__init__-72"><span class="linenos">72</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__inc</span> <span class="o">=</span> <span class="n">inc</span>
</span></pre></div>


            <div class="docstring"><p>Create a new <code><a href="#Timestamp">Timestamp</a></code>.</p>

<p>This class is only for use with the MongoDB opLog. If you need
to store a regular timestamp, please use a
<code>~datetime.datetime</code>.</p>

<p>Raises <code>TypeError</code> if <code><a href="#Timestamp.time">time</a></code> is not an instance of
:class: <code>int</code> or <code>~datetime.datetime</code>, or <code><a href="#Timestamp.inc">inc</a></code> is not
an instance of <code>int</code>. Raises <code>ValueError</code> if
<code><a href="#Timestamp.time">time</a></code> or <code><a href="#Timestamp.inc">inc</a></code> is not in [0, 2**32).</p>

<p>:Parameters:</p>

<ul>
<li><code><a href="#Timestamp.time">time</a></code>: time in seconds since epoch UTC, or a naive UTC
<code>~datetime.datetime</code>, or an aware
<code>~datetime.datetime</code></li>
<li><code><a href="#Timestamp.inc">inc</a></code>: the incrementing counter</li>
</ul>
</div>


                            </div>
                            <div id="Timestamp.time" class="classattr">
                                <div class="attr variable">
            <span class="name">time</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Timestamp.time"></a>
    
            <div class="docstring"><p>Get the time portion of this <code><a href="#Timestamp">Timestamp</a></code>.</p>
</div>


                            </div>
                            <div id="Timestamp.inc" class="classattr">
                                <div class="attr variable">
            <span class="name">inc</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Timestamp.inc"></a>
    
            <div class="docstring"><p>Get the inc portion of this <code><a href="#Timestamp">Timestamp</a></code>.</p>
</div>


                            </div>
                            <div id="Timestamp.as_datetime" class="classattr">
                                        <input id="Timestamp.as_datetime-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">as_datetime</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>:</span></span>

                <label class="view-source-button" for="Timestamp.as_datetime-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Timestamp.as_datetime"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Timestamp.as_datetime-119"><a href="#Timestamp.as_datetime-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="nf">as_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
</span><span id="Timestamp.as_datetime-120"><a href="#Timestamp.as_datetime-120"><span class="linenos">120</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a :class:`~datetime.datetime` instance corresponding</span>
</span><span id="Timestamp.as_datetime-121"><a href="#Timestamp.as_datetime-121"><span class="linenos">121</span></a><span class="sd">        to the time portion of this :class:`Timestamp`.</span>
</span><span id="Timestamp.as_datetime-122"><a href="#Timestamp.as_datetime-122"><span class="linenos">122</span></a>
</span><span id="Timestamp.as_datetime-123"><a href="#Timestamp.as_datetime-123"><span class="linenos">123</span></a><span class="sd">        The returned datetime&#39;s timezone is UTC.</span>
</span><span id="Timestamp.as_datetime-124"><a href="#Timestamp.as_datetime-124"><span class="linenos">124</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Timestamp.as_datetime-125"><a href="#Timestamp.as_datetime-125"><span class="linenos">125</span></a>        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__time</span><span class="p">,</span> <span class="n">utc</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return a <code>~datetime.datetime</code> instance corresponding
to the time portion of this <code><a href="#Timestamp">Timestamp</a></code>.</p>

<p>The returned datetime's timezone is UTC.</p>
</div>


                            </div>
                </section>
                <section id="utc">
                    <div class="attr variable">
            <span class="name">utc</span>        =
<span class="default_value">&lt;xtquant.xtbson.bson37.tz_util.FixedOffset object&gt;</span>

        
    </div>
    <a class="headerlink" href="#utc"></a>
    
    

                </section>
                <section id="EPOCH_AWARE">
                    <div class="attr variable">
            <span class="name">EPOCH_AWARE</span>        =
<span class="default_value">datetime.datetime(1970, 1, 1, 0, 0, tzinfo=&lt;xtquant.xtbson.bson37.tz_util.FixedOffset object&gt;)</span>

        
    </div>
    <a class="headerlink" href="#EPOCH_AWARE"></a>
    
    

                </section>
                <section id="EPOCH_NAIVE">
                    <div class="attr variable">
            <span class="name">EPOCH_NAIVE</span>        =
<span class="default_value">datetime.datetime(1970, 1, 1, 0, 0)</span>

        
    </div>
    <a class="headerlink" href="#EPOCH_NAIVE"></a>
    
    

                </section>
                <section id="BSONNUM">
                    <div class="attr variable">
            <span class="name">BSONNUM</span>        =
<span class="default_value">b&#39;\x01&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONNUM"></a>
    
    

                </section>
                <section id="BSONSTR">
                    <div class="attr variable">
            <span class="name">BSONSTR</span>        =
<span class="default_value">b&#39;\x02&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONSTR"></a>
    
    

                </section>
                <section id="BSONOBJ">
                    <div class="attr variable">
            <span class="name">BSONOBJ</span>        =
<span class="default_value">b&#39;\x03&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONOBJ"></a>
    
    

                </section>
                <section id="BSONARR">
                    <div class="attr variable">
            <span class="name">BSONARR</span>        =
<span class="default_value">b&#39;\x04&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONARR"></a>
    
    

                </section>
                <section id="BSONBIN">
                    <div class="attr variable">
            <span class="name">BSONBIN</span>        =
<span class="default_value">b&#39;\x05&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONBIN"></a>
    
    

                </section>
                <section id="BSONUND">
                    <div class="attr variable">
            <span class="name">BSONUND</span>        =
<span class="default_value">b&#39;\x06&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONUND"></a>
    
    

                </section>
                <section id="BSONOID">
                    <div class="attr variable">
            <span class="name">BSONOID</span>        =
<span class="default_value">b&#39;\x07&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONOID"></a>
    
    

                </section>
                <section id="BSONBOO">
                    <div class="attr variable">
            <span class="name">BSONBOO</span>        =
<span class="default_value">b&#39;\x08&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONBOO"></a>
    
    

                </section>
                <section id="BSONDAT">
                    <div class="attr variable">
            <span class="name">BSONDAT</span>        =
<span class="default_value">b&#39;\t&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONDAT"></a>
    
    

                </section>
                <section id="BSONNUL">
                    <div class="attr variable">
            <span class="name">BSONNUL</span>        =
<span class="default_value">b&#39;\n&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONNUL"></a>
    
    

                </section>
                <section id="BSONRGX">
                    <div class="attr variable">
            <span class="name">BSONRGX</span>        =
<span class="default_value">b&#39;\x0b&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONRGX"></a>
    
    

                </section>
                <section id="BSONREF">
                    <div class="attr variable">
            <span class="name">BSONREF</span>        =
<span class="default_value">b&#39;\x0c&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONREF"></a>
    
    

                </section>
                <section id="BSONCOD">
                    <div class="attr variable">
            <span class="name">BSONCOD</span>        =
<span class="default_value">b&#39;\r&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONCOD"></a>
    
    

                </section>
                <section id="BSONSYM">
                    <div class="attr variable">
            <span class="name">BSONSYM</span>        =
<span class="default_value">b&#39;\x0e&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONSYM"></a>
    
    

                </section>
                <section id="BSONCWS">
                    <div class="attr variable">
            <span class="name">BSONCWS</span>        =
<span class="default_value">b&#39;\x0f&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONCWS"></a>
    
    

                </section>
                <section id="BSONINT">
                    <div class="attr variable">
            <span class="name">BSONINT</span>        =
<span class="default_value">b&#39;\x10&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONINT"></a>
    
    

                </section>
                <section id="BSONTIM">
                    <div class="attr variable">
            <span class="name">BSONTIM</span>        =
<span class="default_value">b&#39;\x11&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONTIM"></a>
    
    

                </section>
                <section id="BSONLON">
                    <div class="attr variable">
            <span class="name">BSONLON</span>        =
<span class="default_value">b&#39;\x12&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONLON"></a>
    
    

                </section>
                <section id="BSONDEC">
                    <div class="attr variable">
            <span class="name">BSONDEC</span>        =
<span class="default_value">b&#39;\x13&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONDEC"></a>
    
    

                </section>
                <section id="BSONMIN">
                    <div class="attr variable">
            <span class="name">BSONMIN</span>        =
<span class="default_value">b&#39;\xff&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONMIN"></a>
    
    

                </section>
                <section id="BSONMAX">
                    <div class="attr variable">
            <span class="name">BSONMAX</span>        =
<span class="default_value">b&#39;\x7f&#39;</span>

        
    </div>
    <a class="headerlink" href="#BSONMAX"></a>
    
    

                </section>
                <section id="get_data_and_view">
                            <input id="get_data_and_view-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_data_and_view</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="get_data_and_view-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_data_and_view"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_data_and_view-233"><a href="#get_data_and_view-233"><span class="linenos">233</span></a><span class="k">def</span> <span class="nf">get_data_and_view</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">]:</span>
</span><span id="get_data_and_view-234"><a href="#get_data_and_view-234"><span class="linenos">234</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bytearray</span><span class="p">)):</span>
</span><span id="get_data_and_view-235"><a href="#get_data_and_view-235"><span class="linenos">235</span></a>        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="get_data_and_view-236"><a href="#get_data_and_view-236"><span class="linenos">236</span></a>    <span class="n">view</span> <span class="o">=</span> <span class="nb">memoryview</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="get_data_and_view-237"><a href="#get_data_and_view-237"><span class="linenos">237</span></a>    <span class="k">return</span> <span class="n">view</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(),</span> <span class="n">view</span>
</span></pre></div>


    

                </section>
                <section id="gen_list_name">
                            <input id="gen_list_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">gen_list_name</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="n">Generator</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="gen_list_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#gen_list_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="gen_list_name-625"><a href="#gen_list_name-625"><span class="linenos">625</span></a><span class="k">def</span> <span class="nf">gen_list_name</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="gen_list_name-626"><a href="#gen_list_name-626"><span class="linenos">626</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate &quot;keys&quot; for encoded lists in the sequence</span>
</span><span id="gen_list_name-627"><a href="#gen_list_name-627"><span class="linenos">627</span></a><span class="sd">    b&quot;0\x00&quot;, b&quot;1\x00&quot;, b&quot;2\x00&quot;, ...</span>
</span><span id="gen_list_name-628"><a href="#gen_list_name-628"><span class="linenos">628</span></a>
</span><span id="gen_list_name-629"><a href="#gen_list_name-629"><span class="linenos">629</span></a><span class="sd">    The first 1000 keys are returned from a pre-built cache. All</span>
</span><span id="gen_list_name-630"><a href="#gen_list_name-630"><span class="linenos">630</span></a><span class="sd">    subsequent keys are generated on the fly.</span>
</span><span id="gen_list_name-631"><a href="#gen_list_name-631"><span class="linenos">631</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="gen_list_name-632"><a href="#gen_list_name-632"><span class="linenos">632</span></a>    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">_LIST_NAMES</span><span class="p">:</span>
</span><span id="gen_list_name-633"><a href="#gen_list_name-633"><span class="linenos">633</span></a>        <span class="k">yield</span> <span class="n">name</span>
</span><span id="gen_list_name-634"><a href="#gen_list_name-634"><span class="linenos">634</span></a>
</span><span id="gen_list_name-635"><a href="#gen_list_name-635"><span class="linenos">635</span></a>    <span class="n">counter</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</span><span id="gen_list_name-636"><a href="#gen_list_name-636"><span class="linenos">636</span></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="gen_list_name-637"><a href="#gen_list_name-637"><span class="linenos">637</span></a>        <span class="k">yield</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate "keys" for encoded lists in the sequence
b"0 ", b"1 ", b"2 ", ...</p>

<p>The first 1000 keys are returned from a pre-built cache. All
subsequent keys are generated on the fly.</p>
</div>


                </section>
                <section id="encode">
                            <input id="encode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">encode</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">document</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>,</span><span class="param">	<span class="n">check_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">codec_options</span><span class="p">:</span> <span class="n"><a href="#CodecOptions">xtquant.xtbson.bson37.CodecOptions</a></span> <span class="o">=</span> <span class="n">CodecOptions</span><span class="p">(</span><span class="n">document_class</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">tz_aware</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">uuid_representation</span><span class="o">=</span><span class="n"><a href="#UuidRepresentation.UNSPECIFIED">UuidRepresentation.UNSPECIFIED</a></span><span class="p">,</span> <span class="n">unicode_decode_error_handler</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">type_registry</span><span class="o">=</span><span class="n">TypeRegistry</span><span class="p">(</span><span class="n">type_codecs</span><span class="o">=</span><span class="p">[],</span> <span class="n">fallback_encoder</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">datetime_conversion</span><span class="o">=</span><span class="n"><a href="#DatetimeConversion.DATETIME">DatetimeConversion.DATETIME</a></span><span class="p">)</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="encode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#encode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="encode-994"><a href="#encode-994"><span class="linenos"> 994</span></a><span class="k">def</span> <span class="nf">encode</span><span class="p">(</span>
</span><span id="encode-995"><a href="#encode-995"><span class="linenos"> 995</span></a>    <span class="n">document</span><span class="p">:</span> <span class="n">_DocumentIn</span><span class="p">,</span>
</span><span id="encode-996"><a href="#encode-996"><span class="linenos"> 996</span></a>    <span class="n">check_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="encode-997"><a href="#encode-997"><span class="linenos"> 997</span></a>    <span class="n">codec_options</span><span class="p">:</span> <span class="n">CodecOptions</span> <span class="o">=</span> <span class="n">DEFAULT_CODEC_OPTIONS</span><span class="p">,</span>
</span><span id="encode-998"><a href="#encode-998"><span class="linenos"> 998</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="encode-999"><a href="#encode-999"><span class="linenos"> 999</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Encode a document to BSON.</span>
</span><span id="encode-1000"><a href="#encode-1000"><span class="linenos">1000</span></a>
</span><span id="encode-1001"><a href="#encode-1001"><span class="linenos">1001</span></a><span class="sd">    A document can be any mapping type (like :class:`dict`).</span>
</span><span id="encode-1002"><a href="#encode-1002"><span class="linenos">1002</span></a>
</span><span id="encode-1003"><a href="#encode-1003"><span class="linenos">1003</span></a><span class="sd">    Raises :class:`TypeError` if `document` is not a mapping type,</span>
</span><span id="encode-1004"><a href="#encode-1004"><span class="linenos">1004</span></a><span class="sd">    or contains keys that are not instances of</span>
</span><span id="encode-1005"><a href="#encode-1005"><span class="linenos">1005</span></a><span class="sd">    :class:`basestring` (:class:`str` in python 3). Raises</span>
</span><span id="encode-1006"><a href="#encode-1006"><span class="linenos">1006</span></a><span class="sd">    :class:`~bson.errors.InvalidDocument` if `document` cannot be</span>
</span><span id="encode-1007"><a href="#encode-1007"><span class="linenos">1007</span></a><span class="sd">    converted to :class:`BSON`.</span>
</span><span id="encode-1008"><a href="#encode-1008"><span class="linenos">1008</span></a>
</span><span id="encode-1009"><a href="#encode-1009"><span class="linenos">1009</span></a><span class="sd">    :Parameters:</span>
</span><span id="encode-1010"><a href="#encode-1010"><span class="linenos">1010</span></a><span class="sd">      - `document`: mapping type representing a document</span>
</span><span id="encode-1011"><a href="#encode-1011"><span class="linenos">1011</span></a><span class="sd">      - `check_keys` (optional): check if keys start with &#39;$&#39; or</span>
</span><span id="encode-1012"><a href="#encode-1012"><span class="linenos">1012</span></a><span class="sd">        contain &#39;.&#39;, raising :class:`~bson.errors.InvalidDocument` in</span>
</span><span id="encode-1013"><a href="#encode-1013"><span class="linenos">1013</span></a><span class="sd">        either case</span>
</span><span id="encode-1014"><a href="#encode-1014"><span class="linenos">1014</span></a><span class="sd">      - `codec_options` (optional): An instance of</span>
</span><span id="encode-1015"><a href="#encode-1015"><span class="linenos">1015</span></a><span class="sd">        :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="encode-1016"><a href="#encode-1016"><span class="linenos">1016</span></a>
</span><span id="encode-1017"><a href="#encode-1017"><span class="linenos">1017</span></a><span class="sd">    .. versionadded:: 3.9</span>
</span><span id="encode-1018"><a href="#encode-1018"><span class="linenos">1018</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="encode-1019"><a href="#encode-1019"><span class="linenos">1019</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">codec_options</span><span class="p">,</span> <span class="n">CodecOptions</span><span class="p">):</span>
</span><span id="encode-1020"><a href="#encode-1020"><span class="linenos">1020</span></a>        <span class="k">raise</span> <span class="n">_CODEC_OPTIONS_TYPE_ERROR</span>
</span><span id="encode-1021"><a href="#encode-1021"><span class="linenos">1021</span></a>
</span><span id="encode-1022"><a href="#encode-1022"><span class="linenos">1022</span></a>    <span class="k">return</span> <span class="n">_dict_to_bson</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Encode a document to BSON.</p>

<p>A document can be any mapping type (like <code>dict</code>).</p>

<p>Raises <code>TypeError</code> if <code>document</code> is not a mapping type,
or contains keys that are not instances of
<code>basestring</code> (<code>str</code> in python 3). Raises
<code>~bson.errors.InvalidDocument</code> if <code>document</code> cannot be
converted to <code><a href="#BSON">BSON</a></code>.</p>

<p>:Parameters:</p>

<ul>
<li><code>document</code>: mapping type representing a document</li>
<li><code>check_keys</code> (optional): check if keys start with '$' or
contain '.', raising <code>~bson.errors.InvalidDocument</code> in
either case</li>
<li><code>codec_options</code> (optional): An instance of
<code>~bson.codec_options.CodecOptions</code>.</li>
</ul>

<p><em>New in version 3.9.</em></p>
</div>


                </section>
                <section id="decode">
                            <input id="decode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decode</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">,</span> <span class="n">mmap</span><span class="o">.</span><span class="n">mmap</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">]</span>,</span><span class="param">	<span class="n">codec_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#CodecOptions">xtquant.xtbson.bson37.CodecOptions</a></span><span class="p">[</span><span class="o">~</span><span class="n">_DocumentType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="o">~</span><span class="n">_DocumentType</span>:</span></span>

                <label class="view-source-button" for="decode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#decode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="decode-1025"><a href="#decode-1025"><span class="linenos">1025</span></a><span class="k">def</span> <span class="nf">decode</span><span class="p">(</span>
</span><span id="decode-1026"><a href="#decode-1026"><span class="linenos">1026</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">_ReadableBuffer</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">:</span> <span class="s2">&quot;Optional[CodecOptions[_DocumentType]]&quot;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="decode-1027"><a href="#decode-1027"><span class="linenos">1027</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DocumentType</span><span class="p">:</span>
</span><span id="decode-1028"><a href="#decode-1028"><span class="linenos">1028</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode BSON to a document.</span>
</span><span id="decode-1029"><a href="#decode-1029"><span class="linenos">1029</span></a>
</span><span id="decode-1030"><a href="#decode-1030"><span class="linenos">1030</span></a><span class="sd">    By default, returns a BSON document represented as a Python</span>
</span><span id="decode-1031"><a href="#decode-1031"><span class="linenos">1031</span></a><span class="sd">    :class:`dict`. To use a different :class:`MutableMapping` class,</span>
</span><span id="decode-1032"><a href="#decode-1032"><span class="linenos">1032</span></a><span class="sd">    configure a :class:`~bson.codec_options.CodecOptions`::</span>
</span><span id="decode-1033"><a href="#decode-1033"><span class="linenos">1033</span></a>
</span><span id="decode-1034"><a href="#decode-1034"><span class="linenos">1034</span></a><span class="sd">        &gt;&gt;&gt; import collections  # From Python standard library.</span>
</span><span id="decode-1035"><a href="#decode-1035"><span class="linenos">1035</span></a><span class="sd">        &gt;&gt;&gt; import bson</span>
</span><span id="decode-1036"><a href="#decode-1036"><span class="linenos">1036</span></a><span class="sd">        &gt;&gt;&gt; from .codec_options import CodecOptions</span>
</span><span id="decode-1037"><a href="#decode-1037"><span class="linenos">1037</span></a><span class="sd">        &gt;&gt;&gt; data = bson.encode({&#39;a&#39;: 1})</span>
</span><span id="decode-1038"><a href="#decode-1038"><span class="linenos">1038</span></a><span class="sd">        &gt;&gt;&gt; decoded_doc = bson.decode(data)</span>
</span><span id="decode-1039"><a href="#decode-1039"><span class="linenos">1039</span></a><span class="sd">        &lt;type &#39;dict&#39;&gt;</span>
</span><span id="decode-1040"><a href="#decode-1040"><span class="linenos">1040</span></a><span class="sd">        &gt;&gt;&gt; options = CodecOptions(document_class=collections.OrderedDict)</span>
</span><span id="decode-1041"><a href="#decode-1041"><span class="linenos">1041</span></a><span class="sd">        &gt;&gt;&gt; decoded_doc = bson.decode(data, codec_options=options)</span>
</span><span id="decode-1042"><a href="#decode-1042"><span class="linenos">1042</span></a><span class="sd">        &gt;&gt;&gt; type(decoded_doc)</span>
</span><span id="decode-1043"><a href="#decode-1043"><span class="linenos">1043</span></a><span class="sd">        &lt;class &#39;collections.OrderedDict&#39;&gt;</span>
</span><span id="decode-1044"><a href="#decode-1044"><span class="linenos">1044</span></a>
</span><span id="decode-1045"><a href="#decode-1045"><span class="linenos">1045</span></a><span class="sd">    :Parameters:</span>
</span><span id="decode-1046"><a href="#decode-1046"><span class="linenos">1046</span></a><span class="sd">      - `data`: the BSON to decode. Any bytes-like object that implements</span>
</span><span id="decode-1047"><a href="#decode-1047"><span class="linenos">1047</span></a><span class="sd">        the buffer protocol.</span>
</span><span id="decode-1048"><a href="#decode-1048"><span class="linenos">1048</span></a><span class="sd">      - `codec_options` (optional): An instance of</span>
</span><span id="decode-1049"><a href="#decode-1049"><span class="linenos">1049</span></a><span class="sd">        :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="decode-1050"><a href="#decode-1050"><span class="linenos">1050</span></a>
</span><span id="decode-1051"><a href="#decode-1051"><span class="linenos">1051</span></a><span class="sd">    .. versionadded:: 3.9</span>
</span><span id="decode-1052"><a href="#decode-1052"><span class="linenos">1052</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="decode-1053"><a href="#decode-1053"><span class="linenos">1053</span></a>    <span class="n">opts</span><span class="p">:</span> <span class="n">CodecOptions</span> <span class="o">=</span> <span class="n">codec_options</span> <span class="ow">or</span> <span class="n">DEFAULT_CODEC_OPTIONS</span>
</span><span id="decode-1054"><a href="#decode-1054"><span class="linenos">1054</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">CodecOptions</span><span class="p">):</span>
</span><span id="decode-1055"><a href="#decode-1055"><span class="linenos">1055</span></a>        <span class="k">raise</span> <span class="n">_CODEC_OPTIONS_TYPE_ERROR</span>
</span><span id="decode-1056"><a href="#decode-1056"><span class="linenos">1056</span></a>
</span><span id="decode-1057"><a href="#decode-1057"><span class="linenos">1057</span></a>    <span class="k">return</span> <span class="n">_bson_to_dict</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Decode BSON to a document.</p>

<p>By default, returns a BSON document represented as a Python
<code>dict</code>. To use a different <code>MutableMapping</code> class,
configure a <code>~bson.codec_options.CodecOptions</code>::</p>

<pre><code>&gt;&gt;&gt; import collections  # From Python standard library.
&gt;&gt;&gt; import bson
&gt;&gt;&gt; from .codec_options import CodecOptions
&gt;&gt;&gt; data = bson.encode({'a': 1})
&gt;&gt;&gt; decoded_doc = bson.decode(data)
&lt;type 'dict'&gt;
&gt;&gt;&gt; options = CodecOptions(document_class=collections.OrderedDict)
&gt;&gt;&gt; decoded_doc = bson.decode(data, codec_options=options)
&gt;&gt;&gt; type(decoded_doc)
&lt;class 'collections.OrderedDict'&gt;
</code></pre>

<p>:Parameters:</p>

<ul>
<li><code>data</code>: the BSON to decode. Any bytes-like object that implements
the buffer protocol.</li>
<li><code>codec_options</code> (optional): An instance of
<code>~bson.codec_options.CodecOptions</code>.</li>
</ul>

<p><em>New in version 3.9.</em></p>
</div>


                </section>
                <section id="decode_all">
                            <input id="decode_all-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decode_all</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">memoryview</span><span class="p">,</span> <span class="n">mmap</span><span class="o">.</span><span class="n">mmap</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">array</span><span class="p">]</span>,</span><span class="param">	<span class="n">codec_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#CodecOptions">xtquant.xtbson.bson37.CodecOptions</a></span><span class="p">[</span><span class="o">~</span><span class="n">_DocumentType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="o">~</span><span class="n">_DocumentType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="decode_all-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#decode_all"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="decode_all-1094"><a href="#decode_all-1094"><span class="linenos">1094</span></a><span class="k">def</span> <span class="nf">decode_all</span><span class="p">(</span>
</span><span id="decode_all-1095"><a href="#decode_all-1095"><span class="linenos">1095</span></a>    <span class="n">data</span><span class="p">:</span> <span class="n">_ReadableBuffer</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">:</span> <span class="s2">&quot;Optional[CodecOptions[_DocumentType]]&quot;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="decode_all-1096"><a href="#decode_all-1096"><span class="linenos">1096</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">_DocumentType</span><span class="p">]:</span>
</span><span id="decode_all-1097"><a href="#decode_all-1097"><span class="linenos">1097</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode BSON data to multiple documents.</span>
</span><span id="decode_all-1098"><a href="#decode_all-1098"><span class="linenos">1098</span></a>
</span><span id="decode_all-1099"><a href="#decode_all-1099"><span class="linenos">1099</span></a><span class="sd">    `data` must be a bytes-like object implementing the buffer protocol that</span>
</span><span id="decode_all-1100"><a href="#decode_all-1100"><span class="linenos">1100</span></a><span class="sd">    provides concatenated, valid, BSON-encoded documents.</span>
</span><span id="decode_all-1101"><a href="#decode_all-1101"><span class="linenos">1101</span></a>
</span><span id="decode_all-1102"><a href="#decode_all-1102"><span class="linenos">1102</span></a><span class="sd">    :Parameters:</span>
</span><span id="decode_all-1103"><a href="#decode_all-1103"><span class="linenos">1103</span></a><span class="sd">      - `data`: BSON data</span>
</span><span id="decode_all-1104"><a href="#decode_all-1104"><span class="linenos">1104</span></a><span class="sd">      - `codec_options` (optional): An instance of</span>
</span><span id="decode_all-1105"><a href="#decode_all-1105"><span class="linenos">1105</span></a><span class="sd">        :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="decode_all-1106"><a href="#decode_all-1106"><span class="linenos">1106</span></a>
</span><span id="decode_all-1107"><a href="#decode_all-1107"><span class="linenos">1107</span></a><span class="sd">    .. versionchanged:: 3.9</span>
</span><span id="decode_all-1108"><a href="#decode_all-1108"><span class="linenos">1108</span></a><span class="sd">       Supports bytes-like objects that implement the buffer protocol.</span>
</span><span id="decode_all-1109"><a href="#decode_all-1109"><span class="linenos">1109</span></a>
</span><span id="decode_all-1110"><a href="#decode_all-1110"><span class="linenos">1110</span></a><span class="sd">    .. versionchanged:: 3.0</span>
</span><span id="decode_all-1111"><a href="#decode_all-1111"><span class="linenos">1111</span></a><span class="sd">       Removed `compile_re` option: PyMongo now always represents BSON regular</span>
</span><span id="decode_all-1112"><a href="#decode_all-1112"><span class="linenos">1112</span></a><span class="sd">       expressions as :class:`~bson.regex.Regex` objects. Use</span>
</span><span id="decode_all-1113"><a href="#decode_all-1113"><span class="linenos">1113</span></a><span class="sd">       :meth:`~bson.regex.Regex.try_compile` to attempt to convert from a</span>
</span><span id="decode_all-1114"><a href="#decode_all-1114"><span class="linenos">1114</span></a><span class="sd">       BSON regular expression to a Python regular expression object.</span>
</span><span id="decode_all-1115"><a href="#decode_all-1115"><span class="linenos">1115</span></a>
</span><span id="decode_all-1116"><a href="#decode_all-1116"><span class="linenos">1116</span></a><span class="sd">       Replaced `as_class`, `tz_aware`, and `uuid_subtype` options with</span>
</span><span id="decode_all-1117"><a href="#decode_all-1117"><span class="linenos">1117</span></a><span class="sd">       `codec_options`.</span>
</span><span id="decode_all-1118"><a href="#decode_all-1118"><span class="linenos">1118</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="decode_all-1119"><a href="#decode_all-1119"><span class="linenos">1119</span></a>    <span class="n">opts</span> <span class="o">=</span> <span class="n">codec_options</span> <span class="ow">or</span> <span class="n">DEFAULT_CODEC_OPTIONS</span>
</span><span id="decode_all-1120"><a href="#decode_all-1120"><span class="linenos">1120</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">CodecOptions</span><span class="p">):</span>
</span><span id="decode_all-1121"><a href="#decode_all-1121"><span class="linenos">1121</span></a>        <span class="k">raise</span> <span class="n">_CODEC_OPTIONS_TYPE_ERROR</span>
</span><span id="decode_all-1122"><a href="#decode_all-1122"><span class="linenos">1122</span></a>
</span><span id="decode_all-1123"><a href="#decode_all-1123"><span class="linenos">1123</span></a>    <span class="k">return</span> <span class="n">_decode_all</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
</span></pre></div>


            <div class="docstring"><p>Decode BSON data to multiple documents.</p>

<p><code>data</code> must be a bytes-like object implementing the buffer protocol that
provides concatenated, valid, BSON-encoded documents.</p>

<p>:Parameters:</p>

<ul>
<li><code>data</code>: BSON data</li>
<li><code>codec_options</code> (optional): An instance of
<code>~bson.codec_options.CodecOptions</code>.</li>
</ul>

<p><em>Changed in version 3.9:</em>
Supports bytes-like objects that implement the buffer protocol.</p>

<p><em>Changed in version 3.0:</em>
Removed <code>compile_re</code> option: PyMongo now always represents BSON regular
expressions as <code>~bson.regex.Regex</code> objects. Use
<code>~bson.regex.Regex.try_compile()</code> to attempt to convert from a
BSON regular expression to a Python regular expression object.</p>

<p>Replaced <code>as_class</code>, <code>tz_aware</code>, and <code>uuid_subtype</code> options with
<code>codec_options</code>.</p>
</div>


                </section>
                <section id="decode_iter">
                            <input id="decode_iter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decode_iter</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span>,</span><span class="param">	<span class="n">codec_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#CodecOptions">xtquant.xtbson.bson37.CodecOptions</a></span><span class="p">[</span><span class="o">~</span><span class="n">_DocumentType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Iterator</span><span class="p">[</span><span class="o">~</span><span class="n">_DocumentType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="decode_iter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#decode_iter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="decode_iter-1230"><a href="#decode_iter-1230"><span class="linenos">1230</span></a><span class="k">def</span> <span class="nf">decode_iter</span><span class="p">(</span>
</span><span id="decode_iter-1231"><a href="#decode_iter-1231"><span class="linenos">1231</span></a>    <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">:</span> <span class="s2">&quot;Optional[CodecOptions[_DocumentType]]&quot;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="decode_iter-1232"><a href="#decode_iter-1232"><span class="linenos">1232</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_DocumentType</span><span class="p">]:</span>
</span><span id="decode_iter-1233"><a href="#decode_iter-1233"><span class="linenos">1233</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode BSON data to multiple documents as a generator.</span>
</span><span id="decode_iter-1234"><a href="#decode_iter-1234"><span class="linenos">1234</span></a>
</span><span id="decode_iter-1235"><a href="#decode_iter-1235"><span class="linenos">1235</span></a><span class="sd">    Works similarly to the decode_all function, but yields one document at a</span>
</span><span id="decode_iter-1236"><a href="#decode_iter-1236"><span class="linenos">1236</span></a><span class="sd">    time.</span>
</span><span id="decode_iter-1237"><a href="#decode_iter-1237"><span class="linenos">1237</span></a>
</span><span id="decode_iter-1238"><a href="#decode_iter-1238"><span class="linenos">1238</span></a><span class="sd">    `data` must be a string of concatenated, valid, BSON-encoded</span>
</span><span id="decode_iter-1239"><a href="#decode_iter-1239"><span class="linenos">1239</span></a><span class="sd">    documents.</span>
</span><span id="decode_iter-1240"><a href="#decode_iter-1240"><span class="linenos">1240</span></a>
</span><span id="decode_iter-1241"><a href="#decode_iter-1241"><span class="linenos">1241</span></a><span class="sd">    :Parameters:</span>
</span><span id="decode_iter-1242"><a href="#decode_iter-1242"><span class="linenos">1242</span></a><span class="sd">      - `data`: BSON data</span>
</span><span id="decode_iter-1243"><a href="#decode_iter-1243"><span class="linenos">1243</span></a><span class="sd">      - `codec_options` (optional): An instance of</span>
</span><span id="decode_iter-1244"><a href="#decode_iter-1244"><span class="linenos">1244</span></a><span class="sd">        :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="decode_iter-1245"><a href="#decode_iter-1245"><span class="linenos">1245</span></a>
</span><span id="decode_iter-1246"><a href="#decode_iter-1246"><span class="linenos">1246</span></a><span class="sd">    .. versionchanged:: 3.0</span>
</span><span id="decode_iter-1247"><a href="#decode_iter-1247"><span class="linenos">1247</span></a><span class="sd">       Replaced `as_class`, `tz_aware`, and `uuid_subtype` options with</span>
</span><span id="decode_iter-1248"><a href="#decode_iter-1248"><span class="linenos">1248</span></a><span class="sd">       `codec_options`.</span>
</span><span id="decode_iter-1249"><a href="#decode_iter-1249"><span class="linenos">1249</span></a>
</span><span id="decode_iter-1250"><a href="#decode_iter-1250"><span class="linenos">1250</span></a><span class="sd">    .. versionadded:: 2.8</span>
</span><span id="decode_iter-1251"><a href="#decode_iter-1251"><span class="linenos">1251</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="decode_iter-1252"><a href="#decode_iter-1252"><span class="linenos">1252</span></a>    <span class="n">opts</span> <span class="o">=</span> <span class="n">codec_options</span> <span class="ow">or</span> <span class="n">DEFAULT_CODEC_OPTIONS</span>
</span><span id="decode_iter-1253"><a href="#decode_iter-1253"><span class="linenos">1253</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">CodecOptions</span><span class="p">):</span>
</span><span id="decode_iter-1254"><a href="#decode_iter-1254"><span class="linenos">1254</span></a>        <span class="k">raise</span> <span class="n">_CODEC_OPTIONS_TYPE_ERROR</span>
</span><span id="decode_iter-1255"><a href="#decode_iter-1255"><span class="linenos">1255</span></a>
</span><span id="decode_iter-1256"><a href="#decode_iter-1256"><span class="linenos">1256</span></a>    <span class="n">position</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="decode_iter-1257"><a href="#decode_iter-1257"><span class="linenos">1257</span></a>    <span class="n">end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="decode_iter-1258"><a href="#decode_iter-1258"><span class="linenos">1258</span></a>    <span class="k">while</span> <span class="n">position</span> <span class="o">&lt;</span> <span class="n">end</span><span class="p">:</span>
</span><span id="decode_iter-1259"><a href="#decode_iter-1259"><span class="linenos">1259</span></a>        <span class="n">obj_size</span> <span class="o">=</span> <span class="n">_UNPACK_INT_FROM</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">position</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="decode_iter-1260"><a href="#decode_iter-1260"><span class="linenos">1260</span></a>        <span class="n">elements</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">position</span> <span class="p">:</span> <span class="n">position</span> <span class="o">+</span> <span class="n">obj_size</span><span class="p">]</span>
</span><span id="decode_iter-1261"><a href="#decode_iter-1261"><span class="linenos">1261</span></a>        <span class="n">position</span> <span class="o">+=</span> <span class="n">obj_size</span>
</span><span id="decode_iter-1262"><a href="#decode_iter-1262"><span class="linenos">1262</span></a>
</span><span id="decode_iter-1263"><a href="#decode_iter-1263"><span class="linenos">1263</span></a>        <span class="k">yield</span> <span class="n">_bson_to_dict</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Decode BSON data to multiple documents as a generator.</p>

<p>Works similarly to the decode_all function, but yields one document at a
time.</p>

<p><code>data</code> must be a string of concatenated, valid, BSON-encoded
documents.</p>

<p>:Parameters:</p>

<ul>
<li><code>data</code>: BSON data</li>
<li><code>codec_options</code> (optional): An instance of
<code>~bson.codec_options.CodecOptions</code>.</li>
</ul>

<p><em>Changed in version 3.0:</em>
Replaced <code>as_class</code>, <code>tz_aware</code>, and <code>uuid_subtype</code> options with
<code>codec_options</code>.</p>

<p><em>New in version 2.8.</em></p>
</div>


                </section>
                <section id="decode_file_iter">
                            <input id="decode_file_iter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decode_file_iter</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">file_obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BinaryIO</span><span class="p">,</span> <span class="n">IO</span><span class="p">]</span>,</span><span class="param">	<span class="n">codec_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#CodecOptions">xtquant.xtbson.bson37.CodecOptions</a></span><span class="p">[</span><span class="o">~</span><span class="n">_DocumentType</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Iterator</span><span class="p">[</span><span class="o">~</span><span class="n">_DocumentType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="decode_file_iter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#decode_file_iter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="decode_file_iter-1266"><a href="#decode_file_iter-1266"><span class="linenos">1266</span></a><span class="k">def</span> <span class="nf">decode_file_iter</span><span class="p">(</span>
</span><span id="decode_file_iter-1267"><a href="#decode_file_iter-1267"><span class="linenos">1267</span></a>    <span class="n">file_obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">BinaryIO</span><span class="p">,</span> <span class="n">IO</span><span class="p">],</span> <span class="n">codec_options</span><span class="p">:</span> <span class="s2">&quot;Optional[CodecOptions[_DocumentType]]&quot;</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="decode_file_iter-1268"><a href="#decode_file_iter-1268"><span class="linenos">1268</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">_DocumentType</span><span class="p">]:</span>
</span><span id="decode_file_iter-1269"><a href="#decode_file_iter-1269"><span class="linenos">1269</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode bson data from a file to multiple documents as a generator.</span>
</span><span id="decode_file_iter-1270"><a href="#decode_file_iter-1270"><span class="linenos">1270</span></a>
</span><span id="decode_file_iter-1271"><a href="#decode_file_iter-1271"><span class="linenos">1271</span></a><span class="sd">    Works similarly to the decode_all function, but reads from the file object</span>
</span><span id="decode_file_iter-1272"><a href="#decode_file_iter-1272"><span class="linenos">1272</span></a><span class="sd">    in chunks and parses bson in chunks, yielding one document at a time.</span>
</span><span id="decode_file_iter-1273"><a href="#decode_file_iter-1273"><span class="linenos">1273</span></a>
</span><span id="decode_file_iter-1274"><a href="#decode_file_iter-1274"><span class="linenos">1274</span></a><span class="sd">    :Parameters:</span>
</span><span id="decode_file_iter-1275"><a href="#decode_file_iter-1275"><span class="linenos">1275</span></a><span class="sd">      - `file_obj`: A file object containing BSON data.</span>
</span><span id="decode_file_iter-1276"><a href="#decode_file_iter-1276"><span class="linenos">1276</span></a><span class="sd">      - `codec_options` (optional): An instance of</span>
</span><span id="decode_file_iter-1277"><a href="#decode_file_iter-1277"><span class="linenos">1277</span></a><span class="sd">        :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="decode_file_iter-1278"><a href="#decode_file_iter-1278"><span class="linenos">1278</span></a>
</span><span id="decode_file_iter-1279"><a href="#decode_file_iter-1279"><span class="linenos">1279</span></a><span class="sd">    .. versionchanged:: 3.0</span>
</span><span id="decode_file_iter-1280"><a href="#decode_file_iter-1280"><span class="linenos">1280</span></a><span class="sd">       Replaced `as_class`, `tz_aware`, and `uuid_subtype` options with</span>
</span><span id="decode_file_iter-1281"><a href="#decode_file_iter-1281"><span class="linenos">1281</span></a><span class="sd">       `codec_options`.</span>
</span><span id="decode_file_iter-1282"><a href="#decode_file_iter-1282"><span class="linenos">1282</span></a>
</span><span id="decode_file_iter-1283"><a href="#decode_file_iter-1283"><span class="linenos">1283</span></a><span class="sd">    .. versionadded:: 2.8</span>
</span><span id="decode_file_iter-1284"><a href="#decode_file_iter-1284"><span class="linenos">1284</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="decode_file_iter-1285"><a href="#decode_file_iter-1285"><span class="linenos">1285</span></a>    <span class="n">opts</span> <span class="o">=</span> <span class="n">codec_options</span> <span class="ow">or</span> <span class="n">DEFAULT_CODEC_OPTIONS</span>
</span><span id="decode_file_iter-1286"><a href="#decode_file_iter-1286"><span class="linenos">1286</span></a>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="decode_file_iter-1287"><a href="#decode_file_iter-1287"><span class="linenos">1287</span></a>        <span class="c1"># Read size of next object.</span>
</span><span id="decode_file_iter-1288"><a href="#decode_file_iter-1288"><span class="linenos">1288</span></a>        <span class="n">size_data</span> <span class="o">=</span> <span class="n">file_obj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="decode_file_iter-1289"><a href="#decode_file_iter-1289"><span class="linenos">1289</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">size_data</span><span class="p">:</span>
</span><span id="decode_file_iter-1290"><a href="#decode_file_iter-1290"><span class="linenos">1290</span></a>            <span class="k">break</span>  <span class="c1"># Finished with file normaly.</span>
</span><span id="decode_file_iter-1291"><a href="#decode_file_iter-1291"><span class="linenos">1291</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">size_data</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="decode_file_iter-1292"><a href="#decode_file_iter-1292"><span class="linenos">1292</span></a>            <span class="k">raise</span> <span class="n">InvalidBSON</span><span class="p">(</span><span class="s2">&quot;cut off in middle of objsize&quot;</span><span class="p">)</span>
</span><span id="decode_file_iter-1293"><a href="#decode_file_iter-1293"><span class="linenos">1293</span></a>        <span class="n">obj_size</span> <span class="o">=</span> <span class="n">_UNPACK_INT_FROM</span><span class="p">(</span><span class="n">size_data</span><span class="p">,</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span>
</span><span id="decode_file_iter-1294"><a href="#decode_file_iter-1294"><span class="linenos">1294</span></a>        <span class="n">elements</span> <span class="o">=</span> <span class="n">size_data</span> <span class="o">+</span> <span class="n">file_obj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">obj_size</span><span class="p">))</span>
</span><span id="decode_file_iter-1295"><a href="#decode_file_iter-1295"><span class="linenos">1295</span></a>        <span class="k">yield</span> <span class="n">_bson_to_dict</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Decode bson data from a file to multiple documents as a generator.</p>

<p>Works similarly to the decode_all function, but reads from the file object
in chunks and parses bson in chunks, yielding one document at a time.</p>

<p>:Parameters:</p>

<ul>
<li><code>file_obj</code>: A file object containing BSON data.</li>
<li><code>codec_options</code> (optional): An instance of
<code>~bson.codec_options.CodecOptions</code>.</li>
</ul>

<p><em>Changed in version 3.0:</em>
Replaced <code>as_class</code>, <code>tz_aware</code>, and <code>uuid_subtype</code> options with
<code>codec_options</code>.</p>

<p><em>New in version 2.8.</em></p>
</div>


                </section>
                <section id="is_valid">
                            <input id="is_valid-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_valid</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">bson</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="is_valid-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#is_valid"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="is_valid-1298"><a href="#is_valid-1298"><span class="linenos">1298</span></a><span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="n">bson</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="is_valid-1299"><a href="#is_valid-1299"><span class="linenos">1299</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check that the given string represents valid :class:`BSON` data.</span>
</span><span id="is_valid-1300"><a href="#is_valid-1300"><span class="linenos">1300</span></a>
</span><span id="is_valid-1301"><a href="#is_valid-1301"><span class="linenos">1301</span></a><span class="sd">    Raises :class:`TypeError` if `bson` is not an instance of</span>
</span><span id="is_valid-1302"><a href="#is_valid-1302"><span class="linenos">1302</span></a><span class="sd">    :class:`str` (:class:`bytes` in python 3). Returns ``True``</span>
</span><span id="is_valid-1303"><a href="#is_valid-1303"><span class="linenos">1303</span></a><span class="sd">    if `bson` is valid :class:`BSON`, ``False`` otherwise.</span>
</span><span id="is_valid-1304"><a href="#is_valid-1304"><span class="linenos">1304</span></a>
</span><span id="is_valid-1305"><a href="#is_valid-1305"><span class="linenos">1305</span></a><span class="sd">    :Parameters:</span>
</span><span id="is_valid-1306"><a href="#is_valid-1306"><span class="linenos">1306</span></a><span class="sd">      - `bson`: the data to be validated</span>
</span><span id="is_valid-1307"><a href="#is_valid-1307"><span class="linenos">1307</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="is_valid-1308"><a href="#is_valid-1308"><span class="linenos">1308</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bson</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span id="is_valid-1309"><a href="#is_valid-1309"><span class="linenos">1309</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;BSON data must be an instance of a subclass of bytes&quot;</span><span class="p">)</span>
</span><span id="is_valid-1310"><a href="#is_valid-1310"><span class="linenos">1310</span></a>
</span><span id="is_valid-1311"><a href="#is_valid-1311"><span class="linenos">1311</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="is_valid-1312"><a href="#is_valid-1312"><span class="linenos">1312</span></a>        <span class="n">_bson_to_dict</span><span class="p">(</span><span class="n">bson</span><span class="p">,</span> <span class="n">DEFAULT_CODEC_OPTIONS</span><span class="p">)</span>
</span><span id="is_valid-1313"><a href="#is_valid-1313"><span class="linenos">1313</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="is_valid-1314"><a href="#is_valid-1314"><span class="linenos">1314</span></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="is_valid-1315"><a href="#is_valid-1315"><span class="linenos">1315</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Check that the given string represents valid <code><a href="#BSON">BSON</a></code> data.</p>

<p>Raises <code>TypeError</code> if <code>bson</code> is not an instance of
<code>str</code> (<code>bytes</code> in python 3). Returns <code>True</code>
if <code>bson</code> is valid <code><a href="#BSON">BSON</a></code>, <code>False</code> otherwise.</p>

<p>:Parameters:</p>

<ul>
<li><code>bson</code>: the data to be validated</li>
</ul>
</div>


                </section>
                <section id="BSON">
                            <input id="BSON-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BSON</span><wbr>(<span class="base">builtins.bytes</span>):

                <label class="view-source-button" for="BSON-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BSON"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BSON-1318"><a href="#BSON-1318"><span class="linenos">1318</span></a><span class="k">class</span> <span class="nc">BSON</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
</span><span id="BSON-1319"><a href="#BSON-1319"><span class="linenos">1319</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;BSON (Binary JSON) data.</span>
</span><span id="BSON-1320"><a href="#BSON-1320"><span class="linenos">1320</span></a>
</span><span id="BSON-1321"><a href="#BSON-1321"><span class="linenos">1321</span></a><span class="sd">    .. warning:: Using this class to encode and decode BSON adds a performance</span>
</span><span id="BSON-1322"><a href="#BSON-1322"><span class="linenos">1322</span></a><span class="sd">       cost. For better performance use the module level functions</span>
</span><span id="BSON-1323"><a href="#BSON-1323"><span class="linenos">1323</span></a><span class="sd">       :func:`encode` and :func:`decode` instead.</span>
</span><span id="BSON-1324"><a href="#BSON-1324"><span class="linenos">1324</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="BSON-1325"><a href="#BSON-1325"><span class="linenos">1325</span></a>
</span><span id="BSON-1326"><a href="#BSON-1326"><span class="linenos">1326</span></a>    <span class="nd">@classmethod</span>
</span><span id="BSON-1327"><a href="#BSON-1327"><span class="linenos">1327</span></a>    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span>
</span><span id="BSON-1328"><a href="#BSON-1328"><span class="linenos">1328</span></a>        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;BSON&quot;</span><span class="p">],</span>
</span><span id="BSON-1329"><a href="#BSON-1329"><span class="linenos">1329</span></a>        <span class="n">document</span><span class="p">:</span> <span class="n">_DocumentIn</span><span class="p">,</span>
</span><span id="BSON-1330"><a href="#BSON-1330"><span class="linenos">1330</span></a>        <span class="n">check_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BSON-1331"><a href="#BSON-1331"><span class="linenos">1331</span></a>        <span class="n">codec_options</span><span class="p">:</span> <span class="n">CodecOptions</span> <span class="o">=</span> <span class="n">DEFAULT_CODEC_OPTIONS</span><span class="p">,</span>
</span><span id="BSON-1332"><a href="#BSON-1332"><span class="linenos">1332</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BSON&quot;</span><span class="p">:</span>
</span><span id="BSON-1333"><a href="#BSON-1333"><span class="linenos">1333</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Encode a document to a new :class:`BSON` instance.</span>
</span><span id="BSON-1334"><a href="#BSON-1334"><span class="linenos">1334</span></a>
</span><span id="BSON-1335"><a href="#BSON-1335"><span class="linenos">1335</span></a><span class="sd">        A document can be any mapping type (like :class:`dict`).</span>
</span><span id="BSON-1336"><a href="#BSON-1336"><span class="linenos">1336</span></a>
</span><span id="BSON-1337"><a href="#BSON-1337"><span class="linenos">1337</span></a><span class="sd">        Raises :class:`TypeError` if `document` is not a mapping type,</span>
</span><span id="BSON-1338"><a href="#BSON-1338"><span class="linenos">1338</span></a><span class="sd">        or contains keys that are not instances of</span>
</span><span id="BSON-1339"><a href="#BSON-1339"><span class="linenos">1339</span></a><span class="sd">        :class:`basestring` (:class:`str` in python 3). Raises</span>
</span><span id="BSON-1340"><a href="#BSON-1340"><span class="linenos">1340</span></a><span class="sd">        :class:`~bson.errors.InvalidDocument` if `document` cannot be</span>
</span><span id="BSON-1341"><a href="#BSON-1341"><span class="linenos">1341</span></a><span class="sd">        converted to :class:`BSON`.</span>
</span><span id="BSON-1342"><a href="#BSON-1342"><span class="linenos">1342</span></a>
</span><span id="BSON-1343"><a href="#BSON-1343"><span class="linenos">1343</span></a><span class="sd">        :Parameters:</span>
</span><span id="BSON-1344"><a href="#BSON-1344"><span class="linenos">1344</span></a><span class="sd">          - `document`: mapping type representing a document</span>
</span><span id="BSON-1345"><a href="#BSON-1345"><span class="linenos">1345</span></a><span class="sd">          - `check_keys` (optional): check if keys start with &#39;$&#39; or</span>
</span><span id="BSON-1346"><a href="#BSON-1346"><span class="linenos">1346</span></a><span class="sd">            contain &#39;.&#39;, raising :class:`~bson.errors.InvalidDocument` in</span>
</span><span id="BSON-1347"><a href="#BSON-1347"><span class="linenos">1347</span></a><span class="sd">            either case</span>
</span><span id="BSON-1348"><a href="#BSON-1348"><span class="linenos">1348</span></a><span class="sd">          - `codec_options` (optional): An instance of</span>
</span><span id="BSON-1349"><a href="#BSON-1349"><span class="linenos">1349</span></a><span class="sd">            :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="BSON-1350"><a href="#BSON-1350"><span class="linenos">1350</span></a>
</span><span id="BSON-1351"><a href="#BSON-1351"><span class="linenos">1351</span></a><span class="sd">        .. versionchanged:: 3.0</span>
</span><span id="BSON-1352"><a href="#BSON-1352"><span class="linenos">1352</span></a><span class="sd">           Replaced `uuid_subtype` option with `codec_options`.</span>
</span><span id="BSON-1353"><a href="#BSON-1353"><span class="linenos">1353</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BSON-1354"><a href="#BSON-1354"><span class="linenos">1354</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">))</span>
</span><span id="BSON-1355"><a href="#BSON-1355"><span class="linenos">1355</span></a>
</span><span id="BSON-1356"><a href="#BSON-1356"><span class="linenos">1356</span></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">:</span> <span class="s2">&quot;CodecOptions[_DocumentType]&quot;</span> <span class="o">=</span> <span class="n">DEFAULT_CODEC_OPTIONS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DocumentType</span><span class="p">:</span>  <span class="c1"># type: ignore[override,assignment]</span>
</span><span id="BSON-1357"><a href="#BSON-1357"><span class="linenos">1357</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Decode this BSON data.</span>
</span><span id="BSON-1358"><a href="#BSON-1358"><span class="linenos">1358</span></a>
</span><span id="BSON-1359"><a href="#BSON-1359"><span class="linenos">1359</span></a><span class="sd">        By default, returns a BSON document represented as a Python</span>
</span><span id="BSON-1360"><a href="#BSON-1360"><span class="linenos">1360</span></a><span class="sd">        :class:`dict`. To use a different :class:`MutableMapping` class,</span>
</span><span id="BSON-1361"><a href="#BSON-1361"><span class="linenos">1361</span></a><span class="sd">        configure a :class:`~bson.codec_options.CodecOptions`::</span>
</span><span id="BSON-1362"><a href="#BSON-1362"><span class="linenos">1362</span></a>
</span><span id="BSON-1363"><a href="#BSON-1363"><span class="linenos">1363</span></a><span class="sd">            &gt;&gt;&gt; import collections  # From Python standard library.</span>
</span><span id="BSON-1364"><a href="#BSON-1364"><span class="linenos">1364</span></a><span class="sd">            &gt;&gt;&gt; import bson</span>
</span><span id="BSON-1365"><a href="#BSON-1365"><span class="linenos">1365</span></a><span class="sd">            &gt;&gt;&gt; from .codec_options import CodecOptions</span>
</span><span id="BSON-1366"><a href="#BSON-1366"><span class="linenos">1366</span></a><span class="sd">            &gt;&gt;&gt; data = bson.BSON.encode({&#39;a&#39;: 1})</span>
</span><span id="BSON-1367"><a href="#BSON-1367"><span class="linenos">1367</span></a><span class="sd">            &gt;&gt;&gt; decoded_doc = bson.BSON(data).decode()</span>
</span><span id="BSON-1368"><a href="#BSON-1368"><span class="linenos">1368</span></a><span class="sd">            &lt;type &#39;dict&#39;&gt;</span>
</span><span id="BSON-1369"><a href="#BSON-1369"><span class="linenos">1369</span></a><span class="sd">            &gt;&gt;&gt; options = CodecOptions(document_class=collections.OrderedDict)</span>
</span><span id="BSON-1370"><a href="#BSON-1370"><span class="linenos">1370</span></a><span class="sd">            &gt;&gt;&gt; decoded_doc = bson.BSON(data).decode(codec_options=options)</span>
</span><span id="BSON-1371"><a href="#BSON-1371"><span class="linenos">1371</span></a><span class="sd">            &gt;&gt;&gt; type(decoded_doc)</span>
</span><span id="BSON-1372"><a href="#BSON-1372"><span class="linenos">1372</span></a><span class="sd">            &lt;class &#39;collections.OrderedDict&#39;&gt;</span>
</span><span id="BSON-1373"><a href="#BSON-1373"><span class="linenos">1373</span></a>
</span><span id="BSON-1374"><a href="#BSON-1374"><span class="linenos">1374</span></a><span class="sd">        :Parameters:</span>
</span><span id="BSON-1375"><a href="#BSON-1375"><span class="linenos">1375</span></a><span class="sd">          - `codec_options` (optional): An instance of</span>
</span><span id="BSON-1376"><a href="#BSON-1376"><span class="linenos">1376</span></a><span class="sd">            :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="BSON-1377"><a href="#BSON-1377"><span class="linenos">1377</span></a>
</span><span id="BSON-1378"><a href="#BSON-1378"><span class="linenos">1378</span></a><span class="sd">        .. versionchanged:: 3.0</span>
</span><span id="BSON-1379"><a href="#BSON-1379"><span class="linenos">1379</span></a><span class="sd">           Removed `compile_re` option: PyMongo now always represents BSON</span>
</span><span id="BSON-1380"><a href="#BSON-1380"><span class="linenos">1380</span></a><span class="sd">           regular expressions as :class:`~bson.regex.Regex` objects. Use</span>
</span><span id="BSON-1381"><a href="#BSON-1381"><span class="linenos">1381</span></a><span class="sd">           :meth:`~bson.regex.Regex.try_compile` to attempt to convert from a</span>
</span><span id="BSON-1382"><a href="#BSON-1382"><span class="linenos">1382</span></a><span class="sd">           BSON regular expression to a Python regular expression object.</span>
</span><span id="BSON-1383"><a href="#BSON-1383"><span class="linenos">1383</span></a>
</span><span id="BSON-1384"><a href="#BSON-1384"><span class="linenos">1384</span></a><span class="sd">           Replaced `as_class`, `tz_aware`, and `uuid_subtype` options with</span>
</span><span id="BSON-1385"><a href="#BSON-1385"><span class="linenos">1385</span></a><span class="sd">           `codec_options`.</span>
</span><span id="BSON-1386"><a href="#BSON-1386"><span class="linenos">1386</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BSON-1387"><a href="#BSON-1387"><span class="linenos">1387</span></a>        <span class="k">return</span> <span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>BSON (Binary JSON) data.</p>

<div class="pdoc-alert pdoc-alert-warning">

<h6 id="using-this-class-to-encode-and-decode-bson-adds-a-performance">Using this class to encode and decode BSON adds a performance</h6>

<p>cost. For better performance use the module level functions
<code><a href="#BSON.encode">encode()</a></code> and <code><a href="#BSON.decode">decode()</a></code> instead.</p>

</div>
</div>


                            <div id="BSON.encode" class="classattr">
                                        <input id="BSON.encode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">encode</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n"><a href="#BSON">xtquant.xtbson.bson37.BSON</a></span><span class="p">]</span>,</span><span class="param">	<span class="n">document</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>,</span><span class="param">	<span class="n">check_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">codec_options</span><span class="p">:</span> <span class="n"><a href="#CodecOptions">xtquant.xtbson.bson37.CodecOptions</a></span> <span class="o">=</span> <span class="n">CodecOptions</span><span class="p">(</span><span class="n">document_class</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">tz_aware</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">uuid_representation</span><span class="o">=</span><span class="n"><a href="#UuidRepresentation.UNSPECIFIED">UuidRepresentation.UNSPECIFIED</a></span><span class="p">,</span> <span class="n">unicode_decode_error_handler</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">type_registry</span><span class="o">=</span><span class="n">TypeRegistry</span><span class="p">(</span><span class="n">type_codecs</span><span class="o">=</span><span class="p">[],</span> <span class="n">fallback_encoder</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">datetime_conversion</span><span class="o">=</span><span class="n"><a href="#DatetimeConversion.DATETIME">DatetimeConversion.DATETIME</a></span><span class="p">)</span></span><span class="return-annotation">) -> <span class="n"><a href="#BSON">xtquant.xtbson.bson37.BSON</a></span>:</span></span>

                <label class="view-source-button" for="BSON.encode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BSON.encode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BSON.encode-1326"><a href="#BSON.encode-1326"><span class="linenos">1326</span></a>    <span class="nd">@classmethod</span>
</span><span id="BSON.encode-1327"><a href="#BSON.encode-1327"><span class="linenos">1327</span></a>    <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span>
</span><span id="BSON.encode-1328"><a href="#BSON.encode-1328"><span class="linenos">1328</span></a>        <span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="s2">&quot;BSON&quot;</span><span class="p">],</span>
</span><span id="BSON.encode-1329"><a href="#BSON.encode-1329"><span class="linenos">1329</span></a>        <span class="n">document</span><span class="p">:</span> <span class="n">_DocumentIn</span><span class="p">,</span>
</span><span id="BSON.encode-1330"><a href="#BSON.encode-1330"><span class="linenos">1330</span></a>        <span class="n">check_keys</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="BSON.encode-1331"><a href="#BSON.encode-1331"><span class="linenos">1331</span></a>        <span class="n">codec_options</span><span class="p">:</span> <span class="n">CodecOptions</span> <span class="o">=</span> <span class="n">DEFAULT_CODEC_OPTIONS</span><span class="p">,</span>
</span><span id="BSON.encode-1332"><a href="#BSON.encode-1332"><span class="linenos">1332</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BSON&quot;</span><span class="p">:</span>
</span><span id="BSON.encode-1333"><a href="#BSON.encode-1333"><span class="linenos">1333</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Encode a document to a new :class:`BSON` instance.</span>
</span><span id="BSON.encode-1334"><a href="#BSON.encode-1334"><span class="linenos">1334</span></a>
</span><span id="BSON.encode-1335"><a href="#BSON.encode-1335"><span class="linenos">1335</span></a><span class="sd">        A document can be any mapping type (like :class:`dict`).</span>
</span><span id="BSON.encode-1336"><a href="#BSON.encode-1336"><span class="linenos">1336</span></a>
</span><span id="BSON.encode-1337"><a href="#BSON.encode-1337"><span class="linenos">1337</span></a><span class="sd">        Raises :class:`TypeError` if `document` is not a mapping type,</span>
</span><span id="BSON.encode-1338"><a href="#BSON.encode-1338"><span class="linenos">1338</span></a><span class="sd">        or contains keys that are not instances of</span>
</span><span id="BSON.encode-1339"><a href="#BSON.encode-1339"><span class="linenos">1339</span></a><span class="sd">        :class:`basestring` (:class:`str` in python 3). Raises</span>
</span><span id="BSON.encode-1340"><a href="#BSON.encode-1340"><span class="linenos">1340</span></a><span class="sd">        :class:`~bson.errors.InvalidDocument` if `document` cannot be</span>
</span><span id="BSON.encode-1341"><a href="#BSON.encode-1341"><span class="linenos">1341</span></a><span class="sd">        converted to :class:`BSON`.</span>
</span><span id="BSON.encode-1342"><a href="#BSON.encode-1342"><span class="linenos">1342</span></a>
</span><span id="BSON.encode-1343"><a href="#BSON.encode-1343"><span class="linenos">1343</span></a><span class="sd">        :Parameters:</span>
</span><span id="BSON.encode-1344"><a href="#BSON.encode-1344"><span class="linenos">1344</span></a><span class="sd">          - `document`: mapping type representing a document</span>
</span><span id="BSON.encode-1345"><a href="#BSON.encode-1345"><span class="linenos">1345</span></a><span class="sd">          - `check_keys` (optional): check if keys start with &#39;$&#39; or</span>
</span><span id="BSON.encode-1346"><a href="#BSON.encode-1346"><span class="linenos">1346</span></a><span class="sd">            contain &#39;.&#39;, raising :class:`~bson.errors.InvalidDocument` in</span>
</span><span id="BSON.encode-1347"><a href="#BSON.encode-1347"><span class="linenos">1347</span></a><span class="sd">            either case</span>
</span><span id="BSON.encode-1348"><a href="#BSON.encode-1348"><span class="linenos">1348</span></a><span class="sd">          - `codec_options` (optional): An instance of</span>
</span><span id="BSON.encode-1349"><a href="#BSON.encode-1349"><span class="linenos">1349</span></a><span class="sd">            :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="BSON.encode-1350"><a href="#BSON.encode-1350"><span class="linenos">1350</span></a>
</span><span id="BSON.encode-1351"><a href="#BSON.encode-1351"><span class="linenos">1351</span></a><span class="sd">        .. versionchanged:: 3.0</span>
</span><span id="BSON.encode-1352"><a href="#BSON.encode-1352"><span class="linenos">1352</span></a><span class="sd">           Replaced `uuid_subtype` option with `codec_options`.</span>
</span><span id="BSON.encode-1353"><a href="#BSON.encode-1353"><span class="linenos">1353</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BSON.encode-1354"><a href="#BSON.encode-1354"><span class="linenos">1354</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">encode</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">check_keys</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Encode a document to a new <code><a href="#BSON">BSON</a></code> instance.</p>

<p>A document can be any mapping type (like <code>dict</code>).</p>

<p>Raises <code>TypeError</code> if <code>document</code> is not a mapping type,
or contains keys that are not instances of
<code>basestring</code> (<code>str</code> in python 3). Raises
<code>~bson.errors.InvalidDocument</code> if <code>document</code> cannot be
converted to <code><a href="#BSON">BSON</a></code>.</p>

<p>:Parameters:</p>

<ul>
<li><code>document</code>: mapping type representing a document</li>
<li><code>check_keys</code> (optional): check if keys start with '$' or
contain '.', raising <code>~bson.errors.InvalidDocument</code> in
either case</li>
<li><code>codec_options</code> (optional): An instance of
<code>~bson.codec_options.CodecOptions</code>.</li>
</ul>

<p><em>Changed in version 3.0:</em>
Replaced <code>uuid_subtype</code> option with <code>codec_options</code>.</p>
</div>


                            </div>
                            <div id="BSON.decode" class="classattr">
                                        <input id="BSON.decode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">decode</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">codec_options</span><span class="p">:</span> <span class="n"><a href="#CodecOptions">xtquant.xtbson.bson37.CodecOptions</a></span><span class="p">[</span><span class="o">~</span><span class="n">_DocumentType</span><span class="p">]</span> <span class="o">=</span> <span class="n">CodecOptions</span><span class="p">(</span><span class="n">document_class</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">tz_aware</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">uuid_representation</span><span class="o">=</span><span class="n"><a href="#UuidRepresentation.UNSPECIFIED">UuidRepresentation.UNSPECIFIED</a></span><span class="p">,</span> <span class="n">unicode_decode_error_handler</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">type_registry</span><span class="o">=</span><span class="n">TypeRegistry</span><span class="p">(</span><span class="n">type_codecs</span><span class="o">=</span><span class="p">[],</span> <span class="n">fallback_encoder</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">datetime_conversion</span><span class="o">=</span><span class="n"><a href="#DatetimeConversion.DATETIME">DatetimeConversion.DATETIME</a></span><span class="p">)</span></span><span class="return-annotation">) -> <span class="o">~</span><span class="n">_DocumentType</span>:</span></span>

                <label class="view-source-button" for="BSON.decode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BSON.decode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BSON.decode-1356"><a href="#BSON.decode-1356"><span class="linenos">1356</span></a>    <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">:</span> <span class="s2">&quot;CodecOptions[_DocumentType]&quot;</span> <span class="o">=</span> <span class="n">DEFAULT_CODEC_OPTIONS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DocumentType</span><span class="p">:</span>  <span class="c1"># type: ignore[override,assignment]</span>
</span><span id="BSON.decode-1357"><a href="#BSON.decode-1357"><span class="linenos">1357</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Decode this BSON data.</span>
</span><span id="BSON.decode-1358"><a href="#BSON.decode-1358"><span class="linenos">1358</span></a>
</span><span id="BSON.decode-1359"><a href="#BSON.decode-1359"><span class="linenos">1359</span></a><span class="sd">        By default, returns a BSON document represented as a Python</span>
</span><span id="BSON.decode-1360"><a href="#BSON.decode-1360"><span class="linenos">1360</span></a><span class="sd">        :class:`dict`. To use a different :class:`MutableMapping` class,</span>
</span><span id="BSON.decode-1361"><a href="#BSON.decode-1361"><span class="linenos">1361</span></a><span class="sd">        configure a :class:`~bson.codec_options.CodecOptions`::</span>
</span><span id="BSON.decode-1362"><a href="#BSON.decode-1362"><span class="linenos">1362</span></a>
</span><span id="BSON.decode-1363"><a href="#BSON.decode-1363"><span class="linenos">1363</span></a><span class="sd">            &gt;&gt;&gt; import collections  # From Python standard library.</span>
</span><span id="BSON.decode-1364"><a href="#BSON.decode-1364"><span class="linenos">1364</span></a><span class="sd">            &gt;&gt;&gt; import bson</span>
</span><span id="BSON.decode-1365"><a href="#BSON.decode-1365"><span class="linenos">1365</span></a><span class="sd">            &gt;&gt;&gt; from .codec_options import CodecOptions</span>
</span><span id="BSON.decode-1366"><a href="#BSON.decode-1366"><span class="linenos">1366</span></a><span class="sd">            &gt;&gt;&gt; data = bson.BSON.encode({&#39;a&#39;: 1})</span>
</span><span id="BSON.decode-1367"><a href="#BSON.decode-1367"><span class="linenos">1367</span></a><span class="sd">            &gt;&gt;&gt; decoded_doc = bson.BSON(data).decode()</span>
</span><span id="BSON.decode-1368"><a href="#BSON.decode-1368"><span class="linenos">1368</span></a><span class="sd">            &lt;type &#39;dict&#39;&gt;</span>
</span><span id="BSON.decode-1369"><a href="#BSON.decode-1369"><span class="linenos">1369</span></a><span class="sd">            &gt;&gt;&gt; options = CodecOptions(document_class=collections.OrderedDict)</span>
</span><span id="BSON.decode-1370"><a href="#BSON.decode-1370"><span class="linenos">1370</span></a><span class="sd">            &gt;&gt;&gt; decoded_doc = bson.BSON(data).decode(codec_options=options)</span>
</span><span id="BSON.decode-1371"><a href="#BSON.decode-1371"><span class="linenos">1371</span></a><span class="sd">            &gt;&gt;&gt; type(decoded_doc)</span>
</span><span id="BSON.decode-1372"><a href="#BSON.decode-1372"><span class="linenos">1372</span></a><span class="sd">            &lt;class &#39;collections.OrderedDict&#39;&gt;</span>
</span><span id="BSON.decode-1373"><a href="#BSON.decode-1373"><span class="linenos">1373</span></a>
</span><span id="BSON.decode-1374"><a href="#BSON.decode-1374"><span class="linenos">1374</span></a><span class="sd">        :Parameters:</span>
</span><span id="BSON.decode-1375"><a href="#BSON.decode-1375"><span class="linenos">1375</span></a><span class="sd">          - `codec_options` (optional): An instance of</span>
</span><span id="BSON.decode-1376"><a href="#BSON.decode-1376"><span class="linenos">1376</span></a><span class="sd">            :class:`~bson.codec_options.CodecOptions`.</span>
</span><span id="BSON.decode-1377"><a href="#BSON.decode-1377"><span class="linenos">1377</span></a>
</span><span id="BSON.decode-1378"><a href="#BSON.decode-1378"><span class="linenos">1378</span></a><span class="sd">        .. versionchanged:: 3.0</span>
</span><span id="BSON.decode-1379"><a href="#BSON.decode-1379"><span class="linenos">1379</span></a><span class="sd">           Removed `compile_re` option: PyMongo now always represents BSON</span>
</span><span id="BSON.decode-1380"><a href="#BSON.decode-1380"><span class="linenos">1380</span></a><span class="sd">           regular expressions as :class:`~bson.regex.Regex` objects. Use</span>
</span><span id="BSON.decode-1381"><a href="#BSON.decode-1381"><span class="linenos">1381</span></a><span class="sd">           :meth:`~bson.regex.Regex.try_compile` to attempt to convert from a</span>
</span><span id="BSON.decode-1382"><a href="#BSON.decode-1382"><span class="linenos">1382</span></a><span class="sd">           BSON regular expression to a Python regular expression object.</span>
</span><span id="BSON.decode-1383"><a href="#BSON.decode-1383"><span class="linenos">1383</span></a>
</span><span id="BSON.decode-1384"><a href="#BSON.decode-1384"><span class="linenos">1384</span></a><span class="sd">           Replaced `as_class`, `tz_aware`, and `uuid_subtype` options with</span>
</span><span id="BSON.decode-1385"><a href="#BSON.decode-1385"><span class="linenos">1385</span></a><span class="sd">           `codec_options`.</span>
</span><span id="BSON.decode-1386"><a href="#BSON.decode-1386"><span class="linenos">1386</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="BSON.decode-1387"><a href="#BSON.decode-1387"><span class="linenos">1387</span></a>        <span class="k">return</span> <span class="n">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Decode this BSON data.</p>

<p>By default, returns a BSON document represented as a Python
<code>dict</code>. To use a different <code>MutableMapping</code> class,
configure a <code>~bson.codec_options.CodecOptions</code>::</p>

<pre><code>&gt;&gt;&gt; import collections  # From Python standard library.
&gt;&gt;&gt; import bson
&gt;&gt;&gt; from .codec_options import CodecOptions
&gt;&gt;&gt; data = bson.BSON.encode({'a': 1})
&gt;&gt;&gt; decoded_doc = bson.BSON(data).decode()
&lt;type 'dict'&gt;
&gt;&gt;&gt; options = CodecOptions(document_class=collections.OrderedDict)
&gt;&gt;&gt; decoded_doc = bson.BSON(data).decode(codec_options=options)
&gt;&gt;&gt; type(decoded_doc)
&lt;class 'collections.OrderedDict'&gt;
</code></pre>

<p>:Parameters:</p>

<ul>
<li><code>codec_options</code> (optional): An instance of
<code>~bson.codec_options.CodecOptions</code>.</li>
</ul>

<p><em>Changed in version 3.0:</em>
Removed <code>compile_re</code> option: PyMongo now always represents BSON
regular expressions as <code>~bson.regex.Regex</code> objects. Use
<code>~bson.regex.Regex.try_compile()</code> to attempt to convert from a
BSON regular expression to a Python regular expression object.</p>

<p>Replaced <code>as_class</code>, <code>tz_aware</code>, and <code>uuid_subtype</code> options with
<code>codec_options</code>.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.bytes</dt>
                                <dd id="BSON.capitalize" class="function">capitalize</dd>
                <dd id="BSON.center" class="function">center</dd>
                <dd id="BSON.count" class="function">count</dd>
                <dd id="BSON.endswith" class="function">endswith</dd>
                <dd id="BSON.expandtabs" class="function">expandtabs</dd>
                <dd id="BSON.find" class="function">find</dd>
                <dd id="BSON.fromhex" class="function">fromhex</dd>
                <dd id="BSON.hex" class="function">hex</dd>
                <dd id="BSON.index" class="function">index</dd>
                <dd id="BSON.isalnum" class="function">isalnum</dd>
                <dd id="BSON.isalpha" class="function">isalpha</dd>
                <dd id="BSON.isascii" class="function">isascii</dd>
                <dd id="BSON.isdigit" class="function">isdigit</dd>
                <dd id="BSON.islower" class="function">islower</dd>
                <dd id="BSON.isspace" class="function">isspace</dd>
                <dd id="BSON.istitle" class="function">istitle</dd>
                <dd id="BSON.isupper" class="function">isupper</dd>
                <dd id="BSON.join" class="function">join</dd>
                <dd id="BSON.ljust" class="function">ljust</dd>
                <dd id="BSON.lower" class="function">lower</dd>
                <dd id="BSON.lstrip" class="function">lstrip</dd>
                <dd id="BSON.maketrans" class="function">maketrans</dd>
                <dd id="BSON.partition" class="function">partition</dd>
                <dd id="BSON.replace" class="function">replace</dd>
                <dd id="BSON.removeprefix" class="function">removeprefix</dd>
                <dd id="BSON.removesuffix" class="function">removesuffix</dd>
                <dd id="BSON.rfind" class="function">rfind</dd>
                <dd id="BSON.rindex" class="function">rindex</dd>
                <dd id="BSON.rjust" class="function">rjust</dd>
                <dd id="BSON.rpartition" class="function">rpartition</dd>
                <dd id="BSON.rsplit" class="function">rsplit</dd>
                <dd id="BSON.rstrip" class="function">rstrip</dd>
                <dd id="BSON.split" class="function">split</dd>
                <dd id="BSON.splitlines" class="function">splitlines</dd>
                <dd id="BSON.startswith" class="function">startswith</dd>
                <dd id="BSON.strip" class="function">strip</dd>
                <dd id="BSON.swapcase" class="function">swapcase</dd>
                <dd id="BSON.title" class="function">title</dd>
                <dd id="BSON.translate" class="function">translate</dd>
                <dd id="BSON.upper" class="function">upper</dd>
                <dd id="BSON.zfill" class="function">zfill</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="has_c">
                            <input id="has_c-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">has_c</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="has_c-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#has_c"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="has_c-1390"><a href="#has_c-1390"><span class="linenos">1390</span></a><span class="k">def</span> <span class="nf">has_c</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="has_c-1391"><a href="#has_c-1391"><span class="linenos">1391</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Is the C extension installed?&quot;&quot;&quot;</span>
</span><span id="has_c-1392"><a href="#has_c-1392"><span class="linenos">1392</span></a>    <span class="k">return</span> <span class="n">_USE_C</span>
</span></pre></div>


            <div class="docstring"><p>Is the C extension installed?</p>
</div>


                </section>
                <section id="DatetimeConversion">
                            <input id="DatetimeConversion-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DatetimeConversion</span><wbr>(<span class="base">builtins.int</span>, <span class="base">enum.Enum</span>):

                <label class="view-source-button" for="DatetimeConversion-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DatetimeConversion"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatetimeConversion-203"><a href="#DatetimeConversion-203"><span class="linenos">203</span></a><span class="k">class</span> <span class="nc">DatetimeConversion</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">enum</span><span class="o">.</span><span class="n">Enum</span><span class="p">):</span>
</span><span id="DatetimeConversion-204"><a href="#DatetimeConversion-204"><span class="linenos">204</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Options for decoding BSON datetimes.&quot;&quot;&quot;</span>
</span><span id="DatetimeConversion-205"><a href="#DatetimeConversion-205"><span class="linenos">205</span></a>
</span><span id="DatetimeConversion-206"><a href="#DatetimeConversion-206"><span class="linenos">206</span></a>    <span class="n">DATETIME</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="DatetimeConversion-207"><a href="#DatetimeConversion-207"><span class="linenos">207</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON UTC datetime as a :class:`datetime.datetime`.</span>
</span><span id="DatetimeConversion-208"><a href="#DatetimeConversion-208"><span class="linenos">208</span></a>
</span><span id="DatetimeConversion-209"><a href="#DatetimeConversion-209"><span class="linenos">209</span></a><span class="sd">    BSON UTC datetimes that cannot be represented as a</span>
</span><span id="DatetimeConversion-210"><a href="#DatetimeConversion-210"><span class="linenos">210</span></a><span class="sd">    :class:`~datetime.datetime` will raise an :class:`OverflowError`</span>
</span><span id="DatetimeConversion-211"><a href="#DatetimeConversion-211"><span class="linenos">211</span></a><span class="sd">    or a :class:`ValueError`.</span>
</span><span id="DatetimeConversion-212"><a href="#DatetimeConversion-212"><span class="linenos">212</span></a>
</span><span id="DatetimeConversion-213"><a href="#DatetimeConversion-213"><span class="linenos">213</span></a><span class="sd">    .. versionadded 4.3</span>
</span><span id="DatetimeConversion-214"><a href="#DatetimeConversion-214"><span class="linenos">214</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DatetimeConversion-215"><a href="#DatetimeConversion-215"><span class="linenos">215</span></a>
</span><span id="DatetimeConversion-216"><a href="#DatetimeConversion-216"><span class="linenos">216</span></a>    <span class="n">DATETIME_CLAMP</span> <span class="o">=</span> <span class="mi">2</span>
</span><span id="DatetimeConversion-217"><a href="#DatetimeConversion-217"><span class="linenos">217</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON UTC datetime as a :class:`datetime.datetime`, clamping</span>
</span><span id="DatetimeConversion-218"><a href="#DatetimeConversion-218"><span class="linenos">218</span></a><span class="sd">    to :attr:`~datetime.datetime.min` and :attr:`~datetime.datetime.max`.</span>
</span><span id="DatetimeConversion-219"><a href="#DatetimeConversion-219"><span class="linenos">219</span></a>
</span><span id="DatetimeConversion-220"><a href="#DatetimeConversion-220"><span class="linenos">220</span></a><span class="sd">    .. versionadded 4.3</span>
</span><span id="DatetimeConversion-221"><a href="#DatetimeConversion-221"><span class="linenos">221</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DatetimeConversion-222"><a href="#DatetimeConversion-222"><span class="linenos">222</span></a>
</span><span id="DatetimeConversion-223"><a href="#DatetimeConversion-223"><span class="linenos">223</span></a>    <span class="n">DATETIME_MS</span> <span class="o">=</span> <span class="mi">3</span>
</span><span id="DatetimeConversion-224"><a href="#DatetimeConversion-224"><span class="linenos">224</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON UTC datetime as a :class:`~bson.datetime_ms.DatetimeMS`</span>
</span><span id="DatetimeConversion-225"><a href="#DatetimeConversion-225"><span class="linenos">225</span></a><span class="sd">    object.</span>
</span><span id="DatetimeConversion-226"><a href="#DatetimeConversion-226"><span class="linenos">226</span></a>
</span><span id="DatetimeConversion-227"><a href="#DatetimeConversion-227"><span class="linenos">227</span></a><span class="sd">    .. versionadded 4.3</span>
</span><span id="DatetimeConversion-228"><a href="#DatetimeConversion-228"><span class="linenos">228</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="DatetimeConversion-229"><a href="#DatetimeConversion-229"><span class="linenos">229</span></a>
</span><span id="DatetimeConversion-230"><a href="#DatetimeConversion-230"><span class="linenos">230</span></a>    <span class="n">DATETIME_AUTO</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="DatetimeConversion-231"><a href="#DatetimeConversion-231"><span class="linenos">231</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode a BSON UTC datetime as a :class:`datetime.datetime` if possible,</span>
</span><span id="DatetimeConversion-232"><a href="#DatetimeConversion-232"><span class="linenos">232</span></a><span class="sd">    and a :class:`~bson.datetime_ms.DatetimeMS` if not.</span>
</span><span id="DatetimeConversion-233"><a href="#DatetimeConversion-233"><span class="linenos">233</span></a>
</span><span id="DatetimeConversion-234"><a href="#DatetimeConversion-234"><span class="linenos">234</span></a><span class="sd">    .. versionadded 4.3</span>
</span><span id="DatetimeConversion-235"><a href="#DatetimeConversion-235"><span class="linenos">235</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Options for decoding BSON datetimes.</p>
</div>


                            <div id="DatetimeConversion.DATETIME" class="classattr">
                                <div class="attr variable">
            <span class="name">DATETIME</span>        =
<span class="default_value">&lt;<a href="#DatetimeConversion.DATETIME">DatetimeConversion.DATETIME</a>: 1&gt;</span>

        
    </div>
    <a class="headerlink" href="#DatetimeConversion.DATETIME"></a>
    
            <div class="docstring"><p>Decode a BSON UTC datetime as a <code>datetime.datetime</code>.</p>

<p>BSON UTC datetimes that cannot be represented as a
<code>~datetime.datetime</code> will raise an <code>OverflowError</code>
or a <code>ValueError</code>.</p>

<p>.. versionadded 4.3</p>
</div>


                            </div>
                            <div id="DatetimeConversion.DATETIME_CLAMP" class="classattr">
                                <div class="attr variable">
            <span class="name">DATETIME_CLAMP</span>        =
<span class="default_value">&lt;<a href="#DatetimeConversion.DATETIME_CLAMP">DatetimeConversion.DATETIME_CLAMP</a>: 2&gt;</span>

        
    </div>
    <a class="headerlink" href="#DatetimeConversion.DATETIME_CLAMP"></a>
    
            <div class="docstring"><p>Decode a BSON UTC datetime as a <code>datetime.datetime</code>, clamping
to <code>~datetime.datetime.min</code> and <code>~datetime.datetime.max</code>.</p>

<p>.. versionadded 4.3</p>
</div>


                            </div>
                            <div id="DatetimeConversion.DATETIME_MS" class="classattr">
                                <div class="attr variable">
            <span class="name">DATETIME_MS</span>        =
<span class="default_value">&lt;<a href="#DatetimeConversion.DATETIME_MS">DatetimeConversion.DATETIME_MS</a>: 3&gt;</span>

        
    </div>
    <a class="headerlink" href="#DatetimeConversion.DATETIME_MS"></a>
    
            <div class="docstring"><p>Decode a BSON UTC datetime as a <code>~bson.datetime_ms.DatetimeMS</code>
object.</p>

<p>.. versionadded 4.3</p>
</div>


                            </div>
                            <div id="DatetimeConversion.DATETIME_AUTO" class="classattr">
                                <div class="attr variable">
            <span class="name">DATETIME_AUTO</span>        =
<span class="default_value">&lt;<a href="#DatetimeConversion.DATETIME_AUTO">DatetimeConversion.DATETIME_AUTO</a>: 4&gt;</span>

        
    </div>
    <a class="headerlink" href="#DatetimeConversion.DATETIME_AUTO"></a>
    
            <div class="docstring"><p>Decode a BSON UTC datetime as a <code>datetime.datetime</code> if possible,
and a <code>~bson.datetime_ms.DatetimeMS</code> if not.</p>

<p>.. versionadded 4.3</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>enum.Enum</dt>
                                <dd id="DatetimeConversion.name" class="variable">name</dd>
                <dd id="DatetimeConversion.value" class="variable">value</dd>

            </div>
            <div><dt>builtins.int</dt>
                                <dd id="DatetimeConversion.conjugate" class="function">conjugate</dd>
                <dd id="DatetimeConversion.bit_length" class="function">bit_length</dd>
                <dd id="DatetimeConversion.bit_count" class="function">bit_count</dd>
                <dd id="DatetimeConversion.to_bytes" class="function">to_bytes</dd>
                <dd id="DatetimeConversion.from_bytes" class="function">from_bytes</dd>
                <dd id="DatetimeConversion.as_integer_ratio" class="function">as_integer_ratio</dd>
                <dd id="DatetimeConversion.real" class="variable">real</dd>
                <dd id="DatetimeConversion.imag" class="variable">imag</dd>
                <dd id="DatetimeConversion.numerator" class="variable">numerator</dd>
                <dd id="DatetimeConversion.denominator" class="variable">denominator</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="DatetimeMS">
                            <input id="DatetimeMS-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DatetimeMS</span>:

                <label class="view-source-button" for="DatetimeMS-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DatetimeMS"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatetimeMS-33"><a href="#DatetimeMS-33"><span class="linenos"> 33</span></a><span class="k">class</span> <span class="nc">DatetimeMS</span><span class="p">:</span>
</span><span id="DatetimeMS-34"><a href="#DatetimeMS-34"><span class="linenos"> 34</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Represents a BSON UTC datetime.&quot;&quot;&quot;</span>
</span><span id="DatetimeMS-35"><a href="#DatetimeMS-35"><span class="linenos"> 35</span></a>
</span><span id="DatetimeMS-36"><a href="#DatetimeMS-36"><span class="linenos"> 36</span></a>    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;_value&quot;</span><span class="p">,)</span>
</span><span id="DatetimeMS-37"><a href="#DatetimeMS-37"><span class="linenos"> 37</span></a>
</span><span id="DatetimeMS-38"><a href="#DatetimeMS-38"><span class="linenos"> 38</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]):</span>
</span><span id="DatetimeMS-39"><a href="#DatetimeMS-39"><span class="linenos"> 39</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Represents a BSON UTC datetime.</span>
</span><span id="DatetimeMS-40"><a href="#DatetimeMS-40"><span class="linenos"> 40</span></a>
</span><span id="DatetimeMS-41"><a href="#DatetimeMS-41"><span class="linenos"> 41</span></a><span class="sd">        BSON UTC datetimes are defined as an int64 of milliseconds since the</span>
</span><span id="DatetimeMS-42"><a href="#DatetimeMS-42"><span class="linenos"> 42</span></a><span class="sd">        Unix epoch. The principal use of DatetimeMS is to represent</span>
</span><span id="DatetimeMS-43"><a href="#DatetimeMS-43"><span class="linenos"> 43</span></a><span class="sd">        datetimes outside the range of the Python builtin</span>
</span><span id="DatetimeMS-44"><a href="#DatetimeMS-44"><span class="linenos"> 44</span></a><span class="sd">        :class:`~datetime.datetime` class when</span>
</span><span id="DatetimeMS-45"><a href="#DatetimeMS-45"><span class="linenos"> 45</span></a><span class="sd">        encoding/decoding BSON.</span>
</span><span id="DatetimeMS-46"><a href="#DatetimeMS-46"><span class="linenos"> 46</span></a>
</span><span id="DatetimeMS-47"><a href="#DatetimeMS-47"><span class="linenos"> 47</span></a><span class="sd">        To decode UTC datetimes as a ``DatetimeMS``, `datetime_conversion` in</span>
</span><span id="DatetimeMS-48"><a href="#DatetimeMS-48"><span class="linenos"> 48</span></a><span class="sd">        :class:`~bson.CodecOptions` must be set to &#39;datetime_ms&#39; or</span>
</span><span id="DatetimeMS-49"><a href="#DatetimeMS-49"><span class="linenos"> 49</span></a><span class="sd">        &#39;datetime_auto&#39;. See :ref:`handling-out-of-range-datetimes` for</span>
</span><span id="DatetimeMS-50"><a href="#DatetimeMS-50"><span class="linenos"> 50</span></a><span class="sd">        details.</span>
</span><span id="DatetimeMS-51"><a href="#DatetimeMS-51"><span class="linenos"> 51</span></a>
</span><span id="DatetimeMS-52"><a href="#DatetimeMS-52"><span class="linenos"> 52</span></a><span class="sd">        :Parameters:</span>
</span><span id="DatetimeMS-53"><a href="#DatetimeMS-53"><span class="linenos"> 53</span></a><span class="sd">          - `value`: An instance of :class:`datetime.datetime` to be</span>
</span><span id="DatetimeMS-54"><a href="#DatetimeMS-54"><span class="linenos"> 54</span></a><span class="sd">            represented as milliseconds since the Unix epoch, or int of</span>
</span><span id="DatetimeMS-55"><a href="#DatetimeMS-55"><span class="linenos"> 55</span></a><span class="sd">            milliseconds since the Unix epoch.</span>
</span><span id="DatetimeMS-56"><a href="#DatetimeMS-56"><span class="linenos"> 56</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatetimeMS-57"><a href="#DatetimeMS-57"><span class="linenos"> 57</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="DatetimeMS-58"><a href="#DatetimeMS-58"><span class="linenos"> 58</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">63</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">63</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="DatetimeMS-59"><a href="#DatetimeMS-59"><span class="linenos"> 59</span></a>                <span class="k">raise</span> <span class="ne">OverflowError</span><span class="p">(</span><span class="s2">&quot;Must be a 64-bit integer of milliseconds&quot;</span><span class="p">)</span>
</span><span id="DatetimeMS-60"><a href="#DatetimeMS-60"><span class="linenos"> 60</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="DatetimeMS-61"><a href="#DatetimeMS-61"><span class="linenos"> 61</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
</span><span id="DatetimeMS-62"><a href="#DatetimeMS-62"><span class="linenos"> 62</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">_datetime_to_millis</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="DatetimeMS-63"><a href="#DatetimeMS-63"><span class="linenos"> 63</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DatetimeMS-64"><a href="#DatetimeMS-64"><span class="linenos"> 64</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not a valid type for DatetimeMS&quot;</span><span class="p">)</span>
</span><span id="DatetimeMS-65"><a href="#DatetimeMS-65"><span class="linenos"> 65</span></a>
</span><span id="DatetimeMS-66"><a href="#DatetimeMS-66"><span class="linenos"> 66</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="DatetimeMS-67"><a href="#DatetimeMS-67"><span class="linenos"> 67</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span>
</span><span id="DatetimeMS-68"><a href="#DatetimeMS-68"><span class="linenos"> 68</span></a>
</span><span id="DatetimeMS-69"><a href="#DatetimeMS-69"><span class="linenos"> 69</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="DatetimeMS-70"><a href="#DatetimeMS-70"><span class="linenos"> 70</span></a>        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
</span><span id="DatetimeMS-71"><a href="#DatetimeMS-71"><span class="linenos"> 71</span></a>
</span><span id="DatetimeMS-72"><a href="#DatetimeMS-72"><span class="linenos"> 72</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;DatetimeMS&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="DatetimeMS-73"><a href="#DatetimeMS-73"><span class="linenos"> 73</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">&lt;</span> <span class="n">other</span>
</span><span id="DatetimeMS-74"><a href="#DatetimeMS-74"><span class="linenos"> 74</span></a>
</span><span id="DatetimeMS-75"><a href="#DatetimeMS-75"><span class="linenos"> 75</span></a>    <span class="k">def</span> <span class="fm">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;DatetimeMS&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="DatetimeMS-76"><a href="#DatetimeMS-76"><span class="linenos"> 76</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">&lt;=</span> <span class="n">other</span>
</span><span id="DatetimeMS-77"><a href="#DatetimeMS-77"><span class="linenos"> 77</span></a>
</span><span id="DatetimeMS-78"><a href="#DatetimeMS-78"><span class="linenos"> 78</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="DatetimeMS-79"><a href="#DatetimeMS-79"><span class="linenos"> 79</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DatetimeMS</span><span class="p">):</span>
</span><span id="DatetimeMS-80"><a href="#DatetimeMS-80"><span class="linenos"> 80</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">_value</span>
</span><span id="DatetimeMS-81"><a href="#DatetimeMS-81"><span class="linenos"> 81</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="DatetimeMS-82"><a href="#DatetimeMS-82"><span class="linenos"> 82</span></a>
</span><span id="DatetimeMS-83"><a href="#DatetimeMS-83"><span class="linenos"> 83</span></a>    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="DatetimeMS-84"><a href="#DatetimeMS-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DatetimeMS</span><span class="p">):</span>
</span><span id="DatetimeMS-85"><a href="#DatetimeMS-85"><span class="linenos"> 85</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">_value</span>
</span><span id="DatetimeMS-86"><a href="#DatetimeMS-86"><span class="linenos"> 86</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="DatetimeMS-87"><a href="#DatetimeMS-87"><span class="linenos"> 87</span></a>
</span><span id="DatetimeMS-88"><a href="#DatetimeMS-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="fm">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;DatetimeMS&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="DatetimeMS-89"><a href="#DatetimeMS-89"><span class="linenos"> 89</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">&gt;</span> <span class="n">other</span>
</span><span id="DatetimeMS-90"><a href="#DatetimeMS-90"><span class="linenos"> 90</span></a>
</span><span id="DatetimeMS-91"><a href="#DatetimeMS-91"><span class="linenos"> 91</span></a>    <span class="k">def</span> <span class="fm">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;DatetimeMS&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="DatetimeMS-92"><a href="#DatetimeMS-92"><span class="linenos"> 92</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">&gt;=</span> <span class="n">other</span>
</span><span id="DatetimeMS-93"><a href="#DatetimeMS-93"><span class="linenos"> 93</span></a>
</span><span id="DatetimeMS-94"><a href="#DatetimeMS-94"><span class="linenos"> 94</span></a>    <span class="n">_type_marker</span> <span class="o">=</span> <span class="mi">9</span>
</span><span id="DatetimeMS-95"><a href="#DatetimeMS-95"><span class="linenos"> 95</span></a>
</span><span id="DatetimeMS-96"><a href="#DatetimeMS-96"><span class="linenos"> 96</span></a>    <span class="k">def</span> <span class="nf">as_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">:</span> <span class="n">CodecOptions</span> <span class="o">=</span> <span class="n">DEFAULT_CODEC_OPTIONS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
</span><span id="DatetimeMS-97"><a href="#DatetimeMS-97"><span class="linenos"> 97</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Python :class:`~datetime.datetime` from this DatetimeMS object.</span>
</span><span id="DatetimeMS-98"><a href="#DatetimeMS-98"><span class="linenos"> 98</span></a>
</span><span id="DatetimeMS-99"><a href="#DatetimeMS-99"><span class="linenos"> 99</span></a><span class="sd">        :Parameters:</span>
</span><span id="DatetimeMS-100"><a href="#DatetimeMS-100"><span class="linenos">100</span></a><span class="sd">          - `codec_options`: A CodecOptions instance for specifying how the</span>
</span><span id="DatetimeMS-101"><a href="#DatetimeMS-101"><span class="linenos">101</span></a><span class="sd">            resulting DatetimeMS object will be formatted using ``tz_aware``</span>
</span><span id="DatetimeMS-102"><a href="#DatetimeMS-102"><span class="linenos">102</span></a><span class="sd">            and ``tz_info``. Defaults to</span>
</span><span id="DatetimeMS-103"><a href="#DatetimeMS-103"><span class="linenos">103</span></a><span class="sd">            :const:`~bson.codec_options.DEFAULT_CODEC_OPTIONS`.</span>
</span><span id="DatetimeMS-104"><a href="#DatetimeMS-104"><span class="linenos">104</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatetimeMS-105"><a href="#DatetimeMS-105"><span class="linenos">105</span></a>        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">_millis_to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">))</span>
</span><span id="DatetimeMS-106"><a href="#DatetimeMS-106"><span class="linenos">106</span></a>
</span><span id="DatetimeMS-107"><a href="#DatetimeMS-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="fm">__int__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="DatetimeMS-108"><a href="#DatetimeMS-108"><span class="linenos">108</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>
</span></pre></div>


            <div class="docstring"><p>Represents a BSON UTC datetime.</p>
</div>


                            <div id="DatetimeMS.__init__" class="classattr">
                                        <input id="DatetimeMS.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">DatetimeMS</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]</span></span>)</span>

                <label class="view-source-button" for="DatetimeMS.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DatetimeMS.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatetimeMS.__init__-38"><a href="#DatetimeMS.__init__-38"><span class="linenos">38</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">]):</span>
</span><span id="DatetimeMS.__init__-39"><a href="#DatetimeMS.__init__-39"><span class="linenos">39</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Represents a BSON UTC datetime.</span>
</span><span id="DatetimeMS.__init__-40"><a href="#DatetimeMS.__init__-40"><span class="linenos">40</span></a>
</span><span id="DatetimeMS.__init__-41"><a href="#DatetimeMS.__init__-41"><span class="linenos">41</span></a><span class="sd">        BSON UTC datetimes are defined as an int64 of milliseconds since the</span>
</span><span id="DatetimeMS.__init__-42"><a href="#DatetimeMS.__init__-42"><span class="linenos">42</span></a><span class="sd">        Unix epoch. The principal use of DatetimeMS is to represent</span>
</span><span id="DatetimeMS.__init__-43"><a href="#DatetimeMS.__init__-43"><span class="linenos">43</span></a><span class="sd">        datetimes outside the range of the Python builtin</span>
</span><span id="DatetimeMS.__init__-44"><a href="#DatetimeMS.__init__-44"><span class="linenos">44</span></a><span class="sd">        :class:`~datetime.datetime` class when</span>
</span><span id="DatetimeMS.__init__-45"><a href="#DatetimeMS.__init__-45"><span class="linenos">45</span></a><span class="sd">        encoding/decoding BSON.</span>
</span><span id="DatetimeMS.__init__-46"><a href="#DatetimeMS.__init__-46"><span class="linenos">46</span></a>
</span><span id="DatetimeMS.__init__-47"><a href="#DatetimeMS.__init__-47"><span class="linenos">47</span></a><span class="sd">        To decode UTC datetimes as a ``DatetimeMS``, `datetime_conversion` in</span>
</span><span id="DatetimeMS.__init__-48"><a href="#DatetimeMS.__init__-48"><span class="linenos">48</span></a><span class="sd">        :class:`~bson.CodecOptions` must be set to &#39;datetime_ms&#39; or</span>
</span><span id="DatetimeMS.__init__-49"><a href="#DatetimeMS.__init__-49"><span class="linenos">49</span></a><span class="sd">        &#39;datetime_auto&#39;. See :ref:`handling-out-of-range-datetimes` for</span>
</span><span id="DatetimeMS.__init__-50"><a href="#DatetimeMS.__init__-50"><span class="linenos">50</span></a><span class="sd">        details.</span>
</span><span id="DatetimeMS.__init__-51"><a href="#DatetimeMS.__init__-51"><span class="linenos">51</span></a>
</span><span id="DatetimeMS.__init__-52"><a href="#DatetimeMS.__init__-52"><span class="linenos">52</span></a><span class="sd">        :Parameters:</span>
</span><span id="DatetimeMS.__init__-53"><a href="#DatetimeMS.__init__-53"><span class="linenos">53</span></a><span class="sd">          - `value`: An instance of :class:`datetime.datetime` to be</span>
</span><span id="DatetimeMS.__init__-54"><a href="#DatetimeMS.__init__-54"><span class="linenos">54</span></a><span class="sd">            represented as milliseconds since the Unix epoch, or int of</span>
</span><span id="DatetimeMS.__init__-55"><a href="#DatetimeMS.__init__-55"><span class="linenos">55</span></a><span class="sd">            milliseconds since the Unix epoch.</span>
</span><span id="DatetimeMS.__init__-56"><a href="#DatetimeMS.__init__-56"><span class="linenos">56</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatetimeMS.__init__-57"><a href="#DatetimeMS.__init__-57"><span class="linenos">57</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="DatetimeMS.__init__-58"><a href="#DatetimeMS.__init__-58"><span class="linenos">58</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">63</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">63</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="DatetimeMS.__init__-59"><a href="#DatetimeMS.__init__-59"><span class="linenos">59</span></a>                <span class="k">raise</span> <span class="ne">OverflowError</span><span class="p">(</span><span class="s2">&quot;Must be a 64-bit integer of milliseconds&quot;</span><span class="p">)</span>
</span><span id="DatetimeMS.__init__-60"><a href="#DatetimeMS.__init__-60"><span class="linenos">60</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="DatetimeMS.__init__-61"><a href="#DatetimeMS.__init__-61"><span class="linenos">61</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">):</span>
</span><span id="DatetimeMS.__init__-62"><a href="#DatetimeMS.__init__-62"><span class="linenos">62</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">_datetime_to_millis</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="DatetimeMS.__init__-63"><a href="#DatetimeMS.__init__-63"><span class="linenos">63</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="DatetimeMS.__init__-64"><a href="#DatetimeMS.__init__-64"><span class="linenos">64</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2"> is not a valid type for DatetimeMS&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Represents a BSON UTC datetime.</p>

<p>BSON UTC datetimes are defined as an int64 of milliseconds since the
Unix epoch. The principal use of DatetimeMS is to represent
datetimes outside the range of the Python builtin
<code>~datetime.datetime</code> class when
encoding/decoding BSON.</p>

<p>To decode UTC datetimes as a <code><a href="#DatetimeMS">DatetimeMS</a></code>, <code>datetime_conversion</code> in
<code>~bson.CodecOptions</code> must be set to 'datetime_ms' or
'datetime_auto'. See :ref:<code>handling-out-of-range-datetimes</code> for
details.</p>

<p>:Parameters:</p>

<ul>
<li><code>value</code>: An instance of <code>datetime.datetime</code> to be
represented as milliseconds since the Unix epoch, or int of
milliseconds since the Unix epoch.</li>
</ul>
</div>


                            </div>
                            <div id="DatetimeMS.as_datetime" class="classattr">
                                        <input id="DatetimeMS.as_datetime-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">as_datetime</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">codec_options</span><span class="p">:</span> <span class="n"><a href="#CodecOptions">xtquant.xtbson.bson37.CodecOptions</a></span> <span class="o">=</span> <span class="n">CodecOptions</span><span class="p">(</span><span class="n">document_class</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span> <span class="n">tz_aware</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">uuid_representation</span><span class="o">=</span><span class="n"><a href="#UuidRepresentation.UNSPECIFIED">UuidRepresentation.UNSPECIFIED</a></span><span class="p">,</span> <span class="n">unicode_decode_error_handler</span><span class="o">=</span><span class="s1">&#39;strict&#39;</span><span class="p">,</span> <span class="n">tzinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">type_registry</span><span class="o">=</span><span class="n">TypeRegistry</span><span class="p">(</span><span class="n">type_codecs</span><span class="o">=</span><span class="p">[],</span> <span class="n">fallback_encoder</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span> <span class="n">datetime_conversion</span><span class="o">=</span><span class="n"><a href="#DatetimeConversion.DATETIME">DatetimeConversion.DATETIME</a></span><span class="p">)</span></span><span class="return-annotation">) -> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span>:</span></span>

                <label class="view-source-button" for="DatetimeMS.as_datetime-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DatetimeMS.as_datetime"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DatetimeMS.as_datetime-96"><a href="#DatetimeMS.as_datetime-96"><span class="linenos"> 96</span></a>    <span class="k">def</span> <span class="nf">as_datetime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">:</span> <span class="n">CodecOptions</span> <span class="o">=</span> <span class="n">DEFAULT_CODEC_OPTIONS</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">:</span>
</span><span id="DatetimeMS.as_datetime-97"><a href="#DatetimeMS.as_datetime-97"><span class="linenos"> 97</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a Python :class:`~datetime.datetime` from this DatetimeMS object.</span>
</span><span id="DatetimeMS.as_datetime-98"><a href="#DatetimeMS.as_datetime-98"><span class="linenos"> 98</span></a>
</span><span id="DatetimeMS.as_datetime-99"><a href="#DatetimeMS.as_datetime-99"><span class="linenos"> 99</span></a><span class="sd">        :Parameters:</span>
</span><span id="DatetimeMS.as_datetime-100"><a href="#DatetimeMS.as_datetime-100"><span class="linenos">100</span></a><span class="sd">          - `codec_options`: A CodecOptions instance for specifying how the</span>
</span><span id="DatetimeMS.as_datetime-101"><a href="#DatetimeMS.as_datetime-101"><span class="linenos">101</span></a><span class="sd">            resulting DatetimeMS object will be formatted using ``tz_aware``</span>
</span><span id="DatetimeMS.as_datetime-102"><a href="#DatetimeMS.as_datetime-102"><span class="linenos">102</span></a><span class="sd">            and ``tz_info``. Defaults to</span>
</span><span id="DatetimeMS.as_datetime-103"><a href="#DatetimeMS.as_datetime-103"><span class="linenos">103</span></a><span class="sd">            :const:`~bson.codec_options.DEFAULT_CODEC_OPTIONS`.</span>
</span><span id="DatetimeMS.as_datetime-104"><a href="#DatetimeMS.as_datetime-104"><span class="linenos">104</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="DatetimeMS.as_datetime-105"><a href="#DatetimeMS.as_datetime-105"><span class="linenos">105</span></a>        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">,</span> <span class="n">_millis_to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">codec_options</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Create a Python <code>~datetime.datetime</code> from this DatetimeMS object.</p>

<p>:Parameters:</p>

<ul>
<li><code>codec_options</code>: A CodecOptions instance for specifying how the
resulting DatetimeMS object will be formatted using <code>tz_aware</code>
and <code>tz_info</code>. Defaults to
<code>~bson.codec_options.DEFAULT_CODEC_OPTIONS</code>.</li>
</ul>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>